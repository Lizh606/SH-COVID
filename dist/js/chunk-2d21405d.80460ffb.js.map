{"version":3,"sources":["webpack:///./node_modules/@arcgis/core/views/3d/layers/PointCloudWorker.js"],"names":["p","e","a","this","_transform","o","points","buffer","rgb","pointIdFilterMap","push","t","attributes","values","Promise","resolve","result","transferList","r","schema","geometryBuffer","length","f","s","primaryAttributeData","attributeInfo","i","modulationAttributeData","rendererInfo","filterInfo","filterAttributesData","map","Uint32Array","userAttributesData","Uint8Array","slice","_applyElevationOffsetInPlace","elevationOffset","c","_transformCoordinates","obb","fromJSON","inSR","outSR","n","u","Error","l","center","b","m","quaternion","Float32Array","halfSize","Math","max","abs","h"],"mappings":"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","file":"js/chunk-2d21405d.80460ffb.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{isArrayBuffer as r}from\"../../../core/typedArrayUtil.js\";import{c as e}from\"../../../chunks/quat.js\";import{b as a}from\"../../../chunks/quatf32.js\";import{q as o}from\"../../../chunks/vec3.js\";import{f,c as s}from\"../../../chunks/vec3f32.js\";import{projectBuffer as i}from\"../../../geometry/projection.js\";import n from\"../../../geometry/SpatialReference.js\";import{readGeometry as u,getAttributeValues as l,evaluateRenderer as b,filterInPlace as m}from\"./i3s/PointCloudWorkerUtil.js\";class p{transform(e){const a=this._transform(e),o=[a.points.buffer,a.rgb.buffer];t(a.pointIdFilterMap)&&o.push(a.pointIdFilterMap.buffer);for(const t of a.attributes)\"buffer\"in t.values&&r(t.values.buffer)&&t.values.buffer!==a.rgb.buffer&&o.push(t.values.buffer);return Promise.resolve({result:a,transferList:o})}_transform(r){const e=u(r.schema,r.geometryBuffer);let a=e.length/3,o=null;const f=[],s=l(r.primaryAttributeData,e,a);t(r.primaryAttributeData)&&s&&f.push({attributeInfo:r.primaryAttributeData.attributeInfo,values:s});const i=l(r.modulationAttributeData,e,a);t(r.modulationAttributeData)&&i&&f.push({attributeInfo:r.modulationAttributeData.attributeInfo,values:i});let p=b(r.rendererInfo,s,i,a);if(r.filterInfo&&r.filterInfo.length>0&&t(r.filterAttributesData)){const t=r.filterAttributesData.map((t=>{const r=l(t,e,a),o={attributeInfo:t.attributeInfo,values:r};return f.push(o),o}));o=new Uint32Array(a),a=m(e,p,o,r.filterInfo,t)}for(const t of r.userAttributesData){const r=l(t,e,a);f.push({attributeInfo:t.attributeInfo,values:r})}3*a<p.length&&(p=new Uint8Array(p.buffer.slice(0,3*a))),this._applyElevationOffsetInPlace(e,a,r.elevationOffset);const c=this._transformCoordinates(e,a,r.obb,n.fromJSON(r.inSR),n.fromJSON(r.outSR));return{obb:r.obb,points:c,rgb:p,attributes:f,pointIdFilterMap:o}}_transformCoordinates(t,r,a,n,u){if(!i(t,n,0,t,u,0,r))throw Error(\"Can't reproject\");const l=f(a.center[0],a.center[1],a.center[2]),b=s(),m=s();e(c,a.quaternion);const p=new Float32Array(3*r);for(let e=0;e<r;e++)b[0]=t[3*e]-l[0],b[1]=t[3*e+1]-l[1],b[2]=t[3*e+2]-l[2],o(m,b,c),a.halfSize[0]=Math.max(a.halfSize[0],Math.abs(m[0])),a.halfSize[1]=Math.max(a.halfSize[1],Math.abs(m[1])),a.halfSize[2]=Math.max(a.halfSize[2],Math.abs(m[2])),p[3*e]=b[0],p[3*e+1]=b[1],p[3*e+2]=b[2];return p}_applyElevationOffsetInPlace(t,r,e){if(0!==e)for(let a=0;a<r;a++)t[3*a+2]+=e}}const c=a();function h(){return new p}export{h as default};\n"],"sourceRoot":""}