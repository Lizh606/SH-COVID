{"version":3,"sources":["webpack:///./node_modules/@arcgis/core/views/2d/engine/BitmapContainer.js","webpack:///./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js","webpack:///./node_modules/@arcgis/core/views/2d/engine/ImageryBitmapSource.js","webpack:///./node_modules/@arcgis/core/views/2d/engine/webgl/Mesh2D.js","webpack:///./node_modules/@arcgis/core/views/2d/engine/webgl/ClippingInfo.js","webpack:///./node_modules/@arcgis/core/views/2d/engine/webgl/WGLContainer.js","webpack:///./node_modules/@arcgis/core/views/2d/layers/BaseDynamicLayerView2D.js","webpack:///./node_modules/@arcgis/core/views/2d/viewStateUtils.js","webpack:///./node_modules/@arcgis/core/views/2d/layers/support/ExportStrategy.js","webpack:///./node_modules/@arcgis/core/views/2d/engine/Bitmap.js"],"names":["t","this","children","some","e","blendFunction","s","registerRenderPass","name","brushes","bitmap","target","drawPhase","MAP","super","prepareRenderPasses","i","c","handles","add","r","doRefresh","dataChanged","catch","getLogger","declaredClass","error","prototype","pixelBlock","extent","originalPixelBlock","width","height","l","filter","getAsRGBA","o","createImageData","data","set","putImageData","renderedRasterPixels","Uint8Array","buffer","BYTES_PER_ELEMENT","y","n","x","coords","lengths","length","a","push","f","slice","h","_cache","vertices","indices","primitiveType","isMapSpace","fromScreenExtent","xmin","ymin","xmax","ymax","path","Uint32Array","Math","floor","geometry","type","fromPolygon","fromMapExtent","fromRect","m","u","toScreen","indexBuffer","dispose","vertexBuffers","createIndex","Object","keys","reduce","createVertex","parseFloat","_clip","stage","_handle","watch","_invalidate","ready","mesh","destroy","vao","_destroyGL","remove","size","_lastWidth","_lastHeight","_createMesh","getIndexBuffer","getVertexBuffers","dvs","requestRender","left","right","top","bottom","max","_createScreenRect","fromPath","fromGeometry","arguments","constructor","_clips","forEach","clips","_updateClippingInfo","createRenderParams","painter","globalOpacity","profiler","LABEL","HIGHLIGHT","computedOpacity","recordContainerStart","beforeRenderLayer","_clippingInfos","updateTransforms","state","renderChildren","compositeLayer","recordContainerEnd","_renderPasses","beforeRender","render","afterRender","requireFBO","requiresDedicatedFBO","clip","LABEL_ALPHA","DEBUG","setTransform","onAttach","onDetach","items","map","fromClipArea","strategy","update","notifyChange","_bitmapContainer","container","addChild","fetchSource","fetchBitmapData","bind","requestUpdate","removeChild","removeAllChildren","layer","fetchImage","updating","updateRequested","d","PI","rotation","abs","cos","sin","round","g","imageMaxWidth","imageMaxHeight","imageRotationSupported","imageNormalizationSupported","hidpi","_imagePromise","bitmaps","stationary","destroyed","spatialReference","pixelRatio","worldScreenWidth","valid","paddedViewState","center","_singleExport","resolution","min","_tiledExport","then","async","includes","fadeOut","fadeIn","visible","invalidateTexture","signal","p","_export","create","scales","scale","getTileCoverage","getTileBounds","Promise","all","S","document","createElement","getContext","_","pixelFormat","internalFormat","dataType","wrapMode","requestRenderOnSourceChangedEnabled","_textureInvalidated","stencilRef","coordScale","_height","_source","_width","source","_texture","sourceWidth","sourceHeight","HTMLImageElement","naturalHeight","naturalWidth","updateTexture","context","transforms","toScreenNoRotation","displayViewMat3","mips","descriptor","hasMipmap","generateMipmap","setSamplingMode","samplingMode","bindTexture","resize","getRenderedRasterPixels","setData"],"mappings":"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","file":"js/chunk-6b6e40df.d8abf272.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{brushes as e}from\"./brushes.js\";import{WGLDrawPhase as r}from\"./webgl/enums.js\";import s from\"./webgl/WGLContainer.js\";class t extends s{get requiresDedicatedFBO(){return this.children.some((e=>\"additive\"===e.blendFunction))}prepareRenderPasses(s){const t=s.registerRenderPass({name:\"bitmap\",brushes:[e.bitmap],target:()=>this.children,drawPhase:r.MAP});return[...super.prepareRenderPasses(s),t]}}export{t as BitmapContainer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Logger.js\";import{isAbortError as s}from\"../../core/promiseUtils.js\";import{on as o}from\"../../core/watchUtils.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";const i=i=>{let c=class extends i{initialize(){this.handles.add(o(this,\"layer\",\"refresh\",(r=>{this.doRefresh(r.dataChanged).catch((r=>{s(r)||e.getLogger(this.declaredClass).error(r)}))})),\"RefreshableLayerView\")}};return r([t()],c.prototype,\"layer\",void 0),c=r([a(\"esri.layers.mixins.RefreshableLayerView\")],c),c};export{i as RefreshableLayerView,i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../../core/maybe.js\";class i{constructor(e,t,i){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=i}get width(){return e(this.pixelBlock)?this.pixelBlock.width:0}get height(){return e(this.pixelBlock)?this.pixelBlock.height:0}render(e){const i=this.pixelBlock;if(t(i))return;const l=this.filter({pixelBlock:i});if(t(l.pixelBlock))return;const r=l.pixelBlock.getAsRGBA(),o=e.createImageData(l.pixelBlock.width,l.pixelBlock.height);o.data.set(r),e.putImageData(o,0,0)}getRenderedRasterPixels(){const e=this.filter({pixelBlock:this.pixelBlock});return t(e.pixelBlock)?null:{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Error.js\";import t from\"../../../../core/Logger.js\";import{isSome as r}from\"../../../../core/maybe.js\";import{e as s}from\"../../../../chunks/earcut.js\";import{s as n}from\"../../../../chunks/vec2.js\";import{a as o}from\"../../../../chunks/vec2f64.js\";import{convertFromNestedArray as c,convertFromPolygon as i}from\"../../../../layers/graphics/featureConversionUtils.js\";import a from\"../../../../layers/graphics/OptimizedGeometry.js\";import{i1616to32 as f}from\"./number.js\";import h from\"../../../webgl/BufferObject.js\";const m=t.getLogger(\"esri.views.2d.engine.webgl.Mesh2D\"),u=t=>{switch(t.BYTES_PER_ELEMENT){case 1:return 5121;case 2:return 5123;case 4:return 5125;default:throw new e(\"Cannot get DataType of array\")}},y=(e,t,r,s)=>{let n=0;for(let o=1;o<r;o++){const r=e[2*(t+o-1)],s=e[2*(t+o-1)+1];n+=(e[2*(t+o)]-r)*(e[2*(t+o)+1]+s)}return s?n>0:n<0},x=({coords:e,lengths:t},r)=>{const n=[];for(let o=0,c=0;o<t.length;c+=t[o],o+=1){const i=c,a=[];for(;o<t.length-1&&y(e,c+t[o],t[o+1],r);o+=1,c+=t[o])a.push(c+t[o]-i);const f=e.slice(2*i,2*(c+t[o])),h=s(f,a,2);for(const e of h)n.push(e+i)}return n};class g{constructor(e,t,r,s=!1){this._cache={},this.vertices=e,this.indices=t,this.primitiveType=r,this.isMapSpace=s}static fromRect({x:e,y:t,width:r,height:s}){const n=e,o=t,c=n+r,i=o+s;return g.fromScreenExtent({xmin:n,ymin:o,xmax:c,ymax:i})}static fromPath(e){const t=c(new a,e.path,!1,!1),r=t.coords,s=new Uint32Array(x(t,!0)),n=new Uint32Array(r.length/2);for(let o=0;o<n.length;o++)n[o]=f(Math.floor(r[2*o]),Math.floor(r[2*o+1]));return new g({geometry:n},s,4)}static fromGeometry(t,r){const s=r.geometry.type;switch(s){case\"polygon\":return g.fromPolygon(t,r.geometry);case\"extent\":return g.fromMapExtent(t,r.geometry);default:return m.error(new e(\"mapview-bad-type\",`Unable to create a mesh from type ${s}`,r)),g.fromRect({x:0,y:0,width:1,height:1})}}static fromPolygon(e,t){const r=i(new a,t,!1,!1),s=r.coords,c=new Uint32Array(x(r,!1)),h=new Uint32Array(s.length/2),m=o(),u=o();for(let o=0;o<h.length;o++)n(m,s[2*o],s[2*o+1]),e.toScreen(u,m),h[o]=f(Math.floor(u[0]),Math.floor(u[1]));return new g({geometry:h},c,4,!0)}static fromScreenExtent({xmin:e,xmax:t,ymin:r,ymax:s}){const n={geometry:new Uint32Array([f(e,r),f(t,r),f(e,s),f(e,s),f(t,r),f(t,s)])},o=new Uint32Array([0,1,2,3,4,5]);return new g(n,o,4)}static fromMapExtent(e,t){const[r,s]=e.toScreen([0,0],[t.xmin,t.ymin]),[n,o]=e.toScreen([0,0],[t.xmax,t.ymax]),c={geometry:new Uint32Array([f(r,s),f(n,s),f(r,o),f(r,o),f(n,s),f(n,o)])},i=new Uint32Array([0,1,2,3,4,5]);return new g(c,i,4)}destroy(){r(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(const e in this._cache.vertexBuffers)r(this._cache.vertexBuffers[e])&&this._cache.vertexBuffers[e].dispose()}get elementType(){return u(this.indices)}getIndexBuffer(e,t=35044){return this._cache.indexBuffer||(this._cache.indexBuffer=h.createIndex(e,t,this.indices)),this._cache.indexBuffer}getVertexBuffers(e,t=35044){return this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce(((r,s)=>({...r,[s]:h.createVertex(e,t,this.vertices[s])})),{})),this._cache.vertexBuffers}}export{g as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport t from\"../../../../core/Error.js\";import e from\"../../../../core/Logger.js\";import{isSome as r,isNone as s}from\"../../../../core/maybe.js\";import{c as i}from\"../../../../chunks/mat3f32.js\";import{DisplayObject as o}from\"../DisplayObject.js\";import h from\"./Mesh2D.js\";import a from\"../../../webgl/VertexArrayObject.js\";const c=e.getLogger(\"esri.views.2d.engine.webgl.ClippingInfo\"),n=t=>parseFloat(t)/100;class m extends o{constructor(t,e){super(),this._clip=e,this._cache={},this.stage=t,this._handle=e.watch(\"version\",(()=>this._invalidate())),this.ready()}static fromClipArea(t,e){return new m(t,e)}_destroyGL(){r(this._cache.mesh)&&(this._cache.mesh.destroy(),this._cache.mesh=null),r(this._cache.vao)&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL(),this._handle.remove()}getVAO(t,e,r,i){const[o,h]=e.size;if(\"geometry\"!==this._clip.type&&this._lastWidth===o&&this._lastHeight===h||(this._lastWidth=o,this._lastHeight=h,this._destroyGL()),s(this._cache.vao)){const s=this._createMesh(e,this._clip),o=s.getIndexBuffer(t),h=s.getVertexBuffers(t);this._cache.mesh=s,this._cache.vao=new a(t,r,i,h,o)}return this._cache.vao}_createTransforms(){return{dvs:i()}}_invalidate(){this._destroyGL(),this.requestRender()}_createScreenRect(t,e){const[r,s]=t.size,i=\"string\"==typeof e.left?n(e.left)*r:e.left,o=\"string\"==typeof e.right?n(e.right)*r:e.right,h=\"string\"==typeof e.top?n(e.top)*s:e.top,a=\"string\"==typeof e.bottom?n(e.bottom)*s:e.bottom,c=i,m=h;return{x:c,y:m,width:Math.max(r-o-c,0),height:Math.max(s-a-m,0)}}_createMesh(e,r){switch(r.type){case\"rect\":return h.fromRect(this._createScreenRect(e,r));case\"path\":return h.fromPath(r);case\"geometry\":return h.fromGeometry(e,r);default:return c.error(new t(\"mapview-bad-type\",\"Unable to create ClippingInfo mesh from clip of type: ${clip.type}\")),h.fromRect({x:0,y:0,width:1,height:1})}}}export{m as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{isNone as e,isSome as r}from\"../../../../core/maybe.js\";import{c as s}from\"../../../../chunks/mat3f32.js\";import{brushes as t}from\"../brushes.js\";import{Container as i}from\"../Container.js\";import n from\"./ClippingInfo.js\";import{WGLDrawPhase as o}from\"./enums.js\";class a extends i{constructor(){super(...arguments),this.name=this.constructor.name}set clips(e){this._clips=e,this.children.forEach((r=>r.clips=e)),this._updateClippingInfo()}_createTransforms(){return{dvs:s()}}doRender(e){const r=this.createRenderParams(e),{painter:s,globalOpacity:t,profiler:i,drawPhase:n}=r,a=n===o.LABEL||n===o.HIGHLIGHT?1:t*this.computedOpacity;i.recordContainerStart(this.name),s.beforeRenderLayer(r,this._clippingInfos?255:0,a),this.updateTransforms(e.state),this.renderChildren(r),s.compositeLayer(r,a),i.recordContainerEnd()}renderChildren(r){e(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(r.painter));for(const e of this.children)e.beforeRender(r);for(const e of this._renderPasses)try{e.render(r)}catch(s){}for(const e of this.children)e.afterRender(r)}createRenderParams(e){return e.requireFBO=this.requiresDedicatedFBO,e}prepareRenderPasses(e){return[e.registerRenderPass({name:\"clip\",brushes:[t.clip],target:()=>this._clippingInfos,drawPhase:o.MAP|o.LABEL|o.LABEL_ALPHA|o.DEBUG|o.HIGHLIGHT})]}updateTransforms(e){for(const r of this.children)r.setTransform(e)}onAttach(){super.onAttach(),this._updateClippingInfo()}onDetach(){super.onDetach(),this._updateClippingInfo()}_updateClippingInfo(){if(r(this._clippingInfos)&&(this._clippingInfos.forEach((e=>e.destroy())),this._clippingInfos=null),!this.stage)return;const e=this._clips;r(e)&&e.length&&(this._clippingInfos=e.items.map((e=>n.fromClipArea(this.stage,e)))),this.requestRender()}}export{a as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import e from\"../../../core/Logger.js\";import{isAbortError as r}from\"../../../core/promiseUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import{BitmapContainer as a}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as o}from\"./LayerView2D.js\";import p from\"./support/ExportStrategy.js\";import n from\"../../layers/LayerView.js\";import{RefreshableLayerView as m}from\"../../layers/RefreshableLayerView.js\";const h=e.getLogger(\"esri.views.2d.layers.BaseDynamicLayerView2D\");let c=class extends(m(o(n))){update(t){this.strategy.update(t).catch((t=>{r(t)||h.error(t)})),this.notifyChange(\"updating\")}attach(){this._bitmapContainer=new a,this.container.addChild(this._bitmapContainer),this.strategy=new p({container:this._bitmapContainer,fetchSource:this.fetchBitmapData.bind(this),requestUpdate:this.requestUpdate.bind(this)})}detach(){this.strategy.destroy(),this.strategy=null,this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}fetchBitmapData(t,e,r){return this.layer.fetchImage(t,e,r)}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}};t([s()],c.prototype,\"strategy\",void 0),t([s()],c.prototype,\"updating\",void 0),c=t([i(\"esri.views.2d.layers.BaseDynamicLayerView2D\")],c);const d=c;export{d as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nconst t=Math.PI/180;function n(n){return n*t}function o(t,n,o){const{resolution:r,size:u}=o;return t[0]=r*(Math.round(n[0]/r)+u[0]%2*.5),t[1]=r*(Math.round(n[1]/r)+u[1]%2*.5),t}function r(t,o){const r=n(o.rotation),u=Math.abs(Math.cos(r)),a=Math.abs(Math.sin(r)),[s,c]=o.size;return t[0]=Math.round(c*a+s*u),t[1]=Math.round(c*u+s*a),t}function u(t,n,o,r){const[u,a]=n,[s,c]=r,i=.5*o;return t[0]=u-i*s,t[1]=a-i*c,t[2]=u+i*s,t[3]=a+i*c,t}function a(t,n){const[o,r,u,a]=t,[s,c,i,e]=n;return!(o>i||u<s||r>e||a<c)}export{a as bboxIntersects,u as getBBox,r as getOuterSize,o as snapToPixel};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../core/Accessor.js\";import{debounce as i}from\"../../../../core/promiseUtils.js\";import{property as o}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as r}from\"../../../../core/accessorSupport/decorators/subclass.js\";import s from\"../../../../geometry/Extent.js\";import{create as a}from\"../../../../geometry/support/aaBoundingRect.js\";import{getInfo as p}from\"../../../../geometry/support/spatialReferenceUtils.js\";import n from\"../../../../layers/support/TileInfo.js\";import{getOuterSize as m,getBBox as l}from\"../../viewStateUtils.js\";import{Bitmap as d}from\"../../engine/Bitmap.js\";import h from\"../../tiling/TileInfoView.js\";import c from\"../../tiling/TileKey.js\";const u=a(),g=[0,0],f=new c(0,0,0,0),x={container:null,fetchSource:null,requestUpdate:null,imageMaxWidth:2048,imageMaxHeight:2048,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1};let y=class extends e{constructor(t){super(t),this._imagePromise=null,this.bitmaps=[],this.hidpi=x.hidpi,this.imageMaxWidth=x.imageMaxWidth,this.imageMaxHeight=x.imageMaxHeight,this.imageRotationSupported=x.imageRotationSupported,this.imageNormalizationSupported=x.imageNormalizationSupported,this.update=i((async(t,e)=>{if(!t.stationary||this.destroyed)return null;const i=t.state,o=p(i.spatialReference),r=this.hidpi?t.pixelRatio:1,s=this.imageNormalizationSupported&&i.worldScreenWidth&&i.worldScreenWidth<i.size[0];s?(g[0]=i.worldScreenWidth,g[1]=i.size[1]):this.imageRotationSupported?(g[0]=i.size[0],g[1]=i.size[1]):m(g,i);const a=Math.floor(g[0]*r)>this.imageMaxWidth||Math.floor(g[1]*r)>this.imageMaxHeight,n=o&&(i.extent.xmin<o.valid[0]||i.extent.xmax>o.valid[1]),l=!this.imageNormalizationSupported&&n,d=!a&&!l,h=this.imageRotationSupported?i.rotation:0;if(d){const t=s?i.paddedViewState.center:i.center;this._imagePromise=this._singleExport(i,g,t,i.resolution,h,r,e)}else{let t=Math.min(this.imageMaxWidth,this.imageMaxHeight);l&&(t=Math.min(i.worldScreenWidth,t)),this._imagePromise=this._tiledExport(i,t,h,r,e)}return this._imagePromise.then((async t=>{if(this._imagePromise=null,!this.destroyed){this.bitmaps=null!=t?t:[];for(const e of this.container.children)t.includes(e)||e.fadeOut().then((()=>{e.remove()}));for(const e of t)this.container.addChild(e),e.fadeIn()}})).catch((t=>{throw this._imagePromise=null,t}))}),5e3)}destroy(){this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}updateExports(t){for(const e of this.container.children){if(!e.visible||!e.stage)return;t(e),e.invalidateTexture(),e.requestRender()}}async _export(t,e,i,o,r,s){const a=await this.fetchSource(t,Math.floor(e*r),Math.floor(i*r),{rotation:o,pixelRatio:r,signal:s}),p=new d(a,\"additive\");return p.x=t.xmin,p.y=t.ymax,p.resolution=t.width/e,p.rotation=o,p.pixelRatio=r,p}async _singleExport(t,e,i,o,r,a,p){l(u,i,o,e);const n=new s(u[0],u[1],u[2],u[3],t.spatialReference);return[await this._export(n,e[0],e[1],r,a,p)]}_tiledExport(t,e,i,o,r){const a=n.create({size:e,spatialReference:t.spatialReference,scales:[t.scale]}),p=new h(a),m=p.getTileCoverage(t);if(!m)return null;const l=[];return m.forEach(((a,n,m,d)=>{f.set(a,n,m,d),p.getTileBounds(u,f);const h=new s(u[0],u[1],u[2],u[3],t.spatialReference);l.push(this._export(h,e,e,i,o,r))})),Promise.all(l)}};t([o()],y.prototype,\"_imagePromise\",void 0),t([o()],y.prototype,\"bitmaps\",void 0),t([o()],y.prototype,\"container\",void 0),t([o()],y.prototype,\"fetchSource\",void 0),t([o()],y.prototype,\"hidpi\",void 0),t([o()],y.prototype,\"imageMaxWidth\",void 0),t([o()],y.prototype,\"imageMaxHeight\",void 0),t([o()],y.prototype,\"imageRotationSupported\",void 0),t([o()],y.prototype,\"imageNormalizationSupported\",void 0),t([o()],y.prototype,\"requestUpdate\",void 0),t([o()],y.prototype,\"updating\",null),y=t([r(\"esri.views.2d.layers.support.ExportStrategy\")],y);const S=y;export{S as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{b as e,c as i,r as s,j as r,m as h}from\"../../../chunks/mat3.js\";import{c as n}from\"../../../chunks/mat3f32.js\";import{f as u}from\"../../../chunks/vec2f32.js\";import{DisplayObject as o}from\"./DisplayObject.js\";import a from\"./ImageryBitmapSource.js\";import d from\"../../webgl/Texture.js\";function c(t){return t&&\"render\"in t}function l(t){return t&&!(\"render\"in t)}function x(t){const e=document.createElement(\"canvas\");return e.width=t.width,e.height=t.height,t.render(e.getContext(\"2d\")),e}function _(t,e,i){const s={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return e&&i&&(s.width=e,s.height=i),new d(t,s)}class g extends o{constructor(t=null,e,i=!0){super(),this.requestRenderOnSourceChangedEnabled=i,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.blendFunction=e,this.source=t,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(t){this._height=t}get source(){return this._source}set source(t){this._source=t,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(t){this._width=t}beforeRender(t){super.beforeRender(t),this.updateTexture(t.context)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}_createTransforms(){return{dvs:n()}}setTransform(t){const n=e(this.transforms.dvs),[o,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),d=this.resolution/this.pixelRatio/t.resolution,c=d*this.width,l=d*this.height,x=Math.PI*this.rotation/180;i(n,n,u(o,a)),i(n,n,u(c/2,l/2)),s(n,n,-x),i(n,n,u(-c/2,-l/2)),r(n,n,u(c,l)),h(this.transforms.dvs,t.displayViewMat3,n)}setSamplingProfile(t){this._texture&&(t.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(t.samplingMode))}bind(t,e){this._texture&&t.bindTexture(this._texture,e)}updateTexture(e){var i;if(!this.stage)return null==(i=this._texture)||i.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this.source?this._texture=_(e,this.sourceWidth,this.sourceHeight):this._texture=_(e));const s=this.source;if(s){if(this._texture.resize(this.sourceWidth,this.sourceHeight),c(s))if(s instanceof a){const e=s.getRenderedRasterPixels();this._texture.setData(t(e)?e.renderedRasterPixels:null)}else this._texture.setData(x(s));else l(s)&&this._texture.setData(s);this.ready()}else this._texture.setData(null)}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}export{g as Bitmap,c as isImageSource,x as rasterize};\n"],"sourceRoot":""}