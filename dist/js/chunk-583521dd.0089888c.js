(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-583521dd"],{"0ec3":function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return O}));var i=s("a4ee"),r=s("f57e"),a=(s("ce50"),s("c120")),n=s("e92d"),o=s("b2b2"),c=s("f4cc"),l=(s("cea0"),s("b50f"),s("2dd4"),s("d386")),u=s("0f1c"),d=s("5996"),h=s("175e"),v=s("69c3"),f=s("2779"),p=s("0f0f"),g=s("601e"),S=s("32b6"),y=s("ba46");class b{constructor(e){this._remoteClient=e,this._resourceMap=new Map,this._inFlightResourceMap=new Map}destroy(){}async fetchResource(e,t){const s=this._resourceMap,i=s.get(e);if(i)return i;let r=this._inFlightResourceMap.get(e);if(r)return r;try{r=this._remoteClient.invoke("tileRenderer.fetchResource",{url:e},{...t}),this._inFlightResourceMap.set(e,r),r.then(t=>(this._inFlightResourceMap.delete(e),s.set(e,t),t))}catch(a){return Object(c["m"])(a)?null:{width:0,height:0}}return r}getResource(e){var t;return null!=(t=this._resourceMap.get(e))?t:null}}function m(e,t){return(!e.minScale||e.minScale>=t)&&(!e.maxScale||e.maxScale<=t)}function _(e){const t=e.message,s={message:{data:{},tileKey:t.tileKey,tileKeyOrigin:t.tileKeyOrigin},transferList:new Array};for(const i in t.data){const e=t.data[i];if(s.message.data[i]=null,Object(o["l"])(e)){const t=e.stride,r=e.indices.slice(0),a=e.vertices.slice(0),n=e.records.slice(0),c={stride:t,indices:r,vertices:a,records:n,metrics:Object(o["b"])(e.metrics,e=>e.slice(0))};s.transferList.push(r,a,n),s.message.data[i]=c}}return s}n["a"].getLogger("esri.views.2d.layers.features.processors.SymbolProcessor");let V=class extends y["a"]{constructor(){super(...arguments),this.type="symbol",this._matchers={feature:null,aggregate:null},this._bufferData=new Map,this._bufferIds=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._resourceManagerProxy=new b(this.remoteClient)}destroy(){this._resourceManagerProxy.destroy()}get supportsTileUpdates(){return!0}forEachBufferId(e){this._bufferIds.forEach(t=>{t.forEach(e)})}async update(e,t){const s=t.schema.processors[0];if("symbol"!==s.type)return;const i=Object(u["a"])(this._schema,s);Object(u["b"])(i,"mesh")&&(Object(a["a"])("esri-2d-update-debug")&&console.debug("Applying Update - Processor:",i),e.mesh=!0,e.why.mesh.push("Symbology changed"),this._schema=s,this._factory=this._createFactory(s),this._factory.update(s,this.tileStore.tileScheme.tileInfo))}onTileMessage(e,t,s,i){return Object(c["w"])(i),this._onTileData(e,t,s,i)}onTileClear(e){const t={clear:!0};return this._bufferData.delete(e.key.id),this._bufferIds.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:t})}onTileError(e,t,s){const i=s.signal,r={tileKey:e.id,error:t};return this.remoteClient.invoke("tileRenderer.onTileError",r,{signal:i})}onTileUpdate(e){for(const t of e.removed)this._bufferData.has(t.key.id)&&this._bufferData.delete(t.key.id),this._bufferIds.has(t.key.id)&&this._bufferIds.delete(t.key.id);for(const t of e.added)this._bufferData.forEach(e=>{for(const s of e)s.message.tileKey===t.id&&this._updateTileMesh("append",t,_(s),[],!1,!1,null)})}_addBufferData(e,t){this._bufferData.has(e)||this._bufferData.set(e,[]),this._bufferData.get(e).push(_(t))}_createFactory(e){const{geometryType:t,objectIdField:s,fields:i}=this.service,r=(e,t)=>this.remoteClient.invoke("tileRenderer.getMaterialItems",e,t),a={geometryType:t,fields:i,spatialReference:d["a"].fromJSON(this.spatialReference)},n=new p["a"](r,this.tileStore.tileScheme.tileInfo),{matcher:c,aggregateMatcher:l}=e.mesh;return this._store=n,this._matchers.feature=Object(g["a"])(c,n,a,this._resourceManagerProxy),this._matchers.aggregate=Object(o["b"])(l,e=>Object(g["a"])(e,n,a,this._resourceManagerProxy)),new f["a"](t,s,n)}async _onTileData(e,t,s,i){Object(c["w"])(i);const{type:r,addOrUpdate:a,remove:n}=t,l=t.end,u=!!this._schema.mesh.sortKey;if(!a){const t={type:r,addOrUpdate:null,remove:n,clear:!1,end:l,sort:u};return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:t},i)}const d=this._processFeatures(e,a,s,i);try{const s=await d;if(Object(o["k"])(s)){const t={type:r,addOrUpdate:null,remove:n,clear:!1,end:l,sort:u};return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:t},i)}const a=[];for(const t of s){let s=!1;const i=t.message.bufferIds,r=e.key.id,n=t.message.tileKey;if(r!==n&&Object(o["l"])(i)){if(!this.tileStore.get(n)){this._addBufferData(r,t),a.push(t);continue}let e=this._bufferIds.get(n);e||(e=new Set,this._bufferIds.set(n,e));const o=Array.from(i);for(const t of o){if(e.has(t)){s=!0;break}e.add(t)}}s||(this._addBufferData(r,t),a.push(t))}await Object(c["b"])(a.map(s=>{const a=e.key.id===s.message.tileKey,n=a?t.remove:[],o=a&&t.end;return this._updateTileMesh(r,e,s,n,o,t.clear,i.signal)}))}catch(h){this._handleError(e,h,i)}}async _updateTileMesh(e,t,s,i,r,a,n){const l=e,u=s.message.tileKey,d=!!this._schema.mesh.sortKey;u!==t.key.id&&(r=!1);const h=Object(o["b"])(s,e=>e.message),v=Object(o["b"])(s,e=>e.transferList)||[],f={type:l,addOrUpdate:h,remove:i,clear:!1,end:r,sort:d},p={transferList:Object(o["u"])(v)||[],signal:n};return Object(c["w"])(p),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:u,data:f},p)}async _processFeatures(e,t,s,i){if(Object(o["k"])(t)||!t.hasFeatures)return null;const r={transform:e.transform,hasZ:!1,hasM:!1},a=this._factory,n={viewingMode:"",scale:e.scale},l=await this._matchers.feature,u=await this._matchers.aggregate;Object(c["w"])(i);const d=this._getLabelInfos(e,t);return await a.analyze(t.getCursor(),this._resourceManagerProxy,l,u,r,n),Object(c["w"])(i),this._writeFeatureSet(e,t,r,d,a,s)}_writeFeatureSet(e,t,s,i,r,a){const n=t.getSize(),c=new v["a"](e.key.id,{features:n,records:n,metrics:0},this._schema.mesh.matcher.stride,a,!0),l={viewingMode:"",scale:e.scale},u=t.getCursor();for(;u.next();)try{const t=u.getDisplayId(),a=Object(o["l"])(i)?i.get(t):null;r.writeCursor(c,u,s,l,e.level,a)}catch(h){}const d=e.tileInfoView.tileInfo.isWrappable;return c.serialize(d)}_handleError(e,t,s){if(!Object(c["m"])(t)){const i={tileKey:e.id,error:t.message};return this.remoteClient.invoke("tileRenderer.onTileError",i,{signal:s.signal})}}_getLabelingSchemaForScale(e){const t=this._schema.mesh.labels;if(Object(o["k"])(t))return null;if("subtype"===t.type){const s={type:"subtype",classes:{}};let i=!1;for(const r in t.classes){const a=t.classes[r].filter(t=>m(t,e.scale));i=i||!!a.length,s.classes[r]=a}return i?s:null}const s=t.classes.filter(t=>m(t,e.scale));return s.length?{type:"simple",classes:s}:null}_getLabels(e,t){if("subtype"===t.type){var s;const i=this.service.subtypeField,r=Object(o["w"])(i,"Expected to find subtype Field"),a=e.readAttribute(r);return null==a?[]:null!=(s=t.classes[a])?s:[]}return t.classes}_getLabelInfos(e,t){const s=this._getLabelingSchemaForScale(e);if(Object(o["k"])(s))return null;const i=new Map,a=t.getCursor();for(;a.next();){const e=a.getDisplayId(),t=[],n=Object(h["h"])(e),o=n&&1!==a.readAttribute("cluster_count")?"aggregate":"feature",c=this._getLabels(a,s);for(const s of c){if(s.target!==o)continue;const i=a.getStorage(),c=n&&"feature"===o?i.getComputedStringAtIndex(a.readAttribute("referenceId"),s.fieldIndex):i.getComputedStringAtIndex(e,s.fieldIndex);if(!c)continue;const l=Object(r["a"])(c.toString()),u=l[0],d=l[1];this._store.getMosaicItem(s.symbol,Object(S["a"])(u)).then(e=>{t[s.index]={glyphs:e.glyphMosaicItems,rtl:d,index:s.index}})}i.set(e,t)}return i}};V=Object(i["a"])([Object(l["a"])("esri.views.2d.layers.features.processors.SymbolProcessor")],V);const O=V},"18c6":function(e,t,s){"use strict";s.d(t,"a",(function(){return j})),s.d(t,"b",(function(){return U})),s.d(t,"c",(function(){return R})),s.d(t,"d",(function(){return x})),s.d(t,"e",(function(){return w})),s.d(t,"f",(function(){return A})),s.d(t,"g",(function(){return T})),s.d(t,"h",(function(){return I}));var i=s("ce50"),r=s("c84e"),a=s("9b77");function n(e,t){const s=r["e"].SIZE_FIELD_STOPS|r["e"].SIZE_MINMAX_VALUE|r["e"].SIZE_SCALE_STOPS|r["e"].SIZE_UNIT_VALUE,i=(e&(r["f"].FIELD_TARGETS_OUTLINE|r["f"].MINMAX_TARGETS_OUTLINE|r["f"].SCALE_TARGETS_OUTLINE|r["f"].UNIT_TARGETS_OUTLINE))>>>4;return t.isOutline||t.isOutlinedFill?s&i:s&~i}const o=0,c=8,l=7,u=8,d=11,h=11,v=12,f=13,p=14,g=15,S=15,y=16,b=17,m=18,_=19,V=20,O=21,M=22;function T(e,t){switch(e){case r["d"].FILL:return j.from(t);case r["d"].LINE:return R.from(t);case r["d"].MARKER:return x.from(t);case r["d"].TEXT:return A.from(t);case r["d"].LABEL:return U.from(t);default:throw new Error("Unable to createMaterialKey for unknown geometryType "+e)}}function I(e){switch(w.load(e).geometryType){case r["d"].MARKER:return new x(e);case r["d"].FILL:return new j(e);case r["d"].LINE:return new R(e);case r["d"].TEXT:return new A(e);case r["d"].LABEL:return new U(e)}}class w{constructor(e){this._data=0,this._data=e}static load(e){const t=this.shared;return t.data=e,t}set data(e){this._data=e}get data(){return this._data}get geometryType(){return this.bits(u,d)}set geometryType(e){this.setBits(e,u,d)}get mapAligned(){return!!this.bit(V)}set mapAligned(e){this.setBit(V,e)}get sdf(){return!!this.bit(h)}set sdf(e){this.setBit(h,e)}get pattern(){return!!this.bit(v)}set pattern(e){this.setBit(v,e)}get textureBinding(){return this.bits(o,c)}set textureBinding(e){this.setBits(e,o,c)}get geometryTypeString(){switch(this.geometryType){case r["d"].FILL:return"fill";case r["d"].MARKER:return"marker";case r["d"].LINE:return"line";case r["d"].TEXT:return"text";case r["d"].LABEL:return"label";default:throw new i["a"]("Unable to handle unknown geometryType: "+this.geometryType)}}setBit(e,t){const s=1<<e;t?this._data|=s:this._data&=~s}bit(e){return(this._data&1<<e)>>e}setBits(e,t,s){for(let i=t,r=0;i<s;i++,r++)this.setBit(i,0!=(e&1<<r))}bits(e,t){let s=0;for(let i=e,r=0;i<t;i++,r++)s|=this.bit(i)<<r;return s}hasVV(){return!1}setVV(e,t){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(l&this.textureBinding)}}w.shared=new w(0);const z=e=>class extends e{get vvSizeMinMaxValue(){return 0!==this.bit(y)}set vvSizeMinMaxValue(e){this.setBit(y,e)}get vvSizeScaleStops(){return 0!==this.bit(b)}set vvSizeScaleStops(e){this.setBit(b,e)}get vvSizeFieldStops(){return 0!==this.bit(m)}set vvSizeFieldStops(e){this.setBit(m,e)}get vvSizeUnitValue(){return 0!==this.bit(_)}set vvSizeUnitValue(e){this.setBit(_,e)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(e,t){super.setVV(e,t);const s=n(e,t)&e;this.vvSizeMinMaxValue=!!(s&r["e"].SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(s&r["e"].SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(s&r["e"].SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(s&r["e"].SIZE_SCALE_STOPS)}},E=e=>class extends e{get vvRotation(){return 0!==this.bit(g)}set vvRotation(e){this.setBit(g,e)}hasVV(){return super.hasVV()||this.vvRotation}setVV(e,t){super.setVV(e,t),this.vvRotation=!t.isOutline&&!!(e&r["e"].ROTATION)}},F=e=>class extends e{get vvColor(){return 0!==this.bit(f)}set vvColor(e){this.setBit(f,e)}hasVV(){return super.hasVV()||this.vvColor}setVV(e,t){super.setVV(e,t),this.vvColor=!t.isOutline&&!!(e&r["e"].COLOR)}},L=e=>class extends e{get vvOpacity(){return 0!==this.bit(p)}set vvOpacity(e){this.setBit(p,e)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(e,t){super.setVV(e,t),this.vvOpacity=!t.isOutline&&!!(e&r["e"].OPACITY)}};class j extends(F(L(z(w)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=r["d"].FILL,t.dotDensity="dot-density"===e.stride.fill,t.simple="simple"===e.stride.fill,t.outlinedFill=e.isOutlinedFill,t.dotDensity||t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,outlinedFill:this.outlinedFill,simple:this.simple,vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}get dotDensity(){return!!this.bit(S)}set dotDensity(e){this.setBit(S,e)}get simple(){return!!this.bit(M)}set simple(e){this.setBit(M,e)}get outlinedFill(){return!!this.bit(O)}set outlinedFill(e){this.setBit(O,e)}}j.shared=new j(0);class x extends(F(L(E(z(w))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=r["d"].MARKER,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}x.shared=new x(0);class R extends(F(L(z(w)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=r["d"].LINE,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}R.shared=new R(0);class A extends(F(L(E(z(w))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=r["d"].TEXT,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}A.shared=new A(0);class U extends(z(w)){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=r["d"].LABEL,t.setVV(e.vvFlags,e),t.mapAligned=Object(a["a"])(e.placement),t.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}U.shared=new U(0)},"1d01":function(e,t,s){"use strict";s.d(t,"a",(function(){return d})),s.d(t,"b",(function(){return l})),s.d(t,"c",(function(){return u})),s.d(t,"d",(function(){return c}));Number.POSITIVE_INFINITY;const i=Math.PI,r=128/i,a=256/360,n=1/Math.LN2;function o(e,t){return(e%=t)>=0?e:e+t}function c(e){return o(e*r,256)}function l(e){return o(e*a,256)}function u(e){return Math.log(e)*n}function d(e,t,s){return e>=t&&e<=s||e>=s&&e<=t}},"9b77":function(e,t,s){"use strict";function i(e){switch(e){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}s.d(t,"a",(function(){return i}))},ba46:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var i=s("a4ee"),r=s("9096"),a=s("59b2"),n=(s("b50f"),s("c120"),s("cea0"),s("d386"));let o=class extends r["a"]{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};Object(i["a"])([Object(a["b"])({readOnly:!0})],o.prototype,"supportsTileUpdates",null),Object(i["a"])([Object(a["b"])({constructOnly:!0})],o.prototype,"remoteClient",void 0),Object(i["a"])([Object(a["b"])({constructOnly:!0})],o.prototype,"service",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"spatialReference",null),Object(i["a"])([Object(a["b"])({constructOnly:!0})],o.prototype,"tileInfo",void 0),Object(i["a"])([Object(a["b"])({constructOnly:!0})],o.prototype,"tileStore",void 0),o=Object(i["a"])([Object(n["a"])("esri.views.2d.layers.features.processors.BaseProcessor")],o);const c=o}}]);
//# sourceMappingURL=chunk-583521dd.0089888c.js.map