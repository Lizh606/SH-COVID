(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-151674ce"],{"1bd2":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i("a4ee"),a=i("b2b2"),s=i("fab3"),n=i("59b2"),o=(i("b50f"),i("c120"),i("cea0"),i("d386"));const l=e=>{let t=class extends(Object(s["b"])(e)){constructor(){super(...arguments),this.parent=null}get updating(){return!1}get visible(){const e=!Object(a["l"])(this.parent)||this.parent.visible&&!this.parent.suspended;return this.analysis.visible&&e}};return Object(r["a"])([Object(n["b"])({readOnly:!0})],t.prototype,"type",void 0),Object(r["a"])([Object(n["b"])({constructOnly:!0})],t.prototype,"analysis",void 0),Object(r["a"])([Object(n["b"])({constructOnly:!0})],t.prototype,"parent",void 0),Object(r["a"])([Object(n["b"])({constructOnly:!0})],t.prototype,"view",void 0),Object(r["a"])([Object(n["b"])({readOnly:!0})],t.prototype,"updating",null),Object(r["a"])([Object(n["b"])({readOnly:!0})],t.prototype,"visible",null),t=Object(r["a"])([Object(o["a"])("esri.views.3d.analysis.AnalysisView3D")],t),t}},2252:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i("3886");function a(e){e.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(r["a"]`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));
return viewDirectionDistance*perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;
}`)}function s(e,t,i){e.setUniform1f("perScreenPixelRatio",i.camera.perScreenPixelRatio),e.setUniform1f("screenSize",t.screenSize)}},"2e4d":function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var r=i("a4ee"),a=i("a5d8"),s=i("e694"),n=i("59b2"),o=(i("b50f"),i("c120"),i("cea0")),l=i("afcf"),c=i("d386"),d=i("22f4");let u=class extends(Object(a["a"])(s["b"])){constructor(e){super(e),this.title="",this.id=-1,this.modelName=null,this.isEmpty=null,this.visible=!0,this.opacity=1}readTitle(e,t){return"string"==typeof t.alias?t.alias:"string"==typeof t.name?t.name:""}readIdOnlyOnce(e){return-1!==this.id?this.id:"number"==typeof e?e:void 0}};Object(r["a"])([Object(n["b"])({type:String,json:{origins:{"web-scene":{write:!0},"portal-item":{write:!0}}}})],u.prototype,"title",void 0),Object(r["a"])([Object(l["a"])("service","title",["alias","name"])],u.prototype,"readTitle",null),Object(r["a"])([Object(n["b"])()],u.prototype,"layer",void 0),Object(r["a"])([Object(n["b"])({type:o["a"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],u.prototype,"id",void 0),Object(r["a"])([Object(l["a"])("service","id")],u.prototype,"readIdOnlyOnce",null),Object(r["a"])([Object(n["b"])(Object(d["k"])(String))],u.prototype,"modelName",void 0),Object(r["a"])([Object(n["b"])(Object(d["k"])(Boolean))],u.prototype,"isEmpty",void 0),Object(r["a"])([Object(n["b"])({type:Boolean,json:{name:"visibility",write:!0}})],u.prototype,"visible",void 0),Object(r["a"])([Object(n["b"])({type:Number,json:{write:!0}})],u.prototype,"opacity",void 0),u=Object(r["a"])([Object(c["a"])("esri.layers.buildingSublayers.BuildingSublayer")],u);const p=u},"5fae":function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("b2b2"),a=i("d791"),s=i("afe1"),n=i("f53a"),o=i("5a22"),l=i("748f");class c extends n["a"]{constructor(e){super(e.view),this._resources=null,this._transform=Object(s["d"])()}get object(){return Object(r["l"])(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){Object(a["c"])(this._transform,e),Object(r["l"])(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(Object(r["k"])(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new l["a"]({isPickable:!1,updatePolicy:1});e.add(t);const i=new o["a"]({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial(t=>e.add(t)),e.add(i),t.add(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;!Object(r["k"])(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial(t=>{e.remove(t),t.dispose()}),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){Object(r["k"])(this._resources)||this._resources.object.setVisible(e)}}},"692f":function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return p}));var r=i("2252"),a=i("d272"),s=i("4db9"),n=i("d047"),o=i("c6d7"),l=i("ebd5"),c=i("4377"),d=i("3886"),u=i("690a");function p(e){const t=new u["a"];return t.include(s["a"],{linearDepth:!1}),t.include(r["a"],{}),t.include(a["a"],e),t.fragment.include(c["a"]),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.fragment.uniforms.add("color","vec4"),t.attributes.add("position","vec3"),t.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add("offset","vec3"),e.shadingEnabled&&(t.vertex.uniforms.add("viewNormal","mat4"),t.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add("normal","vec3"),t.varyings.add("vViewNormal","vec3")),t.vertex.code.add(d["a"]`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&t.vertex.code.add(d["a"]`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),t.vertex.code.add(d["a"]`
    ${e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),e.multipassTerrainEnabled&&(t.fragment.include(n["a"]),t.include(o["b"],e)),t.fragment.code.add(d["a"]`
    void main() {
      discardBySlice(vWorldPosition);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.shadingEnabled?t.fragment.code.add(d["a"]`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(color, shadedColor, shadingFactor);`):t.fragment.code.add(d["a"]`vec4 finalColor = color;`),t.fragment.code.add(d["a"]`
      if (finalColor.a < ${d["a"].float(l["c"])}) {
        discard;
      }
      ${7===e.output?d["a"]`gl_FragColor = vec4(finalColor.a);`:""}

      ${0===e.output?d["a"]`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),t}const b=Object.freeze({__proto__:null,build:p})},"94e6":function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r=i("b2b2"),a=i("d791"),s=i("afe1"),n=i("e431"),o=i("0b2d"),l=i("7577"),c=i("5ef2"),d=i("5fae"),u=i("d408"),p=i("86ba");class b extends d["a"]{constructor(e){super(e),this._renderOccluded=4,this._width=1,this._color=Object(c["c"])(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this.applyProps(e)}setGeometryFromRenderSpacePoint(e){const t=1e3,i=[];i.push([[e[0]-t,e[1]+0,e[2]+0],[e[0]+t,e[1]+0,e[2]+0]]),i.push([[e[0]-0,e[1]-t,e[2]+0],[e[0]+0,e[1]+t,e[2]+0]]),i.push([[e[0]-0,e[1]+0,e[2]-t],[e[0]+0,e[1]+0,e[2]+t]]),this.geometry=i}setGeometryFromExtent(e){const t=this.view.spatialReference,i=Object(o["f"])(),r=Object(o["f"])(),a=100,s=[];Object(n["y"])(i,e[0],e[1],a),this.view.renderCoordsHelper.toRenderCoords(i,t,r),s.push([r[0],r[1],r[2]]),Object(n["y"])(i,e[2],e[1],a),this.view.renderCoordsHelper.toRenderCoords(i,t,r),s.push([r[0],r[1],r[2]]),Object(n["y"])(i,e[2],e[3],a),this.view.renderCoordsHelper.toRenderCoords(i,t,r),s.push([r[0],r[1],r[2]]),Object(n["y"])(i,e[0],e[3],a),this.view.renderCoordsHelper.toRenderCoords(i,t,r),s.push([r[0],r[1],r[2]]),Object(n["y"])(i,e[0],e[1],a),this.view.renderCoordsHelper.toRenderCoords(i,t,r),s.push([r[0],r[1],r[2]]),Object(n["y"])(i,e[0],e[1],a),this.view.renderCoordsHelper.toRenderCoords(i,t,r),s.push([r[0],r[1],r[2]]),this.geometry=[s]}setGeometryFromFrustum(e){const t=[];e.lines.forEach(e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])}),this.geometry=[t]}setGeometryFromBoundedPlane(e){const t=[],i=e.origin,r=e.basis1,a=e.basis2,s=.5,n=Object(o["f"])(),l=Object(o["f"])(),c=Object(o["f"])(),d=Object(o["f"])();n[0]=i[0]-r[0]*s-a[0]*s,n[1]=i[1]-r[1]*s-a[1]*s,n[2]=i[2]-r[2]*s-a[2]*s,l[0]=i[0]-r[0]*s+a[0]*s,l[1]=i[1]-r[1]*s+a[1]*s,l[2]=i[2]-r[2]*s+a[2]*s,c[0]=i[0]+r[0]*s+a[0]*s,c[1]=i[1]+r[1]*s+a[1]*s,c[2]=i[2]+r[2]*s+a[2]*s,d[0]=i[0]+r[0]*s-a[0]*s,d[1]=i[1]+r[1]*s-a[1]*s,d[2]=i[2]+r[2]*s-a[2]*s,t.push([n[0],n[1],n[2]]),t.push([l[0],l[1],l[2]]),t.push([c[0],c[1],c[2]]),t.push([d[0],d[1],d[2]]),t.push([n[0],n[1],n[2]]),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;Object(a["i"])(h),Object(a["a"])(h,h,t),this.transform=h;const{points:i}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[i]}setGeometryFromSegments(e,t=o["c"]){Object(a["i"])(h),Object(a["a"])(h,h,t),this.transform=h,this.geometry=e.map(e=>e.createRenderGeometry(t,this.view.renderCoordsHelper).points)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){Object(l["g"])(e,this._color)||(Object(l["c"])(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(r["l"])(e)?!Object(r["k"])(this._innerColor)&&Object(l["g"])(e,this._innerColor)||(this._innerColor=Object(l["c"])(Object(c["b"])(),e),this._updateMaterial()):Object(r["l"])(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(r["l"])(e)!==Object(r["l"])(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(Object(r["k"])(e)||Object(r["k"])(this._stippleOffColor)||!Object(l["g"])(e,this._stippleOffColor))&&(this._stippleOffColor=Object(r["l"])(e)?Object(c["a"])(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){this._stipplePreferContinuous!==e&&(this._stipplePreferContinuous=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}createExternalResources(){this._material=new p["a"](this.materialParameters)}destroyExternalResources(){this._material=null}createGeometries(e){const t=this._createLineGeometries();if(0!==t.length)for(let i=0;i<t.length;++i){const r=Object(u["a"])(t[i]);e.addGeometry(r,this._material)}}forEachExternalMaterial(e){e(this._material)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateMaterial(){this.attached&&this._material.setParameters(this.materialParameters)}_createLineGeometries(){const e=this.geometry;if(Object(r["k"])(e)||0===e.length)return[];const t=[];return e.forEach(e=>{const i=e.length,r=new Float64Array(3*i);e.forEach((e,t)=>{r[3*t+0]=e[0],r[3*t+1]=e[1],r[3*t+2]=e[2]});const a={overlayInfo:null,attributeData:{position:r},removeDuplicateStartEnd:0};t.push(a)}),t}}const h=Object(s["d"])()},"9c6b":function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return it}));var r=i("a4ee"),a=i("fc29"),s=i("b2b2"),n=i("59b2"),o=(i("b50f"),i("c120")),l=i("cea0"),c=i("d386"),d=i("1bd2"),u=i("af40"),p=i("e92d"),b=i("477c"),h=i("3795"),y=i("0d9f"),O=i("a6a3"),f=i("e814");function j(e,t,i){i.warnOnce(`Failed to project analysis geometry (id: '${e.id}'), projection from spatial reference (wkid: '${t.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)}i("e06a");var g=i("6c97"),v=i("38a4"),m=i("a915"),w=i("d791"),_=i("afe1"),C=(i("04f0"),i("e431")),P=i("0b2d"),x=i("8188"),E=i("7289"),S=i("d18f"),V=i("a1b1"),T=i("7361"),F=(i("ce6d"),i("4c37"),i("1c92"),i("dae5")),D=(i("3349"),i("f694"),i("9180"),i("bd7e")),L=(i("d3cf"),i("0cb9")),R=(i("9990"),i("171c"),i("5a22"),i("748f"),i("4ae5"));Object(m["f"])(),Object(D["c"])(),Object(S["c"])(),Object(F["b"])(),Object(_["d"])(),Object(_["d"])(),Object(E["d"])(),Object(P["f"])(),Object(P["f"])(),Object(P["f"])(),Object(P["f"])(),Object(P["f"])(),Object(P["f"])(),new R["a"]({x:0,y:0,z:0,spatialReference:null});var k=i("0fc4"),z=(i("ba58"),i("caf7")),I=(i("d36e"),i("4261"),i("8190"),i("fc00"),i("d7f7")),M=(i("b061"),i("35b3")),G=(i("1153"),i("5957"),i("7c51")),U=i("2252"),W=i("d272"),A=i("c6d7"),q=i("8e97"),N=i("c3a4"),H=i("ca98"),$=i("da35"),B=i("7438"),Q=i("c829"),K=i("692f"),J=i("189c");class Z extends H["a"]{initializeProgram(e){const t=Z.shader.get(),i=this.configuration,r=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new Q["a"](e.rctx,r,Y)}bindPass(e,t){const{screenSizeEnabled:i,shadingEnabled:r}=this.configuration,{color:a,shadingTint:s,shadingDirection:n}=e;Object(q["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("color",a),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(A["a"])(this.program,t)),r&&(this.program.setUniform4fv("shadedColor",this.blendColor(ee,s,a)),this.program.setUniform3fv("shadingDirection",n),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix)),i&&Object(U["b"])(this.program,e,t)}bindDraw(e){Object(q["d"])(this.program,e),Object(q["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(W["c"])(this.program,this.configuration,e),this.program.rebindTextures()}blendColor(e,t,i){const r=1-t[3],a=t[3]+i[3]*r;return 0===a?(e[3]=a,e):(e[0]=(t[0]*t[3]+i[0]*i[3]*r)/a,e[1]=(t[1]*t[3]+i[1]*i[3]*r)/a,e[2]=(t[2]*t[3]+i[2]*i[3]*r)/a,e[3]=i[3],e)}setPipelineState(e){const t=this.configuration,i=3===e,r=2===e;return Object(J["g"])({blending:0!==t.output&&7!==t.output||!t.transparent?null:i?B["g"]:Object(B["a"])(e),culling:Object(J["c"])(t.cullFace),depthTest:{func:r?513:t.shadingEnabled?515:513},depthWrite:i?t.writeDepth&&J["e"]:Object(B["c"])(e),colorWrite:J["d"],polygonOffset:i||r?null:B["d"]})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}Z.shader=new N["a"](K["a"],()=>i.e("chunk-2d2219c9").then(i.bind(null,"caa6")));class X extends $["a"]{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(r["a"])([Object($["b"])({count:8})],X.prototype,"output",void 0),Object(r["a"])([Object($["b"])({count:3})],X.prototype,"cullFace",void 0),Object(r["a"])([Object($["b"])()],X.prototype,"slicePlaneEnabled",void 0),Object(r["a"])([Object($["b"])()],X.prototype,"transparent",void 0),Object(r["a"])([Object($["b"])()],X.prototype,"writeDepth",void 0),Object(r["a"])([Object($["b"])()],X.prototype,"screenSizeEnabled",void 0),Object(r["a"])([Object($["b"])()],X.prototype,"shadingEnabled",void 0),Object(r["a"])([Object($["b"])({count:4})],X.prototype,"transparencyPassType",void 0),Object(r["a"])([Object($["b"])()],X.prototype,"multipassTerrainEnabled",void 0),Object(r["a"])([Object($["b"])()],X.prototype,"cullAboveGround",void 0);const Y=new Map([["position",0],["normal",1],["offset",2]]),ee=Object(k["e"])();M["a"];I["a"];Object(C["t"])(Object(P["f"])(),[.5,-.5,-.5]),M["b"];Object(P["f"])(),Object(P["f"])();function te(e,t,i,r){const a=Object(C["t"])(T["d"].get(),e),s=Object(C["t"])(T["d"].get(),t),n=Object(C["i"])(T["d"].get(),a,s);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=0,r[4]=s[0],r[5]=s[1],r[6]=s[2],r[7]=0,r[8]=n[0],r[9]=n[1],r[10]=n[2],r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r}Object(o["a"])("mac"),Math.cos(Object(v["h"])(45)),Math.cos(Object(v["h"])(5));const ie=.7,re=[1,.5,0],ae=2,se=1,ne=[...re,ie],oe=[0,0,0,.04],le=[...re,.5];var ce=i("94e6"),de=i("7577"),ue=i("5ef2"),pe=i("5fae"),be=i("8675"),he=i("fa1e"),ye=i("b04d");class Oe extends H["a"]{initializeProgram(e){const t=Oe.shader.get().build();return new Q["a"](e.rctx,t,he["a"])}bindPass(e,t){Object(q["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",e.backgroundColor),this.program.setUniform4fv("gridColor",e.gridColor),this.program.setUniform1f("gridWidth",e.gridWidth)}bindDraw(e){Object(q["d"])(this.program,e),this.program.rebindTextures()}initializePipeline(){return Object(J["g"])({blending:Object(J["h"])(1,1,771,771),depthTest:{func:513},colorWrite:J["d"]})}}Oe.shader=new N["a"](ye["a"],()=>i.e("chunk-2d0a47c1").then(i.bind(null,"0748")));class fe extends M["a"]{constructor(e){super(e,ge),this._config=new $["a"]}intersect(e,t,i,r,a,s,n){return Object(G["i"])(e,t,r,a,s,void 0,n)}createBufferWriter(){return new be["a"](be["d"])}requiresSlot(e){return 7===e}createGLMaterial(e){return 0===e.output?new je(e):null}getTechniqueConfig(){return this._config}}class je extends I["a"]{constructor(e){super(e),this.ensureTechnique(Oe,null)}updateParameters(){return Object(s["u"])(this.technique)}beginSlot(){return Object(s["u"])(this.technique)}bind(e,t){t.bindPass(this._material.parameters,e)}}const ge={backgroundColor:[1,0,0,.5],gridColor:[0,1,0,.5],gridWidth:4,...M["b"]};class ve extends pe["a"]{constructor(e){super(e),this._material=null,this._renderOccluded=4,this._gridWidth=1,this._gridColor=Object(ue["c"])(1,0,0,1),this._backgroundColor=Object(ue["c"])(1,0,0,1),this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(e){this._gridWidth!==e&&(this._gridWidth=e,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(e){Object(de["c"])(this._gridColor,e),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){Object(de["c"])(this._backgroundColor,e),this._updateMaterial()}createExternalResources(){this._material=new fe(this.materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(e){Object(s["l"])(this._material)&&e(this._material)}createGeometries(e){if(Object(s["l"])(this._material)){const t=z["a"].createSquareGeometry();e.addGeometry(t,this._material)}}get materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){Object(s["l"])(this._material)&&this._material.setParameters(this.materialParameters)}}var me,we=i("92a1"),_e=(i("0278"),i("ad96"),i("3748"),i("86ba"),i("6a0e")),Ce=i("7ffa"),Pe=i("1a3e"),xe=i("c6f7"),Ee=i("680b");let Se=me=class extends _e["a"]{constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}clone(){return new me({position:Object(Ce["a"])(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&Object(s["g"])(this.position,e.position)&&this.width===e.width&&this.height===e.height}};Object(r["a"])([Object(n["b"])({readOnly:!0,json:{read:!1,write:!0}})],Se.prototype,"type",void 0),Object(r["a"])([Object(n["b"])({type:R["a"]}),Object(xe["a"])()],Se.prototype,"position",void 0),Object(r["a"])([Object(n["b"])({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(xe["a"])(),Object(Pe["a"])(e=>Ee["e"].normalize(Object(l["i"])(e),0,!0))],Se.prototype,"heading",void 0),Object(r["a"])([Object(n["b"])({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(xe["a"])(),Object(Pe["a"])(e=>Ee["e"].normalize(Object(l["i"])(e),0,!0))],Se.prototype,"tilt",void 0),Object(r["a"])([Object(n["b"])({type:Number,nonNullable:!0}),Object(xe["a"])()],Se.prototype,"width",void 0),Object(r["a"])([Object(n["b"])({type:Number,nonNullable:!0}),Object(xe["a"])()],Se.prototype,"height",void 0),Se=me=Object(r["a"])([Object(c["a"])("esri.widgets.Slice.SlicePlane")],Se);const Ve=Se;i("3af1");const Te=p["a"].getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function Fe(e,t,i){const r=t.worldUpAtPosition(e.origin,T["d"].get()),a=e.basis1,s=ze(e,r),n=Math.round(s/Ae)*Ae;return Object(y["j"])(e,n-s,a,i)}function De(e,t){return te(e.basis1,e.basis2,e.origin,t)}function Le(e){return new ce["a"]({view:e,attached:!0,color:ne,width:se,writeDepthEnabled:!1,renderOccluded:4,geometry:[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]]]})}function Re(e){return new ve({view:e,attached:!0,backgroundColor:[...oe],gridColor:le,gridWidth:4,renderOccluded:4})}function ke(e,t,i,r=new Ve){if(Object(s["k"])(e))return null;const{renderCoordsHelper:a}=t,n=a.fromRenderCoords(e.origin,t.spatialReference);if(Object(s["k"])(n))return null;const o=Object(x["D"])(n,i);if(Object(s["k"])(o))return null;r.position=o;const l=a.worldUpAtPosition(e.origin,T["d"].get()),c=a.worldBasisAtPosition(e.origin,1,T["d"].get()),d=2*Object(C["r"])(e.basis1),u=2*Object(C["r"])(e.basis2),p=we["a"].renderUnitScaleFactor(t.spatialReference,i);return r.width=d*p,r.height=u*p,r.tilt=Object(v["p"])(ze(e,l)),r.heading=Object(v["p"])(Ie(e,l,c)),r}function ze(e,t){return Object(V["b"])(t,e.basis2,e.basis1)+Ae}function Ie(e,t,i){return Object(V["b"])(e.basis1,i,t)-Ae}function Me(e,t,i,r,a,s,n=Object(y["d"])()){return s.toRenderCoords(e,n.origin)?(s.worldBasisAtPosition(n.origin,0,n.basis1),s.worldBasisAtPosition(n.origin,1,n.basis2),Object(E["j"])(n.basis2,n.basis1,n.origin,n.plane),Object(y["j"])(n,-Object(v["h"])(t),Object(y["i"])(n),n),Object(y["j"])(n,Object(v["h"])(i),n.basis1,n),Object(C["g"])(n.basis1,n.basis1,r/2),Object(C["g"])(n.basis2,n.basis2,a/2),Object(y["l"])(n),n):(Te.error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function Ge(e,t){if(Object(s["k"])(e)||Object(s["k"])(e.position))return null;const i=Object(x["D"])(e.position,t);if(Object(s["k"])(i))return null;const r=we["a"].renderUnitScaleFactor(e.position.spatialReference,t),a=e.width*r,n=e.height*r;return{position:i,heading:e.heading,tilt:e.tilt,renderWidth:a,renderHeight:n}}function Ue(e,t,i,r=Object(y["d"])()){if(Object(s["k"])(e))return null;let a=e.position;!e.position.hasZ&&Object(s["l"])(t.elevationProvider)&&(a=e.position.clone(),a.z=Object(s["v"])(Object(L["b"])(t.elevationProvider,e.position),0));const n=Me(a,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,r);return!i.tiltEnabled&&Object(s["l"])(n)&&Fe(n,t.renderCoordsHelper,n),n}function We(e){switch(e.type){case"analysis":case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return Object(g["a"])(e.type),!1}}Object(S["c"])();const Ae=Math.PI/2;function qe(e){const t="building-scene-3d"===e.type?e:null;return Object(s["l"])(t)}const Ne=p["a"].getLogger("esri.views.3d.analysis.Slice.SliceController");let He=class extends a["a"]{constructor(e){super(e),this._handles=new u["a"],this._internalChange=!1,this._currentSlicePlane=null,this.state="pending"}get ready(){return"ready"===this.state}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",e=>{const t=e.item;null!=t&&(t instanceof O["a"]||t instanceof f["a"])?t instanceof O["a"]&&We(t)?(Ne.error("excludedLayers",`Layer '${t.title}, id:${t.id}' of type '${t.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.analysis.excludedLayers.includes(t)&&e.preventDefault():(Ne.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault())})),this._handles.add(Object(b["c"])(()=>this.view.ready&&Object(s["l"])(this.view.renderCoordsHelper),()=>this._initialize(),{sync:!0,initial:!0,once:!0}))}_initialize(){"destroyed"!==this.state&&"ready"!==this.state&&(Ke(this.view,this),this._handles.add([Object(b["b"])(()=>this.analysisView.analysisViewData.plane,()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()},{sync:!0}),Object(b["b"])(()=>this.analysis.excludeGroundSurface,()=>this._updateLayerViews(),{sync:!0}),this.analysis.excludedLayers.on("change",()=>this._updateLayerViews()),Object(b["b"])(()=>[this.analysisView.active,this.analysisView.visible],()=>{this._updateActiveController(),this._updateViewSlicePlane()},{sync:!0}),Object(b["b"])(()=>this._allLayerAndSubLayerViews,()=>this._updateLayerViews())]),this._handles.add([Object(b["b"])(()=>this.analysis.shape,()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())},{sync:!0})],"analysis"),this._set("state","ready"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())}destroy(){"destroyed"!==this.state&&"pending"!==this.state&&(this.analysisView.active=!1,Ze(this.view,this),this._handles.destroy(),this.view.slicePlane=null,this.set("view",null),this._set("state","destroyed"))}async whenReady(){return await Object(h["k"])(this,"ready"),this}get _allLayerAndSubLayerViews(){const e=this.view.allLayerViews.items;return e.concat(e.filter(qe).flatMap(({sublayerViews:e})=>e.items))}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.shape,t=this._currentSlicePlane;if(Object(s["k"])(t)&&Object(s["k"])(e)||Object(s["l"])(t)&&Object(s["l"])(e)&&e.equals(t))return;let i=null,r=null;if(Object(s["l"])(e)&&Object(s["l"])(e.position)){const t=e.position.spatialReference,a=Ge(e,this.view.spatialReference);Object(s["k"])(a)&&j(this.analysis,t,Ne),i=Ue(a,this.view,{tiltEnabled:this.analysis.tiltEnabled},Object(y["d"])()),Object(s["l"])(i)&&(r={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height})}this._currentSlicePlane=r,this._internalChange=!0,this.analysisView.analysisViewData.plane=i,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const e=this.analysisView.analysisViewData.plane,t=ke(e,this.view,this.view.spatialReference,new Ve);let i=null;Object(s["l"])(t)&&(i={heading:t.heading,tilt:t.tilt,position:t.position,width:t.width,height:t.height}),this._currentSlicePlane=i,this._internalChange=!0,this.analysis.shape=t,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(Be)return;const e=Je(this.view);if(this.analysisView.active)Object(s["l"])(e.activeController)&&e.activeController!==this?(Be=!0,e.activeController.analysisView.active=!1,Be=!1):Object(s["l"])(e.activeController)&&e.activeController,this._updateLayerViews(),e.activeController=this;else{if(Object(s["l"])(e.activeController)&&e.activeController!==this)return;Object(s["l"])(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){"ready"===this.state&&Qe(this.view)}_updateLayerViews(){const e=Object(s["l"])(this.analysisView.analysisViewData.plane)&&this.analysisView.visible&&this.analysisView.active,t=[],i=e=>{"layers"in e?e.layers.forEach(i):t.push(e)};this.analysis.excludedLayers.forEach(i),this.view.allLayerViews.forEach(i=>{i.destroyed||("slicePlaneEnabled"in i&&(i.slicePlaneEnabled=e&&t.indexOf(i.layer)<0),"sublayerViews"in i&&i.sublayerViews.forEach(i=>{i.slicePlaneEnabled=e&&t.indexOf(i.sublayer)<0}))}),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface)}};Object(r["a"])([Object(n["b"])({readOnly:!0})],He.prototype,"state",void 0),Object(r["a"])([Object(n["b"])()],He.prototype,"view",void 0),Object(r["a"])([Object(n["b"])()],He.prototype,"analysis",void 0),Object(r["a"])([Object(n["b"])()],He.prototype,"analysisView",void 0),Object(r["a"])([Object(n["b"])()],He.prototype,"ready",null),Object(r["a"])([Object(n["b"])()],He.prototype,"_allLayerAndSubLayerViews",null),He=Object(r["a"])([Object(c["a"])("esri.views.3d.analysis.Slice.SliceController")],He);const $e=new Map;let Be=!1;function Qe(e){const t=Je(e).activeController;Object(s["l"])(t)&&Object(s["l"])(t.analysisView.analysisViewData.plane)&&t.analysisView.visible?e.slicePlane=t.analysisView.analysisViewData.plane:e.slicePlane=null}function Ke(e,t){$e.has(e)||$e.set(e,{all:[],activeController:null}),$e.get(e).all.push(t)}function Je(e){return $e.get(e)}function Ze(e,t){if(!$e.has(e))throw new Error("view expected in global slice register");const i=$e.get(e),r=i.all.lastIndexOf(t);if(-1===r)throw new Error("controller expected in global slice register");i.all.splice(r,1),0===i.all.length&&$e.delete(e)}let Xe=class extends a["a"]{constructor(){super(...arguments),this.plane=null}};Object(r["a"])([Object(n["b"])()],Xe.prototype,"plane",void 0),Xe=Object(r["a"])([Object(c["a"])("esri.views.3d.analysis.Slice.SliceViewData")],Xe);var Ye=i("3544");let et=class extends a["a"]{constructor(e){super(e),this._handles=new u["a"],this._gridVisualElement=null,this._outlineVisualElement=null,this.state="pending",this.showGrid=!1,this.editable=!0}get ready(){return"ready"===this.state}initialize(){this._initialize()}async _initialize(){if("destroyed"===this.state||"ready"===this.state)return;await Object(h["k"])(this.view,"ready",!0);const e=this.analysisView.analysisViewData;if(Object(s["k"])(e))throw new Error("expected internal object to be valid");this._gridVisualElement=Re(this.view),this._outlineVisualElement=Le(this.view),this._handles.add([Object(b["b"])(()=>({visible:Object(s["l"])(e.plane)&&this.analysisView.visible,active:this.analysisView.active,editable:this.editable,showGrid:this.showGrid}),e=>this._updateMaterials(e),b["e"]),Object(b["b"])(()=>e.plane,e=>this._updatePlane(e),b["e"])],"internal"),this._set("state","ready")}destroy(){"destroyed"!==this.state&&"pending"!==this.state&&(this._handles.destroy(),this._gridVisualElement=Object(s["e"])(this._gridVisualElement),this._outlineVisualElement=Object(s["e"])(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed"))}async whenReady(){return await Object(h["k"])(this,"ready"),this}_updatePlane(e){if(Object(s["k"])(e))return;const t=Object(C["y"])(T["d"].get(),Object(C["r"])(e.basis1),Object(C["r"])(e.basis2),1),i=Object(w["w"])(T["a"].get(),t),r=De(e,T["a"].get()),a=Object(w["m"])(i,r,i);this._outlineVisualElement.transform=a,this._gridVisualElement.transform=a}_updateMaterials({visible:e,active:t,editable:i,showGrid:r}){this._outlineVisualElement.color=ne,this._outlineVisualElement.width=i?se:ae,this._outlineVisualElement.stipplePattern=t?null:Object(Ye["a"])(5);const a=r?le:[0,0,0,0];this._gridVisualElement.backgroundColor=oe,this._gridVisualElement.gridColor=a,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}};Object(r["a"])([Object(n["b"])({readOnly:!0})],et.prototype,"state",void 0),Object(r["a"])([Object(n["b"])()],et.prototype,"view",void 0),Object(r["a"])([Object(n["b"])()],et.prototype,"analysis",void 0),Object(r["a"])([Object(n["b"])()],et.prototype,"analysisView",void 0),Object(r["a"])([Object(n["b"])()],et.prototype,"ready",null),Object(r["a"])([Object(n["b"])()],et.prototype,"showGrid",void 0),Object(r["a"])([Object(n["b"])()],et.prototype,"editable",void 0),et=Object(r["a"])([Object(c["a"])("esri.views.3d.analysis.Slice.SliceVisualization")],et);let tt=class extends(Object(d["a"])(a["a"])){constructor(e){super(e),this.type="slice-view",this.analysisVisualization=null,this.analysisController=null,this.analysisViewData=new Xe,this.active=!0,this.showGrid=!1,this.editable=!1}initialize(){this.analysisVisualization=new et({view:this.view,analysis:this.analysis,analysisView:this}),this.analysisController=new He({view:this.view,analysis:this.analysis,analysisView:this})}destroy(){this.analysisVisualization=Object(s["e"])(this.analysisVisualization),this.analysisController=Object(s["e"])(this.analysisController)}async when(){return await this.analysisVisualization.whenReady(),await this.analysisController.whenReady(),this}get testData(){return{visualization:this.analysisVisualization,controller:this.analysisController}}};Object(r["a"])([Object(n["b"])()],tt.prototype,"type",void 0),Object(r["a"])([Object(n["b"])()],tt.prototype,"analysis",void 0),Object(r["a"])([Object(n["b"])()],tt.prototype,"analysisViewData",void 0),Object(r["a"])([Object(n["b"])()],tt.prototype,"active",void 0),Object(r["a"])([Object(n["b"])({aliasOf:"analysisVisualization.showGrid"})],tt.prototype,"showGrid",void 0),Object(r["a"])([Object(n["b"])({aliasOf:"analysisVisualization.editable"})],tt.prototype,"editable",void 0),tt=Object(r["a"])([Object(c["a"])("esri.views.3d.analysis.Slice.SliceView3D")],tt);const it=tt},ad96:function(e,t,i){"use strict";i.d(t,"a",(function(){return C}));var r=i("b061"),a=i("68af"),s=i("35b3"),n=i("7438"),o=i("8675"),l=i("7c51"),c=i("a4ee"),d=i("d272"),u=i("c6d7"),p=i("8e97"),b=i("c3a4"),h=i("ca98"),y=i("da35"),O=i("fa1e"),f=i("c829"),j=i("87b7"),g=i("f3d9"),v=i("189c");class m extends h["a"]{initializeProgram(e){const t=m.shader.get(),i=this.configuration,r=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new f["a"](e.rctx,r,O["a"])}bindPass(e,t){Object(p["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform1f("opacity",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(u["a"])(this.program,t))}bindDraw(e){Object(p["d"])(this.program,e),Object(d["c"])(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const i=this.configuration,r=3===e,a=2===e;return Object(v["g"])({blending:0!==i.output&&7!==i.output||!i.transparent?null:r?w:Object(n["a"])(e),culling:Object(v["c"])(i.cullFace),depthTest:{func:Object(n["b"])(e)},depthWrite:r?i.writeDepth&&v["e"]:Object(n["c"])(e),colorWrite:v["d"],stencilWrite:i.sceneHasOcludees?j["j"]:null,stencilTest:i.sceneHasOcludees?t?j["f"]:j["e"]:null,polygonOffset:r||a?null:Object(n["h"])(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}m.shader=new b["a"](g["a"],()=>i.e("chunk-2d215c84").then(i.bind(null,"c056")));const w=Object(v["i"])(1,771);class _ extends y["a"]{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(c["a"])([Object(y["b"])({count:8})],_.prototype,"output",void 0),Object(c["a"])([Object(y["b"])({count:3})],_.prototype,"cullFace",void 0),Object(c["a"])([Object(y["b"])()],_.prototype,"slicePlaneEnabled",void 0),Object(c["a"])([Object(y["b"])()],_.prototype,"transparent",void 0),Object(c["a"])([Object(y["b"])()],_.prototype,"enableOffset",void 0),Object(c["a"])([Object(y["b"])()],_.prototype,"writeDepth",void 0),Object(c["a"])([Object(y["b"])()],_.prototype,"sceneHasOcludees",void 0),Object(c["a"])([Object(y["b"])({count:4})],_.prototype,"transparencyPassType",void 0),Object(c["a"])([Object(y["b"])()],_.prototype,"multipassTerrainEnabled",void 0),Object(c["a"])([Object(y["b"])()],_.prototype,"cullAboveGround",void 0);class C extends s["a"]{constructor(e){super(e,x),this.supportsEdges=!0,this.techniqueConfig=new _}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<n["e"],this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,a,s,n){Object(l["i"])(e,t,r,a,s,void 0,n)}requiresSlot(e,t){return 20===e||(4===Object(r["b"])(t)?2===e:e===(this.parameters.transparent?this.parameters.writeDepth?4:7:2))}createGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new P(e):void 0}createBufferWriter(){return new o["a"](o["d"])}}class P extends a["a"]{constructor(e){super({...e,...e.material.parameters})}updateParameters(e){const t=this._material.parameters;return this.updateTexture(t.textureId),this.ensureTechnique(m,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&(this._material.setParameters({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}beginSlot(e){return 0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){this.bindTextures(t.program),this.bindTextureScale(t.program),t.bindPass(this._material.parameters,e)}}const x={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...s["b"]}},b04d:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s}));var r=i("3886"),a=i("690a");function s(){const e=new a["a"];return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(r["a"]`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(r["a"]`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),e}const n=Object.freeze({__proto__:null,build:s})},c6f7:function(e,t,i){"use strict";i.d(t,"a",(function(){return j}));var r=i("b2b2"),a=i("2698"),s=i("e041"),n=i("8eed"),o=i("7af8"),l=i("92ef"),c=i("59b2");function d(e){return b[u(e)]||y}function u(e){return e instanceof Blob?e.type:p(e.url)}function p(e){const t=Object(s["n"])(e);return O[t]||h}const b={},h="text/plain",y=b[h],O={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const V in O)b[O[V]]=V;var f=i("fcf2");function j(e){const t=Object(r["l"])(e)&&e.origins?e.origins:[void 0];return(i,r)=>{const a=g(e,i,r);for(const e of t){const t=Object(c["c"])(i,e,r);for(const e in a)t[e]=a[e]}}}function g(e,t,i){if(Object(r["l"])(e)&&"resource"===e.type)return v(e,t,i);switch(Object(r["l"])(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=f["c"];return{read:e,write:t}}}}function v(e,t,i){const n=Object(o["b"])(t,i);return{type:String,read:(e,t,i)=>{const r=Object(f["d"])(e,t,i);return n.type===String?r:"function"==typeof n.type?new n.type({url:r}):void 0},write:{writer(t,o,c,d){if(!d||!d.resources)return"string"==typeof t?void(o[c]=Object(f["e"])(t,d)):void(o[c]=t.write({},d));const u=E(t),p=u?Object(f["e"])(u,{...d,verifyItemRelativeUrls:d&&d.verifyItemRelativeUrls?{writtenUrls:d.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},1):null,b=n.type!==String&&(!Object(a["a"])(this)||d&&d.origin&&this.originIdOf(i)>Object(l["d"])(d.origin));d&&d.portalItem&&Object(r["l"])(p)&&!Object(s["s"])(p)?b?w(this,i,t,p,o,c,d,e):_(p,o,c,d):d&&d.portalItem&&(Object(r["k"])(p)||Object(r["l"])(Object(f["b"])(p))||Object(s["t"])(p)||b)?m(this,i,t,p,o,c,d,e):o[c]=p}}}}function m(e,t,i,a,o,l,c,u){const p=Object(n["a"])(),b=P(i,a,c),h=Object(s["z"])(Object(r["j"])(u,"prefix"),p),y=`${h}.${d(b)}`,O=c.portalItem.resourceFromPath(y);Object(s["t"])(a)&&c.resources.pendingOperations.push(x(a).then(e=>{O.path=`${h}.${d(e)}`,o[l]=O.itemRelativeUrl}).catch(()=>{})),C(e,t,O,b,c.resources.toAdd),o[l]=O.itemRelativeUrl}function w(e,t,i,r,a,n,o,l){const c=o.portalItem.resourceFromPath(r),u=P(i,r,o);d(u)===Object(s["n"])(c.path)?(C(e,t,c,u,o.resources.toUpdate),a[n]=r):m(e,t,i,r,a,n,o,l)}function _(e,t,i,r){r.resources.toKeep.push({resource:r.portalItem.resourceFromPath(e)}),t[i]=e}function C(e,t,i,r,a){a.push({resource:i,content:r,finish:i=>{S(e,t,i)}})}function P(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}async function x(e){const t=(await Promise.resolve().then(i.bind(null,"2eab"))).default,{data:r}=await t(e,{responseType:"blob"});return r}function E(e){return Object(r["k"])(e)?null:"string"==typeof e?e:e.url}function S(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}},e814:function(e,t,i){"use strict";i.d(t,"a",(function(){return L}));var r=i("a4ee"),a=i("4856"),s=(i("b423"),i("261a"),i("b48d"),i("478c"),i("667b"),i("ff57"),i("da00"),i("f976"),i("5cdb")),n=i("2eab"),o=i("ce50"),l=i("fa8a"),c=i("6d5f"),d=i("e92d"),u=i("b2b2"),p=i("fab3"),b=i("59b2"),h=(i("b50f"),i("c120"),i("cea0"),i("448d")),y=i("afcf"),O=i("d386"),f=i("3af1"),j=i("5996"),g=i("5bd5"),v=i("2e4d"),m=i("7eab"),w=i("22f4"),_=i("2feb"),C=i("80b7"),P=i("6e36"),x=i("5d34"),E=i("69dd"),S=i("f51b"),V=i("fd14");const T=d["a"].getLogger("esri.layers.buildingSublayers.BuildingComponentSublayer"),F=Object(_["a"])();let D=class extends(c["a"].LoadableMixin(Object(p["b"])(v["a"]))){constructor(e){super(e),this.type="building-component",this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.fields=null,this.associatedLayer=null,this.outFields=null,this.listMode="show",this.renderer=null,this.definitionExpression=null,this.popupEnabled=!0,this.popupTemplate=null,this.layerType="3d-object"}get parsedUrl(){return this.layer?{path:`${this.layer.parsedUrl.path}/sublayers/${this.id}`,query:this.layer.parsedUrl.query}:null}get fieldsIndex(){return new C["a"](this.fields)}readAssociatedLayer(e,t){const i=this.layer.associatedFeatureServiceItem,r=t.associatedLayerID;return Object(u["l"])(i)&&"number"==typeof r?new g["default"]({portalItem:i,layerId:r}):null}get objectIdField(){if(null!=this.fields)for(const e of this.fields)if("oid"===e.type)return e.name;return null}get displayField(){return Object(u["l"])(this.associatedLayer)?this.associatedLayer.displayField:null}get defaultPopupTemplate(){return this.createPopupTemplate()}load(e){const t=Object(u["l"])(e)?e.signal:null,i=this._fetchService(t).then(()=>{this.indexInfo=Object(P["a"])(this.parsedUrl.path,this.rootNode,this.nodePages,this.apiKey,T,t)});return this.addResolvingPromise(i),Promise.resolve(this)}createPopupTemplate(e){return Object(S["a"])(this,e)}async _fetchService(e){const t=(await Object(n["default"])(this.parsedUrl.path,{query:{f:"json",token:this.apiKey},responseType:"json",signal:e})).data;this.read(t,{origin:"service",url:this.parsedUrl})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var i,r,a,s;const n=null==(i=this.getFeatureType(null==t?void 0:t.feature))||null==(r=i.domains)?void 0:r[e];return n&&"inherited"!==n.type?n:null!=(a=null==(s=this.getField(e))?void 0:s.domain)?a:null}getFeatureType(e){return e&&Object(u["l"])(this.associatedLayer)?this.associatedLayer.getFeatureType(e):null}get types(){return Object(u["l"])(this.associatedLayer)?this.associatedLayer.types:[]}get typeIdField(){return Object(u["l"])(this.associatedLayer)?this.associatedLayer.typeIdField:null}get geometryType(){return"3d-object"===this.layerType?"mesh":"point"}get profile(){return"3d-object"===this.layerType?"mesh-pyramids":"points"}get capabilities(){const e=Object(u["l"])(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:m["a"],{query:t,data:{supportsZ:i,supportsM:r,isVersioned:a}}=e;return{query:t,data:{supportsZ:i,supportsM:r,isVersioned:a}}}createQuery(){const e=new E["a"];return"mesh"!==this.geometryType&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryFeatures(e||this.createQuery(),t)).then(e=>{if(null!=e&&e.features)for(const t of e.features)t.layer=this.layer,t.sourceLayer=this;return e})}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryObjectIds(e||this.createQuery(),t))}getFieldUsageInfo(e){return this.fieldsIndex.has(e)?{supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1}:{supportsLabelingInfo:!1,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:Object(u["l"])(this.associatedLayer)}}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return Object(u["l"])(e)&&e.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),Object(u["k"])(this.associatedLayer))throw new o["a"]("buildingscenelayer:query-not-available","BuildingSceneLayer component layer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new o["a"]("buildingscenelayer:query-not-available","BuildingSceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}};Object(r["a"])([Object(b["b"])({readOnly:!0})],D.prototype,"parsedUrl",null),Object(r["a"])([Object(b["b"])({type:x["c"],readOnly:!0})],D.prototype,"nodePages",void 0),Object(r["a"])([Object(b["b"])({type:[x["b"]],readOnly:!0})],D.prototype,"materialDefinitions",void 0),Object(r["a"])([Object(b["b"])({type:[x["d"]],readOnly:!0})],D.prototype,"textureSetDefinitions",void 0),Object(r["a"])([Object(b["b"])({type:[x["a"]],readOnly:!0})],D.prototype,"geometryDefinitions",void 0),Object(r["a"])([Object(b["b"])({readOnly:!0})],D.prototype,"serviceUpdateTimeStamp",void 0),Object(r["a"])([Object(b["b"])({readOnly:!0})],D.prototype,"store",void 0),Object(r["a"])([Object(b["b"])({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],D.prototype,"rootNode",void 0),Object(r["a"])([Object(b["b"])({readOnly:!0})],D.prototype,"attributeStorageInfo",void 0),Object(r["a"])([Object(b["b"])(F.fields)],D.prototype,"fields",void 0),Object(r["a"])([Object(b["b"])({readOnly:!0})],D.prototype,"fieldsIndex",null),Object(r["a"])([Object(b["b"])({readOnly:!0,type:g["default"]})],D.prototype,"associatedLayer",void 0),Object(r["a"])([Object(y["a"])("service","associatedLayer",["associatedLayerID"])],D.prototype,"readAssociatedLayer",null),Object(r["a"])([Object(b["b"])(F.outFields)],D.prototype,"outFields",void 0),Object(r["a"])([Object(b["b"])({type:String,readOnly:!0})],D.prototype,"objectIdField",null),Object(r["a"])([Object(b["b"])({readOnly:!0,type:String,json:{read:!1}})],D.prototype,"displayField",null),Object(r["a"])([Object(b["b"])({readOnly:!0,type:String,aliasOf:"layer.apiKey"})],D.prototype,"apiKey",void 0),Object(r["a"])([Object(b["b"])({readOnly:!0,type:f["a"],aliasOf:"layer.fullExtent"})],D.prototype,"fullExtent",void 0),Object(r["a"])([Object(b["b"])({readOnly:!0,type:j["a"],aliasOf:"layer.spatialReference"})],D.prototype,"spatialReference",void 0),Object(r["a"])([Object(b["b"])({readOnly:!0,aliasOf:"layer.version"})],D.prototype,"version",void 0),Object(r["a"])([Object(b["b"])({readOnly:!0,type:V["a"],aliasOf:"layer.elevationInfo"})],D.prototype,"elevationInfo",void 0),Object(r["a"])([Object(b["b"])({readOnly:!0,type:Number,aliasOf:"layer.minScale"})],D.prototype,"minScale",void 0),Object(r["a"])([Object(b["b"])({readOnly:!0,type:Number,aliasOf:"layer.maxScale"})],D.prototype,"maxScale",void 0),Object(r["a"])([Object(b["b"])({type:["hide","show"],json:{write:!0}})],D.prototype,"listMode",void 0),Object(r["a"])([Object(b["b"])({types:s["b"],json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],D.prototype,"renderer",void 0),Object(r["a"])([Object(b["b"])({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],D.prototype,"definitionExpression",void 0),Object(r["a"])([Object(b["b"])(w["j"])],D.prototype,"popupEnabled",void 0),Object(r["a"])([Object(b["b"])({type:a["a"],json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],D.prototype,"popupTemplate",void 0),Object(r["a"])([Object(b["b"])({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],D.prototype,"normalReferenceFrame",void 0),Object(r["a"])([Object(b["b"])({readOnly:!0,json:{read:!1}})],D.prototype,"defaultPopupTemplate",null),Object(r["a"])([Object(b["b"])()],D.prototype,"types",null),Object(r["a"])([Object(b["b"])()],D.prototype,"typeIdField",null),Object(r["a"])([Object(b["b"])({json:{write:!1}}),Object(h["a"])(new l["a"]({"3DObject":"3d-object",Point:"point"}))],D.prototype,"layerType",void 0),Object(r["a"])([Object(b["b"])()],D.prototype,"geometryType",null),Object(r["a"])([Object(b["b"])()],D.prototype,"profile",null),Object(r["a"])([Object(b["b"])({readOnly:!0,json:{read:!1}})],D.prototype,"capabilities",null),D=Object(r["a"])([Object(O["a"])("esri.layers.buildingSublayers.BuildingComponentSublayer")],D);const L=D},f3d9:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return u}));var r=i("d272"),a=i("4db9"),s=i("d047"),n=i("c6d7"),o=i("ebd5"),l=i("4377"),c=i("3886"),d=i("690a");function u(e){const t=new d["a"];return t.include(a["a"],{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(c["a"]`
    void main(void) {
      vpos = position;
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(r["a"],e),e.multipassTerrainEnabled&&(t.fragment.include(s["a"]),t.include(n["b"],e)),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),7===e.output?t.fragment.code.add(c["a"]`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${c["a"].float(o["b"])}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(t.fragment.include(l["a"]),t.fragment.code.add(c["a"]`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${c["a"].float(o["b"])}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),t}const p=Object.freeze({__proto__:null,build:u})},f53a:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this.view.watch("ready",e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())})}applyProps(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}}}]);
//# sourceMappingURL=chunk-151674ce.76ac0bfc.js.map