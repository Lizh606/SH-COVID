(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7458a43c"],{"18c6":function(e,t,i){"use strict";i.d(t,"a",(function(){return L})),i.d(t,"b",(function(){return V})),i.d(t,"c",(function(){return E})),i.d(t,"d",(function(){return z})),i.d(t,"e",(function(){return R})),i.d(t,"f",(function(){return D})),i.d(t,"g",(function(){return I})),i.d(t,"h",(function(){return C}));var n=i("ce50"),r=i("c84e"),s=i("9b77");function o(e,t){const i=r["e"].SIZE_FIELD_STOPS|r["e"].SIZE_MINMAX_VALUE|r["e"].SIZE_SCALE_STOPS|r["e"].SIZE_UNIT_VALUE,n=(e&(r["f"].FIELD_TARGETS_OUTLINE|r["f"].MINMAX_TARGETS_OUTLINE|r["f"].SCALE_TARGETS_OUTLINE|r["f"].UNIT_TARGETS_OUTLINE))>>>4;return t.isOutline||t.isOutlinedFill?i&n:i&~n}const a=0,l=8,c=7,u=8,d=11,h=11,f=12,_=13,m=14,p=15,v=15,g=16,y=17,b=18,S=19,w=20,x=21,T=22;function I(e,t){switch(e){case r["d"].FILL:return L.from(t);case r["d"].LINE:return E.from(t);case r["d"].MARKER:return z.from(t);case r["d"].TEXT:return D.from(t);case r["d"].LABEL:return V.from(t);default:throw new Error("Unable to createMaterialKey for unknown geometryType "+e)}}function C(e){switch(R.load(e).geometryType){case r["d"].MARKER:return new z(e);case r["d"].FILL:return new L(e);case r["d"].LINE:return new E(e);case r["d"].TEXT:return new D(e);case r["d"].LABEL:return new V(e)}}class R{constructor(e){this._data=0,this._data=e}static load(e){const t=this.shared;return t.data=e,t}set data(e){this._data=e}get data(){return this._data}get geometryType(){return this.bits(u,d)}set geometryType(e){this.setBits(e,u,d)}get mapAligned(){return!!this.bit(w)}set mapAligned(e){this.setBit(w,e)}get sdf(){return!!this.bit(h)}set sdf(e){this.setBit(h,e)}get pattern(){return!!this.bit(f)}set pattern(e){this.setBit(f,e)}get textureBinding(){return this.bits(a,l)}set textureBinding(e){this.setBits(e,a,l)}get geometryTypeString(){switch(this.geometryType){case r["d"].FILL:return"fill";case r["d"].MARKER:return"marker";case r["d"].LINE:return"line";case r["d"].TEXT:return"text";case r["d"].LABEL:return"label";default:throw new n["a"]("Unable to handle unknown geometryType: "+this.geometryType)}}setBit(e,t){const i=1<<e;t?this._data|=i:this._data&=~i}bit(e){return(this._data&1<<e)>>e}setBits(e,t,i){for(let n=t,r=0;n<i;n++,r++)this.setBit(n,0!=(e&1<<r))}bits(e,t){let i=0;for(let n=e,r=0;n<t;n++,r++)i|=this.bit(n)<<r;return i}hasVV(){return!1}setVV(e,t){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(c&this.textureBinding)}}R.shared=new R(0);const M=e=>class extends e{get vvSizeMinMaxValue(){return 0!==this.bit(g)}set vvSizeMinMaxValue(e){this.setBit(g,e)}get vvSizeScaleStops(){return 0!==this.bit(y)}set vvSizeScaleStops(e){this.setBit(y,e)}get vvSizeFieldStops(){return 0!==this.bit(b)}set vvSizeFieldStops(e){this.setBit(b,e)}get vvSizeUnitValue(){return 0!==this.bit(S)}set vvSizeUnitValue(e){this.setBit(S,e)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(e,t){super.setVV(e,t);const i=o(e,t)&e;this.vvSizeMinMaxValue=!!(i&r["e"].SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(i&r["e"].SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(i&r["e"].SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(i&r["e"].SIZE_SCALE_STOPS)}},P=e=>class extends e{get vvRotation(){return 0!==this.bit(p)}set vvRotation(e){this.setBit(p,e)}hasVV(){return super.hasVV()||this.vvRotation}setVV(e,t){super.setVV(e,t),this.vvRotation=!t.isOutline&&!!(e&r["e"].ROTATION)}},A=e=>class extends e{get vvColor(){return 0!==this.bit(_)}set vvColor(e){this.setBit(_,e)}hasVV(){return super.hasVV()||this.vvColor}setVV(e,t){super.setVV(e,t),this.vvColor=!t.isOutline&&!!(e&r["e"].COLOR)}},O=e=>class extends e{get vvOpacity(){return 0!==this.bit(m)}set vvOpacity(e){this.setBit(m,e)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(e,t){super.setVV(e,t),this.vvOpacity=!t.isOutline&&!!(e&r["e"].OPACITY)}};class L extends(A(O(M(R)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=r["d"].FILL,t.dotDensity="dot-density"===e.stride.fill,t.simple="simple"===e.stride.fill,t.outlinedFill=e.isOutlinedFill,t.dotDensity||t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,outlinedFill:this.outlinedFill,simple:this.simple,vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}get dotDensity(){return!!this.bit(v)}set dotDensity(e){this.setBit(v,e)}get simple(){return!!this.bit(T)}set simple(e){this.setBit(T,e)}get outlinedFill(){return!!this.bit(x)}set outlinedFill(e){this.setBit(x,e)}}L.shared=new L(0);class z extends(A(O(P(M(R))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=r["d"].MARKER,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}z.shared=new z(0);class E extends(A(O(M(R)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=r["d"].LINE,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}E.shared=new E(0);class D extends(A(O(P(M(R))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=r["d"].TEXT,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}D.shared=new D(0);class V extends(M(R)){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=r["d"].LABEL,t.setVV(e.vvFlags,e),t.mapAligned=Object(s["a"])(e.placement),t.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}V.shared=new V(0)},"1cb4":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("50e6"),r=i("dff3");class s{constructor(e,t){this.lockedSchemaPixelSize=e,this.isGCS=t}getLevelRowColumn(e){return this.isGCS?[e[0],e[1]>>1,e[2]>>1]:256===this.lockedSchemaPixelSize&&e[0]>0?[e[0]-1,e[1]>>1,e[2]>>1]:e}adjustLevel(e){return this.isGCS?e:256===this.lockedSchemaPixelSize?e>0?e-1:0:e}getShift(e,t){let i=0,n=0;return(256===this.lockedSchemaPixelSize||this.isGCS)&&(e[2]%2&&(i=t),e[1]%2&&(n=t)),[i,n]}getScale(e){if(this.isGCS){if(512===this.lockedSchemaPixelSize)return 4}else if(256===this.lockedSchemaPixelSize&&0===e)return 1;return 2}static create256x256CompatibleTileInfo(e){if(!e)return null;if(256===e.size[0]&&256===e.size[1])return e;const t=256,i=e.spatialReference.isGeographic,s=[],o=e.lods.length;for(let r=0;r<o;r++){const t=e.lods[r],o=i?t.resolution:2*t.resolution;s.push(new n["a"]({level:t.level,scale:t.scale,resolution:o}))}return new r["a"]({size:[t,t],dpi:e.dpi,format:e.format,compressionQuality:e.compressionQuality,origin:e.origin,spatialReference:e.spatialReference,lods:s})}static create512x512CompatibleTileInfo(e){if(!e)return null;if(256===e.size[0]||256===e.size[1])return null;const t=512,i=[],s=e.lods.length;for(let r=0;r<s;r++){const t=e.lods[r],s=.5*t.resolution;i.push(new n["a"]({level:t.level,scale:t.scale,resolution:s}))}return new r["a"]({size:[t,t],dpi:e.dpi,format:e.format,compressionQuality:e.compressionQuality,origin:e.origin,spatialReference:e.spatialReference,lods:i})}}},"361b":function(e,t,i){"use strict";i.d(t,"a",(function(){return T}));i("7ce4"),i("d267");var n=i("8e37"),r=(i("d17d"),i("a1ff"),i("0fa6"),i("c120"),i("1956"),i("9f8b"),i("d45f")),s=i("49f0");const o={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = mod(v_accumulatedDistance / (v_patternSize.x * v_widthRatio), 1.0);\nmediump float relativeTexY = 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX = mod((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio), 1.0);\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * v_lineHalfWidth;\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio = width / v_patternSize.y;\n#else\nv_widthRatio = width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}};function a(e){let t=o;return e.split("/").forEach(e=>{t&&(t=t[e])}),t}const l=new s["a"](a);function c(e){return l.resolveIncludes(e)}const u=e=>Object(r["b"])({ID:e.id,PATTERN:e.pattern}),d={shaders:e=>({vertexShader:u(e)+c("background/background.vert"),fragmentShader:u(e)+c("background/background.frag")})},h=e=>Object(r["b"])({ID:e.id}),f={shaders:e=>({vertexShader:h(e)+c("circle/circle.vert"),fragmentShader:h(e)+c("circle/circle.frag")})},_=e=>Object(r["b"])({ID:e.id,PATTERN:e.pattern}),m={shaders:e=>({vertexShader:_(e)+c("fill/fill.vert"),fragmentShader:_(e)+c("fill/fill.frag")})},p=e=>Object(r["b"])({ID:e.id}),v={shaders:e=>({vertexShader:p(e)+c("outline/outline.vert"),fragmentShader:p(e)+c("outline/outline.frag")})},g=e=>Object(r["b"])({ID:e.id,SDF:e.sdf}),y={shaders:e=>({vertexShader:g(e)+c("icon/icon.vert"),fragmentShader:g(e)+c("icon/icon.frag")})},b=e=>Object(r["b"])({ID:e.id,PATTERN:e.pattern,SDF:e.sdf}),S={shaders:e=>({vertexShader:b(e)+c("line/line.vert"),fragmentShader:b(e)+c("line/line.frag")})},w=e=>Object(r["b"])({ID:e.id}),x={shaders:e=>({vertexShader:w(e)+c("text/text.vert"),fragmentShader:w(e)+c("text/text.frag")})};class T{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach(e=>e.dispose()),this._programByKey.clear()}getMaterialProgram(e,t,i){const r=t.key<<3|this._getMaterialOptionsValue(t.type,i);if(this._programByKey.has(r))return this._programByKey.get(r);const s=this._getProgramTemplate(t.type),{shaders:o}=s,{vertexShader:a,fragmentShader:l}=o(i),c=t.getShaderHeader(),u=t.getShaderMain(),d=a.replace("#pragma header",c).replace("#pragma main",u),h=new n["a"](e,d,l,t.getAttributeLocations());return this._programByKey.set(r,h),h}_getMaterialOptionsValue(e,t){switch(e){case 0:{const e=t;return(e.pattern?1:0)<<1|(e.id?1:0)}case 1:{const e=t;return(e.pattern?1:0)<<1|(e.id?1:0)}case 2:return t.id?1:0;case 3:{const e=t;return(e.sdf?1:0)<<2|(e.pattern?1:0)<<1|(e.id?1:0)}case 4:{const e=t;return(e.sdf?1:0)<<1|(e.id?1:0)}case 5:return t.id?1:0;case 6:return t.id?1:0;default:return 0}}_getProgramTemplate(e){switch(e){case 0:return d;case 5:return f;case 1:return m;case 4:return y;case 3:return S;case 2:return v;case 6:return x;default:return null}}}},"51b2":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n=i("8c71"),r=i("db21"),s=i("bc05");function o(e,t,i,n,r,s){const{iconRotationAlignment:o,textRotationAlignment:a,iconTranslate:l,iconTranslateAnchor:c,textTranslate:u,textTranslateAnchor:d}=n;let h=0;for(const f of e.colliders){const[e,n]=0===f.partIndex?l:u,_=0===f.partIndex?c:d,m=f.minLod<=s&&s<=f.maxLod;h+=m?0:1,f.enabled=m,f.xScreen=f.xTile*r[0]+f.yTile*r[3]+r[6],f.yScreen=f.xTile*r[1]+f.yTile*r[4]+r[7],0===_?(f.xScreen+=i*e-t*n,f.yScreen+=t*e+i*n):(f.xScreen+=e,f.yScreen+=n),1===(0===f.partIndex?o:a)?(f.dxScreen=f.dxPixels,f.dyScreen=f.dyPixels):(f.dxScreen=i*(f.dxPixels+f.width/2)-t*(f.dyPixels+f.height/2)-f.width/2,f.dyScreen=t*(f.dxPixels+f.width/2)+i*(f.dyPixels+f.height/2)-f.height/2)}e.colliders.length>0&&h===e.colliders.length&&(e.unique.show=!1)}class a{constructor(e,t,i,o,a,l){this._symbols=e,this._styleRepository=o,this._zoom=a,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new s["a"](t,i,r["a"]),this._si=Math.sin(Math.PI*l/180),this._co=Math.cos(Math.PI*l/180);for(const r of e)for(const e of r.symbols)this._allNeededMatrices.has(e.tile)||this._allNeededMatrices.set(e.tile,Object(n["a"])(e.tile.transforms.tileUnitsToPixels))}work(e){const t=this._gridIndex;function i(e){const i=e.xScreen+e.dxScreen,n=e.yScreen+e.dyScreen,r=i+e.width,s=n+e.height,[o,a,l,c]=t.getCellSpan(i,n,r,s);for(let u=a;u<=c;u++)for(let e=o;e<=l;e++){const o=t.cells[u][e];for(const e of o){const t=e.xScreen+e.dxScreen,o=e.yScreen+e.dyScreen,a=t+e.width,l=o+e.height;if(!(r<t||i>a||s<o||n>l))return!0}}return!1}const n=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const t=this._symbols[this._currentLayerCursor],r=this._getProperties(t.styleLayerUID);for(;this._currentSymbolCursor<t.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-n>e)return!1;const s=t.symbols[this._currentSymbolCursor];if(!s.unique.show)continue;o(s,this._si,this._co,r,this._allNeededMatrices.get(s.tile),this._zoom);const a=s.unique;if(!a.show)continue;const{iconAllowOverlap:l,iconIgnorePlacement:c,textAllowOverlap:u,textIgnorePlacement:d}=r;for(const e of s.colliders){if(!e.enabled)continue;const t=a.parts[e.partIndex];t.show&&(!(e.partIndex?u:l)&&i(e)&&(e.hard?a.show=!1:t.show=!1))}if(a.show)for(const e of s.colliders){if(!e.enabled)continue;if(e.partIndex?d:c)continue;if(!a.parts[e.partIndex].show)continue;const t=e.xScreen+e.dxScreen,i=e.yScreen+e.dyScreen,n=t+e.width,r=i+e.height,[s,o,l,u]=this._gridIndex.getCellSpan(t,i,n,r);for(let a=o;a<=u;a++)for(let t=s;t<=l;t++)this._gridIndex.cells[a][t].push(e)}}}return!0}_getProperties(e){const t=this._styleProps.get(e);if(t)return t;const i=this._zoom,n=this._styleRepository.getStyleLayerByUID(e),r=0!==n.getLayoutValue("symbol-placement",i);let s=n.getLayoutValue("icon-rotation-alignment",i);2===s&&(s=r?0:1);let o=n.getLayoutValue("text-rotation-alignment",i);2===o&&(o=r?0:1);const a=n.getPaintValue("icon-translate",i),l=n.getPaintValue("icon-translate-anchor",i),c=n.getPaintValue("text-translate",i),u=n.getPaintValue("text-translate-anchor",i),d={iconAllowOverlap:n.getLayoutValue("icon-allow-overlap",i),iconIgnorePlacement:n.getLayoutValue("icon-ignore-placement",i),textAllowOverlap:n.getLayoutValue("text-allow-overlap",i),textIgnorePlacement:n.getLayoutValue("text-ignore-placement",i),iconRotationAlignment:s,textRotationAlignment:o,iconTranslateAnchor:l,iconTranslate:a,textTranslateAnchor:u,textTranslate:c};return this._styleProps.set(e,d),d}}},"81af":function(e,t,i){"use strict";i.d(t,"a",(function(){return S}));var n=i("2eab"),r=i("c120"),s=i("f4cc"),o=i("e041"),a=i("dfa0"),l=(i("7ce4"),i("d267"),i("1956"),i("d17d"),i("9f8b"),i("a1ff")),c=(i("0fa6"),i("a9c0"));class u{constructor(e,t){this._width=0,this._height=0,this._free=[],this._width=e,this._height=t,this._free.push(new c["a"](0,0,e,t))}get width(){return this._width}get height(){return this._height}allocate(e,t){if(e>this._width||t>this._height)return new c["a"];let i=null,n=-1;for(let r=0;r<this._free.length;++r){const s=this._free[r];e<=s.width&&t<=s.height&&(null===i||s.y<=i.y&&s.x<=i.x)&&(i=s,n=r)}return null===i?new c["a"]:(this._free.splice(n,1),i.width<i.height?(i.width>e&&this._free.push(new c["a"](i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new c["a"](i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new c["a"](i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new c["a"](i.x,i.y+t,e,i.height-t))),new c["a"](i.x,i.y,e,t))}release(e){for(let t=0;t<this._free.length;++t){const i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}class d{constructor(e,t,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=e,this.height=t,this._glyphSource=i,this._binPack=new u(e-4,t-4),this._glyphData.push(new Uint8Array(e*t)),this._dirties.push(!0),this._textures.push(void 0)}getGlyphItems(e,t){const i=[],n=this._glyphSource,r=new Set,s=1/256;for(const a of t){const e=Math.floor(a*s);r.add(e)}const o=[];return r.forEach(t=>{if(t<=256){const i=e+t;if(this._rangePromises.has(i))o.push(this._rangePromises.get(i));else{const r=n.getRange(e,t).then(()=>{this._rangePromises.delete(i)},()=>{this._rangePromises.delete(i)});this._rangePromises.set(i,r),o.push(r)}}}),Promise.all(o).then(()=>{let r=this._glyphIndex[e];r||(r={},this._glyphIndex[e]=r);for(const s of t){const t=r[s];if(t){i[s]={sdf:!0,rect:t.rect,metrics:t.metrics,page:t.page,code:s};continue}const o=n.getGlyph(e,s);if(!o||!o.metrics)continue;const a=o.metrics;let l;if(0===a.width)l=new c["a"](0,0,0,0);else{const e=3,t=a.width+2*e,i=a.height+2*e;let n=t%4?4-t%4:4,r=i%4?4-i%4:4;1===n&&(n=5),1===r&&(r=5),l=this._binPack.allocate(t+n,i+r),l.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new u(this.width-4,this.height-4),l=this._binPack.allocate(t+n,i+r));const s=this._glyphData[this._currentPage],c=o.bitmap;let d,h;if(c)for(let o=0;o<i;o++){d=t*o,h=this.width*(l.y+o+1)+l.x;for(let e=0;e<t;e++)s[h+e+1]=c[d+e]}}r[s]={rect:l,metrics:a,tileIDs:null,page:this._currentPage},i[s]={sdf:!0,rect:l,metrics:a,page:this._currentPage,code:s},this._dirties[this._currentPage]=!0}return i})}removeGlyphs(e){for(const t in this._glyphIndex){const i=this._glyphIndex[t];if(!i)continue;let n;for(const t in i)if(n=i[t],n.tileIDs.delete(e),0===n.tileIDs.size){const e=this._glyphData[n.page],r=n.rect;let s,o;for(let t=0;t<r.height;t++)for(s=this.width*(r.y+t)+r.x,o=0;o<r.width;o++)e[s+o]=0;delete i[t],this._dirties[n.page]=!0}}}bind(e,t,i,n=0){this._textures[i]||(this._textures[i]=new l["a"](e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));const r=this._textures[i];r.setSamplingMode(t),this._dirties[i]&&r.setData(this._glyphData[i]),e.bindTexture(r,n),this._dirties[i]=!1}dispose(){this._binPack=null;for(const e of this._textures)e&&e.dispose();this._textures.length=0}}var h=i("013b");class f{constructor(e){if(this._metrics=[],this._bitmaps=[],e)for(;e.next();)switch(e.tag()){case 1:{const t=e.getMessage();for(;t.next();)switch(t.tag()){case 3:{const e=t.getMessage();let i,n,r,s,o,a,l;for(;e.next();)switch(e.tag()){case 1:i=e.getUInt32();break;case 2:n=e.getBytes();break;case 3:r=e.getUInt32();break;case 4:s=e.getUInt32();break;case 5:o=e.getSInt32();break;case 6:a=e.getSInt32();break;case 7:l=e.getUInt32();break;default:e.skip()}e.release(),i&&(this._metrics[i]={width:r,height:s,left:o,top:a,advance:l},this._bitmaps[i]=n);break}default:t.skip()}t.release();break}default:e.skip()}}getMetrics(e){return this._metrics[e]}getBitmap(e){return this._bitmaps[e]}}class _{constructor(){this._ranges=[]}getRange(e){return this._ranges[e]}addRange(e,t){this._ranges[e]=t}}class m{constructor(e){this._glyphInfo={},this._baseURL=e}getRange(e,t){const i=this._getFontStack(e);if(i.getRange(t))return Promise.resolve();const r=256*t,s=r+255,o=this._baseURL.replace("{fontstack}",e).replace("{range}",r+"-"+s);return Object(n["default"])(o,{responseType:"array-buffer"}).then(e=>{i.addRange(t,new f(new h["a"](new Uint8Array(e.data),new DataView(e.data))))}).catch(()=>{i.addRange(t,new f)})}getGlyph(e,t){const i=this._getFontStack(e);if(!i)return;const n=Math.floor(t/256);if(n>256)return;const r=i.getRange(n);return r?{metrics:r.getMetrics(t),bitmap:r.getBitmap(t)}:void 0}_getFontStack(e){let t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new _),t}}var p=i("793f");const v="dasharray-";class g{constructor(e,t,i=0){this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(e<=0||t<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=t,i>0&&(this._maxItemSize=i),this._binPack=new u(e-4,t-4)}dispose(){this._binPack=null,this._mosaicRects={};for(const e of this._textures)e&&e.dispose();this._textures.length=0}getWidth(e){return e>=this._size.length?-1:this._size[e][0]}getHeight(e){return e>=this._size.length?-1:this._size[e][1]}getPageSize(e){return e>=this._size.length?null:this._size[e]}setSpriteSource(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new u(this._pageWidth-4,this._pageHeight-4);const e=Math.floor(this._pageWidth),t=Math.floor(this._pageHeight),i=new Uint32Array(e*t);this._mosaicsData[0]=i,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}getSpriteItem(e,t=!1){let i,n,r=this._mosaicRects[e];if(r)return r;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(e&&e.startsWith(v)?([i,n]=this._rasterizeDash(e),t=!0):i=this._sprites.getSpriteInfo(e),!i||!i.width||!i.height||i.width<0||i.height<0)return null;const s=i.width,o=i.height,[a,l,c]=this._allocateImage(s,o);return a.width<=0?null:(this._copy(a,i,l,c,t,n),r={rect:a,width:s,height:o,sdf:i.sdf,simplePattern:!1,pixelRatio:i.pixelRatio,page:l},this._mosaicRects[e]=r,r)}getSpriteItems(e){const t={};for(const i of e)t[i.name]=this.getSpriteItem(i.name,i.repeat);return t}getMosaicItemPosition(e,t){const i=this.getSpriteItem(e,t),n=i&&i.rect;if(!n)return null;n.width=i.width,n.height=i.height;const r=i.width,s=i.height,o=2;return{tl:[n.x+o,n.y+o],br:[n.x+o+r,n.y+o+s],page:i.page}}bind(e,t,i=0,n=0){this._textures[i]||(this._textures[i]=new l["a"](e,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[i][0],height:this._size[i][1]},new Uint8Array(this._mosaicsData[i].buffer)));const r=this._textures[i];r.setSamplingMode(t),this._dirties[i]&&r.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(r,n),this._dirties[i]=!1}static _copyBits(e,t,i,n,r,s,o,a,l,c,u){let d=n*t+i,h=a*s+o;if(u){h-=s;for(let o=-1;o<=c;o++,d=((o+c)%c+n)*t+i,h+=s)for(let t=-1;t<=l;t++)r[h+t]=e[d+(t+l)%l]}else for(let f=0;f<c;f++){for(let t=0;t<l;t++)r[h+t]=e[d+t];d+=t,h+=s}}_copy(e,t,i,n,r,s){if(!this._sprites||"loaded"!==this._sprites.loadStatus||i>=this._mosaicsData.length)return;const o=new Uint32Array(s?s.buffer:this._sprites.image.buffer),a=this._mosaicsData[i];a&&o||console.error("Source or target images are uninitialized!");const l=2,c=s?t.width:this._sprites.width;g._copyBits(o,c,t.x,t.y,a,n[0],e.x+l,e.y+l,t.width,t.height,r),this._dirties[i]=!0}_allocateImage(e,t){e+=2,t+=2;const i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){const i=new c["a"](0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[i,this._mosaicsData.length-1,[e,t]]}let n=e%4?4-e%4:4,r=t%4?4-t%4:4;1===n&&(n=5),1===r&&(r=5);const s=this._binPack.allocate(e+n,t+r);return s.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new u(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[s,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(e){const t=/\[(.*?)\]/,i=e.match(t);if(!i)return null;const n=i[1].split(",").map(Number),r=e.slice(e.lastIndexOf("-")+1),[s,o,a]=p["d"].rasterizeDash(n,r);return[{x:0,y:0,width:o,height:a,sdf:!0,pixelRatio:1},new Uint8Array(s.buffer)]}}var y=i("bf7f"),b=i("ae54");class S{constructor(e,t,i){this._layer=e,this._styleRepository=t,this.devicePixelRatio=i,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null}destroy(){this._connection&&(this._connection.close(),this._connection=null),this._styleRepository=null,this._layer=null,this._spriteMosaic&&(this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic=null)}get spriteMosaic(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}get glyphMosaic(){return this._glyphMosaic}async start(e){this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,e),this._spriteSourcePromise.then(e=>{this._spriteMosaic=new g(1024,1024,250),this._spriteMosaic.setSpriteSource(e)});const t=new m(this._layer.currentStyleInfo.glyphsUrl?Object(o["e"])(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new d(1024,1024,t),this._broadcastPromise=Object(a["b"])("WorkerTileHandler",{client:this,schedule:e.schedule,signal:e.signal}).then(t=>(this._connection=t,Promise.all(this._connection.broadcast("setStyle",{style:this._layer.currentStyleInfo.style,vectorTileLayerMaxBuffers:Object(r["a"])("vectortilelayer-max-buffers")},e))))}async updateStyle(e){return await this._broadcastPromise,this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",e)),this._broadcastPromise}async setStyle(e,t){await this._broadcastPromise,this._styleRepository=e,this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,null),this._spriteSourcePromise.then(e=>{this._spriteMosaic=new g(1024,1024,250),this._spriteMosaic.setSpriteSource(e)});const i=new m(this._layer.currentStyleInfo.glyphsUrl?Object(o["e"])(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);return this._glyphMosaic=new d(1024,1024,i),this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",{style:t,vectorTileLayerMaxBuffers:Object(r["a"])("vectortilelayer-max-buffers")})),this._broadcastPromise}fetchTileData(e,t){return this._getRefKeys(e,t).then(e=>{const i=this._layer.sourceNameToSource,n=[];for(const t in i)n.push(t);return this._getSourcesData(n,e,t)})}parseTileData(e,t){const i=e&&e.data;if(!i)return Promise.resolve(null);const{sourceName2DataAndRefKey:n,transferList:r}=i;return 0===Object.keys(n).length?Promise.resolve(null):this._broadcastPromise.then(()=>this._connection.getAvailableClient().then(i=>i.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:n,styleLayerUIDs:e.styleLayerUIDs},{...t,transferList:r})))}async getSprites(e){return await this._spriteSourcePromise,this._spriteMosaic.getSpriteItems(e)}getGlyphs(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}perfReport({key:e,milliseconds:t}){Object(y["b"])(e,t,"ms")}async _getTilePayload(e,t,i){const n=b["a"].pool.acquire(e.id),r=this._layer.sourceNameToSource[t].getSourceTileUrl(n.level,n.row,n.col);b["a"].pool.release(n);try{return{protobuff:await this.request(r,i),sourceName:t}}catch(o){if(Object(s["m"])(o))throw o;return{protobuff:null,sourceName:t}}}request(e,t){return Object(n["default"])(e,{responseType:"array-buffer",...t}).then(({data:e})=>e)}_getRefKeys(e,t){const i=this._layer.sourceNameToSource,n=new Array;for(const r in i){const s=i[r].getRefKey(e,t);n.push(s)}return Object(s["j"])(n)}_getSourcesData(e,t,i){const n=[];for(let r=0;r<t.length;r++)if(null==t[r].value||null==e[r])n.push(null);else{const s=this._getTilePayload(t[r].value,e[r],i);n.push(s)}return Object(s["j"])(n).then(e=>{const i={},n=[];for(let r=0;r<e.length;r++)if(e[r].value&&e[r].value&&e[r].value.protobuff&&e[r].value.protobuff.byteLength>0){const s=t[r].value.id;i[e[r].value.sourceName]={refKey:s,protobuff:e[r].value.protobuff},n.push(e[r].value.protobuff)}return{sourceName2DataAndRefKey:i,transferList:n}})}}},"9b77":function(e,t,i){"use strict";function n(e){switch(e){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}i.d(t,"a",(function(){return n}))},a9a2:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return l}));var n=i("d114");function r(e,t){return Array.isArray(t)?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]):(e[0]=t.r,e[1]=t.g,e[2]=t.b,e[3]=t.a),e}function s(e,t=0,i=!1){const n=e[t+3];return e[t+0]*=n,e[t+1]*=n,e[t+2]*=n,i||(e[t+3]*=255),e}function o(e){return s(r([],e))}function a(e){if(!e)return 0;const{r:t,g:i,b:r,a:s}=e;return Object(n["b"])(t*s,i*s,r*s,255*s)}function l(e){if(!e)return 0;const[t,i,r,s]=e;return Object(n["b"])(t*(s/255),i*(s/255),r*(s/255),s)}},ac41:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i("b2b2"),r=i("db21");function s(e,t){if(e.priority-t.priority)return e.priority-t.priority;const i=e.tile.key,n=t.tile.key;return i.world-n.world?i.world-n.world:i.level-n.level?i.level-n.level:i.row-n.row?i.row-n.row:i.col-n.col?i.col-n.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}class o{constructor(e,t,i,n,r,s){this._visibleTiles=e,this._symbolRepository=t,this._createCollisionJob=i,this._assignTileSymbolsOpacity=n,this._symbolLayerSorter=r,this._isLayerVisible=s,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}get running(){return this._running}setScreenSize(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const t=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const t=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}return this._running=!1,!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let s=0;s<e.length;s++){const t=e[s];for(let e=0;e<t.uniqueSymbols.length;e++){const i=t.uniqueSymbols[e];for(const e of i.tileSymbols)e.selectedForRendering=!1}}const t=[];let i=0,n=0;const r=this._isLayerVisible;function o(o){let a;const l=performance.now();for(;n<e.length;n++,i=0){const s=e[n],c=s.styleLayerUID;if(!r(c)){t[n]||(t[n]={styleLayerUID:c,symbols:[]});continue}t[n]=t[n]||{styleLayerUID:c,symbols:[]};const u=t[n];for(;i<s.uniqueSymbols.length;i++){if(a=s.uniqueSymbols[i],i%100==99&&performance.now()-l>o)return!1;let e=null,t=!1,n=!1;for(const i of a.tileSymbols)if(!n||!t){const r=i.tile;(!e||r.isCoverage||r.neededForCoverage&&!t)&&(e=i,(r.neededForCoverage||r.isCoverage)&&(n=!0),r.isCoverage&&(t=!0))}if(e.selectedForRendering=!0,n){u.symbols.push(e),a.show=!0;for(const e of a.parts)e.show=!0}else a.show=!1}}for(const e of t)e.symbols.sort(s);return!0}const a=this._symbolLayerSorter;return{work:o,get sortedSymbols(){return t.sort(a)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,t=this._visibleTiles;let i=0;function r(t,i){const n=t.symbols;for(const[e,r]of n)a(r,i);e(t,i);for(const e of t.childrenTiles)r(e,i)}return{work(e){const s=performance.now();for(;i<t.length;i++){if(performance.now()-s>e)return!1;const o=t[i];Object(n["l"])(o.parentTile)||r(o,performance.now())}return!0}}}}function a(e,t){for(const i of e){const e=i.unique;for(const i of e.parts){const n=i.targetOpacity>.5?1:-1;i.startOpacity+=n*((t-i.startTime)/r["d"]),i.startOpacity=Math.min(Math.max(i.startOpacity,0),1),i.startTime=t,i.targetOpacity=e.show&&i.show?1:0}}}},bf7f:function(e,t,i){"use strict";function n(e,t,i,n,r,s){e.fillStyle=t,e.fillRect(i,n,r,s)}function r(e,t,i,n,r,s){e.strokeStyle=t,e.strokeRect(i,n,r,s)}function s(e,t){const i=window.COLLISION_XRAY;for(let s=0;s<t.length;++s){const o=!t[s].unique.show;if(i||!o)for(const a of t[s].colliders){if(!a.enabled)continue;const l=!t[s].unique.parts[a.partIndex].show;if(!i&&l)continue;const c=a.xScreen,u=a.yScreen,d=a.dxScreen,h=a.dyScreen;e.globalAlpha=o||l?.2:1,n(e,"green",c-1,u-1,3,3),r(e,"red",c+d,u+h,a.width,a.height),n(e,"blue",c+d-1,u+h-1,3,3),e.globalAlpha=1}}}function o(e,t,i){if(!window.PERFORMANCE_RECORDING_STORAGE)return;const n=window.PERFORMANCE_RECORDING_STORAGE;n.perf=n.perf||{};const r=n.perf;r[e]=r[e]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:i},r[e].time+=t,r[e].samples.push(t),(null==r[e].min||t<r[e].min)&&(r[e].min=t),(null==r[e].max||t>r[e].max)&&(r[e].max=t)}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o}))},c84e:function(e,t,i){"use strict";var n,r,s,o,a,l,c;i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return n})),i.d(t,"e",(function(){return a})),i.d(t,"f",(function(){return l})),function(e){e[e.FILL=0]="FILL",e[e.LINE=1]="LINE",e[e.MARKER=2]="MARKER",e[e.TEXT=3]="TEXT",e[e.LABEL=4]="LABEL"}(n||(n={})),function(e){e[e.SUCCEEDED=0]="SUCCEEDED",e[e.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY"}(r||(r={})),function(e){e[e.NONE=0]="NONE",e[e.MAP=1]="MAP",e[e.LABEL=2]="LABEL",e[e.LABEL_ALPHA=4]="LABEL_ALPHA",e[e.HITTEST=8]="HITTEST",e[e.HIGHLIGHT=16]="HIGHLIGHT",e[e.CLIP=32]="CLIP",e[e.DEBUG=64]="DEBUG",e[e.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(s||(s={})),function(e){e[e.SIZE=0]="SIZE",e[e.COLOR=1]="COLOR",e[e.OPACITY=2]="OPACITY",e[e.ROTATION=3]="ROTATION"}(o||(o={})),function(e){e[e.NONE=0]="NONE",e[e.OPACITY=1]="OPACITY",e[e.COLOR=2]="COLOR",e[e.ROTATION=4]="ROTATION",e[e.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE",e[e.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS",e[e.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS",e[e.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"}(a||(a={})),function(e){e[e.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",e[e.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",e[e.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",e[e.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(l||(l={})),function(e){e[e.SPRITE=0]="SPRITE",e[e.GLYPH=1]="GLYPH"}(c||(c={}))},c8dd:function(e,t,i){"use strict";i.d(t,"a",(function(){return B})),i.d(t,"b",(function(){return z})),i.d(t,"c",(function(){return E})),i.d(t,"d",(function(){return le})),i.d(t,"e",(function(){return N})),i.d(t,"f",(function(){return H})),i.d(t,"g",(function(){return Y})),i.d(t,"h",(function(){return Z})),i.d(t,"i",(function(){return k})),i.d(t,"j",(function(){return F})),i.d(t,"k",(function(){return ae})),i.d(t,"l",(function(){return W})),i.d(t,"m",(function(){return j})),i.d(t,"n",(function(){return I})),i.d(t,"o",(function(){return ee})),i.d(t,"p",(function(){return U})),i.d(t,"q",(function(){return ne})),i.d(t,"r",(function(){return D})),i.d(t,"s",(function(){return te})),i.d(t,"t",(function(){return Q})),i.d(t,"u",(function(){return V})),i.d(t,"v",(function(){return ie})),i.d(t,"w",(function(){return se})),i.d(t,"x",(function(){return $})),i.d(t,"y",(function(){return re})),i.d(t,"z",(function(){return oe})),i.d(t,"A",(function(){return L}));var n=i("ce50"),r=i("e92d"),s=(i("38a4"),i("a915"),i("a9a2"),i("c84e")),o=i("ecd7");class a{constructor(){this.color=[0,0,0,0],this.haloColor=[0,0,0,0],this.haloSize=0,this.size=12,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}acquire(e,t,i,n,r,s,o,a,l){this.color=e,this.haloColor=t,this.haloSize=i,this.size=n,this.angle=r,this.offsetX=s,this.offsetY=o,this.hAnchor=a,this.vAnchor=l}release(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0,this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0,this.haloSize=0,this.size=0,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}}a.pool=new o["a"](a);i("a1ff");const l=r["a"].getLogger("esri.views.2d.engine.webgl.Utils"),c="geometry",u=[{name:c,strideInBytes:36,divisor:0}],d=[{name:c,strideInBytes:32,divisor:0}],h=[{name:c,strideInBytes:20,divisor:0}],f=[{name:c,strideInBytes:12,divisor:0}],_=[{name:c,strideInBytes:40,divisor:0}],m=[{name:c,strideInBytes:36,divisor:0}],p=[{name:c,strideInBytes:36,divisor:0}];function v(e){const t={};for(const i of e)t[i.name]=i.strideInBytes;return t}const g=v(u),y=v(d),b=v(h),S=v(f),w=v(_),x=v(m),T=v(p);function I(e,{fill:t}){switch(e){case s["d"].MARKER:return g;case s["d"].FILL:return"dot-density"===t?S:"simple"===t?b:y;case s["d"].LINE:return w;case s["d"].TEXT:return x;case s["d"].LABEL:return T}}const C=[c],R=[c],M=[c],P=[c],A=[c];function O(e){switch(e){case s["d"].MARKER:return C;case s["d"].FILL:return R;case s["d"].LINE:return M;case s["d"].TEXT:return P;case s["d"].LABEL:return A}}function L(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function z(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}}function E(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}}function D(e){return null!=e}function V(e){return"number"==typeof e}function k(e){switch(e){case"butt":return 0;case"round":return 1;case"square":return 2;default:return l.error(new n["a"]("mapview-invalid-type",`Cap type ${e} is not a valid option. Defaulting to round`)),1}}function F(e){switch(e){case"miter":return 2;case"bevel":return 0;case"round":return 1;default:return l.error(new n["a"]("mapview-invalid-type",`Join type ${e} is not a valid option. Defaulting to round`)),1}}function U(e){switch(e){case"opacity":return s["b"].OPACITY;case"color":return s["b"].COLOR;case"rotation":return s["b"].ROTATION;case"size":return s["b"].SIZE;default:return l.error("Cannot interpret unknown vv: "+e),null}}function N(e,t,i,n,r,s,o){for(const l in s){const t=s[l].stride,n=L(t),o=s[l].data,a=i[l].data,c=t*r.vertexCount/n,u=t*e/n,d=t*r.vertexFrom/n;for(let e=0;e<c;++e)a[e+u]=o[e+d]}const a=r.indexCount;for(let l=0;l<a;++l)n[l+t]=o[l+r.indexFrom]-r.vertexFrom+e}const B={[c]:35044};function H(e,t){const i=[];for(let n=0;n<5;++n){const r=O(n),s={};for(const e of r)s[e]={data:t(n,e)};i.push({data:e(n),buffers:s})}return i}function q(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function j(e){switch(e){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:return void l.error(new n["a"]("webgl-utils","Unable to handle type "+e))}}function W(e){switch(e){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:return void l.error(new n["a"]("webgl-utils","Unable to handle type "+e))}}function G(e){const t={};for(const i in e){const n=e[i];let r=0;t[i]=n.map(e=>{const t={...e,normalized:e.normalized||!1,divisor:e.divisor||0,offset:r,stride:0};return r+=e.count*q(e.type),t}),t[i].forEach(e=>e.stride=r)}return t}const J=e=>{const t=new Map;for(const i in e)for(const n of e[i])t.set(n.name,n.location);return t},X=e=>{const t={};for(const i in e){const n=e[i];t[i]=n.length?n[0].stride:0}return t},K=new Map,Y=(e,t)=>{if(!K.has(e)){const i=G(t),n={strides:X(i),bufferLayouts:i,attributes:J(t)};K.set(e,n)}return K.get(e)};function Z(e){e(s["d"].FILL),e(s["d"].LINE),e(s["d"].MARKER),e(s["d"].TEXT),e(s["d"].LABEL)}const $=e=>"path"in e&&ce(e.path),Q=e=>"url"in e&&e.url||"imageData"in e&&e.imageData,ee=e=>"imageData"in e&&e.imageData&&"contentType"in e&&e.contentType?`data:${e.contentType};base64,${e.imageData}`:"url"in e?e.url:null,te=e=>"url"in e&&e.url&&e.url.includes(".gif")||"contentType"in e&&"image/gif"===e.contentType||"imageData"in e&&e.imageData.includes("data:image/gif"),ie=e=>"url"in e&&e.url&&e.url.includes(".png")||"contentType"in e&&"image/png"===e.contentType||"imageData"in e&&e.imageData.includes("data:image/png"),ne=e=>e.type&&-1!==e.type.toLowerCase().indexOf("3d");function re(e){switch(e.type){case"line":{const t=e;return"CIMSolidStroke"===t.cim.type&&!t.dashTemplate}case"fill":return"CIMSolidFill"===e.cim.type;case"esriSFS":return"esriSFSSolid"===e.style||"esriSFSNull"===e.style;case"esriSLS":return"esriSLSSolid"===e.style||"esriSLSNull"===e.style;default:return!1}}const se=e=>e.includes("data:image/svg+xml");function oe(e){switch("cim"in e?e.cim.type:e.type){case"esriSMS":case"esriPMS":case"CIMPointSymbol":case"CIMVectorMarker":case"CIMPictureMarker":case"CIMCharacterMarker":return!1;default:return!0}}function ae(e){const t="maxVVSize"in e&&e.maxVVSize,i="width"in e&&e.width||"size"in e&&e.size||0;return t||i}function le(e){const t=[];for(let i=0;i<e.length;i++)t.push(e.charCodeAt(i));return t}const ce=e=>!!e&&(e=e.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(e)&&/[\dz]$/i.test(e)&&e.length>4))},ce88:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return E}));var n=i("a4ee"),r=i("ce50"),s=i("b2b2"),o=i("f4cc"),a=i("3795"),l=i("59b2"),c=(i("b50f"),i("c120"),i("cea0"),i("d386")),u=i("1cb4"),d=i("aefa"),h=i("8c71"),f=i("9180"),_=i("66b9"),m=i("81af"),p=i("cba1"),v=i("51b2"),g=i("ac41"),y=i("d5e4"),b=i("bc05");function S(e,t){const i=[],n=new y["a"](4096,i,()=>{const e=new p["b"];return e.show=!1,e.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1}),e.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1}),e}),r=new g["a"](i,n,(t,i,n)=>new v["a"](t,i,n,e.styleRepository,e.key.level,0),(e,t)=>{Object(b["d"])(e,t,!1)},()=>0,e=>{const i=t.getStyleLayerByUID(e).getLayoutProperty("visibility");return!i||1!==i.getValue()});i.push(e),n.add(e),r.setScreenSize(512,512),r.continue(1/0)}var w=i("ae54");class x extends m["a"]{constructor(e,t,i,n,r){super(e,t,i),this._memCache=n,this._loader=r,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map}destroy(){this._ongoingRequestToController.forEach(e=>e.abort()),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear()}async getVectorTile(e,t,i,n){const r=new w["a"](e,t,i,0);let a=this._memCache.get(r.id);if(Object(s["l"])(a))return a.retain(),a;const l=await this._getVectorTileData(r);if(Object(o["w"])(n),!this._layer)return null;if(a=this._memCache.get(r.id),Object(s["l"])(a))return a.retain(),a;const c=this._layer.tileInfo.getTileBounds(Object(f["l"])(),r);return a=new _["a"](r,c[0],c[3],512,512,this._styleRepository,this._memCache),Object(s["l"])(l)?(a.setData(l),a.retain(),this._memCache.put(r.id,a,a.memoryUsage*a.referenced,d["a"])):a.setData(null),a.neededForCoverage=!0,a.transforms.tileUnitsToPixels=Object(h["c"])(1/8,0,0,0,1/8,0,0,0,1),S(a,this._styleRepository),a}_getVectorTileData(e){const t=e.id;if(this._ongoingTileRequests.has(t))return this._ongoingTileRequests.get(t);const i=new AbortController,n={signal:i.signal},r=this._getParsedVectorTileData(e,n).then(e=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),e)).catch(()=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),null));return this._ongoingTileRequests.set(t,r),this._ongoingRequestToController.set(t,i),r}_getParsedVectorTileData(e,t){return this.fetchTileData(e,t).then(i=>this.parseTileData({key:e,data:i},t))}request(e,t){return this._loader.request(e,"binary",t)}}var T=i("3b1a"),I=i("361b");const C=1e-6;class R{constructor(e,t){this.spriteMosaic=e,this.glyphMosaic=t,this._brushCache=new Map,this._vtlMaterialManager=new I["a"]}dispose(){this._brushCache&&(this._brushCache.forEach(e=>e.dispose()),this._brushCache=null),this._vtlMaterialManager=Object(s["f"])(this._vtlMaterialManager),this.spriteMosaic.dispose(),this.glyphMosaic.dispose()}get vectorTilesMaterialManager(){return this._vtlMaterialManager}drawTile(e,t,i){const{context:n}=e,r=i.layers;i.backgroundBucketIds.length>0&&(e.renderPass="background",i.backgroundBucketIds.forEach(n=>this._renderStyleLayer(i.getLayerById(n),e,t,!0))),n.setBlendingEnabled(!1),n.setDepthTestEnabled(!0),n.setDepthWriteEnabled(!0),n.setDepthFunction(515),e.renderPass="opaque";for(let s=r.length-1;s>=0;s--)this._renderStyleLayer(r[s],e,t,!1);n.setDepthWriteEnabled(!1),n.setBlendingEnabled(!0),n.setBlendFunctionSeparate(1,771,1,771),e.renderPass="translucent";for(let s=0;s<r.length;s++)this._renderStyleLayer(r[s],e,t,!1);n.setDepthTestEnabled(!1),e.renderPass="symbol";for(let s=0;s<r.length;s++)this._renderStyleLayer(r[s],e,t,!1);n.bindVAO()}_renderStyleLayer(e,t,i,n=!1){if(!(n||e&&i.layerData.has(e.uid)))return;const r=e.getLayoutProperty("visibility");if(r&&1===r.getValue())return;const{renderPass:s}=t;let o;switch(e.type){case 0:if("background"!==s)return;o="vtlBackground";break;case 1:if("opaque"!==s&&"translucent"!==t.renderPass)return;o="vtlFill";break;case 2:if("translucent"!==s)return;o="vtlLine";break;case 4:if("symbol"!==s)return;o="vtlCircle";break;case 3:if("symbol"!==s)return;o="vtlSymbol"}const a=t.displayLevel;void 0!==e.minzoom&&e.minzoom>a+C||void 0!==e.maxzoom&&e.maxzoom<=a-C||(t.styleLayerUID=e.uid,t.styleLayer=e,this.drawWithBrush(t,i,o))}drawWithBrush(e,t,i){if(!this._brushCache.has(i)){const e=T["b"][i];this._brushCache.set(i,new e)}this._brushCache.get(i).drawMany(e,[t])}}var M=i("901e"),P=i("66af"),A=i("45e3"),O=i("8b9d"),L=i("365a");let z=class extends(Object(A["a"])(Object(P["a"])(L["a"]))){constructor(){super(...arguments),this.type="vector-tile-3d"}initialize(){if(Object(s["k"])(this.layer.fullExtent))return void this.addResolvingPromise(Promise.reject(new r["a"]("vectortilelayerview:full-extent-undefined","This layer view's layer does not define a fullExtent.")));const e=O["q"].force512VTL?this.layer.tileInfo:this.layer.compatibleTileInfo256,t=this._getTileInfoSupportError(e,this.layer.fullExtent);if(t)return this.addResolvingPromise(Promise.reject(t));const{basemapTerrain:i,spatialReference:n,pixelRatio:l}=this.view,c=Object(a["m"])(this.view,"basemapTerrain.tilingSchemeLocked").then(()=>{const e=i.tilingScheme,t=e.pixelSize;let r;this.schemaHelper=new u["a"](t,n.isGeographic),r=256===t?this.layer.compatibleTileInfo256:this.view.spatialReference.isGeographic?this.layer.compatibleTileInfo512:this.layer.tileInfo;const s=this._getTileInfoCompatibilityError(r,e);if(s)throw s;this._set("tileInfo",r)});this._tileHandlerController=new AbortController;const d=this.view.resourceController;this._memCache=d.memoryController.newCache(this.layer.uid,e=>{e.release()});const{style:h}=this.layer.currentStyleInfo,f=new M["a"](h),_=i.mapTileRequester;this._tileHandler=new x(this.layer,f,l,this._memCache,_);const m=this._tileHandlerController.signal,p=e=>d.schedule(e),v=this._tileHandler.start({signal:m,schedule:p}),g=this._tileHandler.spriteMosaic;g.then(e=>{!Object(o["n"])(m)&&this._tileHandler&&(this.painter=new R(e,this._tileHandler.glyphMosaic))}),v.then(()=>this._tileHandlerController=null);const y=()=>{this._tileHandlerController&&this._tileHandlerController.abort(),this._tileHandlerController=new AbortController,this._memCache.clear();const{style:e}=this.layer.currentStyleInfo,t=new M["a"](e),i=new x(this.layer,t,l,this._memCache,_),n=i.start({signal:this._tileHandlerController.signal,schedule:p}),r=i.spriteMosaic;n.then(()=>this._tileHandlerController=null),this.updatingHandles.addPromise(Promise.all([n,r]).then(([,e])=>{const t=this._tileHandler,n=this.painter;this.painter=new R(e,i.glyphMosaic),this._tileHandler=i,this.emit("data-changed"),t.destroy(),n&&n.dispose()}))};this.updatingHandles.add(this,"layer.currentStyleInfo",y),this.updatingHandles.add(this,"view.pixelRatio",y);const b=Promise.all([c,v,g]);this.addResolvingPromise(b)}destroy(){this.painter=Object(s["f"])(this.painter),this._tileHandlerController&&(this._tileHandlerController.abort(),this._tileHandlerController=null),Object(s["e"])(this._tileHandler),this._memCache=Object(s["e"])(this._memCache),this._tileHandler=null}get dataLevelRange(){const e=this.tileInfo.lods,t=e[0].scale,i=e[e.length-1].scale,n=this.levelRangeFromScaleRange(t,i);return 1===n.minLevel&&256===this.tileInfo.size[0]&&(n.minLevel=0),n}async fetchTile(e,t,i,n){return this._tileHandler.getVectorTile(e,t,i,n)}};Object(n["a"])([Object(l["b"])({aliasOf:"layer.fullExtent"})],z.prototype,"fullExtent",void 0),Object(n["a"])([Object(l["b"])()],z.prototype,"layer",void 0),Object(n["a"])([Object(l["b"])()],z.prototype,"tileInfo",void 0),Object(n["a"])([Object(l["b"])()],z.prototype,"dataLevelRange",null),Object(n["a"])([Object(l["b"])()],z.prototype,"updatingProgressValue",void 0),z=Object(n["a"])([Object(c["a"])("esri.views.3d.layers.VectorTileLayerView3D")],z);const E=z},d114:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return r}));const n=new Float32Array(1);new Uint32Array(n.buffer);function r(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]}function s(e,t){return 65535&e|t<<16}function o(e,t,i,n){return 255&e|(255&t)<<8|(255&i)<<16|n<<24}},d5e4:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i("b2b2"),r=i("bc05");const s=32,o=8,a=64;class l{constructor(e,t,i){this.tileCoordRange=e,this._visibleTiles=t,this._createUnique=i,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return Object(n["k"])(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}add(e,t){this._uniqueSymbolLayerArray=null;let i=this._tiles.get(e.id);i||(i={symbols:new Map},this._tiles.set(e.id,i));const n=new Map;if(t)for(const r of t)i.symbols.has(r)&&(n.set(r,i.symbols.get(r)),i.symbols.delete(r));else for(const[r,s]of e.layerData)i.symbols.has(r)&&(n.set(r,i.symbols.get(r)),i.symbols.delete(r));this._removeSymbols(n);const l=e.symbols,c=new Map;for(const[u,d]of l){let e=d.length;if(e>=s){let t=this.tileCoordRange;do{t/=2,e/=4}while(e>o&&t>a);const n=new r["a"](this.tileCoordRange,this.tileCoordRange,t);c.set(u,{flat:d,index:n}),i.symbols.set(u,{flat:d,index:n});for(const e of d)n.getCell(e.xTile,e.yTile).push(e)}else c.set(u,{flat:d}),i.symbols.set(u,{flat:d})}this._addSymbols(e.key,l)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const[t,i]of this._tiles){const n=new Map;for(const t of e)i.symbols.has(t)&&(n.set(t,i.symbols.get(t)),i.symbols.delete(t));this._removeSymbols(n),0===i.symbols.size&&this._tiles.delete(t)}}removeTile(e){this._uniqueSymbolLayerArray=null;const t=this._tiles.get(e.id);if(!t)return;const i=new Map;for(const[n,r]of e.symbols)t.symbols.has(n)&&(i.set(n,t.symbols.get(n)),t.symbols.delete(n));this._removeSymbols(i),0===t.symbols.size&&this._tiles.delete(e.id)}_removeSymbols(e){for(const[t,{flat:i}]of e)for(const e of i){const i=e.unique,n=i.tileSymbols,r=n.length-1;for(let t=0;t<r;t++)if(n[t]===e){n[t]=n[r];break}if(n.length=r,0===r){const e=this._uniqueSymbolsReferences.get(t);e.delete(i),0===e.size&&this._uniqueSymbolsReferences.delete(t)}e.unique=null}}_addSymbols(e,t){if(0===t.size)return;const i=this._visibleTiles;for(const n of i)n.parentTile||n.key.world!==e.world||n.key.level===e.level&&!n.key.equals(e)||this._matchSymbols(n,e,t);for(const[r,s]of t)for(const e of s)if(Object(n["k"])(e.unique)){const t=this._createUnique();e.unique=t,t.tileSymbols.push(e);let i=this._uniqueSymbolsReferences.get(r);i||(i=new Set,this._uniqueSymbolsReferences.set(r,i)),i.add(t)}}_matchSymbols(e,t,i){if(e.key.level>t.level){const i=e.key.level-t.level;if(e.key.row>>i!==t.row||e.key.col>>i!==t.col)return}if(t.level>e.key.level){const i=t.level-e.key.level;if(t.row>>i!==e.key.row||t.col>>i!==e.key.col)return}if(t.equals(e.key)){for(const n of e.childrenTiles)this._matchSymbols(n,t,i);return}const s=new Map;for(const[o,a]of i){const i=[];for(const n of a){const s=Object(r["c"])(this.tileCoordRange,n.xTile,t.level,t.col,e.key.level,e.key.col),o=Object(r["c"])(this.tileCoordRange,n.yTile,t.level,t.row,e.key.level,e.key.row);s>=0&&s<this.tileCoordRange&&o>=0&&o<this.tileCoordRange&&i.push({symbol:n,xTransformed:s,yTransformed:o})}const l=[],c=e.key.level<t.level?1:1<<e.key.level-t.level,u=this._tiles.get(e.id).symbols.get(o);if(u){const e=u.flat;for(const t of i){let i,r=!1;const s=t.xTransformed,o=t.yTransformed;i=Object(n["l"])(u.index)?u.index.getCell(s,o):e;const a=t.symbol,d=a.hash;for(const e of i)if(d===e.hash&&Math.abs(s-e.xTile)<=c&&Math.abs(o-e.yTile)<=c){const t=e.unique;a.unique=t,t.tileSymbols.push(a),r=!0;break}r||l.push(a)}}l.length>0&&s.set(o,l)}for(const n of e.childrenTiles)this._matchSymbols(n,t,s)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsReferences,t=new Array(e.size);let i,n=0;for(const[r,s]of e){const e=new Array(s.size);i=0;for(const t of s)e[i++]=t;t[n]={styleLayerUID:r,uniqueSymbols:e},n++}return t}}}}]);
//# sourceMappingURL=chunk-7458a43c.659e56ff.js.map