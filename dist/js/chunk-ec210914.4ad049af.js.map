{"version":3,"sources":["webpack:///./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/BaseDynamicLayerView3D.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/support/overlayImageUtils.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/DynamicLayerView3D.js","webpack:///./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ImageMaterialTechnique.js","webpack:///./node_modules/@arcgis/core/views/3d/webgl-engine/materials/ImageMaterial.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/support/projectExtentUtils.js","webpack:///./node_modules/@arcgis/core/chunks/ImageMaterial.glsl.js"],"names":["i","c","this","handles","add","r","doRefresh","dataChanged","catch","getLogger","declaredClass","error","prototype","o","super","arguments","type","t","n","a","width","height","Math","round","createSquareGeometry","e","min","max","h","u","l","m","g","Float64Array","w","Float32Array","d","Uint32Array","f","p","y","x","M","v","length","size","data","exclusive","P","O","drapeSourceType","updatePolicy","fullExtentInLocalViewSpatialReference","maximumDataResolution","_images","Array","_extents","_overlays","updateWhenStationary","refreshDebounced","async","destroyed","_doRefresh","addResolvingPromise","then","_set","updatingHandles","_suspendedChangeHandler","view","resourceController","scheduler","registerIdleStateCallbacks","_isScaleRangeActive","notifyChange","_isScaleRangeLayer","layer","clear","_spatialReference","forEach","index","_updateImageExtent","_clippedExtent","extent","H","resolution","pixelRatio","imageMaxWidth","imageMaxHeight","floor","s","_imageSizeEquals","imageSize","suspended","_fetch","_clearImage","push","canResume","minScale","maxScale","scale","some","loadingPromise","HTMLImageElement","HTMLCanvasElement","image","contains","_createStageObjects","abs","TESTS_DISABLE_OPTIMIZATIONS","texture","material","renderGeometry","loadingAbortController","pixelData","renderExtent","abort","AbortController","signal","_waitFetchReady","requestAsImageElement","getFetchOptions","fetchImage","warnOnce","processResult","aborted","basemapTerrain","overlayManager","renderer","removeGeometries","_stage","remove","preMultiplyAlpha","wrap","loadSynchronous","transparent","textureId","id","setParameters","origin","renderLocalOrigin","addGeometries","viewingMode","ready","readOnly","V","shader","get","configuration","build","output","slicePlaneEnabled","sliceHighlightDisabled","sliceEnabledForVertexPrograms","OITEnabled","transparencyPassType","multipassTerrainEnabled","cullAboveGround","rctx","program","camera","projectionMatrix","setUniform1f","opacity","setUniform2fv","nearFar","inverseViewport","rebindTextures","blending","culling","cullFace","depthTest","func","depthWrite","writeDepth","colorWrite","stencilWrite","sceneHasOcludees","stencilTest","polygonOffset","enableOffset","_occludeePipelineState","setPipelineState","getPipelineState","count","supportsEdges","techniqueConfig","parameters","relativeElevation","_material","updateTexture","ensureTechnique","hasOccludees","updateParameters","_output","_updateOccludeeState","bindTextures","bindTextureScale","bindPass","initTextureTransparent","spatialReference","fullExtent","Promise","resolve","equals","clone","state","isLocal","portalItem","include","linearDepth","vertex","uniforms","attributes","varyings","code","fragment","float","Object","freeze","__proto__"],"mappings":"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","file":"js/chunk-ec210914.4ad049af.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Logger.js\";import{isAbortError as s}from\"../../core/promiseUtils.js\";import{on as o}from\"../../core/watchUtils.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";const i=i=>{let c=class extends i{initialize(){this.handles.add(o(this,\"layer\",\"refresh\",(r=>{this.doRefresh(r.dataChanged).catch((r=>{s(r)||e.getLogger(this.declaredClass).error(r)}))})),\"RefreshableLayerView\")}};return r([t()],c.prototype,\"layer\",void 0),c=r([a(\"esri.layers.mixins.RefreshableLayerView\")],c),c};export{i as RefreshableLayerView,i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as s}from\"../../../chunks/tslib.es6.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/set.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import e from\"./DynamicLayerView3D.js\";let o=class extends e{constructor(){super(...arguments),this.type=\"base-dynamic-3d\"}};o=s([r(\"esri.views.3d.layers.BaseDynamicLayerView3D\")],o);const t=o;export{t as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{width as t,height as e,intersects as n}from\"../../../../geometry/support/aaBoundingRect.js\";import{Geometry as i}from\"../../webgl-engine/lib/Geometry.js\";import r from\"../../webgl-engine/lib/GeometryUtil.js\";function o(n,i,r){const o=t(n)/e(n),a={width:r,height:r};return o>1.0001?a.height=r/o:o<.9999&&(a.width=r*o),a.width=Math.round(a.width/(t(n)/t(i))),a.height=Math.round(a.height/(e(n)/e(i))),a}function a(t){return r.createSquareGeometry([[t[0],t[1],-1],[t[2],t[1],-1],[t[2],t[3],-1],[t[0],t[3],-1]])}function h(t,e){if(!n(t,e))return a(e);const r=[t[1]-e[1],Math.min(t[3],e[3])-Math.max(t[1],e[1]),e[3]-t[3],123456],o=[t[0]-e[0],Math.min(t[2],e[2])-Math.max(t[0],e[0]),e[2]-t[2],123456],h=e[2]-e[0],u=e[3]-e[1],l=o[0]>0&&o[2]>0?3:2,m=r[0]>0&&r[2]>0?3:2,c=(m+1)*(l+1),g=new Float64Array(3*c),w=new Float32Array(2*c),d=new Uint32Array(6*(m*l-1));let f=0,p=0,y=0,x=0,M=0;for(let n=0;n<4;n++){const t=r[n];if(t<=0)continue;let i=0;for(let r=0;r<4;r++){const t=o[r];t<=0||(g[p++]=e[0]+i,g[p++]=e[1]+f,g[p++]=-1,w[y++]=i/h,w[y++]=f/u,r<3&&n<3&&(1!==r||1!==n)&&(d[M++]=x,d[M++]=x+1,d[M++]=x+l+1,d[M++]=x+1,d[M++]=x+l+2,d[M++]=x+l+1),x++,i+=t)}f+=t}const v=new Uint32Array(d.length);return new i([[\"position\",{size:3,data:g,exclusive:!0}],[\"normal\",{size:3,data:s,exclusive:!0}],[\"uv0\",{size:2,data:w,exclusive:!0}]],[[\"position\",d],[\"normal\",v],[\"uv0\",d]])}const s=[0,0,1];export{o as computeImageExportSize,a as createGeometryForExtent,h as createOuterImageGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{forEach as t,result as i}from\"../../../core/asyncUtils.js\";import r from\"../../../core/Logger.js\";import{isNone as a,isSome as s}from\"../../../core/maybe.js\";import{debounce as n,isAbortError as o,eachAlways as l,onAbort as h,isAborted as m,createAbortError as d,always as c,throwIfAborted as g}from\"../../../core/promiseUtils.js\";import{whenOnce as u}from\"../../../core/watchUtils.js\";import{property as p}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as y}from\"../../../core/accessorSupport/decorators/subclass.js\";import f from\"../../../geometry/Extent.js\";import{equals as x,create as w,width as _,height as v,copy as b,intersection as R}from\"../../../geometry/support/aaBoundingRect.js\";import{LayerView3D as S}from\"./LayerView3D.js\";import{computeImageExportSize as j,createGeometryForExtent as E,createOuterImageGeometry as I}from\"./support/overlayImageUtils.js\";import{toViewIfLocal as A}from\"./support/projectExtentUtils.js\";import C from\"../support/debugFlags.js\";import{RenderGeometry as L}from\"../webgl-engine/lib/RenderGeometry.js\";import{Texture as M}from\"../webgl-engine/lib/Texture.js\";import{ImageMaterial as D}from\"../webgl-engine/materials/ImageMaterial.js\";import G from\"../../layers/LayerView.js\";import{RefreshableLayerView as T}from\"../../layers/RefreshableLayerView.js\";const P=r.getLogger(\"esri.views.3d.layers.DynamicLayerView3D\");let O=class extends(T(S(G))){constructor(){super(...arguments),this.drapeSourceType=0,this.updatePolicy=1,this.fullExtentInLocalViewSpatialReference=null,this.maximumDataResolution=null,this._images=new Array,this._extents=new Array,this._overlays=new Array,this.updateWhenStationary=!0,this.refreshDebounced=n((async e=>{this.destroyed||await this._doRefresh(e).catch((e=>{o(e)||r.getLogger(this.declaredClass).error(e)}))}),2e3)}initialize(){this.addResolvingPromise(A(this).then((e=>this._set(\"fullExtentInLocalViewSpatialReference\",e)))),this.updatingHandles.add(this,\"suspended\",(()=>this._suspendedChangeHandler())),this.handles.add(this.view.resourceController.scheduler.registerIdleStateCallbacks((()=>{this._isScaleRangeActive()&&this.notifyChange(\"suspended\")}),(()=>{}))),this._isScaleRangeLayer()&&this.updatingHandles.add(this.layer,\"scaleRangeId\",(()=>this.notifyChange(\"suspended\")))}destroy(){this.clear()}setDrapingExtent(e,t){this._spatialReference=t,e.forEach((e=>{this._overlays[e.index]=e,this._updateImageExtent(e)}))}_updateImageExtent(e){const t=this._clippedExtent(e.extent,H);if(a(t))return;const i=j(e.extent,t,e.resolution);let r=e.pixelRatio*this.view.pixelRatio;if(\"imageMaxWidth\"in this.layer||\"imageMaxHeight\"in this.layer){const e=this.layer.imageMaxWidth,t=this.layer.imageMaxHeight;if(i.width>e){const t=e/i.width;i.height=Math.floor(i.height*t),i.width=e,r*=t}if(i.height>t){const e=t/i.height;i.width=Math.floor(i.width*e),i.height=t,r*=e}}const s=this._extents[e.index];s&&x(s.extent,t)&&this._imageSizeEquals(t,s.imageSize,i)||(this._extents[e.index]={extent:w(t),imageSize:i,pixelRatio:r},this.suspended||this._fetch(e.index).catch((e=>{o(e)||P.error(e)})))}clear(){for(let e=0;e<this._images.length;e++)this._clearImage(e)}async doRefresh(){return this._doRefresh()}async _doRefresh(e){if(this.suspended)return;const t=[];for(let i=0;i<this._extents.length;i++)this._extents[i]&&t.push(this._fetch(i,e));await l(t)}canResume(){if(!super.canResume())return!1;if(this._isScaleRangeLayer()){const{minScale:e,maxScale:t}=this.layer;if(e>0||t>0){const i=this.view.scale;if(i<t||e>0&&i>e)return!1}}return!0}isUpdating(){return this._images.some((e=>!!e.loadingPromise))}async processResult(e,t,i){(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e.image=t)}findExtentInfoAt(e){for(const t of this._extents){const i=t.extent;if(new f(i[0],i[1],i[2],i[3],this._spatialReference).contains(e))return t}return null}getFetchOptions(){}async redraw(e,i){await t(this._images,(async(t,r)=>{t&&(await e(t,i),await this._createStageObjects(r,t.image,i))}))}_imageSizeEquals(e,t,i){if(!this.maximumDataResolution)return!1;const r=_(e)/this.maximumDataResolution.x,a=v(e)/this.maximumDataResolution.y,s=r/t.width,n=a/t.height,o=r/i.width,l=a/i.height,h=Math.abs(s-o),m=Math.abs(n-l),d=C.TESTS_DISABLE_OPTIMIZATIONS?0:1.5;return h<=d&&m<=d}async _fetch(e,t){if(this.suspended)return;const i=this._extents[e],r=i.extent;this._images[e]||(this._images[e]={texture:null,material:null,renderGeometry:null,loadingPromise:null,loadingAbortController:null,image:null,pixelData:null,renderExtent:w(r)});const a=this._images[e];a.loadingAbortController&&(a.loadingAbortController.abort(),a.loadingAbortController=null);const s=new f(r[0],r[1],r[2],r[3],this._spatialReference);if(0===s.width||0===s.height)return void this._clearImage(e);const n=new AbortController;a.loadingAbortController=n,h(t,(()=>n.abort()));const l=n.signal,g=this._waitFetchReady(l).then((()=>{const t={requestAsImageElement:!0,pixelRatio:this._overlays[e].pixelRatio,...this.getFetchOptions(),signal:l},{height:r,width:a}=i.imageSize;return this.layer.fetchImage(s,a,r,t)})).then((e=>{if(m(l))throw P.warnOnce(\"A call to fetchImage resolved even though the request was aborted. fetchImage should not resolve if options.signal.aborted is true.\"),d();return this.processResult(a,e)})).then((()=>b(a.renderExtent,r)));a.loadingPromise=g,c(g,(()=>{g===a.loadingPromise&&(a.loadingPromise=null,a.loadingAbortController=null)})),this.notifyChange(\"updating\"),await g.then((async()=>{if(l.aborted)throw d();await this._createStageObjects(e,a.image,l),this.notifyChange(\"updating\")})).catch((e=>{throw e&&!o(e)&&P.error(e),this.notifyChange(\"updating\"),e}))}_clearImage(e){const t=this._images[e];if(t){s(t.renderGeometry)&&(this.view.basemapTerrain.overlayManager.renderer.removeGeometries([t.renderGeometry],this,2),t.renderGeometry=null);const e=this.view._stage;e.remove(t.texture),t.texture=null,e.remove(t.material),t.material=null,t.loadingAbortController&&(t.loadingAbortController.abort(),t.loadingAbortController=null),t.loadingPromise=null,t.image=null,t.pixelData=null}}async _createStageObjects(e,t,r){const n=this.view._stage,o=this._images[e],l=this.view.basemapTerrain.overlayManager.renderer,h=()=>{n.remove(o.texture),o.texture=null,s(o.renderGeometry)&&(l.removeGeometries([o.renderGeometry],this,2),o.renderGeometry=null)};if(t){const s=new M(t,{width:t.width,height:t.height,preMultiplyAlpha:!0,wrap:{s:33071,t:33071}});let m;if(await i(this._images[0===e?1:0].loadingPromise),g(r),0===e)m=E(o.renderExtent);else{const e=this._images[0].renderExtent;if(!e)return void h();m=I(e,o.renderExtent)}h(),n.add(s),n.loadSynchronous(s),o.texture=s,a(o.material)?(o.material=new D({transparent:!0,textureId:s.id}),n.add(o.material)):o.material.setParameters({textureId:s.id}),o.renderGeometry=new L(m,o.material),o.renderGeometry.origin=this._overlays[e].renderLocalOrigin,l.addGeometries([o.renderGeometry],this,2)}else h(),n.remove(o.material),o.material=null}_isScaleRangeLayer(){return\"minScale\"in this.layer&&\"maxScale\"in this.layer}_isScaleRangeActive(){return!!this._isScaleRangeLayer()&&(this.layer.minScale>0||this.layer.maxScale>0)}_clippedExtent(e,t){if(\"local\"!==this.view.viewingMode)return b(t,e);const i=this.view.basemapTerrain;return i.ready?R(e,i.extent,t):b(t,e)}_suspendedChangeHandler(){this.suspended?this.clear():this.refreshDebounced()}async _waitFetchReady(e){await u(this.view,\"stationary\",e),g(e)}};e([p()],O.prototype,\"layer\",void 0),e([p()],O.prototype,\"suspended\",void 0),e([p({readOnly:!0})],O.prototype,\"fullExtentInLocalViewSpatialReference\",void 0),e([p()],O.prototype,\"updating\",void 0),O=e([y(\"esri.views.3d.layers.DynamicLayerView3D\")],O);const H=w(),V=O;export{V as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{bindSliceUniformsWithOrigin as t}from\"../core/shaderLibrary/Slice.glsl.js\";import{bindMultipassTerrainTexture as r}from\"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{bindProjectionMatrix as i,bindView as s}from\"../core/shaderLibrary/util/View.glsl.js\";import{ReloadableShaderModule as a}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as o}from\"../core/shaderTechnique/ShaderTechnique.js\";import{parameter as n,ShaderTechniqueConfiguration as l}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{Default3D as p}from\"../lib/DefaultVertexAttributeLocations.js\";import{OITBlending as c,OITDepthTest as u,OITDepthWrite as d,getOITPolygonOffset as h}from\"../lib/OrderIndependentTransparency.js\";import{Program as m}from\"../lib/Program.js\";import{stencilWriteMaskOn as b,stencilToolMaskBaseParams as f,stencilBaseAllZerosParams as g}from\"../lib/StencilUtils.js\";import{I as y}from\"../../../../chunks/ImageMaterial.glsl.js\";import{simpleBlendingParams as T,makePipelineState as P,cullingParams as v,defaultDepthWriteParams as j,defaultColorWriteParams as S}from\"../../../webgl/renderState.js\";class E extends o{initializeProgram(e){const t=E.shader.get(),r=this.configuration,i=t.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===r.transparencyPassType,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new m(e.rctx,i,p)}bindPass(e,t){i(this.program,t.camera.projectionMatrix),this.program.setUniform1f(\"opacity\",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv(\"cameraNearFar\",t.camera.nearFar),this.program.setUniform2fv(\"inverseViewport\",t.inverseViewport),r(this.program,t))}bindDraw(e){s(this.program,e),t(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const r=this.configuration,i=3===e,s=2===e;return P({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?w:c(e),culling:v(r.cullFace),depthTest:{func:u(e)},depthWrite:i?r.writeDepth&&j:d(e),colorWrite:S,stencilWrite:r.sceneHasOcludees?b:null,stencilTest:r.sceneHasOcludees?t?f:g:null,polygonOffset:i||s?null:h(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}E.shader=new a(y,(()=>import(\"./ImageMaterial.glsl.js\")));const w=T(1,771);class O extends l{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}e([n({count:8})],O.prototype,\"output\",void 0),e([n({count:3})],O.prototype,\"cullFace\",void 0),e([n()],O.prototype,\"slicePlaneEnabled\",void 0),e([n()],O.prototype,\"transparent\",void 0),e([n()],O.prototype,\"enableOffset\",void 0),e([n()],O.prototype,\"writeDepth\",void 0),e([n()],O.prototype,\"sceneHasOcludees\",void 0),e([n({count:4})],O.prototype,\"transparencyPassType\",void 0),e([n()],O.prototype,\"multipassTerrainEnabled\",void 0),e([n()],O.prototype,\"cullAboveGround\",void 0);export{E as ImageMaterialTechnique,O as ImageMaterialTechniqueConfiguration};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{outputFromPass as e}from\"../lib/GLMaterials.js\";import t from\"../lib/GLMaterialTexture.js\";import{Material as r,materialParametersDefaults as a}from\"../lib/Material.js\";import{OITPolygonOffsetLimit as s}from\"../lib/OrderIndependentTransparency.js\";import{DefaultBufferWriter as i,PositionUVLayout as n}from\"./internal/DefaultBufferWriter.js\";import{intersectTriangleGeometry as u}from\"./internal/MaterialUtil.js\";import{ImageMaterialTechniqueConfiguration as c,ImageMaterialTechnique as l}from\"../shaders/ImageMaterialTechnique.js\";class h extends r{constructor(e){super(e,o),this.supportsEdges=!0,this.techniqueConfig=new c}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<s,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}intersect(e,t,r,a,s,i,n){u(e,t,a,s,i,void 0,n)}requiresSlot(t,r){if(20===t)return!0;if(4===e(r))return 2===t;return t===(this.parameters.transparent?this.parameters.writeDepth?4:7:2)}createGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new p(e):void 0}createBufferWriter(){return new i(n)}}class p extends t{constructor(e){super({...e,...e.material.parameters})}updateParameters(e){const t=this._material.parameters;return this.updateTexture(t.textureId),this.ensureTechnique(l,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&(this._material.setParameters({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}beginSlot(e){return 0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){this.bindTextures(t.program),this.bindTextureScale(t.program),t.bindPass(this._material.parameters,e)}}const o={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...a};export{h as ImageMaterial};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as r}from\"../../../../core/maybe.js\";import{project as o}from\"../../../../geometry/support/webMercatorUtils.js\";import{projectGeometry as t}from\"../../../../portal/support/geometryServiceUtils.js\";function l(l){const s=l.view.spatialReference,i=l.layer.fullExtent,n=e(i)&&i.spatialReference;if(r(i)||!n)return Promise.resolve(null);if(n.equals(s))return Promise.resolve(i.clone());const a=o(i,s);return e(a)?Promise.resolve(a):l.view.state.isLocal?t(i,s,l.layer.portalItem).then((e=>!l.destroyed&&e?e:void 0)).catch((()=>null)):Promise.resolve(null)}export{l as toViewIfLocal};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{Slice as e}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{Transform as r}from\"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js\";import{ReadLinearDepth as a}from\"../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js\";import{multipassTerrainTest as o}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{defaultMaskAlphaCutoff as i}from\"../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl.js\";import{ColorConversion as d}from\"../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js\";import{glsl as t}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{ShaderBuilder as l}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";function s(s){const n=new l;return n.include(r,{linearDepth:!1}),n.vertex.uniforms.add(\"proj\",\"mat4\").add(\"view\",\"mat4\"),n.attributes.add(\"position\",\"vec3\"),n.attributes.add(\"uv0\",\"vec2\"),n.varyings.add(\"vpos\",\"vec3\"),s.multipassTerrainEnabled&&n.varyings.add(\"depth\",\"float\"),n.vertex.uniforms.add(\"textureCoordinateScaleFactor\",\"vec2\"),n.vertex.code.add(t`\n    void main(void) {\n      vpos = position;\n      ${s.multipassTerrainEnabled?\"depth = (view * vec4(vpos, 1.0)).z;\":\"\"}\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  `),n.include(e,s),s.multipassTerrainEnabled&&(n.fragment.include(a),n.include(o,s)),n.fragment.uniforms.add(\"tex\",\"sampler2D\"),n.fragment.uniforms.add(\"opacity\",\"float\"),n.varyings.add(\"vTexCoord\",\"vec2\"),7===s.output?n.fragment.code.add(t`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ${t.float(i)}) {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    `):(n.fragment.include(d),n.fragment.code.add(t`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ${t.float(i)}) {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ${s.OITEnabled?\"gl_FragColor = premultiplyAlpha(gl_FragColor);\":\"\"}\n    }\n    `)),n}const n=Object.freeze({__proto__:null,build:s});export{n as I,s as b};\n"],"sourceRoot":""}