(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2b5941d6","chunk-2d0cc20b"],{"4d38":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return l}));var i=r("a4ee"),s=r("2c4f"),a=r("7d7d"),n=r("59b2"),c=(r("b50f"),r("c120"),r("cea0"),r("d386")),h=r("365a");let o=class extends h["a"]{constructor(e){super(e),this.type="group",this.layerViews=new s["a"]}initialize(){this.handles.add([this.layerViews.on("change",e=>this._layerViewsChangeHandler(e)),this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()),this.layer.watch("visibilityMode",()=>this._visibilityModeHandler(),!0),this.watch("visible",()=>this._visibleHandler(),!0)],"grouplayerview"),this._layerViewsChangeHandler({target:null,added:this.layerViews.toArray(),removed:[],moved:[]}),this._layerViewsAfterChangesHandler()}set layerViews(e){this._set("layerViews",Object(a["b"])(e,this._get("layerViews")))}isUpdating(){return this.layerViews.some(e=>e.updating)}get updatingProgress(){return 0===this.layerViews.length?1:this.layerViews.reduce((e,t)=>e+t.updatingProgress,0)/this.layerViews.length}_hasLayerViewVisibleOverrides(){return this.layerViews.some(e=>e._isOverridden("visible"))}_findLayerViewForLayer(e){return e&&this.layerViews.find(t=>t.layer===e)}_firstVisibleOnLayerOrder(){const e=this.layer.layers.find(e=>{const t=this._findLayerViewForLayer(e);return t&&t.visible});return e&&this._findLayerViewForLayer(e)}_enforceExclusiveVisibility(e){this._hasLayerViewVisibleOverrides()&&(e||!(e=this._firstVisibleOnLayerOrder())&&this.layerViews.length>0&&(e=this._findLayerViewForLayer(this.layer.layers.getItemAt(0))),this.layerViews.forEach(t=>{t.visible=t===e}))}_layerViewsChangeHandler(e){this.handles.remove("grouplayerview:visible"),this.handles.add(this.layerViews.map(e=>e.watch("visible",t=>this._layerViewVisibleHandler(t,e),!0)).toArray(),"grouplayerview:visible");const t=e.added[e.added.length-1];let r=null;t&&t.visible&&(r=t),this._enforceVisibility(r)}_layerViewsAfterChangesHandler(){this.handles.remove("grouplayerview:updating"),this.handles.add(this.layerViews.map(e=>e.watch("updating",()=>this._updateUpdating(),!0)).toArray(),"grouplayerview:updating"),this._updateUpdating()}_enforceVisibility(e){if(this._hasLayerViewVisibleOverrides())switch(this.layer.visibilityMode){case"inherited":{const e=this.visible;this.layerViews.forEach(t=>{t.visible=e});break}case"exclusive":this._enforceExclusiveVisibility(e)}}_visibilityModeHandler(){this._enforceVisibility()}_layerViewVisibleHandler(e,t){if(this._hasLayerViewVisibleOverrides())switch(this.layer.visibilityMode){case"inherited":e!==this.visible&&(t.visible=this.visible);break;case"exclusive":this._enforceExclusiveVisibility(e&&t)}}_visibleHandler(){var e;this._hasLayerViewVisibleOverrides()&&"inherited"===(null==(e=this.layer)?void 0:e.visibilityMode)&&this._enforceVisibility()}_updateUpdating(){this.notifyChange("updating")}};Object(i["a"])([Object(n["b"])({cast:a["a"]})],o.prototype,"layerViews",null),Object(i["a"])([Object(n["b"])()],o.prototype,"view",void 0),Object(i["a"])([Object(n["b"])({readOnly:!0})],o.prototype,"updatingProgress",null),o=Object(i["a"])([Object(c["a"])("esri.views.layers.GroupLayerView")],o);const l=o},"9a02":function(e,t,r){"use strict";r.d(t,"a",(function(){return C}));r("c120");var i=r("b2b2"),s=r("8c71"),a=r("3b1a"),n=r("00c0"),c=r("ce50"),h=r("e92d"),o=r("7c4b"),l=r("9812"),d=r("3349"),f=r("02f1"),p=r("6655"),y=r("8152"),u=r("d114"),g=r("7ce4");const b=h["a"].getLogger("esri.views.2d.engine.webgl.Mesh2D"),_=e=>{switch(e.BYTES_PER_ELEMENT){case 1:return 5121;case 2:return 5123;case 4:return 5125;default:throw new c["a"]("Cannot get DataType of array")}},w=(e,t,r,i)=>{let s=0;for(let a=1;a<r;a++){const r=e[2*(t+a-1)],i=e[2*(t+a-1)+1];s+=(e[2*(t+a)]-r)*(e[2*(t+a)+1]+i)}return i?s>0:s<0},m=({coords:e,lengths:t},r)=>{const i=[];for(let s=0,a=0;s<t.length;a+=t[s],s+=1){const n=a,c=[];for(;s<t.length-1&&w(e,a+t[s],t[s+1],r);s+=1,a+=t[s])c.push(a+t[s]-n);const h=e.slice(2*n,2*(a+t[s])),o=Object(l["a"])(h,c,2);for(const e of o)i.push(e+n)}return i};class v{constructor(e,t,r,i=!1){this._cache={},this.vertices=e,this.indices=t,this.primitiveType=r,this.isMapSpace=i}static fromRect({x:e,y:t,width:r,height:i}){const s=e,a=t,n=s+r,c=a+i;return v.fromScreenExtent({xmin:s,ymin:a,xmax:n,ymax:c})}static fromPath(e){const t=Object(p["f"])(new y["a"],e.path,!1,!1),r=t.coords,i=new Uint32Array(m(t,!0)),s=new Uint32Array(r.length/2);for(let a=0;a<s.length;a++)s[a]=Object(u["a"])(Math.floor(r[2*a]),Math.floor(r[2*a+1]));return new v({geometry:s},i,4)}static fromGeometry(e,t){const r=t.geometry.type;switch(r){case"polygon":return v.fromPolygon(e,t.geometry);case"extent":return v.fromMapExtent(e,t.geometry);default:return b.error(new c["a"]("mapview-bad-type","Unable to create a mesh from type "+r,t)),v.fromRect({x:0,y:0,width:1,height:1})}}static fromPolygon(e,t){const r=Object(p["g"])(new y["a"],t,!1,!1),i=r.coords,s=new Uint32Array(m(r,!1)),a=new Uint32Array(i.length/2),n=Object(f["b"])(),c=Object(f["b"])();for(let h=0;h<a.length;h++)Object(d["s"])(n,i[2*h],i[2*h+1]),e.toScreen(c,n),a[h]=Object(u["a"])(Math.floor(c[0]),Math.floor(c[1]));return new v({geometry:a},s,4,!0)}static fromScreenExtent({xmin:e,xmax:t,ymin:r,ymax:i}){const s={geometry:new Uint32Array([Object(u["a"])(e,r),Object(u["a"])(t,r),Object(u["a"])(e,i),Object(u["a"])(e,i),Object(u["a"])(t,r),Object(u["a"])(t,i)])},a=new Uint32Array([0,1,2,3,4,5]);return new v(s,a,4)}static fromMapExtent(e,t){const[r,i]=e.toScreen([0,0],[t.xmin,t.ymin]),[s,a]=e.toScreen([0,0],[t.xmax,t.ymax]),n={geometry:new Uint32Array([Object(u["a"])(r,i),Object(u["a"])(s,i),Object(u["a"])(r,a),Object(u["a"])(r,a),Object(u["a"])(s,i),Object(u["a"])(s,a)])},c=new Uint32Array([0,1,2,3,4,5]);return new v(n,c,4)}destroy(){Object(i["l"])(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(const e in this._cache.vertexBuffers)Object(i["l"])(this._cache.vertexBuffers[e])&&this._cache.vertexBuffers[e].dispose()}get elementType(){return _(this.indices)}getIndexBuffer(e,t=35044){return this._cache.indexBuffer||(this._cache.indexBuffer=g["a"].createIndex(e,t,this.indices)),this._cache.indexBuffer}getVertexBuffers(e,t=35044){return this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce((r,i)=>({...r,[i]:g["a"].createVertex(e,t,this.vertices[i])}),{})),this._cache.vertexBuffers}}var O=r("0fa6");const V=h["a"].getLogger("esri.views.2d.engine.webgl.ClippingInfo"),x=e=>parseFloat(e)/100;class j extends o["a"]{constructor(e,t){super(),this._clip=t,this._cache={},this.stage=e,this._handle=t.watch("version",()=>this._invalidate()),this.ready()}static fromClipArea(e,t){return new j(e,t)}_destroyGL(){Object(i["l"])(this._cache.mesh)&&(this._cache.mesh.destroy(),this._cache.mesh=null),Object(i["l"])(this._cache.vao)&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL(),this._handle.remove()}getVAO(e,t,r,s){const[a,n]=t.size;if("geometry"!==this._clip.type&&this._lastWidth===a&&this._lastHeight===n||(this._lastWidth=a,this._lastHeight=n,this._destroyGL()),Object(i["k"])(this._cache.vao)){const i=this._createMesh(t,this._clip),a=i.getIndexBuffer(e),n=i.getVertexBuffers(e);this._cache.mesh=i,this._cache.vao=new O["a"](e,r,s,n,a)}return this._cache.vao}_createTransforms(){return{dvs:Object(s["b"])()}}_invalidate(){this._destroyGL(),this.requestRender()}_createScreenRect(e,t){const[r,i]=e.size,s="string"==typeof t.left?x(t.left)*r:t.left,a="string"==typeof t.right?x(t.right)*r:t.right,n="string"==typeof t.top?x(t.top)*i:t.top,c="string"==typeof t.bottom?x(t.bottom)*i:t.bottom,h=s,o=n;return{x:h,y:o,width:Math.max(r-a-h,0),height:Math.max(i-c-o,0)}}_createMesh(e,t){switch(t.type){case"rect":return v.fromRect(this._createScreenRect(e,t));case"path":return v.fromPath(t);case"geometry":return v.fromGeometry(e,t);default:return V.error(new c["a"]("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),v.fromRect({x:0,y:0,width:1,height:1})}}}var L=r("c84e");class C extends n["a"]{constructor(){super(...arguments),this.name=this.constructor.name}set clips(e){this._clips=e,this.children.forEach(t=>t.clips=e),this._updateClippingInfo()}_createTransforms(){return{dvs:Object(s["b"])()}}doRender(e){const t=this.createRenderParams(e),{painter:r,globalOpacity:i,profiler:s,drawPhase:a}=t,n=a===L["c"].LABEL||a===L["c"].HIGHLIGHT?1:i*this.computedOpacity;s.recordContainerStart(this.name),r.beforeRenderLayer(t,this._clippingInfos?255:0,n),this.updateTransforms(e.state),this.renderChildren(t),r.compositeLayer(t,n),s.recordContainerEnd()}renderChildren(e){Object(i["k"])(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(e.painter));for(const r of this.children)r.beforeRender(e);for(const r of this._renderPasses)try{r.render(e)}catch(t){}for(const r of this.children)r.afterRender(e)}createRenderParams(e){return e.requireFBO=this.requiresDedicatedFBO,e}prepareRenderPasses(e){return[e.registerRenderPass({name:"clip",brushes:[a["a"].clip],target:()=>this._clippingInfos,drawPhase:L["c"].MAP|L["c"].LABEL|L["c"].LABEL_ALPHA|L["c"].DEBUG|L["c"].HIGHLIGHT})]}updateTransforms(e){for(const t of this.children)t.setTransform(e)}onAttach(){super.onAttach(),this._updateClippingInfo()}onDetach(){super.onDetach(),this._updateClippingInfo()}_updateClippingInfo(){if(Object(i["l"])(this._clippingInfos)&&(this._clippingInfos.forEach(e=>e.destroy()),this._clippingInfos=null),!this.stage)return;const e=this._clips;Object(i["l"])(e)&&e.length&&(this._clippingInfos=e.items.map(e=>j.fromClipArea(this.stage,e))),this.requestRender()}}},d86a:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return d}));var i=r("a4ee"),s=(r("e92d"),r("cea0"),r("b50f"),r("c120"),r("2dd4"),r("d386")),a=(r("7ce4"),r("d267")),n=(r("1956"),r("d17d"),r("9f8b"),r("a1ff"),r("0fa6"),r("9a02"));class c extends n["a"]{constructor(){super(...arguments),this._lastWidth=0,this._lastHeight=0,this.requiresDedicatedFBO=!1}dispose(){this._renderTarget&&(this._renderTarget.dispose(),this._renderTarget=null)}doRender(e){const t=this.createRenderParams(e),{context:r,painter:i,profiler:s}=t;this._prevFBO=r.getBoundFramebufferObject(),s.recordContainerStart(this.name);const a=this._getFbo(t),n=i.getRenderTarget();r.bindFramebuffer(a),i.setRenderTarget(a),r.setDepthWriteEnabled(!0),r.setColorMask(!0,!0,!0,!0),r.setClearColor(0,0,0,0),r.setClearDepth(1),r.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT),r.setDepthWriteEnabled(!1);for(const c of this.children)c.beforeRender(e);for(const c of this.children)c.processRender(t);for(const c of this.children)c.afterRender(e);i.setRenderTarget(n),r.bindFramebuffer(this._prevFBO),i.beforeRenderLayer(t,this._clippingInfos?255:0,this.computedOpacity),r.setStencilTestEnabled(!1),r.setStencilWriteMask(0),i.blitTexture(r,a.colorTexture,9728),i.compositeLayer(t,this.computedOpacity),s.recordContainerEnd()}createRenderParams(e){return{...super.createRenderParams(e),blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:1}}_getFbo(e){const{context:t,painter:r}=e,{width:i,height:s}=t.getViewport();if(i!==this._lastWidth||s!==this._lastHeight)if(this._lastWidth=i,this._lastHeight=s,this._renderTarget)this._renderTarget.resize(i,s);else{const e={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:i,height:s},n={colorTarget:0,depthStencilTarget:3};this._renderTarget=new a["a"](t,n,e,r.getSharedStencilBuffer())}return this._renderTarget}}var h=r("566d"),o=r("4d38");let l=class extends(Object(h["a"])(o["default"])){constructor(){super(...arguments),this.container=new c}attach(){this._updateStageChildren(),this.handles.add(this.layerViews.on("after-changes",()=>this._updateStageChildren()),"grouplayerview2d")}detach(){this.handles.remove("grouplayerview2d"),this.container.removeAllChildren()}update(e){}moveStart(){}viewChange(){}moveEnd(){}_updateStageChildren(){this.container.removeAllChildren(),this.layerViews.forEach((e,t)=>this.container.addChildAt(e.container,t))}};l=Object(i["a"])([Object(s["a"])("esri.views.2d.layers.GroupLayerView2D")],l);const d=l}}]);
//# sourceMappingURL=chunk-2b5941d6.f97287f8.js.map