{"version":3,"sources":["webpack:///./node_modules/@arcgis/core/views/3d/layers/ImageryLayerView3D.js","webpack:///./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/support/overlayImageUtils.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/DynamicLayerView3D.js","webpack:///./node_modules/@arcgis/core/views/layers/support/popupUtils.js","webpack:///./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ImageMaterialTechnique.js","webpack:///./node_modules/@arcgis/core/views/3d/webgl-engine/materials/ImageMaterial.js","webpack:///./node_modules/@arcgis/core/views/layers/ImageryLayerView.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/support/projectExtentUtils.js","webpack:///./node_modules/@arcgis/core/chunks/ImageMaterial.glsl.js"],"names":["m","super","arguments","this","type","redrawDebounced","async","redraw","e","t","_redrawImage","handles","add","view","basemapTerrain","initializeMaximumDataResolution","layer","on","updatingHandles","addPromise","refreshDebounced","spatialReference","fullExtent","equals","maximumDataResolution","x","pixelSizeX","y","pixelSizeY","timeExtent","a","imageElement","image","document","createElement","pixelData","HTMLCanvasElement","Promise","reject","i","r","getContext","s","applyRenderer","signal","o","applyFilter","pixelBlock","width","height","createImageData","data","set","getAsRGBA","putImageData","n","c","doRefresh","dataChanged","catch","getLogger","declaredClass","error","prototype","Math","round","createSquareGeometry","min","max","h","u","l","g","Float64Array","w","Float32Array","d","Uint32Array","f","p","M","v","length","size","exclusive","P","O","drapeSourceType","updatePolicy","fullExtentInLocalViewSpatialReference","_images","Array","_extents","_overlays","updateWhenStationary","destroyed","_doRefresh","addResolvingPromise","then","_set","_suspendedChangeHandler","resourceController","scheduler","registerIdleStateCallbacks","_isScaleRangeActive","notifyChange","_isScaleRangeLayer","clear","_spatialReference","forEach","index","_updateImageExtent","_clippedExtent","extent","H","resolution","pixelRatio","imageMaxWidth","imageMaxHeight","floor","_imageSizeEquals","imageSize","suspended","_fetch","_clearImage","push","canResume","minScale","maxScale","scale","some","loadingPromise","HTMLImageElement","contains","_createStageObjects","abs","TESTS_DISABLE_OPTIMIZATIONS","texture","material","renderGeometry","loadingAbortController","renderExtent","abort","AbortController","_waitFetchReady","requestAsImageElement","getFetchOptions","fetchImage","warnOnce","processResult","aborted","overlayManager","renderer","removeGeometries","_stage","remove","preMultiplyAlpha","wrap","loadSynchronous","transparent","textureId","id","setParameters","origin","renderLocalOrigin","addGeometries","viewingMode","ready","readOnly","V","popupTemplate","getRequiredFields","fieldsIndex","lastEditInfoEnabled","objectIdField","typeIdField","globalIdField","relationships","includes","has","indexOf","keyField","defaultPopupTemplateEnabled","defaultPopupTemplate","shader","get","configuration","build","output","slicePlaneEnabled","sliceHighlightDisabled","sliceEnabledForVertexPrograms","OITEnabled","transparencyPassType","multipassTerrainEnabled","cullAboveGround","rctx","program","camera","projectionMatrix","setUniform1f","opacity","setUniform2fv","nearFar","inverseViewport","rebindTextures","blending","culling","cullFace","depthTest","func","depthWrite","writeDepth","colorWrite","stencilWrite","sceneHasOcludees","stencilTest","polygonOffset","enableOffset","_occludeePipelineState","setPipelineState","getPipelineState","count","supportsEdges","techniqueConfig","parameters","relativeElevation","_material","updateTexture","ensureTechnique","hasOccludees","updateParameters","_output","_updateOccludeeState","bindTextures","bindTextureScale","bindPass","initTextureTransparent","popupEnabled","geometry","outFields","outSpatialReference","returnTopmostRaster","showNoDataRecords","layerOptions","returnDomainValues","pixelSize","queryVisibleRasters","isEmpty","resolve","clone","state","isLocal","portalItem","include","linearDepth","vertex","uniforms","attributes","varyings","code","fragment","float","Object","freeze","__proto__"],"mappings":"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","file":"js/chunk-cf9611a8.35ed5604.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{isNone as t}from\"../../../core/maybe.js\";import{debounce as a}from\"../../../core/promiseUtils.js\";import{whenOnce as i}from\"../../../core/watchUtils.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/set.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"./DynamicLayerView3D.js\";import{ImageryLayerView as o}from\"../../layers/ImageryLayerView.js\";let m=class extends(o(s)){constructor(){super(...arguments),this.type=\"imagery-3d\",this.redrawDebounced=a((async e=>{this.redraw(((e,t)=>this._redrawImage(e,t)),e)}),2e3)}initialize(){this.handles.add([i(this.view.basemapTerrain,\"ready\",(()=>this.initializeMaximumDataResolution())),this.layer.on(\"redraw\",(()=>this.redrawDebounced()))]),this.updatingHandles.add(this.layer,\"exportImageServiceParameters.version\",(()=>{this.updatingHandles.addPromise(this.refreshDebounced())})),this.updatingHandles.add(this,\"timeExtent\",(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}initializeMaximumDataResolution(){const e=this.view.basemapTerrain.spatialReference,t=this.layer.fullExtent;t&&e.equals(t.spatialReference)&&(this.maximumDataResolution={x:this.layer.pixelSizeX,y:this.layer.pixelSizeY})}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,t,a){t.imageElement?e.image=t.imageElement:(e.image=document.createElement(\"canvas\"),e.pixelData=t.pixelData,await this._redrawImage(e,a))}async _redrawImage(e,a){if(!(e.image instanceof HTMLCanvasElement)||t(e.pixelData))return Promise.reject();const i=e.image,r=i.getContext(\"2d\"),s=await this.layer.applyRenderer(e.pixelData,{signal:a}),o=this.layer.applyFilter(s).pixelBlock;if(t(o))return Promise.reject();i.width=o.width,i.height=o.height;const m=r.createImageData(o.width,o.height);m.data.set(o.getAsRGBA()),r.putImageData(m,0,0)}};m=e([r(\"esri.views.3d.layers.ImageryLayerView3D\")],m);const n=m;export{n as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Logger.js\";import{isAbortError as s}from\"../../core/promiseUtils.js\";import{on as o}from\"../../core/watchUtils.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";const i=i=>{let c=class extends i{initialize(){this.handles.add(o(this,\"layer\",\"refresh\",(r=>{this.doRefresh(r.dataChanged).catch((r=>{s(r)||e.getLogger(this.declaredClass).error(r)}))})),\"RefreshableLayerView\")}};return r([t()],c.prototype,\"layer\",void 0),c=r([a(\"esri.layers.mixins.RefreshableLayerView\")],c),c};export{i as RefreshableLayerView,i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{width as t,height as e,intersects as n}from\"../../../../geometry/support/aaBoundingRect.js\";import{Geometry as i}from\"../../webgl-engine/lib/Geometry.js\";import r from\"../../webgl-engine/lib/GeometryUtil.js\";function o(n,i,r){const o=t(n)/e(n),a={width:r,height:r};return o>1.0001?a.height=r/o:o<.9999&&(a.width=r*o),a.width=Math.round(a.width/(t(n)/t(i))),a.height=Math.round(a.height/(e(n)/e(i))),a}function a(t){return r.createSquareGeometry([[t[0],t[1],-1],[t[2],t[1],-1],[t[2],t[3],-1],[t[0],t[3],-1]])}function h(t,e){if(!n(t,e))return a(e);const r=[t[1]-e[1],Math.min(t[3],e[3])-Math.max(t[1],e[1]),e[3]-t[3],123456],o=[t[0]-e[0],Math.min(t[2],e[2])-Math.max(t[0],e[0]),e[2]-t[2],123456],h=e[2]-e[0],u=e[3]-e[1],l=o[0]>0&&o[2]>0?3:2,m=r[0]>0&&r[2]>0?3:2,c=(m+1)*(l+1),g=new Float64Array(3*c),w=new Float32Array(2*c),d=new Uint32Array(6*(m*l-1));let f=0,p=0,y=0,x=0,M=0;for(let n=0;n<4;n++){const t=r[n];if(t<=0)continue;let i=0;for(let r=0;r<4;r++){const t=o[r];t<=0||(g[p++]=e[0]+i,g[p++]=e[1]+f,g[p++]=-1,w[y++]=i/h,w[y++]=f/u,r<3&&n<3&&(1!==r||1!==n)&&(d[M++]=x,d[M++]=x+1,d[M++]=x+l+1,d[M++]=x+1,d[M++]=x+l+2,d[M++]=x+l+1),x++,i+=t)}f+=t}const v=new Uint32Array(d.length);return new i([[\"position\",{size:3,data:g,exclusive:!0}],[\"normal\",{size:3,data:s,exclusive:!0}],[\"uv0\",{size:2,data:w,exclusive:!0}]],[[\"position\",d],[\"normal\",v],[\"uv0\",d]])}const s=[0,0,1];export{o as computeImageExportSize,a as createGeometryForExtent,h as createOuterImageGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{forEach as t,result as i}from\"../../../core/asyncUtils.js\";import r from\"../../../core/Logger.js\";import{isNone as a,isSome as s}from\"../../../core/maybe.js\";import{debounce as n,isAbortError as o,eachAlways as l,onAbort as h,isAborted as m,createAbortError as d,always as c,throwIfAborted as g}from\"../../../core/promiseUtils.js\";import{whenOnce as u}from\"../../../core/watchUtils.js\";import{property as p}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as y}from\"../../../core/accessorSupport/decorators/subclass.js\";import f from\"../../../geometry/Extent.js\";import{equals as x,create as w,width as _,height as v,copy as b,intersection as R}from\"../../../geometry/support/aaBoundingRect.js\";import{LayerView3D as S}from\"./LayerView3D.js\";import{computeImageExportSize as j,createGeometryForExtent as E,createOuterImageGeometry as I}from\"./support/overlayImageUtils.js\";import{toViewIfLocal as A}from\"./support/projectExtentUtils.js\";import C from\"../support/debugFlags.js\";import{RenderGeometry as L}from\"../webgl-engine/lib/RenderGeometry.js\";import{Texture as M}from\"../webgl-engine/lib/Texture.js\";import{ImageMaterial as D}from\"../webgl-engine/materials/ImageMaterial.js\";import G from\"../../layers/LayerView.js\";import{RefreshableLayerView as T}from\"../../layers/RefreshableLayerView.js\";const P=r.getLogger(\"esri.views.3d.layers.DynamicLayerView3D\");let O=class extends(T(S(G))){constructor(){super(...arguments),this.drapeSourceType=0,this.updatePolicy=1,this.fullExtentInLocalViewSpatialReference=null,this.maximumDataResolution=null,this._images=new Array,this._extents=new Array,this._overlays=new Array,this.updateWhenStationary=!0,this.refreshDebounced=n((async e=>{this.destroyed||await this._doRefresh(e).catch((e=>{o(e)||r.getLogger(this.declaredClass).error(e)}))}),2e3)}initialize(){this.addResolvingPromise(A(this).then((e=>this._set(\"fullExtentInLocalViewSpatialReference\",e)))),this.updatingHandles.add(this,\"suspended\",(()=>this._suspendedChangeHandler())),this.handles.add(this.view.resourceController.scheduler.registerIdleStateCallbacks((()=>{this._isScaleRangeActive()&&this.notifyChange(\"suspended\")}),(()=>{}))),this._isScaleRangeLayer()&&this.updatingHandles.add(this.layer,\"scaleRangeId\",(()=>this.notifyChange(\"suspended\")))}destroy(){this.clear()}setDrapingExtent(e,t){this._spatialReference=t,e.forEach((e=>{this._overlays[e.index]=e,this._updateImageExtent(e)}))}_updateImageExtent(e){const t=this._clippedExtent(e.extent,H);if(a(t))return;const i=j(e.extent,t,e.resolution);let r=e.pixelRatio*this.view.pixelRatio;if(\"imageMaxWidth\"in this.layer||\"imageMaxHeight\"in this.layer){const e=this.layer.imageMaxWidth,t=this.layer.imageMaxHeight;if(i.width>e){const t=e/i.width;i.height=Math.floor(i.height*t),i.width=e,r*=t}if(i.height>t){const e=t/i.height;i.width=Math.floor(i.width*e),i.height=t,r*=e}}const s=this._extents[e.index];s&&x(s.extent,t)&&this._imageSizeEquals(t,s.imageSize,i)||(this._extents[e.index]={extent:w(t),imageSize:i,pixelRatio:r},this.suspended||this._fetch(e.index).catch((e=>{o(e)||P.error(e)})))}clear(){for(let e=0;e<this._images.length;e++)this._clearImage(e)}async doRefresh(){return this._doRefresh()}async _doRefresh(e){if(this.suspended)return;const t=[];for(let i=0;i<this._extents.length;i++)this._extents[i]&&t.push(this._fetch(i,e));await l(t)}canResume(){if(!super.canResume())return!1;if(this._isScaleRangeLayer()){const{minScale:e,maxScale:t}=this.layer;if(e>0||t>0){const i=this.view.scale;if(i<t||e>0&&i>e)return!1}}return!0}isUpdating(){return this._images.some((e=>!!e.loadingPromise))}async processResult(e,t,i){(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e.image=t)}findExtentInfoAt(e){for(const t of this._extents){const i=t.extent;if(new f(i[0],i[1],i[2],i[3],this._spatialReference).contains(e))return t}return null}getFetchOptions(){}async redraw(e,i){await t(this._images,(async(t,r)=>{t&&(await e(t,i),await this._createStageObjects(r,t.image,i))}))}_imageSizeEquals(e,t,i){if(!this.maximumDataResolution)return!1;const r=_(e)/this.maximumDataResolution.x,a=v(e)/this.maximumDataResolution.y,s=r/t.width,n=a/t.height,o=r/i.width,l=a/i.height,h=Math.abs(s-o),m=Math.abs(n-l),d=C.TESTS_DISABLE_OPTIMIZATIONS?0:1.5;return h<=d&&m<=d}async _fetch(e,t){if(this.suspended)return;const i=this._extents[e],r=i.extent;this._images[e]||(this._images[e]={texture:null,material:null,renderGeometry:null,loadingPromise:null,loadingAbortController:null,image:null,pixelData:null,renderExtent:w(r)});const a=this._images[e];a.loadingAbortController&&(a.loadingAbortController.abort(),a.loadingAbortController=null);const s=new f(r[0],r[1],r[2],r[3],this._spatialReference);if(0===s.width||0===s.height)return void this._clearImage(e);const n=new AbortController;a.loadingAbortController=n,h(t,(()=>n.abort()));const l=n.signal,g=this._waitFetchReady(l).then((()=>{const t={requestAsImageElement:!0,pixelRatio:this._overlays[e].pixelRatio,...this.getFetchOptions(),signal:l},{height:r,width:a}=i.imageSize;return this.layer.fetchImage(s,a,r,t)})).then((e=>{if(m(l))throw P.warnOnce(\"A call to fetchImage resolved even though the request was aborted. fetchImage should not resolve if options.signal.aborted is true.\"),d();return this.processResult(a,e)})).then((()=>b(a.renderExtent,r)));a.loadingPromise=g,c(g,(()=>{g===a.loadingPromise&&(a.loadingPromise=null,a.loadingAbortController=null)})),this.notifyChange(\"updating\"),await g.then((async()=>{if(l.aborted)throw d();await this._createStageObjects(e,a.image,l),this.notifyChange(\"updating\")})).catch((e=>{throw e&&!o(e)&&P.error(e),this.notifyChange(\"updating\"),e}))}_clearImage(e){const t=this._images[e];if(t){s(t.renderGeometry)&&(this.view.basemapTerrain.overlayManager.renderer.removeGeometries([t.renderGeometry],this,2),t.renderGeometry=null);const e=this.view._stage;e.remove(t.texture),t.texture=null,e.remove(t.material),t.material=null,t.loadingAbortController&&(t.loadingAbortController.abort(),t.loadingAbortController=null),t.loadingPromise=null,t.image=null,t.pixelData=null}}async _createStageObjects(e,t,r){const n=this.view._stage,o=this._images[e],l=this.view.basemapTerrain.overlayManager.renderer,h=()=>{n.remove(o.texture),o.texture=null,s(o.renderGeometry)&&(l.removeGeometries([o.renderGeometry],this,2),o.renderGeometry=null)};if(t){const s=new M(t,{width:t.width,height:t.height,preMultiplyAlpha:!0,wrap:{s:33071,t:33071}});let m;if(await i(this._images[0===e?1:0].loadingPromise),g(r),0===e)m=E(o.renderExtent);else{const e=this._images[0].renderExtent;if(!e)return void h();m=I(e,o.renderExtent)}h(),n.add(s),n.loadSynchronous(s),o.texture=s,a(o.material)?(o.material=new D({transparent:!0,textureId:s.id}),n.add(o.material)):o.material.setParameters({textureId:s.id}),o.renderGeometry=new L(m,o.material),o.renderGeometry.origin=this._overlays[e].renderLocalOrigin,l.addGeometries([o.renderGeometry],this,2)}else h(),n.remove(o.material),o.material=null}_isScaleRangeLayer(){return\"minScale\"in this.layer&&\"maxScale\"in this.layer}_isScaleRangeActive(){return!!this._isScaleRangeLayer()&&(this.layer.minScale>0||this.layer.maxScale>0)}_clippedExtent(e,t){if(\"local\"!==this.view.viewingMode)return b(t,e);const i=this.view.basemapTerrain;return i.ready?R(e,i.extent,t):b(t,e)}_suspendedChangeHandler(){this.suspended?this.clear():this.refreshDebounced()}async _waitFetchReady(e){await u(this.view,\"stationary\",e),g(e)}};e([p()],O.prototype,\"layer\",void 0),e([p()],O.prototype,\"suspended\",void 0),e([p({readOnly:!0})],O.prototype,\"fullExtentInLocalViewSpatialReference\",void 0),e([p()],O.prototype,\"updating\",void 0),O=e([y(\"esri.views.3d.layers.DynamicLayerView3D\")],O);const H=w(),V=O;export{V as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l}from\"../../../layers/support/fieldUtils.js\";async function t(t,d=t.popupTemplate){if(!e(d))return[];const i=await d.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:n}=d,{objectIdField:s,typeIdField:a,globalIdField:o,relationships:u}=t;if(i.includes(\"*\"))return[\"*\"];const f=n?await p(t):[],r=l(t.fieldsIndex,[...i,...f]);return a&&r.push(a),r&&s&&t.fieldsIndex.has(s)&&-1===r.indexOf(s)&&r.push(s),r&&o&&t.fieldsIndex.has(o)&&-1===r.indexOf(o)&&r.push(o),u&&u.forEach((e=>{const{keyField:p}=e;r&&p&&t.fieldsIndex.has(p)&&-1===r.indexOf(p)&&r.push(p)})),r}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,t as getRequiredFields};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{bindSliceUniformsWithOrigin as t}from\"../core/shaderLibrary/Slice.glsl.js\";import{bindMultipassTerrainTexture as r}from\"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{bindProjectionMatrix as i,bindView as s}from\"../core/shaderLibrary/util/View.glsl.js\";import{ReloadableShaderModule as a}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as o}from\"../core/shaderTechnique/ShaderTechnique.js\";import{parameter as n,ShaderTechniqueConfiguration as l}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{Default3D as p}from\"../lib/DefaultVertexAttributeLocations.js\";import{OITBlending as c,OITDepthTest as u,OITDepthWrite as d,getOITPolygonOffset as h}from\"../lib/OrderIndependentTransparency.js\";import{Program as m}from\"../lib/Program.js\";import{stencilWriteMaskOn as b,stencilToolMaskBaseParams as f,stencilBaseAllZerosParams as g}from\"../lib/StencilUtils.js\";import{I as y}from\"../../../../chunks/ImageMaterial.glsl.js\";import{simpleBlendingParams as T,makePipelineState as P,cullingParams as v,defaultDepthWriteParams as j,defaultColorWriteParams as S}from\"../../../webgl/renderState.js\";class E extends o{initializeProgram(e){const t=E.shader.get(),r=this.configuration,i=t.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===r.transparencyPassType,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new m(e.rctx,i,p)}bindPass(e,t){i(this.program,t.camera.projectionMatrix),this.program.setUniform1f(\"opacity\",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv(\"cameraNearFar\",t.camera.nearFar),this.program.setUniform2fv(\"inverseViewport\",t.inverseViewport),r(this.program,t))}bindDraw(e){s(this.program,e),t(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const r=this.configuration,i=3===e,s=2===e;return P({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?w:c(e),culling:v(r.cullFace),depthTest:{func:u(e)},depthWrite:i?r.writeDepth&&j:d(e),colorWrite:S,stencilWrite:r.sceneHasOcludees?b:null,stencilTest:r.sceneHasOcludees?t?f:g:null,polygonOffset:i||s?null:h(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}E.shader=new a(y,(()=>import(\"./ImageMaterial.glsl.js\")));const w=T(1,771);class O extends l{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}e([n({count:8})],O.prototype,\"output\",void 0),e([n({count:3})],O.prototype,\"cullFace\",void 0),e([n()],O.prototype,\"slicePlaneEnabled\",void 0),e([n()],O.prototype,\"transparent\",void 0),e([n()],O.prototype,\"enableOffset\",void 0),e([n()],O.prototype,\"writeDepth\",void 0),e([n()],O.prototype,\"sceneHasOcludees\",void 0),e([n({count:4})],O.prototype,\"transparencyPassType\",void 0),e([n()],O.prototype,\"multipassTerrainEnabled\",void 0),e([n()],O.prototype,\"cullAboveGround\",void 0);export{E as ImageMaterialTechnique,O as ImageMaterialTechniqueConfiguration};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{outputFromPass as e}from\"../lib/GLMaterials.js\";import t from\"../lib/GLMaterialTexture.js\";import{Material as r,materialParametersDefaults as a}from\"../lib/Material.js\";import{OITPolygonOffsetLimit as s}from\"../lib/OrderIndependentTransparency.js\";import{DefaultBufferWriter as i,PositionUVLayout as n}from\"./internal/DefaultBufferWriter.js\";import{intersectTriangleGeometry as u}from\"./internal/MaterialUtil.js\";import{ImageMaterialTechniqueConfiguration as c,ImageMaterialTechnique as l}from\"../shaders/ImageMaterialTechnique.js\";class h extends r{constructor(e){super(e,o),this.supportsEdges=!0,this.techniqueConfig=new c}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<s,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}intersect(e,t,r,a,s,i,n){u(e,t,a,s,i,void 0,n)}requiresSlot(t,r){if(20===t)return!0;if(4===e(r))return 2===t;return t===(this.parameters.transparent?this.parameters.writeDepth?4:7:2)}createGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new p(e):void 0}createBufferWriter(){return new i(n)}}class p extends t{constructor(e){super({...e,...e.material.parameters})}updateParameters(e){const t=this._material.parameters;return this.updateTexture(t.textureId),this.ensureTechnique(l,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&(this._material.setParameters({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}beginSlot(e){return 0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){this.bindTextures(t.program),this.bindTextureScale(t.program),t.bindPass(this._material.parameters,e)}}const o={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...a};export{h as ImageMaterial};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";import p from\"../../geometry/Point.js\";import{combinedViewLayerTimeExtentProperty as i}from\"../../layers/support/commonProperties.js\";import a from\"../../rest/support/Query.js\";import{getFetchPopupTemplate as n}from\"./support/popupUtils.js\";const u=u=>{let m=class extends u{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,o){const{layer:s}=this;if(!e)throw new r(\"imagerylayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:s});const{popupEnabled:i}=s,u=n(s,o);if(!i||!t(u))throw new r(\"imagerylayerview:fetchPopupFeatures\",\"Missing required popupTemplate or popupEnabled\",{popupEnabled:i,popupTemplate:u});const m=await u.getRequiredFields(),c=new a;c.timeExtent=this.timeExtent,c.geometry=e,c.outFields=m,c.outSpatialReference=e.spatialReference;const l=this.view.resolution,y=\"2d\"===this.view.type?new p(l,l,this.view.spatialReference):new p(.5*l,.5*l,this.view.spatialReference),{returnTopmostRaster:h,showNoDataRecords:w}=u.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},d={returnDomainValues:!0,returnTopmostRaster:h,pixelSize:y,showNoDataRecords:w,signal:t(o)?o.signal:null};return s.queryVisibleRasters(c,d).then((e=>e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}};return e([o()],m.prototype,\"layer\",void 0),e([o()],m.prototype,\"suspended\",void 0),e([o(i)],m.prototype,\"timeExtent\",void 0),e([o()],m.prototype,\"view\",void 0),m=e([s(\"esri.views.layers.ImageryLayerView\")],m),m};export{u as ImageryLayerView,u as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as r}from\"../../../../core/maybe.js\";import{project as o}from\"../../../../geometry/support/webMercatorUtils.js\";import{projectGeometry as t}from\"../../../../portal/support/geometryServiceUtils.js\";function l(l){const s=l.view.spatialReference,i=l.layer.fullExtent,n=e(i)&&i.spatialReference;if(r(i)||!n)return Promise.resolve(null);if(n.equals(s))return Promise.resolve(i.clone());const a=o(i,s);return e(a)?Promise.resolve(a):l.view.state.isLocal?t(i,s,l.layer.portalItem).then((e=>!l.destroyed&&e?e:void 0)).catch((()=>null)):Promise.resolve(null)}export{l as toViewIfLocal};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{Slice as e}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{Transform as r}from\"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js\";import{ReadLinearDepth as a}from\"../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js\";import{multipassTerrainTest as o}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{defaultMaskAlphaCutoff as i}from\"../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl.js\";import{ColorConversion as d}from\"../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js\";import{glsl as t}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{ShaderBuilder as l}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";function s(s){const n=new l;return n.include(r,{linearDepth:!1}),n.vertex.uniforms.add(\"proj\",\"mat4\").add(\"view\",\"mat4\"),n.attributes.add(\"position\",\"vec3\"),n.attributes.add(\"uv0\",\"vec2\"),n.varyings.add(\"vpos\",\"vec3\"),s.multipassTerrainEnabled&&n.varyings.add(\"depth\",\"float\"),n.vertex.uniforms.add(\"textureCoordinateScaleFactor\",\"vec2\"),n.vertex.code.add(t`\n    void main(void) {\n      vpos = position;\n      ${s.multipassTerrainEnabled?\"depth = (view * vec4(vpos, 1.0)).z;\":\"\"}\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  `),n.include(e,s),s.multipassTerrainEnabled&&(n.fragment.include(a),n.include(o,s)),n.fragment.uniforms.add(\"tex\",\"sampler2D\"),n.fragment.uniforms.add(\"opacity\",\"float\"),n.varyings.add(\"vTexCoord\",\"vec2\"),7===s.output?n.fragment.code.add(t`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ${t.float(i)}) {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    `):(n.fragment.include(d),n.fragment.code.add(t`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ${t.float(i)}) {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ${s.OITEnabled?\"gl_FragColor = premultiplyAlpha(gl_FragColor);\":\"\"}\n    }\n    `)),n}const n=Object.freeze({__proto__:null,build:s});export{n as I,s as b};\n"],"sourceRoot":""}