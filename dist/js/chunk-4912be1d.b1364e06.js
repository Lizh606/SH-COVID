(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4912be1d"],{"00c0":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("8c71"),s=i("0326"),n=i("7c4b");class a extends n["a"]{constructor(){super(...arguments),this._childrenSet=new Set,this._needsSort=!1,this.children=[],this._effectView=null}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e,this.requestRender()}get clips(){return this._clips}set clips(e){this._clips=e,this.children.forEach(t=>t.clips=e)}get computedEffects(){var e,t;return null!=(e=null==(t=this._effectView)?void 0:t.effects)?e:null}get effect(){var e,t;return null!=(e=null==(t=this._effectView)?void 0:t.effect)?e:""}set effect(e){(this._effectView||e)&&(this._effectView||(this._effectView=new s["a"]),this._effectView.effect=e,this.requestRender())}updateTransitionProperties(e,t){super.updateTransitionProperties(e,t),this._effectView&&(this._effectView.transitionStep(e,t),this._effectView.transitioning&&this.requestRender())}doRender(e){const t=this.createRenderParams(e);this.renderChildren(t)}addChild(e){return this.addChildAt(e,this.children.length)}addChildAt(e,t=this.children.length){if(!e)return e;if(this.contains(e))return e;this._needsSort=!0;const i=e.parent;return i&&i!==this&&i.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),e}contains(e){return this._childrenSet.has(e)}removeAllChildren(){this._childrenSet.clear(),this._needsSort=!0;for(const e of this.children)this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null;this.children.length=0}removeChild(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}removeChildAt(e){if(e<0||e>=this.children.length)return null;this._needsSort=!0;const t=this.children.splice(e,1)[0];return this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,t}sortChildren(e){this._needsSort&&(this.children.sort(e),this._needsSort=!1)}_createTransforms(){return{dvs:Object(r["b"])()}}onAttach(){super.onAttach();const e=this.stage;for(const t of this.children)t.stage=e}onDetach(){super.onDetach();for(const e of this.children)e.stage=null}renderChildren(e){for(const t of this.children)t.beforeRender(e);for(const t of this.children)t.processRender(e);for(const t of this.children)t.afterRender(e)}createRenderParams(e){return{...e,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition}}}},"18c6":function(e,t,i){"use strict";i.d(t,"a",(function(){return L})),i.d(t,"b",(function(){return z})),i.d(t,"c",(function(){return C})),i.d(t,"d",(function(){return A})),i.d(t,"e",(function(){return I})),i.d(t,"f",(function(){return E})),i.d(t,"g",(function(){return j})),i.d(t,"h",(function(){return T}));var r=i("ce50"),s=i("c84e"),n=i("9b77");function a(e,t){const i=s["e"].SIZE_FIELD_STOPS|s["e"].SIZE_MINMAX_VALUE|s["e"].SIZE_SCALE_STOPS|s["e"].SIZE_UNIT_VALUE,r=(e&(s["f"].FIELD_TARGETS_OUTLINE|s["f"].MINMAX_TARGETS_OUTLINE|s["f"].SCALE_TARGETS_OUTLINE|s["f"].UNIT_TARGETS_OUTLINE))>>>4;return t.isOutline||t.isOutlinedFill?i&r:i&~r}const o=0,l=8,c=7,h=8,u=11,d=11,f=12,p=13,m=14,y=15,b=15,g=16,v=17,w=18,x=19,_=20,O=21,S=22;function j(e,t){switch(e){case s["d"].FILL:return L.from(t);case s["d"].LINE:return C.from(t);case s["d"].MARKER:return A.from(t);case s["d"].TEXT:return E.from(t);case s["d"].LABEL:return z.from(t);default:throw new Error("Unable to createMaterialKey for unknown geometryType "+e)}}function T(e){switch(I.load(e).geometryType){case s["d"].MARKER:return new A(e);case s["d"].FILL:return new L(e);case s["d"].LINE:return new C(e);case s["d"].TEXT:return new E(e);case s["d"].LABEL:return new z(e)}}class I{constructor(e){this._data=0,this._data=e}static load(e){const t=this.shared;return t.data=e,t}set data(e){this._data=e}get data(){return this._data}get geometryType(){return this.bits(h,u)}set geometryType(e){this.setBits(e,h,u)}get mapAligned(){return!!this.bit(_)}set mapAligned(e){this.setBit(_,e)}get sdf(){return!!this.bit(d)}set sdf(e){this.setBit(d,e)}get pattern(){return!!this.bit(f)}set pattern(e){this.setBit(f,e)}get textureBinding(){return this.bits(o,l)}set textureBinding(e){this.setBits(e,o,l)}get geometryTypeString(){switch(this.geometryType){case s["d"].FILL:return"fill";case s["d"].MARKER:return"marker";case s["d"].LINE:return"line";case s["d"].TEXT:return"text";case s["d"].LABEL:return"label";default:throw new r["a"]("Unable to handle unknown geometryType: "+this.geometryType)}}setBit(e,t){const i=1<<e;t?this._data|=i:this._data&=~i}bit(e){return(this._data&1<<e)>>e}setBits(e,t,i){for(let r=t,s=0;r<i;r++,s++)this.setBit(r,0!=(e&1<<s))}bits(e,t){let i=0;for(let r=e,s=0;r<t;r++,s++)i|=this.bit(r)<<s;return i}hasVV(){return!1}setVV(e,t){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(c&this.textureBinding)}}I.shared=new I(0);const R=e=>class extends e{get vvSizeMinMaxValue(){return 0!==this.bit(g)}set vvSizeMinMaxValue(e){this.setBit(g,e)}get vvSizeScaleStops(){return 0!==this.bit(v)}set vvSizeScaleStops(e){this.setBit(v,e)}get vvSizeFieldStops(){return 0!==this.bit(w)}set vvSizeFieldStops(e){this.setBit(w,e)}get vvSizeUnitValue(){return 0!==this.bit(x)}set vvSizeUnitValue(e){this.setBit(x,e)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(e,t){super.setVV(e,t);const i=a(e,t)&e;this.vvSizeMinMaxValue=!!(i&s["e"].SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(i&s["e"].SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(i&s["e"].SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(i&s["e"].SIZE_SCALE_STOPS)}},M=e=>class extends e{get vvRotation(){return 0!==this.bit(y)}set vvRotation(e){this.setBit(y,e)}hasVV(){return super.hasVV()||this.vvRotation}setVV(e,t){super.setVV(e,t),this.vvRotation=!t.isOutline&&!!(e&s["e"].ROTATION)}},P=e=>class extends e{get vvColor(){return 0!==this.bit(p)}set vvColor(e){this.setBit(p,e)}hasVV(){return super.hasVV()||this.vvColor}setVV(e,t){super.setVV(e,t),this.vvColor=!t.isOutline&&!!(e&s["e"].COLOR)}},V=e=>class extends e{get vvOpacity(){return 0!==this.bit(m)}set vvOpacity(e){this.setBit(m,e)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(e,t){super.setVV(e,t),this.vvOpacity=!t.isOutline&&!!(e&s["e"].OPACITY)}};class L extends(P(V(R(I)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=s["d"].FILL,t.dotDensity="dot-density"===e.stride.fill,t.simple="simple"===e.stride.fill,t.outlinedFill=e.isOutlinedFill,t.dotDensity||t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,outlinedFill:this.outlinedFill,simple:this.simple,vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}get dotDensity(){return!!this.bit(b)}set dotDensity(e){this.setBit(b,e)}get simple(){return!!this.bit(S)}set simple(e){this.setBit(S,e)}get outlinedFill(){return!!this.bit(O)}set outlinedFill(e){this.setBit(O,e)}}L.shared=new L(0);class A extends(P(V(M(R(I))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=s["d"].MARKER,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}A.shared=new A(0);class C extends(P(V(R(I)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=s["d"].LINE,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}C.shared=new C(0);class E extends(P(V(M(R(I))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=s["d"].TEXT,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}E.shared=new E(0);class z extends(R(I)){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=s["d"].LABEL,t.setVV(e.vvFlags,e),t.mapAligned=Object(n["a"])(e.placement),t.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}z.shared=new z(0)},"19db":function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return y})),i.d(t,"c",(function(){return V})),i.d(t,"d",(function(){return P})),i.d(t,"e",(function(){return u})),i.d(t,"f",(function(){return L})),i.d(t,"g",(function(){return b})),i.d(t,"h",(function(){return h})),i.d(t,"i",(function(){return f}));var r=i("fa8a"),s=i("b2b2"),n=i("3e27"),a=i("9dee");const o=new Map;o.set("meter-per-second",1),o.set("kilometer-per-hour",.277778),o.set("knots",.514444),o.set("feet-per-second",.3048),o.set("mile-per-hour",.44704);const l=180/Math.PI,c=5,h=new r["a"]({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function u(e,t){return o.get(e)/o.get(t)||1}function d(e){return(450-e)%360}function f(e,t="geographic"){const[i,r]=e,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i)*l;return n=(360+n)%360,"geographic"===t&&(n=d(n)),[s,n]}function p(e,t="geographic"){let i=e[1];"geographic"===t&&(i=d(i)),i%=360;const r=e[0];return[r*Math.cos(i/l),r*Math.sin(i/l)]}function m(e,t,i="geographic",r=1){if(!Object(a["i"])(e))return e;const{pixels:s,width:o,height:l}=e,c=o*l,h=s[0],u=s[1],d=n["a"].createEmptyBand(e.pixelType,c),m=n["a"].createEmptyBand(e.pixelType,c);let y=0;for(let n=0;n<l;n++)for(let e=0;e<o;e++)"vector-uv"===t?([d[y],m[y]]=f([h[y],u[y]],i),d[y]*=r):([d[y],m[y]]=p([h[y],u[y]],i),d[y]*=r,m[y]*=r),y++;const b=new n["a"]({pixelType:e.pixelType,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:[d,m]});return b.updateStatistics(),b}function y(e,t,i=1){if(1===i||!Object(a["i"])(e))return e;const r=e.clone(),{pixels:s,width:n,height:o}=r,l=s[0],c=s[1];let h=0;for(let a=0;a<o;a++)for(let e=0;e<n;e++)"vector-uv"===t?(l[h]*=i,c[h]*=i):l[h]*=i,h++;return r.updateStatistics(),r}function b(e,t,i,r,n){if(!Object(s["l"])(n)||!n.spatialReference.equals(e.spatialReference))return{extent:e,width:t,height:i,resolution:e.width/t};const a=n.xmin,o=n.ymax;r=Math.max(r||0,30);const l=Math.ceil(t*(1/r)),c=Math.ceil(i*(1/r)),h=((e.xmax-e.xmin)/l+(e.ymax-e.ymin)/c)/2;return e.xmin=a+Math.floor((e.xmin-a)/h)*h,e.xmax=a+Math.ceil((e.xmax-a)/h)*h,e.ymin=o+Math.floor((e.ymin-o)/h)*h,e.ymax=o+Math.ceil((e.ymax-o)/h)*h,{extent:e,width:Math.round(e.width/h),height:Math.round(e.height/h),resolution:h}}const g=v(0,0,0);function v(e=0,t=0,i=Math.PI,r=!0){r&&(i=(2*Math.PI-i)%(2*Math.PI));const s=r?-1:1,n=13*s,a=-7*s,o=-2*s,l=-16*s,c=29,[h,u]=x(0,t+n,i,c),[d,f]=x(e-5.5,t+a,i,c),[p,m]=x(e+5.5,t+a,i,c),[y,b]=x(e-1.5,t+o,i,c),[g,v]=x(e+1.5,t+o,i,c),[w,_]=x(e-1.5,t+l,i,c),[O,S]=x(e+1.5,t+l,i,c);return[h,u,d,f,y,b,g,v,p,m,w,_,O,S]}function w(e=0,t=Math.PI,i=!0){i&&(t=(2*Math.PI-t)%(2*Math.PI));const r=10,s=i?-1:1,n=5*s,a=20*s,o=25*s,l=45,h=0,u=0,d=2,f=0,p=d*s;let[m,y]=[h+r/2,u-a],[b,g]=[m+d,y],[v,w]=[b-f,g+p],[_,O]=[h-r/2,u-o],[S,j]=[_+f,O-p],T=Math.ceil(e/c),I=Math.floor(T/10);T-=8*I;const R=[],M=[];for(let c=0;c<T/2;c++,I--){I<=0&&T%2==1&&c===(T-1)/2&&(_=h,S=_+f,O=(O+y)/2,j=O-p);const[e,i]=x(_,O,t,l);if(I>0){const[r,s]=x(b,O,t,l),[n,a]=x(m,y,t,l);R.push(r),R.push(s),R.push(e),R.push(i),R.push(n),R.push(a)}else{const[r,s]=x(b,g,t,l),[n,a]=x(v,w,t,l),[o,c]=x(S,j,t,l);M.push(e),M.push(i),M.push(o),M.push(c),M.push(n),M.push(a),M.push(r),M.push(s)}O+=n,y+=n,g+=n,w+=n,j+=n}const[P,V]=x(h+r/2,u+a,t,l),L=r/2+d,[A,C]=x(h+L,u+a,t,l),[E,z]=x(h+r/2,u-o,t,l),[k,D]=x(h+L,u-o,t,l);return{pennants:R,barbs:M,shaft:[P,V,A,C,E,z,k,D]}}function x(e,t,i,r=1){const s=Math.sqrt(e*e+t*t)/r,n=(2*Math.PI+Math.atan2(t,e))%(2*Math.PI);return[s,(2*Math.PI+n-i)%(2*Math.PI)]}const _=[0,1,3,6,10,16,21,27,33,40,47,55,63],O=[0,.5,1,1.5,2],S=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function j(e,t,i,r){const s=u(r||"knots",i);let n;for(n=1;n<t.length;n++)if(n===t.length-1){if(e<t[n]*s)break}else if(e<=t[n]*s)break;return Math.min(n-1,t.length-2)}function T(e,t,i,r,s){let n=0;switch(t){case"beaufort_kn":n=j(e,_,"knots",i);break;case"beaufort_km":n=j(e,_,"kilometer-per-hour",i);break;case"beaufort_ft":n=j(e,_,"feet-per-second",i);break;case"beaufort_m":n=j(e,_,"meter-per-second",i);break;case"classified_arrow":n=j(e,s,r,i);break;case"ocean_current_m":n=j(e,O,"meter-per-second",i);break;case"ocean_current_kn":n=j(e,S,"knots",i)}return n}function I(e,t){const{style:i,inputUnit:r,outputUnit:s,breakValues:n}=t,a=h.fromJSON(r),o=h.fromJSON(s),l=42,c=15;let u=0,d=0;const{width:f,height:p,mask:m}=e,y=e.pixels[0],b=e.pixels[1],v=m?m.filter(e=>e>0).length:f*p,w=new Float32Array(v*l),x=new Uint32Array(c*v);for(let h=0;h<p;h++)for(let e=0;e<f;e++){const t=h*f+e;if(!m||m[h*f+e]){var _;const r=null!=(_=(b[t]+360)%360/180*Math.PI)?_:2*Math.PI*Math.random(),s=T(y[t],i,a,o,n);for(let i=0;i<g.length;i+=2)w[u++]=(e+.5)/f,w[u++]=(h+.5)/p,w[u++]=g[i],w[u++]=g[i+1]+r,w[u++]=s,w[u++]=y[t];const c=7*(u/l-1);x[d++]=c,x[d++]=c+1,x[d++]=c+2,x[d++]=c+0,x[d++]=c+4,x[d++]=c+3,x[d++]=c+0,x[d++]=c+2,x[d++]=c+3,x[d++]=c+2,x[d++]=c+5,x[d++]=c+3,x[d++]=c+5,x[d++]=c+6,x[d++]=c+3}}return{vertexData:w,indexData:x}}const R=[];function M(e,t){if(0===R.length)for(let c=0;c<30;c++)R.push(w(5*c,0));const i=u(h.fromJSON(t.inputUnit),"knots"),{width:r,height:s,mask:n}=e,a=e.pixels[0],o=e.pixels[1],l=6,d=[],f=[];let p=0,m=0;for(let h=0;h<s;h++)for(let e=0;e<r;e++){const t=h*r+e,u=a[t]*i;if((!n||n[h*r+e])&&u>=c){var y;const i=null!=(y=(o[t]+360)%360/180*Math.PI)?y:2*Math.PI*Math.random(),{pennants:n,barbs:a,shaft:c}=R[Math.min(Math.floor(u/5),29)];if(n.length+a.length===0)continue;let b=d.length/l;const g=(e+.5)/r,v=(h+.5)/s;for(let e=0;e<n.length;e+=2)d[p++]=g,d[p++]=v,d[p++]=n[e],d[p++]=n[e+1]+i,d[p++]=0,d[p++]=u;for(let e=0;e<a.length;e+=2)d[p++]=g,d[p++]=v,d[p++]=a[e],d[p++]=a[e+1]+i,d[p++]=0,d[p++]=u;for(let e=0;e<c.length;e+=2)d[p++]=g,d[p++]=v,d[p++]=c[e],d[p++]=c[e+1]+i,d[p++]=0,d[p++]=u;for(let e=0;e<n.length/6;e++)f[m++]=b,f[m++]=b+1,f[m++]=b+2,b+=3;for(let e=0;e<a.length/8;e++)f[m++]=b,f[m++]=b+1,f[m++]=b+2,f[m++]=b+1,f[m++]=b+2,f[m++]=b+3,b+=4;f[m++]=b+0,f[m++]=b+1,f[m++]=b+2,f[m++]=b+1,f[m++]=b+3,f[m++]=b+2,b+=4}}return{vertexData:new Float32Array(d),indexData:new Uint32Array(f)}}function P(e,t){const i=24;let r=0,s=0;const{width:n,height:a,mask:o}=e,l=e.pixels[0],h=[],u=[],d="wind_speed"===t.style?c:Number.MAX_VALUE;for(let c=0;c<a;c++)for(let e=0;e<n;e++){const t=c*n+e;if((!o||o[c*n+e])&&l[t]<d){for(let i=0;i<4;i++)h[r++]=(e+.5)/n,h[r++]=(c+.5)/a,h[r++]=i<2?-.5:.5,h[r++]=i%2==0?-.5:.5,h[r++]=0,h[r++]=l[t];const o=4*(r/i-1);u[s++]=o,u[s++]=o+1,u[s++]=o+2,u[s++]=o+1,u[s++]=o+2,u[s++]=o+3}}return{vertexData:new Float32Array(h),indexData:new Uint32Array(u)}}function V(e,t){return"simple_scalar"===t.style?P(e,t):"wind_speed"===t.style?M(e,t):I(e,t)}function L(e,t,i,r=[0,0],s=.5){const{width:a,height:o,mask:l}=e,[c,h]=e.pixels,[u,d]=r,m=Math.round((a-u)/i),y=Math.round((o-d)/i),b=m*y,g=new Float32Array(b),v=new Float32Array(b),w=new Uint8Array(b),x="vector-uv"===t;for(let n=0;n<y;n++)for(let e=0;e<m;e++){let t=0;const r=n*m+e,y=Math.max(0,n*i+d),b=Math.max(0,e*i+u),_=Math.min(o,y+i),O=Math.min(a,b+i);for(let e=y;e<_;e++)for(let i=b;i<O;i++){const s=e*a+i;if(!l||l[s]){t++;const e=x?[c[s],h[s]]:[c[s],(360+h[s])%360],[i,n]=x?e:p(e);g[r]+=i,v[r]+=n}}if(t>=(_-y)*(O-b)*(1-s)){w[r]=1;const[e,i]=f([g[r]/t,v[r]/t]);g[r]=e,v[r]=i}else w[r]=0,g[r]=0,v[r]=0}const _=new n["a"]({width:m,height:y,pixels:[g,v],mask:w});return _.updateStatistics(),_}},"218c":function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return m})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return h})),i.d(t,"g",(function(){return u})),i.d(t,"h",(function(){return b}));i("e06a");var r=i("b2b2");class s{constructor(e=15e3,t=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,t)}decreaseRefCount(e,t){const i=e+"/"+t,r=this._cachedBlocks;if(r.has(i)){const e=r.get(i);return e.refCount--,e.refCount<=0&&(r.delete(i),e.controller&&e.controller.abort()),e.refCount}return 0}getBlock(e,t){const i=e+"/"+t,r=this._cachedBlocks;if(r.has(i)){const e=r.get(i);return e.ts=Date.now(),e.refCount++,r.delete(i),r.set(i,e),e.block}return null}putBlock(e,t,i,r=null){const s=this._cachedBlocks,n=e+"/"+t;if(s.has(n)){const e=s.get(n);e.ts=Date.now(),e.refCount++}else s.set(n,{block:i,ts:Date.now(),refCount:1,controller:r});this.trim(),this.updateTimer()}deleteBlock(e,t){const i=this._cachedBlocks,r=e+"/"+t;i.has(r)&&i.delete(r)}updateMaxSize(e){this._size=e,this.trim()}empty(){this._cachedBlocks.clear(),this.clearTimer()}getCurrentSize(){return this._cachedBlocks.size}updateTimer(){if(null!=this._timer)return;const e=this._cachedBlocks;this._timer=setInterval(()=>{const t=Array.from(e),i=Date.now();for(let r=0;r<t.length&&t[r][1].ts<=i-this._duration;r++)e.delete(t[r][0]);0===e.size&&this.clearTimer()},this._interval)}trim(){const e=this._cachedBlocks;if(-1===this._size||this._size>=e.size)return;const t=Array.from(e);for(let i=0;i<t.length-this._size;i++)e.delete(t[i][0])}clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}var n=i("b4e0"),a=i("4ae5");const o=new Map,l=new s;function c(e,t){return null==t?e:`${e}?sliceId=${t}`}function h(e,t){const i={extent:null,rasterInfo:t,cache:new Map};if(o.has(e)){const t=o.get(e);return t.push(i),t.length-1}return o.set(e,[i]),0}function u(e,t){if(o.has(e)){const i=o.get(e);i[t]=null,i.some(e=>null!=e)||o.delete(e)}}function d(e,t,i){if(!o.has(e))return null==t?l.decreaseRefCount(e,i):0;const r=o.get(e);if(null==r[t])return l.decreaseRefCount(e,i);const s=r[t].cache;if(s.has(i)){const e=s.get(i);if(e.refCount--,0===e.refCount){s.delete(i);for(let e=0;e<r.length;e++)r[e]&&r[e].cache.has(i)&&r[e].cache.delete(i);e.controller&&e.controller.abort()}return e.refCount}return 0}function f(e,t,i){if(!o.has(e))return null==t?l.getBlock(e,i):null;const r=o.get(e);if(null==r[t]){for(let e=0;e<r.length;e++)if(r[e]&&r[e].cache.has(i)){const t=r[e].cache.get(i);return t.refCount++,t.block}return l.getBlock(e,i)}const s=r[t].cache;if(s.has(i)){const e=s.get(i);return e.refCount++,e.block}for(let n=0;n<r.length;n++)if(n!==t&&r[n]&&r[n]&&r[n].cache.has(i)){const e=r[n].cache.get(i);return e.refCount++,s.set(i,e),e.block}return null}function p(e,t,i,r,s=null){if(!o.has(e))return void(null==t&&l.putBlock(e,i,r,s));const n=o.get(e);if(null==n[t])return void l.putBlock(e,i,r,s);const a={refCount:1,block:r,isResolved:!1,isRejected:!1,controller:s};r.then(()=>a.isResolved=!0).catch(()=>a.isRejected=!0),n[t].cache.set(i,a)}function m(e,t,i){if(!o.has(e))return void(null==t&&l.deleteBlock(e,i));const r=o.get(e);null!=r[t]?r[t].cache.delete(i):l.deleteBlock(e,i)}function y(e,t){if(!o.has(e))return null;const i=o.get(e);return null==i[t]?null:i[t]}function b(e,t,i,s,o,l,c=null){const h=y(e,t),u=h.extent,{cache:d,rasterInfo:f}=h;if(u&&u.xmin===i.xmin&&u.xmax===i.xmax&&u.ymin===i.ymin&&u.ymax===i.ymax)return;const p=i.clone().normalize(),{spatialReference:m,transform:b}=f,g=new Set;for(let y=0;y<p.length;y++){const e=p[y];if(e.xmax-e.xmin<=s||e.ymax-e.ymin<=s)continue;let t=Object(n["h"])(e,m,c);Object(r["l"])(b)&&(t=b.inverseTransform(t));const i=new a["a"]({x:s,y:s,spatialReference:e.spatialReference});if(null==o&&!(o=Object(n["j"])(i,m,e,c)))return;const{pyramidLevel:h,pyramidResolution:u,excessiveReading:d}=Object(n["m"])(o,f,l||"closest");if(d)return;const{storageInfo:v}=f,{origin:w}=v,x={x:Math.max(0,Math.floor((t.xmin-w.x)/u.x)),y:Math.max(0,Math.floor((w.y-t.ymax)/u.y))},_=Math.ceil((t.xmax-t.xmin)/u.x-.1),O=Math.ceil((t.ymax-t.ymin)/u.y-.1),S=h>0?v.pyramidBlockWidth:v.blockWidth,j=h>0?v.pyramidBlockHeight:v.blockHeight,T=1,I=Math.max(0,Math.floor(x.x/S)-T),R=Math.max(0,Math.floor(x.y/j)-T),M=Math.floor((x.x+_-1)/S)+T,P=Math.floor((x.y+O-1)/j)+T;for(let r=R;r<=P;r++)for(let e=I;e<=M;e++)g.add(`${h}/${r}/${e}`)}d.forEach((e,t)=>{if(!g.has(t)){const e=d.get(t);(null==e||e.isResolved||e.isRejected)&&d.delete(t)}}),h.extent={xmin:i.xmin,ymin:i.ymin,xmax:i.xmax,ymax:i.ymax}}},2616:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return w}));i("e06a");var r=i("e92d"),s=i("38a4"),n=i("b2b2"),a=i("f4cc"),o=i("880d"),l=i("7f83"),c=i("3af1");const h=r["a"].getLogger("esri.views.2d.engine.flow.dataUtils"),u=8;async function d(e,t,i){const r=performance.now(),s=f(e,t),n=performance.now(),o=m(e,s,t.width,t.height),l=performance.now(),c=b(o,!0),u=performance.now(),d=g(c),p=performance.now();if(e.profile){const e={"_createFlowFieldFromData()":Math.round(n-r),"_getStreamlines()":Math.round(l-n),"createAnimatedLinesData()":Math.round(u-l),"createLinesMesh()":Math.round(p-u),"Total elapsed time":Math.round(p-r)};h.info("createStreamlinesMesh profile",e)}return await Promise.resolve(),Object(a["w"])(i),d}function f(e,t){const i=y(t.data,t.width,t.height,e.smoothing);return e.interpolate?(e,r)=>{const s=Math.floor(e),n=Math.floor(r);if(s<0||s>=t.width)return[0,0];if(n<0||n>=t.height)return[0,0];const a=e-s,o=r-n,l=s,c=n,h=s<t.width-1?s+1:s,u=n<t.height-1?n+1:n,d=i[2*(c*t.width+l)],f=i[2*(c*t.width+h)],p=i[2*(u*t.width+l)],m=i[2*(u*t.width+h)],y=i[2*(c*t.width+l)+1],b=i[2*(c*t.width+h)+1];return[(d*(1-o)+p*o)*(1-a)+(f*(1-o)+m*o)*a,(y*(1-o)+i[2*(u*t.width+l)+1]*o)*(1-a)+(b*(1-o)+i[2*(u*t.width+h)+1]*o)*a]}:(e,r)=>{const s=Math.round(e),n=Math.round(r);return s<0||s>=t.width||n<0||n>=t.height?[0,0]:[i[2*(n*t.width+s)+0],i[2*(n*t.width+s)+1]]}}function p(e,t,i,r,s,n,a,o,l){const c=[];let h,u,d=i,f=r,p=0;c.push({x:d,y:f,t:p});for(let m=0;m<e.verticesPerLine;m++){let[i,r]=t(d,f);i*=e.velocityScale,r*=e.velocityScale;const m=Math.sqrt(i*i+r*r);if(m<e.minSpeedThreshold)return c;const y=i/m,b=r/m;if(d+=y*e.segmentLength,f+=b*e.segmentLength,p+=e.segmentLength/m,Math.acos(y*h+b*u)>e.maxTurnAngle)return c;if(e.mergeLines){const e=Math.round(d*l),t=Math.round(f*l);if(e<0||e>a-1||t<0||t>o-1)return c;const i=n[t*a+e];if(-1!==i&&i!==s)return c;n[t*a+e]=s}c.push({x:d,y:f,t:p}),h=y,u=b}return c}function m(e,t,i,r){const s=[],n=new o["a"],a=1/Math.max(e.lineCollisionWidth,1),l=Math.round(i*a),c=Math.round(r*a),h=new Int32Array(l*c);for(let o=0;o<h.length;o++)h[o]=-1;const u=[];for(let o=0;o<r;o+=e.lineSpacing)for(let t=0;t<i;t+=e.lineSpacing)u.push({x:t,y:o,sort:n.getFloat()});u.sort((e,t)=>e.sort-t.sort);for(const{x:o,y:d}of u)if(n.getFloat()<e.density){const i=p(e,t,o,d,s.length,h,l,c,a);if(i.length<2)continue;s.push(i)}return s}function y(e,t,i,r){if(0===r)return e;const s=Math.round(3*r),n=new Array(2*s+1);let a=0;for(let c=-s;c<=s;c++){const e=Math.exp(-c*c/(r*r));n[c+s]=e,a+=e}for(let c=-s;c<=s;c++)n[c+s]/=a;const o=new Float32Array(e.length);for(let c=0;c<i;c++)for(let i=0;i<t;i++){let r=0,a=0;for(let o=-s;o<=s;o++){if(i+o<0||i+o>=t)continue;const l=n[o+s];r+=l*e[2*(c*t+(i+o))+0],a+=l*e[2*(c*t+(i+o))+1]}o[2*(c*t+i)+0]=r,o[2*(c*t+i)+1]=a}const l=new Float32Array(e.length);for(let c=0;c<t;c++)for(let e=0;e<i;e++){let r=0,a=0;for(let l=-s;l<=s;l++){if(e+l<0||e+l>=i)continue;const h=n[l+s];r+=h*o[2*((e+l)*t+c)+0],a+=h*o[2*((e+l)*t+c)+1]}l[2*(e*t+c)+0]=r,l[2*(e*t+c)+1]=a}return l}function b(e,t){const i=new o["a"],r=e.reduce((e,t)=>e+t.length,0),s=new Float32Array(3*r),n=new Array(e.length);let a=0,l=0;for(const o of e){const e=a;for(const t of o)s[3*a+0]=t.x,s[3*a+1]=t.y,s[3*a+2]=t.t,a++;n[l++]={startVertex:e,numberOfVertices:o.length,totalTime:o[o.length-1].t,timeSeed:t?i.getFloat():0}}return{lineVertices:s,lineDescriptors:n}}function g(e,t=10){const{lineVertices:i,lineDescriptors:r}=e;let s=0,n=0;for(const u of r)s+=2*u.numberOfVertices,n+=6*(u.numberOfVertices-1);const a=new Float32Array(s*u),o=new Uint32Array(n);let l=0,c=0;function h(){o[c++]=l-2,o[c++]=l,o[c++]=l-1,o[c++]=l,o[c++]=l+1,o[c++]=l-1}function d(e,t,i,r,s,n,o){const c=l*u;let h=0;a[c+h++]=e,a[c+h++]=t,a[c+h++]=1,a[c+h++]=i,a[c+h++]=n,a[c+h++]=o,a[c+h++]=r,a[c+h++]=s,l++,a[c+h++]=e,a[c+h++]=t,a[c+h++]=-1,a[c+h++]=i,a[c+h++]=n,a[c+h++]=o,a[c+h++]=-r,a[c+h++]=-s,l++}for(const u of r){const{totalTime:e,timeSeed:r}=u;let s=null,n=null,a=null,o=null,l=null;for(let c=0;c<u.numberOfVertices;c++){const f=i[3*(u.startVertex+c)+0],p=i[3*(u.startVertex+c)+1],m=i[3*(u.startVertex+c)+2];let y=null,b=null,g=null,v=null;if(c>0){y=f-s,b=p-n;const i=Math.sqrt(y*y+b*b);if(y/=i,b/=i,c>1){let e=y+o,i=b+l;const r=Math.sqrt(e*e+i*i);e/=r,i/=r;const s=Math.min(1/(e*y+i*b),t);e*=s,i*=s,g=-i,v=e}else g=-b,v=y;null!==g&&null!==v&&(d(s,n,a,g,v,e,r),h())}s=f,n=p,a=m,o=y,l=b}d(s,n,a,-l,o,e,r)}return{vertexData:a,indexData:o}}function v(e,t){const i=t.pixels,{width:r,height:n}=t,a=new Float32Array(r*n*2);if("vector-uv"===e)for(let s=0;s<r*n;s++)a[2*s+0]=i[0][s],a[2*s+1]=-i[1][s];else if("vector-magdir"===e)for(let o=0;o<r*n;o++){const e=i[0][o],t=Object(s["h"])(i[1][o]),r=Math.cos(t-Math.PI/2),n=Math.sin(t-Math.PI/2);a[2*o+0]=r*e,a[2*o+1]=n*e}return{data:a,width:r,height:n}}async function w(e,t,i,r,s){const n=Object(l["e"])(t.spatialReference);if(!n)return x(e,t,i,r,s);const[a,o]=n.valid,h=o-a,u=Math.ceil(t.width/h),d=t.width/u,f=Math.round(i/u);let p=t.xmin;const m=[];for(let l=0;l<u;l++){const i=new c["a"]({xmin:p,xmax:p+d,ymin:t.ymin,ymax:t.ymax,spatialReference:t.spatialReference});m.push(x(e,i,f,r,s)),p+=d}const y=await Promise.all(m),b={data:new Float32Array(i*r*2),width:i,height:r};let g=0;for(const l of y){for(let e=0;e<l.height;e++)for(let t=0;t<l.width;t++)g+t>=i||(b.data[2*(e*i+g+t)+0]=l.data[2*(e*l.width+t)+0],b.data[2*(e*i+g+t)+1]=l.data[2*(e*l.width+t)+1]);g+=l.width}return b}async function x(e,t,i,r,s){if("imagery"===e.type){await e.load({signal:s});const a=e.rasterInfo.dataType,o=await e.fetchImage(t,i,r,{signal:s});return!o||Object(n["k"])(o.pixelData)||Object(n["k"])(o.pixelData.pixelBlock)?{data:new Float32Array(i*r*2),width:i,height:r}:v(a,o.pixelData.pixelBlock)}await e.load({signal:s});const a=e.rasterInfo.dataType,o=await e.fetchPixels(t,i,r,{signal:s});return!o||Object(n["k"])(o.pixelBlock)?{data:new Float32Array(i*r*2),width:i,height:r}:v(a,o.pixelBlock)}},"45a5":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var r=i("fa8a");const s=new r["a"]({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function n(e){return s.toJSON(e)}function a(e){const{bandCount:t,attributeTable:i,colormap:r,pixelType:s}=e.rasterInfo;return 1===t&&(null!=i||null!=r||"u8"===s||"s8"===s)}},"566d":function(e,t,i){"use strict";i.d(t,"a",(function(){return O}));var r,s=i("a4ee"),n=i("2c4f"),a=i("7d7d"),o=i("3795"),l=i("59b2"),c=(i("b50f"),i("c120"),i("cea0"),i("d386")),h=i("00c0"),u=i("66e4"),d=i("2f51"),f=(i("e06a"),i("3760")),p=i("a9ab"),m=i("3af1"),y=i("1219");const b={base:f["a"],key:"type",typeMap:{extent:m["a"],polygon:y["a"]}};let g=r=class extends u["a"]{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new r({geometry:this.geometry.clone()})}};Object(s["a"])([Object(l["b"])({types:b,json:{read:p["a"],write:!0}})],g.prototype,"geometry",void 0),Object(s["a"])([Object(l["b"])({readOnly:!0})],g.prototype,"version",null),g=r=Object(s["a"])([Object(c["a"])("esri.views.layers.support.Geometry")],g);const v=g;let w=class extends u["a"]{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};Object(s["a"])([Object(l["b"])({type:[[[Number]]],json:{write:!0}})],w.prototype,"path",void 0),Object(s["a"])([Object(l["b"])({readOnly:!0})],w.prototype,"version",null),w=Object(s["a"])([Object(c["a"])("esri.views.layers.support.Path")],w);const x=w,_=n["a"].ofType({key:"type",base:u["a"],typeMap:{rect:d["a"],path:x,geometry:v}}),O=e=>{let t=class extends e{constructor(){super(...arguments),this.clips=new _,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var e;this.container||(this.container=new h["a"]),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(o["a"])(this,"suspended",e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()},!0),Object(o["a"])(this,["layer.opacity","container"],()=>{var e,t;this.container&&(this.container.opacity=null!=(e=null==(t=this.layer)?void 0:t.opacity)?e:1)},!0),Object(o["a"])(this,["layer.blendMode"],e=>{this.container&&(this.container.blendMode=e)},!0),Object(o["a"])(this,["layer.effect"],e=>{this.container&&(this.container.effect=e)},!0),this.clips.on("change",()=>{this.container.clips=this.clips,this.notifyChange("clips")})]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then(e=>{e!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(!this.updatingHandles||!this.updatingHandles.updating)}isVisibleAtScale(e){let t=!0;const i=this.layer,r=i.minScale,s=i.maxScale;if(null!=r&&null!=s){let i=!r,n=!s;!i&&e<=r&&(i=!0),!n&&e>=s&&(n=!0),t=i&&n}return t}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}hitTest(e,t){return Promise.resolve(null)}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return Object(s["a"])([Object(l["b"])({type:_,set(e){const t=Object(a["b"])(e,this._get("clips"),_);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(s["a"])([Object(l["b"])()],t.prototype,"moving",void 0),Object(s["a"])([Object(l["b"])()],t.prototype,"attached",void 0),Object(s["a"])([Object(l["b"])()],t.prototype,"container",void 0),Object(s["a"])([Object(l["b"])()],t.prototype,"suspended",void 0),Object(s["a"])([Object(l["b"])({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(s["a"])([Object(l["b"])()],t.prototype,"updateRequested",void 0),Object(s["a"])([Object(l["b"])()],t.prototype,"updating",null),Object(s["a"])([Object(l["b"])()],t.prototype,"view",void 0),t=Object(s["a"])([Object(c["a"])("esri.views.2d.layers.LayerView2D")],t),t}},6722:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("c120"),s=i("c84e"),n=i("9a02"),a=i("6f75"),o=i("ec5e");const l=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;class c extends n["a"]{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(l),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:t}=e,i=super.createRenderParams(e);return i.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,i.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),i}prepareRenderPasses(e){const t=super.prepareRenderPasses(e);return t.push(e.registerRenderPass({name:"stencil",brushes:[o["a"]],drawPhase:s["c"].DEBUG|s["c"].MAP|s["c"].HIGHLIGHT,target:()=>this.getStencilTarget()})),Object(r["a"])("esri-tiles-debug")&&t.push(e.registerRenderPass({name:"tileInfo",brushes:[a["a"]],drawPhase:s["c"].DEBUG,target:()=>this.children})),t}getStencilTarget(){return this.children}updateTransforms(e){for(const t of this.children){const i=this._tileInfoView.getTileResolution(t.key);t.setTransform(e,i)}}setStencilReference(){let e=1;for(const t of this.children)t.stencilRef=e++}}},"6c7a":function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("a4ee"),s=i("e92d"),n=i("f4cc"),a=i("3795"),o=i("59b2"),l=(i("b50f"),i("c120"),i("cea0"),i("d386"));const c=e=>{let t=class extends e{initialize(){this.handles.add(Object(a["b"])(this,"layer","refresh",e=>{this.doRefresh(e.dataChanged).catch(e=>{Object(n["m"])(e)||s["a"].getLogger(this.declaredClass).error(e)})}),"RefreshableLayerView")}};return Object(r["a"])([Object(o["b"])()],t.prototype,"layer",void 0),t=Object(r["a"])([Object(l["a"])("esri.layers.mixins.RefreshableLayerView")],t),t}},"72d8":function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i("a4ee"),s=i("8d60"),n=i("ce50"),a=i("b2b2"),o=i("59b2"),l=(i("b50f"),i("c120"),i("cea0"),i("d386")),c=i("22f4"),h=i("b4e0"),u=i("ad73");const d=e=>{let t=class extends e{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.fullExtent=null,this.tileInfo=null,this.datumTransformation=null}get hasTilingEffects(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}async fetchPopupFeatures(e,t){const{layer:i}=this;if(!e)return Promise.reject(new n["a"]("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i}));const{popupEnabled:r}=i,o=Object(u["a"])(i,t);if(!r||!Object(a["l"])(o))throw new n["a"]("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:r,popupTemplate:o});const l=[],{value:c,magdirValue:h}=await i.identify(e,{timeExtent:this.timeExtent});let d="";if(c&&c.length){var f,p;d="imagery-tile"===i.type&&i.hasStandardTime()&&null!=c[0]?c.map(e=>i.getStandardTimeValue(e)).join(", "):c.join(", ");const e={ObjectId:0},t="Raster.ServicePixelValue";e[t]=this._formatAttributeValue(d,t);const r=null==(f=i.rasterInfo)||null==(p=f.attributeTable)?void 0:p.features;if(r&&r.length>0){const t=r.filter(e=>{const t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===d});if(t.length>0){const i=t[0];if(i)for(const t in i.attributes)if(i.attributes.hasOwnProperty(t)){const r=this._rasterFieldPrefix+t;e[r]=this._formatAttributeValue(i.attributes[t],r)}}}const n=i.rasterInfo.dataType;"vector-magdir"!==n&&"vector-uv"!==n||(e["Raster.Magnitude"]=null==h?void 0:h[0],e["Raster.Direction"]=null==h?void 0:h[1]);const a=new s["a"](this.fullExtent.clone(),null,e);a.layer=i,a.sourceLayer=a.layer,l.push(a)}return l}updateFullExtent(){const e=this.layer.tileInfo;if(!e||!e.spatialReference)return Promise.reject(new n["a"]("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));if(Object(a["k"])(this.layer.fullExtent))return Promise.reject(new n["a"]("layerview:extent-missing","The layer doesn't provide a full extent.",{layer:this.layer}));const t=Object(h["b"])(this.layer.fullExtent,this.view.spatialReference,!1),i=Object(h["h"])(this.layer.fullExtent,this.view.spatialReference,t);return null==i?Promise.reject(new n["a"]("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})):(this._set("fullExtent",i),this.datumTransformation||(this.datumTransformation=Object(h["b"])(this.layer.fullExtent,this.view.spatialReference,!0)),Promise.resolve())}_formatAttributeValue(e,t){if("string"==typeof e){const i=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,r=this._getFieldInfo(i,t),s=r&&r.format;if(s){let t,i;return e.trim().indexOf(",")>-1?(t=",",i=t+" ",this._formatDelimitedString(e,t,i,s)):e.trim().indexOf(" ")>-1?(t=i=" ",this._formatDelimitedString(e,t,i,s)):this._formatNumberFromString(e,s)}}return e}_getFieldInfo(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some(e=>!(!e.fieldName||e.fieldName.toLowerCase()!==i&&e.fieldName.toLowerCase()!==i.replace(/ /g,"_"))&&(r=e,!0)),r}_formatDelimitedString(e,t,i,r){return e&&t&&i&&r?e.trim().split(t).map(e=>this._formatNumberFromString(e,r)).join(i):e}_formatNumberFromString(e,t){if(!e||!t)return e;const i=Number(e);return isNaN(i)?e:t.format(i)}};return Object(r["a"])([Object(o["b"])()],t.prototype,"layer",void 0),Object(r["a"])([Object(o["b"])(c["a"])],t.prototype,"timeExtent",void 0),Object(r["a"])([Object(o["b"])()],t.prototype,"view",void 0),Object(r["a"])([Object(o["b"])()],t.prototype,"fullExtent",void 0),Object(r["a"])([Object(o["b"])()],t.prototype,"tileInfo",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],t.prototype,"hasTilingEffects",null),t=Object(r["a"])([Object(l["a"])("esri.views.layers.ImageryTileLayerView")],t),t}},"8c81":function(e,t,i){"use strict";i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return k})),i.d(t,"e",(function(){return N})),i.d(t,"f",(function(){return F})),i.d(t,"g",(function(){return D})),i.d(t,"h",(function(){return U})),i.d(t,"i",(function(){return B})),i.d(t,"j",(function(){return G})),i.d(t,"k",(function(){return C})),i.d(t,"l",(function(){return a})),i.d(t,"m",(function(){return I})),i.d(t,"n",(function(){return T})),i.d(t,"o",(function(){return l})),i.d(t,"p",(function(){return j})),i.d(t,"q",(function(){return M})),i.d(t,"r",(function(){return o})),i.d(t,"s",(function(){return S})),i.d(t,"t",(function(){return z})),i.d(t,"u",(function(){return r})),i.d(t,"v",(function(){return E})),i.d(t,"w",(function(){return s})),i.d(t,"x",(function(){return A})),i.d(t,"y",(function(){return p})),i.d(t,"z",(function(){return m})),i.d(t,"A",(function(){return y})),i.d(t,"B",(function(){return b})),i.d(t,"C",(function(){return f})),i.d(t,"D",(function(){return d})),i.d(t,"E",(function(){return g})),i.d(t,"F",(function(){return v})),i.d(t,"G",(function(){return w})),i.d(t,"H",(function(){return x})),i.d(t,"I",(function(){return u})),i.d(t,"J",(function(){return c})),i.d(t,"K",(function(){return R})),i.d(t,"L",(function(){return n})),i.d(t,"M",(function(){return L})),i.d(t,"N",(function(){return V})),i.d(t,"O",(function(){return P}));const r=1e-30,s=4294967295,n=512,a=8,o=29,l=24,c=8,h={metrics:{width:15,height:17,left:0,top:-7,advance:14}},u=0,d=0,f=0,p=1,m=2,y=3,b=4,g=5,v=6,w=5,x=6,_=1,O=2,S=2,j=1,T=2,I=4,R=1.05,M=6,P=5,V=6,L=1.15,A=2,C=8,E=500,z=10,k=2,D=0,F=1,U=4,B=8,N=4,G=1},"9a02":function(e,t,i){"use strict";i.d(t,"a",(function(){return I}));i("c120");var r=i("b2b2"),s=i("8c71"),n=i("3b1a"),a=i("00c0"),o=i("ce50"),l=i("e92d"),c=i("7c4b"),h=i("9812"),u=i("3349"),d=i("02f1"),f=i("6655"),p=i("8152"),m=i("d114"),y=i("7ce4");const b=l["a"].getLogger("esri.views.2d.engine.webgl.Mesh2D"),g=e=>{switch(e.BYTES_PER_ELEMENT){case 1:return 5121;case 2:return 5123;case 4:return 5125;default:throw new o["a"]("Cannot get DataType of array")}},v=(e,t,i,r)=>{let s=0;for(let n=1;n<i;n++){const i=e[2*(t+n-1)],r=e[2*(t+n-1)+1];s+=(e[2*(t+n)]-i)*(e[2*(t+n)+1]+r)}return r?s>0:s<0},w=({coords:e,lengths:t},i)=>{const r=[];for(let s=0,n=0;s<t.length;n+=t[s],s+=1){const a=n,o=[];for(;s<t.length-1&&v(e,n+t[s],t[s+1],i);s+=1,n+=t[s])o.push(n+t[s]-a);const l=e.slice(2*a,2*(n+t[s])),c=Object(h["a"])(l,o,2);for(const e of c)r.push(e+a)}return r};class x{constructor(e,t,i,r=!1){this._cache={},this.vertices=e,this.indices=t,this.primitiveType=i,this.isMapSpace=r}static fromRect({x:e,y:t,width:i,height:r}){const s=e,n=t,a=s+i,o=n+r;return x.fromScreenExtent({xmin:s,ymin:n,xmax:a,ymax:o})}static fromPath(e){const t=Object(f["f"])(new p["a"],e.path,!1,!1),i=t.coords,r=new Uint32Array(w(t,!0)),s=new Uint32Array(i.length/2);for(let n=0;n<s.length;n++)s[n]=Object(m["a"])(Math.floor(i[2*n]),Math.floor(i[2*n+1]));return new x({geometry:s},r,4)}static fromGeometry(e,t){const i=t.geometry.type;switch(i){case"polygon":return x.fromPolygon(e,t.geometry);case"extent":return x.fromMapExtent(e,t.geometry);default:return b.error(new o["a"]("mapview-bad-type","Unable to create a mesh from type "+i,t)),x.fromRect({x:0,y:0,width:1,height:1})}}static fromPolygon(e,t){const i=Object(f["g"])(new p["a"],t,!1,!1),r=i.coords,s=new Uint32Array(w(i,!1)),n=new Uint32Array(r.length/2),a=Object(d["b"])(),o=Object(d["b"])();for(let l=0;l<n.length;l++)Object(u["s"])(a,r[2*l],r[2*l+1]),e.toScreen(o,a),n[l]=Object(m["a"])(Math.floor(o[0]),Math.floor(o[1]));return new x({geometry:n},s,4,!0)}static fromScreenExtent({xmin:e,xmax:t,ymin:i,ymax:r}){const s={geometry:new Uint32Array([Object(m["a"])(e,i),Object(m["a"])(t,i),Object(m["a"])(e,r),Object(m["a"])(e,r),Object(m["a"])(t,i),Object(m["a"])(t,r)])},n=new Uint32Array([0,1,2,3,4,5]);return new x(s,n,4)}static fromMapExtent(e,t){const[i,r]=e.toScreen([0,0],[t.xmin,t.ymin]),[s,n]=e.toScreen([0,0],[t.xmax,t.ymax]),a={geometry:new Uint32Array([Object(m["a"])(i,r),Object(m["a"])(s,r),Object(m["a"])(i,n),Object(m["a"])(i,n),Object(m["a"])(s,r),Object(m["a"])(s,n)])},o=new Uint32Array([0,1,2,3,4,5]);return new x(a,o,4)}destroy(){Object(r["l"])(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(const e in this._cache.vertexBuffers)Object(r["l"])(this._cache.vertexBuffers[e])&&this._cache.vertexBuffers[e].dispose()}get elementType(){return g(this.indices)}getIndexBuffer(e,t=35044){return this._cache.indexBuffer||(this._cache.indexBuffer=y["a"].createIndex(e,t,this.indices)),this._cache.indexBuffer}getVertexBuffers(e,t=35044){return this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce((i,r)=>({...i,[r]:y["a"].createVertex(e,t,this.vertices[r])}),{})),this._cache.vertexBuffers}}var _=i("0fa6");const O=l["a"].getLogger("esri.views.2d.engine.webgl.ClippingInfo"),S=e=>parseFloat(e)/100;class j extends c["a"]{constructor(e,t){super(),this._clip=t,this._cache={},this.stage=e,this._handle=t.watch("version",()=>this._invalidate()),this.ready()}static fromClipArea(e,t){return new j(e,t)}_destroyGL(){Object(r["l"])(this._cache.mesh)&&(this._cache.mesh.destroy(),this._cache.mesh=null),Object(r["l"])(this._cache.vao)&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL(),this._handle.remove()}getVAO(e,t,i,s){const[n,a]=t.size;if("geometry"!==this._clip.type&&this._lastWidth===n&&this._lastHeight===a||(this._lastWidth=n,this._lastHeight=a,this._destroyGL()),Object(r["k"])(this._cache.vao)){const r=this._createMesh(t,this._clip),n=r.getIndexBuffer(e),a=r.getVertexBuffers(e);this._cache.mesh=r,this._cache.vao=new _["a"](e,i,s,a,n)}return this._cache.vao}_createTransforms(){return{dvs:Object(s["b"])()}}_invalidate(){this._destroyGL(),this.requestRender()}_createScreenRect(e,t){const[i,r]=e.size,s="string"==typeof t.left?S(t.left)*i:t.left,n="string"==typeof t.right?S(t.right)*i:t.right,a="string"==typeof t.top?S(t.top)*r:t.top,o="string"==typeof t.bottom?S(t.bottom)*r:t.bottom,l=s,c=a;return{x:l,y:c,width:Math.max(i-n-l,0),height:Math.max(r-o-c,0)}}_createMesh(e,t){switch(t.type){case"rect":return x.fromRect(this._createScreenRect(e,t));case"path":return x.fromPath(t);case"geometry":return x.fromGeometry(e,t);default:return O.error(new o["a"]("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),x.fromRect({x:0,y:0,width:1,height:1})}}}var T=i("c84e");class I extends a["a"]{constructor(){super(...arguments),this.name=this.constructor.name}set clips(e){this._clips=e,this.children.forEach(t=>t.clips=e),this._updateClippingInfo()}_createTransforms(){return{dvs:Object(s["b"])()}}doRender(e){const t=this.createRenderParams(e),{painter:i,globalOpacity:r,profiler:s,drawPhase:n}=t,a=n===T["c"].LABEL||n===T["c"].HIGHLIGHT?1:r*this.computedOpacity;s.recordContainerStart(this.name),i.beforeRenderLayer(t,this._clippingInfos?255:0,a),this.updateTransforms(e.state),this.renderChildren(t),i.compositeLayer(t,a),s.recordContainerEnd()}renderChildren(e){Object(r["k"])(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(e.painter));for(const i of this.children)i.beforeRender(e);for(const i of this._renderPasses)try{i.render(e)}catch(t){}for(const i of this.children)i.afterRender(e)}createRenderParams(e){return e.requireFBO=this.requiresDedicatedFBO,e}prepareRenderPasses(e){return[e.registerRenderPass({name:"clip",brushes:[n["a"].clip],target:()=>this._clippingInfos,drawPhase:T["c"].MAP|T["c"].LABEL|T["c"].LABEL_ALPHA|T["c"].DEBUG|T["c"].HIGHLIGHT})]}updateTransforms(e){for(const t of this.children)t.setTransform(e)}onAttach(){super.onAttach(),this._updateClippingInfo()}onDetach(){super.onDetach(),this._updateClippingInfo()}_updateClippingInfo(){if(Object(r["l"])(this._clippingInfos)&&(this._clippingInfos.forEach(e=>e.destroy()),this._clippingInfos=null),!this.stage)return;const e=this._clips;Object(r["l"])(e)&&e.length&&(this._clippingInfos=e.items.map(e=>j.fromClipArea(this.stage,e))),this.requestRender()}}},"9b77":function(e,t,i){"use strict";function r(e){switch(e){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}i.d(t,"a",(function(){return r}))},a9a2:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return l}));var r=i("d114");function s(e,t){return Array.isArray(t)?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]):(e[0]=t.r,e[1]=t.g,e[2]=t.b,e[3]=t.a),e}function n(e,t=0,i=!1){const r=e[t+3];return e[t+0]*=r,e[t+1]*=r,e[t+2]*=r,i||(e[t+3]*=255),e}function a(e){return n(s([],e))}function o(e){if(!e)return 0;const{r:t,g:i,b:s,a:n}=e;return Object(r["b"])(t*n,i*n,s*n,255*n)}function l(e){if(!e)return 0;const[t,i,s,n]=e;return Object(r["b"])(t*(n/255),i*(n/255),s*(n/255),n)}},ad73:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var r=i("b2b2"),s=i("c1da");async function n(e,t=e.popupTemplate){if(!Object(r["l"])(t))return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:n}=t,{objectIdField:a,typeIdField:o,globalIdField:l,relationships:c}=e;if(i.includes("*"))return["*"];const h=n?await Object(s["n"])(e):[],u=Object(s["j"])(e.fieldsIndex,[...i,...h]);return o&&u.push(o),u&&a&&e.fieldsIndex.has(a)&&-1===u.indexOf(a)&&u.push(a),u&&l&&e.fieldsIndex.has(l)&&-1===u.indexOf(l)&&u.push(l),c&&c.forEach(t=>{const{keyField:i}=t;u&&i&&e.fieldsIndex.has(i)&&-1===u.indexOf(i)&&u.push(i)}),u}function a(e,t){return e.popupTemplate?e.popupTemplate:Object(r["l"])(t)&&t.defaultPopupTemplateEnabled&&Object(r["l"])(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},aebc:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return se}));var r=i("a4ee"),s=i("8d60"),n=i("e92d"),a=i("f4cc"),o=i("3795"),l=i("59b2"),c=(i("b50f"),i("c120"),i("cea0"),i("d386")),h=i("d23c"),u=i("566d"),d=i("b2b2"),f=i("9180"),p=i("a98b"),m=i("3b1a"),y=i("8c71"),b=i("37c9"),g=i("e4b1");class v extends g["a"]{constructor(e,t,i,r,s,n=null){super(e,t,i,r,s),this.bitmap=new b["a"](n,null,null),this.bitmap.coordScale=[r,s],this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.bitmap.destroy(),this.bitmap=null,this.stage=null}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}setTransform(e,t){super.setTransform(e,t),this.bitmap.transforms.dvs=this.transforms.dvs}_createTransforms(){return{dvs:Object(y["b"])(),tileMat3:Object(y["b"])()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}var w=i("c84e"),x=i("6722");class _ extends x["a"]{constructor(){super(...arguments),this.isCustomTilingScheme=!1}createTile(e){const t=this._getTileBounds(e),[i,r]=this._tileInfoView.tileInfo.size;return new v(e,t[0],t[3],i,r)}destroyTile(){}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (tile)",brushes:[m["a"].raster],target:()=>this.children.map(e=>e.bitmap),drawPhase:w["c"].MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===w["c"].MAP&&super.doRender(e)}_getTileBounds(e){const t=this._tileInfoView.getTileBounds(Object(f["l"])(),e);if(this.isCustomTilingScheme&&e.world){const{tileInfo:i}=this._tileInfoView,r=Object(p["o"])(i.spatialReference);if(r){const{resolution:s}=i.lodAt(e.level),n=r/s%i.size[0],a=n?(i.size[0]-n)*s:0;t[0]-=a*e.world,t[2]-=a*e.world}}return t}}i("e06a");var O=i("9096"),S=i("4ae5"),j=i("3e27"),T=i("dff3"),I=i("218c"),R=i("9dee"),M=i("b4e0"),P=(i("3e7b"),i("018d")),V=(i("ae54"),i("07cd")),L=i("d302"),A=i("b2af"),C=i("3af1");const E=[0,0],z=n["a"].getLogger("esri.views.2d.layers.ImageryTileLayerView2D");let k=class extends O["a"]{constructor(){super(...arguments),this._emptyTilePixelBlock=null,this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._srcResolutions=null,this.previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._isCustomTilingScheme=!1,this._globalUpdateRequested=!1,this.container=null,this.layer=null,this.redrawOrRefetch=Object(a["i"])((e,t)=>!this.previousLOD||this.layerView.suspended?Promise.resolve():e?this.doRefresh():this._redrawImage(t))}get useWebGLForProcessing(){var e;return null==(e=this._get("useWebGLForProcessing"))||e}set useWebGLForProcessing(e){this._set("useWebGLForProcessing",e)}get useProgressiveUpdate(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")}set useProgressiveUpdate(e){if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this.container.removeAllChildren();const t=this._getCacheSize(e);this._tileStrategy=new L["a"]({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.layerView.requestUpdate()}}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();const{extent:t,resolution:i,scale:r}=e.state,s=this._tileInfoView.getClosestInfoForScale(r);if(this.layer.raster){var n;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const e=this._srcResolutions[s.level],r=t.toJSON?t:C["a"].fromJSON(t);Object(I["h"])(this._blockCacheRegistryUrl,this._blockCacheRegistryId,r,i,e,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(n=this.previousLOD)?void 0:n.level)!==s.level&&(this.previousLOD=s,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1,this.layerView.requestUpdate()}));const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(e),this.layerView.requestUpdate()}get updating(){return this._fetchQueue.length>0||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}attach(){Object(A["a"])().supportsTextureFloat||(this.useWebGLForProcessing=!1),this._initializeTileInfo(),this._tileInfoView=new P["a"](this.layerView.tileInfo,this.layerView.fullExtent);const e=this._computeFetchConcurrency();this._fetchQueue=new V["a"]({tileInfoView:this._tileInfoView,concurrency:e,process:(e,t)=>this._fetchTile1(e,t)});const t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new L["a"]({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}acquireTile(e){const t=this.container.createTile(e);return this._enqueueTileFetch(t),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}releaseTile(e){this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once("detach",()=>{e.destroy(),this.layerView.requestUpdate()}),this.layerView.requestUpdate()}uninstall(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,this.notifyChange("updating"),Object(I["g"])(this._blockCacheRegistryUrl,this._blockCacheRegistryId)}createEmptyTilePixelBlock(e=null){const t=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&Object(d["l"])(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;e=e||this._tileInfoView.tileInfo.size;const[i,r]=e,s=new j["a"]({width:i,height:r,pixels:[new Uint8Array(i*r)],mask:new Uint8Array(i*r),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=s),s}_fetchTile1(e,t){const i=!Object(d["k"])(t)&&t.signal,r=this.canUseWebGLForProcessing(),s={allowPartialFill:!0,datumTransformation:this.layerView.datumTransformation,interpolation:r?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:r,signal:Object(d["u"])(i),srcResolution:this._srcResolutions[e.level],timeExtent:this.layerView.timeExtent,tileInfo:this.layerView.tileInfo};return this.fetchTile(e,s)}_getCacheSize(e){return e?40:0}_initializeTileInfo(){const e=this.layerView.view.spatialReference,t=new S["a"]({x:this.layerView.fullExtent.xmin,y:this.layerView.fullExtent.ymax,spatialReference:e}),{scales:i,srcResolutions:r,isCustomTilingScheme:s}=Object(M["a"])(this.layer.rasterInfo,e),n=T["a"].create({spatialReference:e,size:512,scales:i});(0===n.origin.x||n.origin.x>t.x)&&(n.origin=t),this._isCustomTilingScheme=s,this.layerView.set("tileInfo",n),this._srcResolutions=null!=r?r:[]}_computeFetchConcurrency(){const{blockBoundary:e}=this.layer.rasterInfo.storageInfo,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}async _enqueueTileFetch(e,t){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key);this.notifyChange("updating");const{bandIds:r}=this.layer;let s=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){s=!1;try{await this._redrawImage(this._abortController&&this._abortController.signal)}catch(i){Object(a["m"])(i)&&z.error(i)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const n=this._tileInfoView.getTileCoords(E,e.key),o=this._tileInfoView.getTileResolution(e.key);await this.updateTileSource(e,{source:t,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:s,bandIds:r,coords:n,resolution:o}),e.once("attach",()=>this.layerView.requestUpdate()),this.container.addChild(e)}catch(i){Object(a["m"])(i)||z.error(i)}this.layerView.requestUpdate()}}async _redrawImage(e){if(0===this.container.children.length)return;await this.updatingHandles.addPromise(this.layer.updateRenderer()),this.layerView.hasTilingEffects?await this._updateGlobalSymbolizerParams(e):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null);const t=this.container.children.map(async e=>this.updateTileSymbolizerParameters(e,{local:this._symbolizerParams,global:this._globalSymbolizerParams}));await Object(a["j"])(t),this.container.requestRender()}async _updateGlobalSymbolizerParams(e){const t={srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:e},i=await this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,t);if(!i||!i.pixelBlock)return;const r=this.layer.symbolizer.generateWebGLParameters({pixelBlock:Object(R["h"])(i.pixelBlock,this.layer.bandIds),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds});!this.canUseWebGLForProcessing()&&r&&"stretch"===r.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(r.factor=r.factor.map(e=>255*e),r.outMin=Math.round(255*r.outMin),r.outMax=Math.round(255*r.outMax)),this._globalSymbolizerParams=r}_updateSymbolizerParams(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds})}_updateBlockCacheRegistry(e=!1){const{url:t,rasterInfo:i,raster:r}=this.layer,{multidimensionalDefinition:s}=this.layer.normalizeRasterFetchOptions({multidimensionalDefinition:this.layer.multidimensionalDefinition,timeExtent:this.layerView.timeExtent}),n=null!=i&&i.multidimensionalInfo?r.getSliceIndex(s):null,a=Object(I["d"])(t,n);if(a!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&Object(I["g"])(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=Object(I["f"])(a,this.layer.raster.rasterInfo),e){const e=this._tileInfoView.getClosestInfoForScale(this.layerView.view.scale),t=this._srcResolutions[e.level];Object(I["h"])(a,this._blockCacheRegistryId,this.layerView.view.extent,this.layerView.view.resolution,t,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=a}}async doRefresh(){await this.updatingHandles.addPromise(this.layer.updateRenderer()),this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset(),this.notifyChange("updating");const e=[];this._tileStrategy.tiles.forEach(t=>e.push(this._enqueueTileFetch(t))),await Object(a["j"])(e)}};Object(r["a"])([Object(l["b"])()],k.prototype,"_globalUpdateRequested",void 0),Object(r["a"])([Object(l["b"])()],k.prototype,"container",void 0),Object(r["a"])([Object(l["b"])()],k.prototype,"layer",void 0),Object(r["a"])([Object(l["b"])()],k.prototype,"layerView",void 0),Object(r["a"])([Object(l["b"])()],k.prototype,"type",void 0),Object(r["a"])([Object(l["b"])()],k.prototype,"useWebGLForProcessing",null),Object(r["a"])([Object(l["b"])()],k.prototype,"useProgressiveUpdate",null),Object(r["a"])([Object(l["b"])()],k.prototype,"updating",null),k=Object(r["a"])([Object(c["a"])("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],k);var D=i("45a5");let F=class extends k{constructor(){super(...arguments),this.container=null,this.layer=null,this.type="raster"}canUseWebGLForProcessing(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&Object(D["a"])(this.layer))}fetchTile(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}async updateTileSource(e,t){const{bandIds:i}=this.layer,r=this._getLayerInterpolation(),s=this.canUseWebGLForProcessing(),{source:n,symbolizerParams:a,globalSymbolizerParams:o,suspended:l,coords:c,resolution:h}=t,{bitmap:u}=e;if([u.x,u.y]=c,u.resolution=h,n&&Object(d["l"])(n)&&Object(d["l"])(n.pixelBlock)){const e={extent:n.extent,pixelBlock:n.pixelBlock};if(u.rawPixelData=e,s)u.source=n.pixelBlock,u.isRendereredSource=!1;else{const t=await this.layer.applyRenderer(e,"stretch"===(null==o?void 0:o.type)?o:null);u.source=t,u.isRendereredSource=!0}u.symbolizerParameters=s?a:null,s?u.transformGrid||(u.transformGrid=n.transformGrid):u.transformGrid=null}else{const e=this.createEmptyTilePixelBlock();u.source=e,u.symbolizerParameters=s?a:null,u.transformGrid=null}u.bandIds=s?i:null,u.width=this._tileInfoView.tileInfo.size[0],u.height=this._tileInfoView.tileInfo.size[1],u.interpolation=r,u.suspended=l,u.invalidateTexture()}async updateTileSymbolizerParameters(e,t){const{local:i,global:r}=t,{bandIds:s}=this.layer,n=this._getLayerInterpolation(),a=this.canUseWebGLForProcessing(),{bitmap:o}=e,{rawPixelData:l}=o;!a&&Object(d["l"])(l)?(o.source=await this.layer.applyRenderer(l,"stretch"===(null==r?void 0:r.type)?r:null),o.isRendereredSource=!0):(o.isRendereredSource&&Object(d["l"])(l)&&(o.source=l.pixelBlock),o.isRendereredSource=!1),o.symbolizerParameters=a?r||i:null,o.bandIds=a?s:null,o.interpolation=n,o.suspended=!1}install(e){this.container=new _(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,e.addChild(this.container)}uninstall(){this.container.removeAllChildren(),this.container.remove(),super.uninstall()}_getLayerInterpolation(){const e=this.layer.renderer.type;if("raster-colormap"===e||"unique-value"===e||"class-breaks"===e)return"nearest";const{interpolation:t}=this.layer,{renderer:i}=this.layer;return"raster-stretch"===i.type&&null!=i.colorRamp?"bilinear"===t||"cubic"===t?"bilinear":"nearest":t}};Object(r["a"])([Object(l["b"])()],F.prototype,"container",void 0),Object(r["a"])([Object(l["b"])()],F.prototype,"layer",void 0),Object(r["a"])([Object(l["b"])()],F.prototype,"type",void 0),F=Object(r["a"])([Object(c["a"])("esri.views.2d.layers.imagery.ImageryTileView2D")],F);const U=F;var B=i("19db"),N=i("1c92"),G=i("7ce4"),q=(i("d267"),i("1956"),i("d17d"),i("9f8b"),i("a1ff"),i("0fa6")),W=i("7c4b"),H=i("c8dd");class X extends W["a"]{constructor(e=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.stencilRef=0,this.rawPixelData=null,this.width=null,this.source=e}destroy(){var e,t;Object(d["l"])(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}get source(){return this._source}set source(e){this._source=e,this.invalidateVAO()}invalidateVAO(){var e,t;!this._vaoInvalidated&&Object(d["l"])(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,Object(d["l"])(this.source)&&!Object(d["l"])(this.vaoData)){const{style:t}=this.symbolizerParameters;switch(t){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const t=Object(B["c"])(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t);this.vaoData={magdir:i}}break;case"simple_scalar":{const t=Object(B["d"])(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t);this.vaoData={scalar:i}}break;case"wind_speed":{const t=Object(B["c"])(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t),r=Object(B["d"])(this.source,this.symbolizerParameters),s=this._createVectorFieldVAO(e.context,r);this.vaoData={magdir:i,scalar:s}}}}this.ready(),this.requestRender()}}_createTransforms(){return{dvs:Object(y["b"])()}}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(e,t){const{vertexData:i,indexData:r}=t,s=G["a"].createVertex(e,35044,new Float32Array(i)),n=G["a"].createIndex(e,35044,new Uint32Array(r)),a=Object(H["g"])("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:5126,normalized:!1},{location:1,name:"a_offset",count:2,type:5126,normalized:!1},{location:2,name:"a_vv",count:2,type:5126,normalized:!1}]});return{vao:new q["a"](e,a.attributes,a.bufferLayouts,{geometry:s},n),elementCount:r.length}}}class Z extends g["a"]{constructor(e,t,i,r,s,n=null){super(e,t,i,r,s),this.tileData=new X(n),this.tileData.coordScale=[r,s],this.tileData.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.tileData.destroy(),this.tileData=null,this.stage=null}set stencilRef(e){this.tileData.stencilRef=e}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{dvs:Object(y["b"])(),tileMat3:Object(y["b"])()}}setTransform(e,t){super.setTransform(e,t);const i=t/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[s,n]=this.tileData.offset,a=[this.x+s*t,this.y-n*t],[o,l]=e.toScreenNoRotation([0,0],a),{symbolTileSize:c}=this.tileData.symbolizerParameters,h=Math.round((this.width-this.tileData.offset[0])/c)*c,u=Math.round((this.height-this.tileData.offset[1])/c)*c,d=h/this.rangeX*i,f=u/this.rangeY*i;Object(N["n"])(r,d,0,0,0,f,0,o,l,1),Object(N["k"])(this.transforms.dvs,e.displayViewMat3,r),this.tileData.transforms.dvs=this.transforms.dvs}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}}var Y=i("c1ef");class J extends x["a"]{constructor(){super(...arguments),this.isCustomTilingScheme=!1,this.symbolTypes=["triangle"]}createTile(e){const t=this._tileInfoView.getTileBounds(Object(f["l"])(),e),[i,r]=this._tileInfoView.tileInfo.size;return new Z(e,t[0],t[3],i,r)}destroyTile(){}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (vf tile)",brushes:[Y["a"]],target:()=>this.children.map(e=>e.tileData),drawPhase:w["c"].MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===w["c"].MAP&&this.symbolTypes.forEach(t=>{e.renderPass=t,super.doRender(e)})}}let Q=class extends k{constructor(){super(...arguments),this._handle=null,this.container=null,this.layer=null,this.type="rasterVF"}canUseWebGLForProcessing(){return!1}async fetchTile(e,t){const i=await this.layer.fetchTile(e.level,e.row,e.col,t);return"vector-magdir"===this.layer.rasterInfo.dataType&&null!=i&&i.pixelBlock&&(i.pixelBlock=await this.layer.convertVectorFieldData(i.pixelBlock,t)),i}updateTileSource(e,t){const i=t.symbolizerParams,{tileData:r}=e;r.key=e.key,r.width=this._tileInfoView.tileInfo.size[0],r.height=this._tileInfoView.tileInfo.size[1];const{symbolTileSize:s}=i,{source:n}=t;if(r.offset=this._getTileSymbolOffset(r.key,s),Object(d["l"])(n)&&Object(d["l"])(n.pixelBlock)){const e={extent:n.extent,pixelBlock:n.pixelBlock};r.rawPixelData=e,r.source=this._sampleVectorFieldData(n.pixelBlock,i,r.offset),r.symbolizerParameters=i}else{const e=[Math.round((this._tileInfoView.tileInfo[0]-r.offset[0])/s),Math.round((this._tileInfoView.tileInfo[1]-r.offset[1])/s)],t=this.createEmptyTilePixelBlock(e);r.source=t,r.symbolizerParameters=i}return r.invalidateVAO(),Promise.resolve(null)}updateTileSymbolizerParameters(e,t){var i;const r=t.local,{symbolTileSize:s}=r,{tileData:n}=e;n.offset=this._getTileSymbolOffset(n.key,s);const a=n.symbolizerParameters.symbolTileSize;return n.symbolizerParameters=r,Object(d["l"])(null==(i=n.rawPixelData)?void 0:i.pixelBlock)&&a!==s&&(n.source=this._sampleVectorFieldData(n.rawPixelData.pixelBlock,n.symbolizerParameters,n.offset)),Promise.resolve(null)}install(e){this.container=new J(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=this.layer.watch("renderer",e=>this._updateSymbolType(e)),e.addChild(this.container)}uninstall(){this.container.removeAllChildren(),this._handle.remove(),this._handle=null,this.container.remove(),super.uninstall()}_getTileSymbolOffset(e,t){const i=e.col*this._tileInfoView.tileInfo.size[0]%t,r=e.row*this._tileInfoView.tileInfo.size[1]%t;return[i>t/2?t-i:-i,r>t/2?t-r:-r]}_sampleVectorFieldData(e,t,i){const{symbolTileSize:r}=t;return Object(B["f"])(e,"vector-uv",r,i)}_updateSymbolType(e){"vector-field"===e.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])}};Object(r["a"])([Object(l["b"])()],Q.prototype,"container",void 0),Object(r["a"])([Object(l["b"])()],Q.prototype,"layer",void 0),Object(r["a"])([Object(l["b"])()],Q.prototype,"type",void 0),Q=Object(r["a"])([Object(c["a"])("esri.views.2d.layers.imagery.VectorFieldTileView2D")],Q);const K=Q;var $=i("72d8"),ee=i("365a"),te=i("6c7a");const ie=n["a"].getLogger("esri.views.2d.layers.ImageryTileLayerView2D");let re=class extends(Object($["a"])(Object(te["a"])(Object(u["a"])(ee["a"])))){constructor(){super(...arguments),this._useWebGLForProcessing=!0,this._useProgressiveUpdate=!0,this.subview=null}initialize(){const e=this.updateFullExtent();this.addResolvingPromise(e)}get useWebGLForProcessing(){return this._useWebGLForProcessing}set useWebGLForProcessing(e){this._useWebGLForProcessing=e,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=e)}get useProgressiveUpdate(){return this._useWebGLForProcessing}set useProgressiveUpdate(e){this._useProgressiveUpdate=e,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=e)}update(e){this.subview.update(e),this.notifyChange("updating")}isUpdating(){return!this.subview||this.subview.updating}attach(){this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.handles.add([Object(o["e"])(this.layer,["bandIds","renderer","interpolation","multidimensionalDefinition"],(e,t,i)=>{const r="multidimensionalDefinition"===i,s="interpolation"===i&&("majority"===e||"majority"===t)&&Object(D["a"])(this.layer),n="renderer"===i&&t.type!==e.type;n&&this._updateSubview();const o=r||s||n;this.subview.redrawOrRefetch(o).catch(e=>{Object(a["m"])(e)||ie.error(e)}),this.notifyChange("updating")}),Object(o["a"])(this,["layer.blendMode"],e=>{this.subview&&(this.subview.container.blendMode=e)},!0),Object(o["a"])(this,["layer.effect"],e=>{this.subview&&(this.subview.container.effect=e)},!0),Object(o["a"])(this,"timeExtent",()=>{this.subview.redrawOrRefetch(!0).catch(e=>{Object(a["m"])(e)||ie.error(e)})})],"attach")}detach(){this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this.subview.uninstall()}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.subview.moveEnd()}async hitTest(e,t){return[new s["a"]({attributes:{},geometry:e.clone()})]}doRefresh(){return this.subview.doRefresh()}_updateSubview(){const e="vector-field"===this.layer.renderer.type?"rasterVF":"animated-flow"===this.layer.renderer.type?"rasterAnimatedFlow":"raster";if(this.subview){if(this.subview.type===e)return;this.subview.uninstall()}const{layer:t}=this;let i;i="rasterVF"===e?new K({layer:t,layerView:this}):"rasterAnimatedFlow"===e?new h["a"]({layer:t,layerView:this}):new U({layer:t,layerView:this}),"useWebGLForProcessing"in i&&(i.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in i&&(i.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in i&&(i.previousLOD=this.subview&&"previousLOD"in this.subview&&this.subview.previousLOD),i.attach(),i.install(this.container),i.container.blendMode=t.blendMode,i.container.effect=t.effect,this.subview=i,this.requestUpdate()}};Object(r["a"])([Object(l["b"])()],re.prototype,"subview",void 0),Object(r["a"])([Object(l["b"])()],re.prototype,"useWebGLForProcessing",null),Object(r["a"])([Object(l["b"])()],re.prototype,"useProgressiveUpdate",null),re=Object(r["a"])([Object(c["a"])("esri.views.2d.layers.ImageryTileLayerView2D")],re);const se=re},b4e0:function(e,t,i){"use strict";i.d(t,"a",(function(){return z})),i.d(t,"b",(function(){return g})),i.d(t,"c",(function(){return V})),i.d(t,"d",(function(){return P})),i.d(t,"e",(function(){return T})),i.d(t,"f",(function(){return M})),i.d(t,"g",(function(){return b})),i.d(t,"h",(function(){return S})),i.d(t,"i",(function(){return x})),i.d(t,"j",(function(){return v})),i.d(t,"k",(function(){return h})),i.d(t,"l",(function(){return C})),i.d(t,"m",(function(){return E}));i("e06a");var r=i("ce50"),s=i("b2b2"),n=i("8048"),a=i("8188"),o=i("3af1"),l=i("4ae5");const c=5e-4;function h(e,t,i){return!Object(a["b"])(e,t,i)}function u(e,t,i){const s=h(e,t,i);if(s&&!Object(a["h"])())throw new r["a"]("rasterprojectionhelper-project","projection engine is not loaded");return s}const d=function(e,t,i){const r=(e[0]+e[4]+e[4*t.cols]+e[4*t.cols+4])/4,s=(e[1]+e[5]+e[4*t.rows+1]+e[4*t.rows+5])/4,n=(e[4*t.cols]-e[0]+e[4*t.cols+4]-e[4])/i[0]*.5,a=(e[4*t.cols+1]-e[1]+e[4*t.cols+5]-e[5])/i[1]*.5;return[0===n||isNaN(n)?0:Math.abs(r-e[2*t.rows+2])/Math.abs(n),0===a||isNaN(a)?0:Math.abs(s-e[2*t.rows+3])/Math.abs(a)]},f={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},p=32,m=4,y=m;async function b(){if(Object(a["h"])())return null;await Object(a["i"])()}function g(e,t,i){return u(e.spatialReference,t)?i?Object(a["f"])(t,e.spatialReference,e):Object(a["f"])(e.spatialReference,t,e):null}function v(e,t,i,r=null){if(e.spatialReference.equals(t))return e;u(e.spatialReference,t,r);const n=i.center,l=new o["a"]({xmin:n.x-e.x/2,xmax:n.x+e.x/2,ymin:n.y-e.y/2,ymax:n.y+e.y/2,spatialReference:e.spatialReference}),c=Object(a["m"])(l,t,r);return Object(s["k"])(c)?null:{x:c.xmax-c.xmin,y:c.ymax-c.ymin}}function w(e,t=.01){return Object(n["f"])(e)?t/Object(n["f"])(e):0}function x(e,t,i=null,r=!0){const s=e.spatialReference;if(s.equals(t))return e;u(s,t,i);const n=Object(a["m"])(e,t,i);if(r&&t.isGeographic){const[t,i]=I(s,!0),r=w(s);r&&null!=t&&null!=i&&(Math.abs(e.x-t)<r&&Math.abs(180-n.x)<c?n.x-=360:Math.abs(e.x-i)<r&&Math.abs(180+n.x)<c&&(n.x+=360))}return n}function _(e,t,i=null){const r=e[0].spatialReference;return r.equals(t)?e:(u(r,t,i),Object(a["m"])(e,t,i))}function O(e){const t=T(e[0].spatialReference);if(e.length<2||!Object(s["l"])(t))return e[0];let{xmin:i,xmax:r,ymin:n,ymax:a}=e[0];for(let s=1;s<e.length;s++){const i=e[s];r=i.xmax+t*s,n=Math.min(n,i.ymin),a=Math.max(a,i.ymax)}return new o["a"]({xmin:i,xmax:r,ymin:n,ymax:a,spatialReference:e[0].spatialReference})}function S(e,t,i=null,r=!0){if(e.spatialReference.equals(t))return e;const n=M(e),a=T(e.spatialReference,!0);return Object(s["l"])(a)&&0!==n?O(e.clone().normalize().map(e=>j(e,t,i,r))):j(e,t,i,r)}function j(e,t,i=null,r=!0){const s=e.spatialReference;if(s.equals(t))return e;u(s,t,i);const n=Object(a["m"])(e,t,i);let[o,h]=I(s,!0);if(n&&r&&s.isWebMercator&&t.isGeographic&&null!=o&&null!=h){const r=.001,a=1e3;if(Math.abs(e.xmin-o)<r&&Math.abs(h-e.xmax)>a&&Math.abs(180-n.xmax)<c){n.xmin=-180;const r=[];r.push(new l["a"](e.xmax,e.ymin,s)),r.push(new l["a"](e.xmax,(e.ymin+e.ymax)/2,s)),r.push(new l["a"](e.xmax,e.ymax,s));const a=r.map(e=>x(e,t,i)).filter(e=>!isNaN(null==e?void 0:e.x)).map(e=>e.x);n.xmax=Math.max.apply(null,a)}if(Math.abs(e.xmax-h)<r&&Math.abs(o-e.xmin)>a&&Math.abs(180+n.xmin)<c){n.xmax=180;const r=[];r.push(new l["a"](e.xmin,e.ymin,s)),r.push(new l["a"](e.xmin,(e.ymin+e.ymax)/2,s)),r.push(new l["a"](e.xmin,e.ymax,s));const a=r.map(e=>x(e,t,i)).filter(e=>!isNaN(null==e?void 0:e.x)).map(e=>e.x);n.xmin=Math.min.apply(null,a)}}[o,h]=I(t,!0);const d=w(t);return d&&null!=o&&null!=h&&n&&(Math.abs(n.xmin-o)<d&&(n.xmin=o),Math.abs(n.xmax-h)<d&&(n.xmax=h)),n}function T(e,t=!1){const i=t?20037508.342787:20037508.342788905;return e.isWebMercator?2*i:e.wkid&&e.isGeographic?360:2*f[e.wkid]||null}function I(e,t=!1){const i=[],r=T(e,t);return Object(s["l"])(r)&&(i.push(-r/2),i.push(r/2)),i}function R(e,t,i,r){let s=(e-t)/i;return s-Math.floor(s)!=0?s=Math.floor(s):r&&(s-=1),s}function M(e,t=!1){const i=T(e.spatialReference);if(!Object(s["l"])(i))return 0;const r=t?0:-i/2;return R(e.xmax,r,i,!0)-R(e.xmin,r,i,!1)}function P(e){const t=e.storageInfo.origin.x,i=T(e.spatialReference,!0);if(!Object(s["l"])(i))return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const r=i/2,{nativePixelSize:n,storageInfo:a,extent:o}=e,{maximumPyramidLevel:l,blockWidth:c,pyramidScalingFactor:h}=a;let u=n.x;const d=[],f=Object(s["l"])(e.transform)&&"gcs-shift"===e.transform.type,p=t+(f?0:r),m=f?i-t:r-t;for(let s=0;s<=l;s++){const e=(o.xmax-t)/u/c,i=e-Math.floor(e)==0?e:Math.ceil(e),r=m/u/c,s=r-Math.floor(r)==0?r:Math.ceil(r),n=Math.floor(p/u/c),a=Math.round(p/u)%c,l=(c-Math.round(m/u)%c)%c;d.push({resolutionX:u,blockWidth:c,datsetColumnCount:i,worldColumnCountFromOrigin:s,leftMargin:a,rightPadding:l,originColumnOffset:n}),u*=h}return{originX:t,halfWorldWidth:r,pyramidsInfo:d,hasGCSSShiftTransform:f}}function V(e){const t=e.isAdaptive&&null==e.spacing,i=e.spacing||[p,p];let r=L(e),s={cols:r.size[0]+1,rows:r.size[1]+1},n=d(r.offsets,s,i);const a=(n[0]+n[1])/2,o=r.outofBoundPointCount>0&&r.outofBoundPointCount<r.offsets.length/2;return t&&(o||a>y)&&(r=L({...e,spacing:[m,m]}),s={cols:r.size[0]+1,rows:r.size[1]+1},n=d(r.offsets,s,i)),r.error=n,r.coefficients=A(r.offsets,s,o),r}function L(e){const{projectedExtent:t,srcBufferExtent:i,pixelSize:r,datumTransformation:n,rasterTransform:a}=e,o=t.spatialReference,c=i.spatialReference;u(o,c);const{xmin:h,ymin:d,xmax:f,ymax:m}=t,y=T(c),b=e.hasWrapAround||"gcs-shift"===(null==a?void 0:a.type),g=e.spacing||[p,p],v={x:g[0]*r.x,y:g[1]*r.y},w={cols:Math.ceil((f-h)/v.x-.1/g[0])+1,rows:Math.ceil((m-d)/v.y-.1/g[1])+1},x=v.x,O=v.y,S=[];let j,I=0;const R=[];for(let s=0;s<w.cols;s++)for(let e=0;e<w.rows;e++)R.push(new l["a"]({x:h+x*s,y:m-O*e,spatialReference:o}));const M=_(R,c,n);for(let l=0;l<w.cols;l++){const e=[];for(let t=0;t<w.rows;t++){let r=M[l*w.rows+t];a&&(r=a.inverseTransform(r)),e.push(r),l>0&&b&&r&&j[t]&&Object(s["l"])(y)&&r.x<j[t].x&&(r.x+=y),r?(S.push((r.x-i.xmin)/(i.xmax-i.xmin)),S.push((i.ymax-r.y)/(i.ymax-i.ymin))):(S.push(NaN),S.push(NaN),I++)}j=e}return{offsets:S,error:null,coefficients:null,outofBoundPointCount:I,spacing:g,size:[w.cols-1,w.rows-1]}}function A(e,t,i){const{cols:r,rows:s}=t,n=new Float32Array((r-1)*(s-1)*2*6),a=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),o=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<r-1;l++){for(let t=0;t<s-1;t++){let i=l*s*2+2*t;const c=e[i],h=e[i+1],u=e[i+2],d=e[i+3];i+=2*s;const f=e[i],p=e[i+1],m=e[i+2],y=e[i+3];let b=0,g=12*(t*(r-1)+l);for(let e=0;e<3;e++)n[g++]=a[b++]*c+a[b++]*u+a[b++]*m;b=0;for(let e=0;e<3;e++)n[g++]=a[b++]*h+a[b++]*d+a[b++]*y;b=0;for(let e=0;e<3;e++)n[g++]=o[b++]*c+o[b++]*f+o[b++]*m;b=0;for(let e=0;e<3;e++)n[g++]=o[b++]*h+o[b++]*p+o[b++]*y}if(i)for(let e=0;e<n.length;e++)isNaN(n[e])&&(n[e]=-1)}return n}function C(e){const t=e.clone().normalize();return 1===t.length?t[0]:O(t)}function E(e,t,i){const{storageInfo:r,pixelSize:n}=t;let a,o=!1;const{pyramidResolutions:c}=r;if(Object(s["l"])(c)&&c.length){const r=(e.x+e.y)/2,s=c[c.length-1],h=(s.x+s.y)/2,u=(n.x+n.y)/2;if(r<=u)a=0;else if(r>=h)a=c.length,o=r/h>8;else{let e,t=u;for(let s=1;s<=c.length;s++){if(e=(c[s-1].x+c[s-1].y)/2,r<=e){r===e?a=s:"down"===i?(a=s-1,o=r/t>8):a="up"===i||r-t>e-r||r/t>2?s:s-1;break}t=e}}const d=0===a?n:c[a-1];return{pyramidLevel:a,pyramidResolution:new l["a"]({x:d.x,y:d.y,spatialReference:t.spatialReference}),excessiveReading:o}}const h=Math.log(e.x/n.x)/Math.LN2,u=Math.log(e.y/n.y)/Math.LN2,d=t.storageInfo.maximumPyramidLevel||0;a="down"===i?Math.floor(Math.min(h,u)):"up"===i?Math.ceil(Math.max(h,u)):Math.round((h+u)/2),a<0?a=0:a>d&&(o=a>d+3,a=d);const f=2**a;return{pyramidLevel:a,pyramidResolution:new l["a"]({x:f*t.nativePixelSize.x,y:f*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:o}}function z(e,t,i=512,r=!0){const{extent:s,spatialReference:a,pixelSize:o}=e,c=v(new l["a"]({x:o.x,y:o.y,spatialReference:a}),t,s);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const h=(c.x+c.y)/2,u=Object(n["f"])(t),d=h*u*96*39.37,f=t.isGeographic?256/i*295828763.7958547:256/i*591657527.591555;let p="vector-magdir"===e.dataType||"vector-uv"===e.dataType;const m=S(s,t);p||r&&(t.isGeographic||t.isWebMercator)&&(p=m.xmin*m.xmax<0);let y,b=d;const g=1.001;if(p){b=f;const e=t.isGeographic?1341104507446289e-21:.29858214164761665,i=e*(96*u*39.37),r=t.isGeographic?4326:3857;y=v(new l["a"]({x:e,y:e,spatialReference:{wkid:r}}),a,m),y.x*=b/i,y.y*=b/i}else{y={x:o.x,y:o.y};const t=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2);let i=0;for(;b<f*(g/2)&&i<t;)i++,b*=2,y.x*=2,y.y*=2;Math.max(b,f)/Math.min(b,f)<=g&&(b=f)}const w=[b],x=[{x:y.x,y:y.y}],_=70.5310735,O=Math.min(_,d)/g;for(;b>=O;)b/=2,y.x/=2,y.y/=2,w.push(b),x.push({x:y.x,y:y.y});return{projectedPixelSize:c,scales:w,srcResolutions:x,isCustomTilingScheme:!p}}},c84e:function(e,t,i){"use strict";var r,s,n,a,o,l,c;i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return r})),i.d(t,"e",(function(){return o})),i.d(t,"f",(function(){return l})),function(e){e[e.FILL=0]="FILL",e[e.LINE=1]="LINE",e[e.MARKER=2]="MARKER",e[e.TEXT=3]="TEXT",e[e.LABEL=4]="LABEL"}(r||(r={})),function(e){e[e.SUCCEEDED=0]="SUCCEEDED",e[e.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY"}(s||(s={})),function(e){e[e.NONE=0]="NONE",e[e.MAP=1]="MAP",e[e.LABEL=2]="LABEL",e[e.LABEL_ALPHA=4]="LABEL_ALPHA",e[e.HITTEST=8]="HITTEST",e[e.HIGHLIGHT=16]="HIGHLIGHT",e[e.CLIP=32]="CLIP",e[e.DEBUG=64]="DEBUG",e[e.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(n||(n={})),function(e){e[e.SIZE=0]="SIZE",e[e.COLOR=1]="COLOR",e[e.OPACITY=2]="OPACITY",e[e.ROTATION=3]="ROTATION"}(a||(a={})),function(e){e[e.NONE=0]="NONE",e[e.OPACITY=1]="OPACITY",e[e.COLOR=2]="COLOR",e[e.ROTATION=4]="ROTATION",e[e.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE",e[e.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS",e[e.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS",e[e.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"}(o||(o={})),function(e){e[e.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",e[e.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",e[e.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",e[e.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(l||(l={})),function(e){e[e.SPRITE=0]="SPRITE",e[e.GLYPH=1]="GLYPH"}(c||(c={}))},c8dd:function(e,t,i){"use strict";i.d(t,"a",(function(){return B})),i.d(t,"b",(function(){return A})),i.d(t,"c",(function(){return C})),i.d(t,"d",(function(){return le})),i.d(t,"e",(function(){return U})),i.d(t,"f",(function(){return N})),i.d(t,"g",(function(){return J})),i.d(t,"h",(function(){return Q})),i.d(t,"i",(function(){return k})),i.d(t,"j",(function(){return D})),i.d(t,"k",(function(){return oe})),i.d(t,"l",(function(){return W})),i.d(t,"m",(function(){return q})),i.d(t,"n",(function(){return j})),i.d(t,"o",(function(){return ee})),i.d(t,"p",(function(){return F})),i.d(t,"q",(function(){return re})),i.d(t,"r",(function(){return E})),i.d(t,"s",(function(){return te})),i.d(t,"t",(function(){return $})),i.d(t,"u",(function(){return z})),i.d(t,"v",(function(){return ie})),i.d(t,"w",(function(){return ne})),i.d(t,"x",(function(){return K})),i.d(t,"y",(function(){return se})),i.d(t,"z",(function(){return ae})),i.d(t,"A",(function(){return L}));var r=i("ce50"),s=i("e92d"),n=(i("38a4"),i("a915"),i("a9a2"),i("c84e")),a=i("ecd7");class o{constructor(){this.color=[0,0,0,0],this.haloColor=[0,0,0,0],this.haloSize=0,this.size=12,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}acquire(e,t,i,r,s,n,a,o,l){this.color=e,this.haloColor=t,this.haloSize=i,this.size=r,this.angle=s,this.offsetX=n,this.offsetY=a,this.hAnchor=o,this.vAnchor=l}release(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0,this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0,this.haloSize=0,this.size=0,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}}o.pool=new a["a"](o);i("a1ff");const l=s["a"].getLogger("esri.views.2d.engine.webgl.Utils"),c="geometry",h=[{name:c,strideInBytes:36,divisor:0}],u=[{name:c,strideInBytes:32,divisor:0}],d=[{name:c,strideInBytes:20,divisor:0}],f=[{name:c,strideInBytes:12,divisor:0}],p=[{name:c,strideInBytes:40,divisor:0}],m=[{name:c,strideInBytes:36,divisor:0}],y=[{name:c,strideInBytes:36,divisor:0}];function b(e){const t={};for(const i of e)t[i.name]=i.strideInBytes;return t}const g=b(h),v=b(u),w=b(d),x=b(f),_=b(p),O=b(m),S=b(y);function j(e,{fill:t}){switch(e){case n["d"].MARKER:return g;case n["d"].FILL:return"dot-density"===t?x:"simple"===t?w:v;case n["d"].LINE:return _;case n["d"].TEXT:return O;case n["d"].LABEL:return S}}const T=[c],I=[c],R=[c],M=[c],P=[c];function V(e){switch(e){case n["d"].MARKER:return T;case n["d"].FILL:return I;case n["d"].LINE:return R;case n["d"].TEXT:return M;case n["d"].LABEL:return P}}function L(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function A(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}}function C(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}}function E(e){return null!=e}function z(e){return"number"==typeof e}function k(e){switch(e){case"butt":return 0;case"round":return 1;case"square":return 2;default:return l.error(new r["a"]("mapview-invalid-type",`Cap type ${e} is not a valid option. Defaulting to round`)),1}}function D(e){switch(e){case"miter":return 2;case"bevel":return 0;case"round":return 1;default:return l.error(new r["a"]("mapview-invalid-type",`Join type ${e} is not a valid option. Defaulting to round`)),1}}function F(e){switch(e){case"opacity":return n["b"].OPACITY;case"color":return n["b"].COLOR;case"rotation":return n["b"].ROTATION;case"size":return n["b"].SIZE;default:return l.error("Cannot interpret unknown vv: "+e),null}}function U(e,t,i,r,s,n,a){for(const l in n){const t=n[l].stride,r=L(t),a=n[l].data,o=i[l].data,c=t*s.vertexCount/r,h=t*e/r,u=t*s.vertexFrom/r;for(let e=0;e<c;++e)o[e+h]=a[e+u]}const o=s.indexCount;for(let l=0;l<o;++l)r[l+t]=a[l+s.indexFrom]-s.vertexFrom+e}const B={[c]:35044};function N(e,t){const i=[];for(let r=0;r<5;++r){const s=V(r),n={};for(const e of s)n[e]={data:t(r,e)};i.push({data:e(r),buffers:n})}return i}function G(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function q(e){switch(e){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:return void l.error(new r["a"]("webgl-utils","Unable to handle type "+e))}}function W(e){switch(e){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:return void l.error(new r["a"]("webgl-utils","Unable to handle type "+e))}}function H(e){const t={};for(const i in e){const r=e[i];let s=0;t[i]=r.map(e=>{const t={...e,normalized:e.normalized||!1,divisor:e.divisor||0,offset:s,stride:0};return s+=e.count*G(e.type),t}),t[i].forEach(e=>e.stride=s)}return t}const X=e=>{const t=new Map;for(const i in e)for(const r of e[i])t.set(r.name,r.location);return t},Z=e=>{const t={};for(const i in e){const r=e[i];t[i]=r.length?r[0].stride:0}return t},Y=new Map,J=(e,t)=>{if(!Y.has(e)){const i=H(t),r={strides:Z(i),bufferLayouts:i,attributes:X(t)};Y.set(e,r)}return Y.get(e)};function Q(e){e(n["d"].FILL),e(n["d"].LINE),e(n["d"].MARKER),e(n["d"].TEXT),e(n["d"].LABEL)}const K=e=>"path"in e&&ce(e.path),$=e=>"url"in e&&e.url||"imageData"in e&&e.imageData,ee=e=>"imageData"in e&&e.imageData&&"contentType"in e&&e.contentType?`data:${e.contentType};base64,${e.imageData}`:"url"in e?e.url:null,te=e=>"url"in e&&e.url&&e.url.includes(".gif")||"contentType"in e&&"image/gif"===e.contentType||"imageData"in e&&e.imageData.includes("data:image/gif"),ie=e=>"url"in e&&e.url&&e.url.includes(".png")||"contentType"in e&&"image/png"===e.contentType||"imageData"in e&&e.imageData.includes("data:image/png"),re=e=>e.type&&-1!==e.type.toLowerCase().indexOf("3d");function se(e){switch(e.type){case"line":{const t=e;return"CIMSolidStroke"===t.cim.type&&!t.dashTemplate}case"fill":return"CIMSolidFill"===e.cim.type;case"esriSFS":return"esriSFSSolid"===e.style||"esriSFSNull"===e.style;case"esriSLS":return"esriSLSSolid"===e.style||"esriSLSNull"===e.style;default:return!1}}const ne=e=>e.includes("data:image/svg+xml");function ae(e){switch("cim"in e?e.cim.type:e.type){case"esriSMS":case"esriPMS":case"CIMPointSymbol":case"CIMVectorMarker":case"CIMPictureMarker":case"CIMCharacterMarker":return!1;default:return!0}}function oe(e){const t="maxVVSize"in e&&e.maxVVSize,i="width"in e&&e.width||"size"in e&&e.size||0;return t||i}function le(e){const t=[];for(let i=0;i<e.length;i++)t.push(e.charCodeAt(i));return t}const ce=e=>!!e&&(e=e.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(e)&&/[\dz]$/i.test(e)&&e.length>4))},d114:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return s}));const r=new Float32Array(1);new Uint32Array(r.buffer);function s(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]}function n(e,t){return 65535&e|t<<16}function a(e,t,i,r){return 255&e|(255&t)<<8|(255&i)<<16|r<<24}},d23c:function(e,t,i){"use strict";i.d(t,"a",(function(){return z}));var r=i("a4ee"),s=i("fc29"),n=i("59b2"),a=(i("b50f"),i("c120"),i("cea0"),i("d386")),o=i("2616"),l=i("c9ee"),c=i("c84e"),h=i("9a02");class u extends h["a"]{constructor(){super(...arguments),this.flowStyle=null}get requiresDedicatedFBO(){return!1}doRender(e){super.doRender(e)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"flow",brushes:[l["a"]],target:()=>this.children,drawPhase:c["c"].MAP});return[...super.prepareRenderPasses(e),t]}}i("e06a");var d=i("e92d"),f=i("38a4"),p=i("b2b2"),m=i("f4cc"),y=i("4ae5");const b=d["a"].getLogger("esri.views.2d.engine.flow.FlowDisplayData");class g{constructor(e,t,i,r){this.state={name:"created"},this.flowStyle=e,this.extent=t,this.size=i,this.pixelRatio=r}async load(){const e=new AbortController;this.state={name:"loading",abortController:e};const t=await this.flowStyle.loadResources({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},e.signal);this.state={name:"loaded",resources:t}}prepareForRendering(e,t,i){if("loaded"!==this.state.name)return void b.error("Only loaded resources can be attached.");const r=this.state.resources;r.prepareForRendering(e,t,i),this.state={name:"attached",resources:r}}destroy(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(e){return!!this.flowStyle.areResourcesCompatible(e.flowStyle)&&(!(!this.extent.equals(e.extent)||this.size[0]!==e.size[0]||this.size[1]!==e.size[1]||this.pixelRatio!==e.pixelRatio)&&(this.flowStyle=e.flowStyle,!0))}}var v=i("1c92"),w=i("8c71"),x=i("7c4b");class _ extends x["a"]{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(e){this._displayData=e,this.requestRender()}clear(){Object(p["l"])(this._displayData)&&(this._displayData.destroy(),this._displayData=null,this.requestRender())}setTransform(e){const{displayData:t}=this;if(Object(p["k"])(t))return;const i=t.extent.xmin,r=t.extent.ymax,s=[0,0];e.toScreen(s,[i,r]);const n=(t.extent.xmax-t.extent.xmin)/t.size[0]/e.resolution,a=Object(f["h"])(e.rotation),{dvs:o}=this.transforms;Object(v["b"])(o),Object(v["c"])(o,o,[-1,1,0]),Object(v["d"])(o,o,[2/(e.size[0]*e.pixelRatio),-2/(e.size[1]*e.pixelRatio),1]),Object(v["c"])(o,o,[s[0],s[1],0]),Object(v["m"])(o,o,a),Object(v["d"])(o,o,[n*e.pixelRatio,n*e.pixelRatio,1])}_createTransforms(){return{dvs:Object(w["b"])()}}}var O=i("3af1");const S=1.15,j=d["a"].getLogger("esri.views.2d.engine.flow.FlowStrategy");let T=class extends s["a"]{constructor(e){super(e),this._flowDisplayObject=new _,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(e){const{flowStyle:t}=this.flowContainer;if(Object(p["k"])(t))return void this._clear();const{extent:i,rotation:r,resolution:s,pixelRatio:n}=e.state,a=R(i,r);a.expand(S);const o=[Math.round((a.xmax-a.xmin)/s),Math.round((a.ymax-a.ymin)/s)],l=new g(t,a,o,n);if(Object(p["l"])(this._loading)){if(this._loading.update(l))return;this._loading.destroy(),this._loading=null}!Object(p["k"])(this._flowDisplayObject.displayData)&&this._flowDisplayObject.displayData.update(l)||(l.load().then(()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null},e=>{Object(m["m"])(e)||(j.error("A resource failed to load.",e),this._loading=null)}),this._loading=l)}_clear(){this._flowDisplayObject.clear(),Object(p["l"])(this._loading)&&(this._loading.destroy(),this._loading=null)}};Object(r["a"])([Object(n["b"])()],T.prototype,"_loading",void 0),Object(r["a"])([Object(n["b"])()],T.prototype,"flowContainer",void 0),Object(r["a"])([Object(n["b"])()],T.prototype,"updating",null),T=Object(r["a"])([Object(a["a"])("esri.views.2d.engine.flow.FlowStrategy")],T);const I=T;function R(e,t){const i=new y["a"]({x:(e.xmax+e.xmin)/2,y:(e.ymax+e.ymin)/2,spatialReference:e.spatialReference}),r=e.xmax-e.xmin,s=e.ymax-e.ymin,n=Math.abs(Math.cos(Object(f["h"])(t))),a=Math.abs(Math.sin(Object(f["h"])(t))),o=n*r+a*s,l=a*r+n*s,c=new O["a"]({xmin:i.x-o/2,ymin:i.y-l/2,xmax:i.x+o/2,ymax:i.y+l/2,spatialReference:e.spatialReference});return c.centerAt(i),c}var M=i("a915");function P(e){const t=Object(M["g"])(e.lineWidth),i=2*t,r=Math.round(Object(M["g"])(e.lineLength)/i)+1,s=t,n=10,a=e.lineColor.toRgba(),o=[a[0]/255,a[1]/255,a[2]/255,a[3]],{lineSpeed:l,fadeDuration:c,density:h}=e;return{lineRenderWidth:t,segmentLength:i,verticesPerLine:r,lineCollisionWidth:s,lineSpacing:n,lineColor:o,lineSpeed:l,fadeDuration:c,density:h,smoothing:Object(M["g"])(e.smoothing),velocityScale:1,minWeightThreshold:.001,minSpeedThreshold:.001,maxTurnAngle:1,mergeLines:!0,interpolate:!0,profile:!1}}var V=i("7ce4"),L=(i("d267"),i("1956"),i("d17d"),i("9f8b"),i("a1ff"),i("0fa6"));class A{constructor(e,t){this._vertexData=e,this._indexData=t}prepareForRendering(e,t,i){const r=V["a"].createVertex(e,35044,this._vertexData),s=V["a"].createIndex(e,35044,this._indexData),n=new L["a"](e,t,i,{geometry:r},s);this.vertexBuffer=r,this.indexBuffer=s,this.vertexArray=n,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose(),this.vertexBuffer.dispose(),this.indexBuffer.dispose()}}class C{constructor(e,t,i){this._loadImagery=e,this._createStreamlinesMesh=t,this._rendererSettings=P(i)}get animated(){return this._rendererSettings.lineSpeed>0}get renderSettings(){return this._rendererSettings}areResourcesCompatible(e){let t=!0;return t=t&&e._loadImagery===this._loadImagery,t=t&&e._createStreamlinesMesh===this._createStreamlinesMesh,t=t&&e._rendererSettings.verticesPerLine===this._rendererSettings.verticesPerLine,t=t&&e._rendererSettings.segmentLength===this._rendererSettings.segmentLength,t=t&&e._rendererSettings.lineSpacing===this._rendererSettings.lineSpacing,t=t&&e._rendererSettings.density===this._rendererSettings.density,t=t&&e._rendererSettings.smoothing===this._rendererSettings.smoothing,t=t&&e._rendererSettings.velocityScale===this._rendererSettings.velocityScale,t=t&&e._rendererSettings.minWeightThreshold===this._rendererSettings.minWeightThreshold,t=t&&e._rendererSettings.minSpeedThreshold===this._rendererSettings.minSpeedThreshold,t=t&&e._rendererSettings.mergeLines===this._rendererSettings.mergeLines,t=t&&e._rendererSettings.interpolate===this._rendererSettings.interpolate,t&&this._rendererSettings.mergeLines&&(t=e._rendererSettings.lineCollisionWidth===this._rendererSettings.lineCollisionWidth),!!t}async loadResources(e,t){const{extent:i,size:r}=e;Object(m["w"])(t);const s=await this._loadImagery(i,r[0],r[1],t),{vertexData:n,indexData:a}=await this._createStreamlinesMesh(this._rendererSettings,s,t);return new A(n,a)}}let E=class extends s["a"]{constructor(){super(...arguments),this._loadImagery=(e,t,i,r)=>Object(o["b"])(this.layer,e,t,i,r),this._createStreamlinesMesh=(e,t,i)=>this.layer.createStreamlinesMesh({flowData:t,rendererSettings:e},{signal:i}),this.container=null,this.layer=null,this.type="rasterAnimatedFlow",this.redrawOrRefetch=async()=>{this._rendererChanged()}}get updating(){return!this._strategy||this._strategy.updating}update(e){e.stationary?this._strategy.update(e):this.layerView.requestUpdate()}install(e){this.container=new u,e.addChild(this.container),this._strategy=new I({flowContainer:this.container}),this._rendererChanged()}uninstall(){this._strategy.destroy(),this.container.removeAllChildren(),this.container.remove()}moveEnd(){}async doRefresh(){}attach(){}_rendererChanged(){if("animated-flow"!==this.layer.renderer.type)return;const e=new C(this._loadImagery,this._createStreamlinesMesh,this.layer.renderer);this.container.flowStyle=e,this.layerView.requestUpdate()}};Object(r["a"])([Object(n["b"])()],E.prototype,"_strategy",void 0),Object(r["a"])([Object(n["b"])()],E.prototype,"container",void 0),Object(r["a"])([Object(n["b"])()],E.prototype,"layer",void 0),Object(r["a"])([Object(n["b"])()],E.prototype,"layerView",void 0),Object(r["a"])([Object(n["b"])()],E.prototype,"type",void 0),Object(r["a"])([Object(n["b"])()],E.prototype,"updating",null),E=Object(r["a"])([Object(a["a"])("esri.views.2d.engine.flow.AnimatedFlowView2D")],E);const z=E}}]);
//# sourceMappingURL=chunk-4912be1d.b1364e06.js.map