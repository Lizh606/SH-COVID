(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{1:function(e,t){},2:function(e,t){},"3dUo":function(e,t,a){"use strict";a.d(t,"a",function(){return i});var i=function(e){return e.forEach(function(e){if("Polygon"===e.geometry.type){var t=e.geometry.coordinates;if(1<t.length){for(var a=[[t[0]]],i=1;i<t.length;i++){var r=function(e){for(var t,a,i=0,r=0,n=e.length,o=n-1;r<n;o=r++)t=e[r],a=e[o],i+=(a[0]-t[0])*(t[1]+a[1]);return i}(t[i]);0!==r&&(0<r?a[a.length-1].push(t[i]):a.push([t[i]]))}e.geometry.coordinates=a,e.geometry.type="MultiPolygon"}}}),e}},"45Hi":function(e,t,a){e.exports=a.p+"static/img/tdt-vec.png"},"5Ynx":function(e,t,a){},"5zrt":function(e,t,a){e.exports=a.p+"static/img/tdt-ter.png"},"7L49":function(e,t,a){"use strict";a.d(t,"a",function(){return U});var t=a("hdLw"),f=a.n(t),c=a("Ur4K"),u=a("3dUo"),t=(a("xKWM"),a("hhWd"),a("CYVn"),a("MT78")),i=a.n(t),t=a("y7ZN"),r=a.n(t),t=a("zT9C"),h=a.n(t),n=a("kzZv"),o=a("GjdS"),p=a("o2tc"),d=a("9WTN"),t=a("Z94/"),C=a.n(t),t=a("ATId"),s=a.n(t),Y=a("qAG6"),b=a("xRo1");function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(a){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=v(a);return function(e,t){{if(t&&("object"===l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,i?(e=v(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var x=function(e,o,s,l){return new(s=s||Promise)(function(a,t){function i(e){try{n(l.next(e))}catch(e){t(e)}}function r(e){try{n(l.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?a(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,r)}n((l=l.apply(e,o||[])).next())})},w=["GoogleCRS84Quad","GoogleMapsCompatible","urn:ogc:def:wkss:OGC:1.0:GoogleMapsCompatible","urn:ogc:def:wkss:OGC:1.0:GoogleCRS84Quad"],S=["559082264.0287178","279541132.0143589","139770566.0071794","69885283.00358972","34942641.50179486","17471320.75089743","8735660.375448715","4367830.1877224357","2183915.093862179","1091957.546931089","545978.7734655447","272989.3867327723","136494.6933663862","68247.34668319309","34123.67334159654","17061.83667079827","8530.918335399136","4265.459167699568","2132.729583849784"],P=["5.590822640287176E8","2.795411320143588E8","1.397705660071794E8","6.98852830035897E7","3.494264150179485E7","1.7471320750897426E7","8735660.375448713","4367830.187724357","2183915.0938621783","1091957.5469310891","545978.7734655446","272989.3867327723","136494.69336638614","68247.34668319307","34123.673341596535","17061.836670798268","8530.918335399134"],_=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}(r,o["a"]);var e,t,a,i=g(r);function r(e){var t,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=i.call(this)).proxyOptions={data:"apps/viewer/getUrlResource.json?url=",image:"apps/viewer/getUrlResource.png?url="},"string"==typeof e||"number"==typeof e?t.mapId=e:null!==e&&"object"===l(e)&&(t.mapInfo=e),t.serverUrl=a.serverUrl||"https://www.supermapol.com",t.accessToken=a.accessToken,t.accessKey=a.accessKey,t.tiandituKey=a.tiandituKey||"",t.withCredentials=a.withCredentials||!1,t.excludePortalProxyUrl=a.excludePortalProxyUrl,t.iportalServiceProxyUrl=a.iportalServiceProxyUrlPrefix,t.proxy=a.proxy,t}return e=r,(t=[{key:"setMapId",value:function(e){"string"==typeof e||"number"==typeof e?(this.mapId=e,this.mapInfo=null):null!==e&&"object"===l(e)&&(this.mapInfo=e,this.mapId="")}},{key:"setServerUrl",value:function(e){this.serverUrl=e}},{key:"setWithCredentials",value:function(e){this.withCredentials=e}},{key:"setProxy",value:function(e){this.proxy=e}},{key:"handleServerUrl",value:function(e){var t=e.split("");return"/"!==t[t.length-1]&&(e+="/"),this.serverUrl=e}},{key:"getMapInfo",value:function(){var t=this;if(!this.mapId&&this.mapInfo)return new Promise(function(e){e(t.mapInfo)});var r=this._handleMapUrl();return new Promise(function(a,i){return x(t,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getiPortalServiceProxy();case 3:SuperMap.FetchRequest.get(r,null,{withCredentials:this.withCredentials}).then(function(e){return e.json()}).then(function(e){var t;e&&!1===e.succeed?(t={message:e&&e.error&&e.error.errorMsg},i(t)):(e.mapParams={title:e.title,description:e.description},a(e))}).catch(function(e){i(e)}),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),i(e.t0);case 9:case"end":return e.stop()}},e,this,[[0,6]])}))})}},{key:"getiPortalServiceProxy",value:function(){var i=this;return new Promise(function(t,a){SuperMap.FetchRequest.get("".concat(i.serverUrl,"web/config/portal.json"),{scope:["serviceProxy"]}).then(function(e){return e.json()}).then(function(e){e&&e.serviceProxy?((e=e.serviceProxy).enable&&(e.proxyServerRootUrl?i.iportalServiceProxyUrl=e.proxyServerRootUrl:e.port&&e.rootUrlPostfix&&(i.iportalServiceProxyUrl="".concat(e.port,"/").concat(e.rootUrlPostfix)),-1<i.serverUrl.indexOf(i.iportalServiceProxyUrl)&&(i.iportalServiceProxyUrl="")),t(e)):a("serviceProxyFailed")}).catch(function(e){a(e)})})}},{key:"getLayerFeatures",value:function(e,t,a){var i;switch(e){case"hosted":i=this._getFeaturesFromHosted(t,a);break;case"rest_data":i=this._getFeaturesFromRestData(t,a);break;case"rest_map":i=this._getFeaturesFromRestMap(t);break;case"dataflow":i=this._getFeaturesFromDataflow(t);break;case"user_data":i=this._getFeaturesFromUserData(t)}return i}},{key:"getWmsInfo",value:function(i){var r=this;return new Promise(function(a){var e=r.handleProxy(),t="".concat(i.url.split("?")[0],"?REQUEST=GetCapabilities&SERVICE=WMS");SuperMap.FetchRequest.get(t,null,{withCredentials:r.handleWithCredentials(e,i.url,!1),withoutFormatSuffix:!0,proxy:e}).then(function(e){return e.text()}).then(function(e){var t=b||window.convert,e=JSON.parse(t.xml2json(e,{compact:!0,spaces:4})),e=e.WMT_MS_Capabilities||e.WMS_Capabilities;a({version:e._attributes.version})})})}},{key:"getWmtsInfo",value:function(g,v){var i=this;return new Promise(function(u,t){var h,p=!1,d=22,f="",m="",y="",e=i.handleProxy(),a="".concat(g.url.split("?")[0],"?REQUEST=GetCapabilities&SERVICE=WMTS&VERSION=1.0.0"),a=i.handleParentRes(a);SuperMap.FetchRequest.get(a,null,{withCredentials:i.handleWithCredentials(e,g.url,!1),withoutFormatSuffix:!0,proxy:e}).then(function(e){return e.text()}).then(function(e){var t=b||window.convert,t=JSON.parse(t.xml2json(e,{compact:!0,spaces:4})).Capabilities,e=t.Contents,t=t["ows:OperationsMetadata"];t&&(t=t["ows:Operation"],(t=(t=!Array.isArray(t)?[t]:t).find(function(e){return"GetTile"===e._attributes.name}))&&(c=t["ows:DCP"]["ows:HTTP"]["ows:Get"],(l=(c=!Array.isArray(c)?[c]:c).find(function(e){return"KVP"===e["ows:Constraint"]["ows:AllowedValues"]["ows:Value"]._text}))&&(y=l._attributes["xlink:href"])));for(var a=e.TileMatrixSet,i=0;i<a.length;i++)if(a[i]["ows:Identifier"]&&a[i]["ows:Identifier"]._text===g.tileMatrixSet){if(a[i].WellKnownScaleSet&&-1!==w.indexOf(a[i].WellKnownScaleSet._text))p=!0;else{for(var r=[],n="EPSG:3857"===v?S:P,o=0,s=n.length;o<s&&a[i].TileMatrix[o]&&parseFloat(n[o])===parseFloat(a[i].TileMatrix[o].ScaleDenominator._text);o++)r.push(n[o]);if(d=r.length-1,0===r.length)throw Error("TileMatrixSetNotSuppport");p=!0}break}var l,c=e.Layer.find(function(e){return e["ows:Identifier"]._text===g.layer});c&&(l=c.Style,f=Array.isArray(c.Style)?l[0]["ows:Identifier"]?l[0]["ows:Identifier"]._text:"":l["ows:Identifier"]?l["ows:Identifier"]._text:"",c["ows:WGS84BoundingBox"]&&(e=c["ows:WGS84BoundingBox"]["ows:LowerCorner"]._text.split(" "),l=c["ows:WGS84BoundingBox"]["ows:UpperCorner"]._text.split(" "),h=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(l[0]),parseFloat(l[1])]),c=c.ResourceURL,(c=(c=!Array.isArray(c)?[c]:c).find(function(e){return"tile"===e._attributes.resourceType}))&&(m=c._attributes.template)),u({isMatched:p,matchMaxZoom:d,style:f,bounds:h,restResourceURL:m,kvpResourceUrl:y})}).catch(function(e){t(e)})})}},{key:"_getFeaturesFromHosted",value:function(e,t){var a=e.dataSource,i=e.layerType,r=(a||e).serverId;return r?"MARKER"===i||a&&(!a.accessType||"DIRECT"===a.accessType)?this._getDataFromIportal(r,e):this._getDataFromHosted({layer:e,serverId:r,baseProjection:t}):new Promise(function(e){e({type:"noServerId"})})}},{key:"_getFeaturesFromRestData",value:function(e,i){var r,n=this,o=e.dataSource;return new Promise(function(t,a){n._getFeatureBySQL(o.url,[o.dataSourceName||e.name],function(e){r=n.parseGeoJsonData2Feature({allDatas:{features:e.result.features.features}}),t({type:"feature",features:r})},function(e){a(e)},i)})}},{key:"_getFeaturesFromRestMap",value:function(s){var l=this;return new Promise(function(n,o){l._queryFeatureBySQL(s.dataSource.url,s.dataSource.layerName,function(e){var e=e&&e.result.recordsets,e=e&&e[0],t=e.fields;if(e&&t){var a,i=[];for(a in t){var r=t[a];0===r.indexOf("Sm")&&"SmID"!==r||i.push(r)}l._getFeatures(i,s,function(e){n({type:"feature",features:e})},function(e){o(e)})}},function(e){o(e)},"smid=1")})}},{key:"_getFeaturesFromUserData",value:function(e){var r=this,n=e.dataSource;return new Promise(function(t,a){var e=r.handleProxy(),i=r.handleParentRes(n.url);SuperMap.FetchRequest.get(i,null,{withCredentials:r.handleWithCredentials(e,i,r.withCredentials),proxy:e}).then(function(e){return e.json()}).then(function(e){e=e&&e instanceof Object&&"FeatureCollection"===e.type?e.features:e;e=r.parseGeoJsonData2Feature({allDatas:{features:e}}),t({type:"feature",features:e})}).catch(function(e){a(e)})})}},{key:"_queryFeatureBySQL",value:function(e,t,a,i,r,n,o,s,l,c){s=this._getQueryFeaturesParam(t,r,n,o,s,l,c),l=this.handleProxy(),c=this.handleParentRes(e);new SuperMap.QueryBySQLService(c,{proxy:l,withCredentials:this.handleWithCredentials(l,e,!1),eventListeners:{processCompleted:function(e){a&&a(e)},processFailed:function(e){i&&i(e)}}}).processAsync(s)}},{key:"_getFeatures",value:function(e,t,a,i){var r=this,t=t.dataSource;this._queryFeatureBySQL(t.url,t.layerName,function(e){e=e.result.recordsets[0].features.features,e=r.parseGeoJsonData2Feature({allDatas:{features:e}});a(e)},function(e){i(e)},null,e)}},{key:"_getQueryFeaturesParam",value:function(e,t,a,i,r,n,o){t=new SuperMap.FilterParameter({name:e,attributeFilter:t});a&&(t.fields=a);t={queryParams:[t]};return o&&(t.queryOption=SuperMap.QueryOption.ATTRIBUTE),r&&(t.startRecord=r),n&&(t.expectCount=n),i&&(t.prjCoordSys={epsgCode:i}),new SuperMap.QueryBySQLParameters(t)}},{key:"_getFeaturesFromDataflow",value:function(a){var i=this;return new Promise(function(e,t){i._getDataflowInfo(a,function(){e({type:"dataflow"})},function(e){t(e)})})}},{key:"_getDataflowInfo",value:function(a,t,i){var e=a.url,e="".concat(e,".json");a.credential&&a.credential.token&&(r=a.credential.token,e+="?token=".concat(r));var r=this.handleProxy(),e=this.handleParentRes(e);SuperMap.FetchRequest.get(e,null,{proxy:r,withCredentials:this.handleWithCredentials(r,e,!1)}).then(function(e){return e.json()}).then(function(e){e?(e.featureMetaData&&(a.featureType=e.featureMetaData.featureType.toUpperCase(),a.dataSource={dataTypes:{}},e.featureMetaData.fieldInfos&&0<e.featureMetaData.fieldInfos.length&&e.featureMetaData.fieldInfos.forEach(function(e){var t=e.name.trim();"TEXT"===e.type?a.dataSource.dataTypes[t]="STRING":-1!==["DOUBLE","INT","FLOAT","LONG","SHORT"].indexOf(e.type)?a.dataSource.dataTypes[t]="NUMBER":a.dataSource.dataTypes[t]="UNKNOWN"})),a.wsUrl=e.urls[0].url,a.name=e.urls[0].url.split("iserver/services/")[1].split("/dataflow")[0],t()):i()}).catch(function(){i()})}},{key:"getDatasourceType",value:function(e){var t,a=e.dataSource,e=e.layerType;return a&&"SAMPLE_DATA"===a.type?a.type:(a&&a.serverId||"MARKER"===e||"HOSTED_TILE"===e?t="hosted":"SUPERMAP_REST"===e||"TILE"===e||"WMS"===e||"WMTS"===e||"MAPBOXSTYLE"===e?t="tile":a&&"REST_DATA"===a.type?t="rest_data":a&&"REST_MAP"===a.type&&a.url?t="rest_map":"DATAFLOW_POINT_TRACK"===e||"DATAFLOW_HEAT"===e?t="dataflow":a&&"USER_DATA"===a.type&&(t="user_data"),t)}},{key:"getFeatureProperties",value:function(e){var t=[];return e&&e.length&&e.forEach(function(e){e=e.properties;e&&t.push(e)}),t}},{key:"parseGeoJsonData2Feature",value:function(e){for(var t=e.allDatas.features,a=[],i=0,r=t.length;i<r;i++){var n=t[i],o=n.geometry.coordinates;"Point"===t[i].geometry.type&&t[i].properties&&(t[i].properties.lon=o[0],t[i].properties.lat=o[1]),n.properties.index=i+"",a.push(n)}return a}},{key:"_getDataFromIportal",value:function(e,o){var s,t=this,a="".concat(this.serverUrl,"web/datas/").concat(e,"/content.json?pageSize=9999999&currentPage=1");return this.accessToken&&(a="".concat(a,"&").concat(this.accessKey,"=").concat(this.accessToken)),new Promise(function(r,n){a=t.handleParentRes(a);var e=t.handleProxy();SuperMap.FetchRequest.get(a,null,{withCredentials:t.handleWithCredentials(e,a,t.withCredentials),proxy:e}).then(function(e){return e.json()}).then(function(i){return x(t,void 0,void 0,regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!1===i.succeed&&n(i.error),!i||!i.type){e.next=22;break}if("JSON"!==i.type&&"GEOJSON"!==i.type){e.next=7;break}i.content=JSON.parse(i.content.trim()),s=this._formatGeoJSON(i.content),e.next=21;break;case 7:if("EXCEL"!==i.type&&"CSV"!==i.type){e.next=20;break}if(o.dataSource&&o.dataSource.administrativeInfo)return i.content.rows.unshift(i.content.colTitles),a=o.dataSource.administrativeInfo,t=a.divisionType,a=a.divisionField,e.next=13,this._excelData2FeatureByDivision(i.content,t,a);e.next=17;break;case 13:a=e.sent,s=this._formatGeoJSON(a),e.next=18;break;case 17:s=this._excelData2Feature(i.content,o&&o.xyField||{});case 18:e.next=21;break;case 20:"SHP"===i.type&&(i.content=JSON.parse(i.content.trim()),s=this._formatGeoJSON(i.content.layers[0]));case 21:r({type:"feature",features:s});case 22:case"end":return e.stop()}},e,this)}))}).catch(function(e){n(e)})})}},{key:"_getDataFromHosted",value:function(e){var o=this,s=e.layer,t=e.serverId,l=e.baseProjection,c="HOSTED_TILE"===s.layerType;return new Promise(function(r,n){o._checkUploadToRelationship(t).then(function(e){var a,i;e&&0<e.length?(a=e[0].name,i=e[0].type.toUpperCase(),o._getDataService(t,a).then(function(e){e=e.dataItemServices;0===e.length&&n("noDataServices");var t={layer:s,dataItemServices:e,datasetName:a,featureType:i,resolve:r,reject:n,baseProjection:l};c?(e=e.filter(function(e){return e&&"RESTDATA"===e.serviceType})[0],o._isMvt(e.address,a,l).then(function(e){o._getServiceInfoFromLayer(t,e)}).catch(function(){o._getServiceInfoFromLayer(t)})):o._getServiceInfoFromLayer(t)})):n("resultIsEmpty")}).catch(function(e){n(e)})})}},{key:"_isMvt",value:function(e,t,a){return this._getDatasetsInfo(e,t).then(function(t){return t.epsgCode==a.split("EPSG:")[1]?SuperMap.FetchRequest.get("".concat(t.url,"/tilefeature.mvt")).then(function(e){return e.json()}).then(function(e){return t.isMvt=e.error&&400===e.error.code,t}).catch(function(){return t}):t})}},{key:"_getServiceInfoFromLayer",value:function(e,a){var i=this,r=e.layer,t=e.dataItemServices,n=e.datasetName,o=e.featureType,s=e.resolve,l=e.reject,c=e.baseProjection,u=a?!a.isMvt:"HOSTED_TILE"===r.layerType,h=!1;t.forEach(function(t){h||(t&&u&&"RESTMAP"===t.serviceType?(h=!0,i._getTileLayerInfo(t.address,c).then(function(e){s({type:"restMap",restMaps:e})})):t&&!u&&"RESTDATA"===t.serviceType&&(a&&a.isMvt?s({type:"mvt",info:a,featureType:o}):(h=!0,i._getDatasources(t.address).then(function(e){r.dataSource.dataSourceName=e+":"+n,r.dataSource.url="".concat(t.address,"/data"),i._getFeatureBySQL(r.dataSource.url,[r.dataSource.dataSourceName||r.name],function(e){e=i.parseGeoJsonData2Feature({allDatas:{features:e.result.features.features}});s({type:"feature",features:e})},function(e){l(e)})},function(e){l(e)}))))},this),h||l("noService")}},{key:"_getDatasetsInfo",value:function(i,r){var n=this;return this._getDatasources(i).then(function(t){var a="".concat(i,"/data/datasources/").concat(t,"/datasets/").concat(r),e=n.handleProxy(),a=n.handleParentRes(a);return SuperMap.FetchRequest.get(a,null,{withCredentials:n.handleWithCredentials(e,a,!1),proxy:e}).then(function(e){return e.json()}).then(function(e){return{epsgCode:e.datasetInfo.prjCoordSys.epsgCode,bounds:e.datasetInfo.bounds,datasourceName:t,datasetName:r,url:a}})})}},{key:"_getDatasources",value:function(e){var t=this.handleProxy(),e="".concat(e,"/data/datasources.json"),e=this.handleParentRes(e);return SuperMap.FetchRequest.get(e,null,{withCredentials:this.handleWithCredentials(t,e,!1),proxy:t}).then(function(e){return e.json()}).then(function(e){if(401===e.code)throw Error(e.errorMsg);return e.datasourceNames[0]})}},{key:"_getDataService",value:function(t,a){var e=this.handleProxy(),i="".concat(this.serverUrl,"web/datas/").concat(t,".json"),i=this.handleParentRes(i);return SuperMap.FetchRequest.get(i,null,{withCredentials:this.handleWithCredentials(e,i,this.withCredentials),proxy:e}).then(function(e){return e.json()}).then(function(e){return e.fileId=t,e.datasetName=a,e})}},{key:"_checkUploadToRelationship",value:function(e){var t=this.handleProxy(),e="".concat(this.serverUrl,"web/datas/").concat(e,"/datasets.json"),e=this.handleParentRes(e);return SuperMap.FetchRequest.get(e,null,{withCredentials:this.handleWithCredentials(t,e,this.withCredentials),proxy:t}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"_handleMapUrl",value:function(){var e=this.serverUrl+"web/maps/"+this.mapId+"/map";(this.accessToken||this.accessKey)&&(e+="token="+this.accessToken);var t,a="getUrlResource.json?url=";return this.excludePortalProxyUrl&&-1<this.serverUrl.indexOf(a)&&(1<(t=this.serverUrl.split(a)).length&&(e=t[0]+a+this.serverUrl+"web/maps/"+this.mapId+"/map.json")),e=-1===e.indexOf(".json")?"".concat(e,".json"):e}},{key:"handleProxy",value:function(e){if(!this.proxy)return null;e=this.proxyOptions[e||"data"],e=this.serverUrl+e;return e="string"==typeof this.proxy?this.proxy:e}},{key:"handleWithCredentials",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.withCredentials;return!(!e||!e.startsWith(this.serverUrl)||t&&!t.startsWith(e))||(!!(t&&this.iportalServiceProxyUrl&&0<=t.indexOf(this.iportalServiceProxyUrl))||a)}},{key:"isIportalResourceUrl",value:function(e){return e.startsWith(this.serverUrl)||this.iportalServiceProxyUrl&&0<=e.indexOf(this.iportalServiceProxyUrl)}},{key:"handleParentRes",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.mapId,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"MAP";return this.isIportalResourceUrl(e)?Object(Y.t)(e,"parentResType=".concat(a,"&parentResId=").concat(t)):e}},{key:"_formatGeoJSON",value:function(e){e=e.features;return e.forEach(function(e,t){e.properties.index=t}),e}},{key:"_excelData2Feature",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=e.colTitles,i=a.indexOf(t.xField),r=a.indexOf(t.yField);if(r<0||i<0)for(var n=0,o=a.length;n<o;n++)Object(Y.n)(a[n])&&(i=n),Object(Y.o)(a[n])&&(r=n);for(var s=[],l=0,c=e.rows.length;l<c;l++){for(var u=e.rows[l],h=Number(u[i]),u=Number(u[r]),p={},d=0;d<e.colTitles.length;d++)p[e.colTitles[d].trim()]=e.rows[l][d];p.index=l+"",s.push({type:"Feature",geometry:{type:"Point",coordinates:[h,u]},properties:p})}return s}},{key:"_excelData2FeatureByDivision",value:function(t,e,a){var i=this,r=-1!==["城市","City"].indexOf(e)?"MunicipalData":"ProvinceData";if(window[r]&&window[r].features)return new Promise(function(e){e(i._combineFeature(t,window[r],a))});var n=-1!==["城市","City"].indexOf(e)?"MunicipalData.js":"ProvincialData.js",e=this.handleProxy(),n="".concat(this.serverUrl,"apps/dataviz/libs/administrative_data/").concat(n);return SuperMap.FetchRequest.get(n,null,{withCredentials:!1,proxy:e,withoutFormatSuffix:!0}).then(function(e){return e.text()}).then(function(e){return new Function(e)(),i._combineFeature(t,window[r],a)})}},{key:"_combineFeature",value:function(e,r,t){var n=this,o={type:"FeatureCollection",features:[]};if(e.length<2)return o;var s=e.colTitles,e=e.rows,l=s.findIndex(function(e){return e===t});return e.forEach(function(t){var e,a,i=r.features.find(function(e){return n._isMatchAdministrativeName(e.properties.Name,t[l])});i&&(e=i.properties.Province,a={properties:{},geometry:i.geometry,type:"Feature"},t.forEach(function(e,t){a.properties[s[t]]=e}),e&&(a.properties.Province=e),o.features.push(a))}),o}},{key:"_isMatchAdministrativeName",value:function(e,t){if(e&&"string"==typeof t&&t.constructor===String){var a=e.trim().substr(0,2);return"阿拉"===(a="张家"===a?e.trim().substr(0,3):a)&&(a=e.trim().substr(0,3)),!!t.match(new RegExp(a))}return!1}},{key:"_getTileLayerInfo",value:function(e,t){var i=this,r=this.handleProxy(),n=t.split("EPSG:")[1],e="".concat(e,"/maps.json"),e=this.handleParentRes(e);return SuperMap.FetchRequest.get(e,null,{withCredentials:this.handleWithCredentials(r,e,this.withCredentials),proxy:r}).then(function(e){return e.json()}).then(function(e){var a=[];return e&&e.forEach(function(t){var e=SuperMap.FetchRequest.get("".concat(t.path,".json?prjCoordSys=").concat(JSON.stringify({epsgCode:n})),null,{withCredentials:i.withCredentials,proxy:r}).then(function(e){return e.json()}).then(function(e){return e.url=t.path,e});a.push(e)}),Promise.all(a).then(function(e){return e})})}},{key:"_getFeatureBySQL",value:function(e,t,a,i,r){var n=new SuperMap.FilterParameter({name:t.join().replace(":","@"),attributeFilter:null}),t=new SuperMap.GetFeaturesBySQLParameters({queryParameter:n,datasetNames:t,fromIndex:0,toIndex:-1,maxFeatures:-1,returnContent:!0});r&&(t.targetEpsgCode="EPSG:3857"===r||"EPSG:-1000"===r?4326:+r.split(":")[1]);r=this.handleProxy(),r={proxy:r,withCredentials:this.handleWithCredentials(r,e,!1),eventListeners:{processCompleted:function(e){a&&a(e)},processFailed:function(e){i&&i(e)}}},e=this.handleParentRes(e);new SuperMap.GetFeaturesBySQLService(e,r).processAsync(t)}},{key:"getEpsgCodeInfo",value:function(a,i){return x(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="/"===i.slice(-1)?i:"".concat(i,"/"),t="".concat(t,"epsgcodes/").concat(a,".json"),e.next=4,SuperMap.FetchRequest.get(t,null).then(function(e){return e.json()}).then(function(e){return e.wkt}).catch(function(e){console.error(e)});case 4:return t=e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}},e)}))}}])&&m(e.prototype,t),a&&m(e,a),Object.defineProperty(e,"prototype",{writable:!1}),r}(),T=a("fr48"),k=a("Nwvx");function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(a){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=L(a);return function(e,t){{if(t&&("object"===M(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,i?(e=L(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var D=function(e,o,s,l){return new(s=s||Promise)(function(a,t){function i(e){try{n(l.next(e))}catch(e){t(e)}}function r(e){try{n(l.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?a(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,r)}n((l=l.apply(e,o||[])).next())})},j=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&O(e,t)}(n,o["a"]);var e,t,a,r=I(n);function n(e,t,a){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(i=r.call(this)).echartslayer=[],i._layers=[],i.serverUrl=t.serverUrl||"https://www.supermapol.com",i.accessToken=t.accessToken,i.accessKey=t.accessKey,i.tiandituKey=t.tiandituKey||"",i.withCredentials=t.withCredentials||!1,i.proxy=t.proxy,i.target=t.target||"map",i.excludePortalProxyUrl=t.excludePortalProxyUrl,i.isSuperMapOnline=t.isSuperMapOnline,i.ignoreBaseProjection=t.ignoreBaseProjection,i.echartslayer=[],i.webMapService=new _(e,t),i.mapOptions=a,i.eventTypes=["getmapinfofailed","crsnotsupport","getlayerdatasourcefailed","addlayerssucceeded","notsupportmvt","notsupportbaidumap","projectionIsNotMatch","beforeremovemap"],i.mapId=e,i}return e=n,(t=[{key:"echartsLayerResize",value:function(){this.echartslayer.forEach(function(e){e.chart.resize()})}},{key:"setMapId",value:function(e){var t=this;"string"==typeof e||"number"==typeof e?(this.mapId=e,this.webMapInfo=null):null!==e&&"object"===M(e)&&(this.webMapInfo=e),this.webMapService.setMapId(e),setTimeout(function(){t._initWebMap()},0)}},{key:"setServerUrl",value:function(e){this.serverUrl=e,this.webMapService.setServerUrl(e)}},{key:"setWithCredentials",value:function(e){this.withCredentials=e,this.webMapService.setWithCredentials(e)}},{key:"setProxy",value:function(e){this.proxy=e,this.webMapService.setProxy(e)}},{key:"setZoom",value:function(e){this.map&&(this.mapOptions.zoom=e)!==+this.map.getZoom().toFixed(2)&&(!e&&0!==e||this.map.setZoom(e,{from:"setZoom"}))}},{key:"setMaxBounds",value:function(e){this.map&&(this.mapOptions.maxBounds=e)&&this.map.setMaxBounds(e)}},{key:"setMinZoom",value:function(e){this.map&&(!(this.mapOptions.minZoom=e)&&0!==e||this.map.setMinZoom(e))}},{key:"setMaxZoom",value:function(e){this.map&&(!(this.mapOptions.maxZoom=e)&&0!==e||this.map.setMaxZoom(e))}},{key:"initWebMap",value:function(){if(this.cleanWebMap(),this.serverUrl=this.serverUrl&&this.webMapService.handleServerUrl(this.serverUrl),this.webMapInfo){var e=this.webMapInfo;return e.mapParams={title:this.webMapInfo.title,description:this.webMapInfo.description},this.mapParams=e.mapParams,void this._getMapInfo(e)}this.mapId&&this.serverUrl?(this._taskID=new Date,this.getMapInfo(this._taskID)):this._createMap()}},{key:"getMapInfo",value:function(t){var a=this;this.serverUrl=this.serverUrl&&this.webMapService.handleServerUrl(this.serverUrl),this.webMapService.getMapInfo().then(function(e){a._taskID===t&&(a.mapParams=e.mapParams,a._getMapInfo(e,t))},function(e){throw e}).catch(function(e){a.triggerEvent("getmapinfofailed",{error:e}),console.log(e)})}},{key:"getBaseLayerType",value:function(e){var t=e.layerType;switch(t=-1<t.indexOf("TIANDITU_VEC")||-1<t.indexOf("TIANDITU_IMG")||-1<t.indexOf("TIANDITU_TER")?"TIANDITU":t){case"TILE":case"SUPERMAP_REST":return"TILE";case"CLOUD":case"CLOUD_BLACK":return"CLOUD";case"OSM":case"JAPAN_ORT":case"JAPAN_RELIEF":case"JAPAN_PALE":case"JAPAN_STD":case"GOOGLE_CN":case"GOOGLE":return"XYZ";default:return t}}},{key:"getMapurls",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return{CLOUD:e.CLOUD||"http://t2.dituhui.com/FileService/image?map=quanguo&type=web&x={x}&y={y}&z={z}",CLOUD_BLACK:e.CLOUD_BLACK||"http://t3.dituhui.com/MapService/getGdp?x={x}&y={y}&z={z}",OSM:e.OSM||"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",GOOGLE:"https://www.google.cn/maps/vt/pb=!1m4!1m3!1i{z}!2i{x}!3i{y}!2m3!1e0!2sm!3i380072576!3m8!2szh-CN!3scn!5e1105!12m4!1e68!2m2!1sset!2sRoadmap!4e0!5m1!1e0",GOOGLE_CN:"https://mt{0-3}.google.cn/vt/lyrs=m&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}",JAPAN_STD:"https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",JAPAN_PALE:"https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png",JAPAN_RELIEF:"https://cyberjapandata.gsi.go.jp/xyz/relief/{z}/{x}/{y}.png",JAPAN_ORT:"https://cyberjapandata.gsi.go.jp/xyz/ort/{z}/{x}/{y}.jpg"}}},{key:"getLayerFeatures",value:function(i,r,e){var t=this,e=this.webMapService.getLayerFeatures(e,i,this.baseProjection);e&&e.then(function(a){return D(t,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mapId&&this._taskID!==r)return e.abrupt("return");e.next=2;break;case 2:if(!a||!i.projection){e.next=8;break}if(Object(T.a)(i.projection)){e.next=8;break}return e.next=6,this.webMapService.getEpsgCodeInfo(i.projection.split(":")[1],this.serverUrl);case 6:(t=e.sent)&&Object(T.b)(i.projection,t);case 8:this._getLayerFeaturesSucceeded(a,i);case 9:case"end":return e.stop()}},e,this)}))},function(e){throw new Error(e)}).catch(function(e){t._addLayerSucceeded(),t.triggerEvent("getlayerdatasourcefailed",{error:e,layer:i,map:t.map}),console.log(e)})}},{key:"setFeatureInfo",value:function(e){var t=e.dv_v5_markerInfo;if(!t||!t.dataViz_title)return t;var a,i=t,r=e.properties;for(a in i)r[a]&&(i[a]=r[a],delete r[a]);return i}},{key:"getRankStyleGroup",value:function(t,e,a){var i=[],r=[],n=a.style,o=a.themeSetting,s=o.segmentMethod,l=o.segmentCount,c=o.customSettings,u=a.themeSetting.minRadius,a=a.themeSetting.maxRadius,h=o.colors,p=n.fillColor;e.forEach(function(e){e=e.properties[t];null!=e&&""!==e&&C()(+e)&&i.push(Number(e))});try{r=SuperMap.ArrayStatistic.getArraySegments(i,s,l)}catch(e){console.log(e)}for(var d,f,m=0;m<l;m++)m in c&&(d=c[m].segment.start,f=c[m].segment.end,null!=d&&(r[m]=d),null!=f&&(r[m+1]=f));var y=[];if(r&&r.length){for(var g,v,b=r.length,x=(a-u)/(b-1),w=Number(((a+u)/2).toFixed(2)),S="",P=h?SuperMap.ColorsPickerUtil.getGradientColors(h,b,"RANGE"):[],_=0;_<b-1;_++)w=(g=Number(r[_].toFixed(2)))===(v=Number(r[_+1].toFixed(2)))?w:u+Math.round(x*_),v=_===b-2?v+.01:v,w=c[_]&&c[_].radius?c[_].radius:w,n.radius=w,h&&0<h.length&&(S=c[_]&&c[_].color?c[_].color:P[_]||p,n.fillColor=S),y.push({radius:w,color:S,start:g,end:v,style:n});return y}return!1}},{key:"createRankStyleSource",value:function(e,t){var a=e.themeSetting.themeField,t=this.getRankStyleGroup(a,t,e);return!!t&&{parameters:e,styleGroups:t}}},{key:"isMatchAdministrativeName",value:function(e,t){if("string"!=typeof t||t.constructor!==String)return!1;var a=e.substr(0,2);return"张家"===a&&(a=e.substr(0,3)),!!t.match(new RegExp(a))}},{key:"getRestMapLayerInfo",value:function(e,t){var a=e.bounds,i=e.coordUnit,r=e.visibleScales,e=e.url;return t.layerType="TILE",t.orginEpsgCode=this.baseProjection,t.units=i&&i.toLowerCase(),t.extent=[a.left,a.bottom,a.right,a.top],t.visibleScales=r,t.url=e,t.sourceType="TILE",t}},{key:"handleLayerFeatures",value:function(e,t){var a=t.layerType,i=t.style,r=t.themeSetting,t=t.filterCondition;return e=(i||r)&&t&&"RANGE"!==a&&"UNIQUE"!==a&&"RANK_SYMBOL"!==a?this.getFilterFeatures(t,e):e}},{key:"mergeFeatures",value:function(e,t,a){if(!(t instanceof Array))return t;if(!(t=t.map(function(e,t){return Object.prototype.hasOwnProperty.call(e.properties,"index")||(e.properties.index=t),e})).length||!a&&t[0].geometry)return t;e=this.map.getSource(e);if((!e||!e._data.features)&&t[0].geometry)return t;var i=e&&e._data&&e._data.features,r=[];return!a&&i?i:(t.forEach(function(t){var e=i.find(function(e){return isNaN(+e.properties[a])&&isNaN(+t.properties[a])?JSON.stringify(e.properties[a]||"")===JSON.stringify(t.properties[a]||""):+e.properties[a]==+t.properties[a]});e?r.push(Object.assign(Object.assign({},e),t)):t.geometry&&r.push(t)}),r)}},{key:"getFilterFeatures",value:function(e,t){if(!e)return t;for(var a="select * from json where ("+this.replaceFilterCharacter(e)+")",i=[],r=0;r<t.length;r++){var n=t[r],o=void 0;try{o=window.jsonsql.query(a,{properties:n.properties})}catch(e){continue}o&&0<o.length&&i.push(n)}return i}},{key:"replaceFilterCharacter",value:function(e){return e=e.replace(/=/g,"==").replace(/AND|and/g,"&&").replace(/or|OR/g,"||").replace(/<==/g,"<=").replace(/>==/g,">=")}},{key:"getEchartsLayerOptions",value:function(e,t,a){var i=this.webMapService.getFeatureProperties(t),t=this._createLinesData(e,i),i=this._createPointsData(t,e,i);return this._createOptions(e,t,i,a)}},{key:"getDashStyle",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"array";if(!e)return"array"===a?[]:"";var i,r=t;switch(e){case"solid":i=[];break;case"dot":i=[1,4*r];break;case"dash":i=[4*r,4*r];break;case"dashrailway":i=[8*r,12*r];break;case"dashdot":i=[4*r,4*r,+r,4*r];break;case"longdash":i=[8*r,4*r];break;case"longdashdot":i=[8*r,4*r,1,4*r];break;default:SuperMap.Util.isArray(e)&&(i=e),i=(e=SuperMap.String.trim(e).replace(/\s+/g,",")).replace(/\[|\]/gi,"").split(",")}return i="array"===a?i:i.join(",")}},{key:"getCanvasFromSVG",value:function(e,t,a){var i=document.createElement("canvas");i.id="dataviz-canvas-".concat((new Date).getTime()),i.style.display="none",t.appendChild(i),e?(window.canvg||s.a)(i.id,e,{ignoreMouse:!0,ignoreAnimation:!0,renderCallback:function(){300<i.width||300<i.height||a(i)},forceRedraw:function(){return!1}}):a(i)}},{key:"getRangeStyleGroup",value:function(e,t){var a,i=e.featureType,r=e.style,n=e.themeSetting,o=n.customSettings,s=n.themeField,l=n.segmentCount,e=n.segmentMethod,n=n.colors,c=[];t.forEach(function(e){!(a=e.properties)||((e=a[s])||0===e)&&C()(+e)&&c.push(parseFloat(e))},this);var u=c&&c.length&&SuperMap.ArrayStatistic.getArraySegments(c,e,l);if(u){var h=l;a&&u[0]===u[a.length-1]&&(h=1,u.length=2);for(var p=0;p<u.length;p++){var d=u[p],d=0===p?Math.floor(100*d)/100:Math.ceil(100*d)/100+.1;u[p]=Number(d.toFixed(2))}for(var f=SuperMap.ColorsPickerUtil.getGradientColors(n,h,"RANGE"),m=0;m<h;m++)m in o&&(o[m].segment.start&&(u[m]=o[m].segment.start),o[m].segment.end&&(u[m+1]=o[m].segment.end));for(var y=[],g=0;g<h;g++){var v=f[g];g in o&&o[g].color&&(v=o[g].color),"LINE"===i?r.strokeColor=v:r.fillColor=v;var b=u[g],x=u[g+1],w=JSON.parse(JSON.stringify(r));y.push({style:w,color:v,start:b,end:x})}return y}}},{key:"getUniqueStyleGroup",value:function(e,t){var r=e.featureType,n=e.style,a=e.themeSetting,e=a.colors,o=a.customSettings,s=a.themeField,a=t&&t[0]&&t[0].properties||{};Object.keys(a).forEach(function(e){e.toLocaleUpperCase()===s.toLocaleUpperCase()&&(s=e)});var i,l=[];for(i in t){var c,u=t[i].properties[s],h=!1;for(c in l)if(l[c]===u){h=!0;break}h||l.push(u||"0")}var p=SuperMap.ColorsPickerUtil.getGradientColors(e,l.length),d=[];return l.forEach(function(e,t){var a=p[t],i=Object.assign({},n);e in o&&("object"===M(t=o[e])?i=Object.assign(i,t):("string"==typeof t&&(a=o[e]),"LINE"===r?i.strokeColor=a:i.fillColor=a)),d.push({color:a,style:i,value:e,themeField:s})},this),d}},{key:"transformFeatures",value:function(i){var r=this;return i&&i.forEach(function(e,t){var a=e.geometry&&e.geometry.coordinates;a&&0!==a.length&&(Object(k.a)(e,function(e){var t=r._unproject(e);e[0]=t[0],e[1]=t[1]}),i[t]=e)}),i}},{key:"_drawTextRectAndGetSize",value:function(e){var o=e.context,t=e.style,a=e.textArray,i=e.lineHeight,r=e.doublePadding,n=e.canvas,e=t.backgroundFill,s=t.maxWidth-r,l=0,c=0,u=[];a.forEach(function(e){var t="",a=!1;c++;for(var i=0;i<e.length;i++){var r=t+e[i],n=o.measureText(r).width;s<n&&0<i||"\n"===e[i]?(t=e[i],c++,a=!0):(t=r,l=n)}a?u.push(s):u.push(l)},this);for(var h=0;h<u.length;h++){var p=u[h];if(s<=p){l=s;break}l<p&&(l=p)}return l+=r,r=c*i+r-6,n.width=l,n.height=r,o.fillStyle=e,o.fillRect(0,0,l,r),o.lineWidth=t.borderWidth,o.strokeStyle=t.borderColor,o.strokeRect(0,0,l,r),{width:l,height:r}}},{key:"_drawTextWithCanvas",value:function(e){var h=e.context,t=e.canvas,p=e.style,d=Number(p.font.replace(/[^0-9]/gi,""))+3,e=p.text.split("\r\n");h.font=p.font;var f=this._drawTextRectAndGetSize({context:h,style:p,textArray:e,lineHeight:d,doublePadding:16,canvas:t}),m=8;e.forEach(function(e,t){0!==t&&(m+=d),h.font=p.font;var a,i=p.textAlign,r=f.width-16;switch(i){case"center":a=r/2;break;case"right":a=r;break;default:a=8}for(var n=e.split(""),o="",s=p.fillColor,l=p.maxWidth-16,c=0;c<n.length;c++){var u=o+n[c];l<h.measureText(u).width&&0<c||"\n"===n[c]?(h.fillStyle=s,h.textAlign=i,h.textBaseline="top",h.fillText(o,a,m),o=n[c],m+=d):o=u}h.fillStyle=s,h.textAlign=i,h.textBaseline="top",h.fillText(o,a,m)},this)}},{key:"handleSvgColor",value:function(e,t){var a=e.fillColor,i=e.fillOpacity,r=e.strokeColor,n=e.strokeOpacity,o=e.strokeWidth,s=t.getContext("2d");e.text?this._drawTextWithCanvas({context:s,canvas:t,style:e}):(a&&(s.fillStyle=Object(Y.c)(a,i),s.fill()),(r||o)&&(s.strokeStyle=Object(Y.c)(r,n),s.lineWidth=o,s.stroke()))}},{key:"_createLinesData",value:function(e,t){var n,o,s,l,i,r=this,c=[];return t&&t.length&&(n=e.from,o=e.to,"XY_FIELD"===n.type&&n.xField&&n.yField&&o.xField&&o.yField?t.forEach(function(e){var t=e[n.xField],a=e[n.yField],i=e[o.xField],r=e[o.yField];t&&a&&i&&r&&(s=[e[n.xField],e[n.yField]],l=[e[o.xField],e[o.yField]],c.push({coords:[s,l]}))}):"PLACE_FIELD"===n.type&&n.field&&o.field&&(i=d.concat(p),t.forEach(function(e){var t=e[n.field],a=e[o.field];s=i.find(function(e){return r.isMatchAdministrativeName(e.name,t)}),l=i.find(function(e){return r.isMatchAdministrativeName(e.name,a)}),s&&l&&c.push({coords:[s.coord,l.coord]})}))),c}},{key:"_createPointsData",value:function(e,t,r){var a=[],n=t.labelSetting;if(!n.show||!e.length)return a;var o=[],s=[];return e.forEach(function(e,t){var e=e.coords,a=e[0],i=e[1],e=r[t][n.from],t=r[t][n.to];o.find(function(e){return e.value[0]===a[0]&&e.value[1]===a[1]})||o.push({name:e,value:a}),s.find(function(e){return e.value[0]===i[0]&&e.value[1]===i[1]})||s.push({name:t,value:i})}),a=o.concat(s)}},{key:"_createOptions",value:function(e,t,a,i){t=this._createLineSeries(e,t,i);return{series:a&&a.length?(i=this._createPointSeries(e,a,i),t.concat(i)):t.slice()}}},{key:"_createPointSeries",value:function(e,t,a){var i=e.lineSetting,r=e.animationSetting,e=e.labelSetting,t=[{name:"point-series",coordinateSystem:a,zlevel:2,label:{normal:{show:e.show,position:"right",formatter:"{b}",color:e.color,fontFamily:e.fontFamily}},itemStyle:{normal:{color:i.color||e.color}},data:t}];return r.show?(t[0].type="effectScatter",t[0].rippleEffect={brushType:"stroke"}):t[0].type="scatter",t}},{key:"_createLineSeries",value:function(e,t,a){var i=e.lineSetting,e=e.animationSetting,i=[{name:"line-series",coordinateSystem:a,type:"lines",zlevel:1,effect:{show:e.show,constantSpeed:e.constantSpeed,trailLength:0,symbol:e.symbol,symbolSize:e.symbolSize},lineStyle:{normal:{color:i.color,type:i.type,width:i.width,opacity:i.opacity,curveness:i.curveness}},data:t}];return 1e3<=t.length&&(i[0].large=!0,i[0].largeThreshold=100,i[0].blendMode="lighter"),i}},{key:"_getLayerFeaturesSucceeded",value:function(e,t){switch(e.type){case"feature":this._initOverlayLayer(t,e.features);break;case"restMap":t.layerType="restMap",this._initOverlayLayer(t,e.restMaps);break;case"mvt":t.layerType="mvt",this._initOverlayLayer(t,e);break;case"dataflow":case"noServerId":this._initOverlayLayer(t)}}}])&&E(e.prototype,t),a&&E(e,a),Object.defineProperty(e,"prototype",{writable:!1}),n}(),A=a("p5/s");function K(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function F(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(a){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=z(a);return function(e,t){{if(t&&("object"===N(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,i?(e=z(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function z(e){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var U=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B(e,t)}(s,j);var e,t,a,o=R(s);function s(e){var t,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{style:{version:8,sources:{},layers:[]}},r=3<arguments.length?arguments[3]:void 0,n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:function(){return!0};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e,a,i))._cacheLayerId=[],t._layerTimerList=[],"string"==typeof e||"number"==typeof e?t.mapId=e:null!==e&&"object"===N(e)&&(t.webMapInfo=e),t.mapId||i.center||i.zoom||(i.center=[0,0],i.zoom=0),t.centerValid(i.center)&&(t.center=i.center),t.zoom=i.zoom,t.bounds=i.bounds,t.bearing=i.bearing,t.pitch=i.pitch,t.rasterTileSize=i.rasterTileSize||256,t.layerFilter=n,t.checkSameLayer=a.checkSameLayer,t._legendList={},r?(t.map=r,t._taskID=new Date,t.getMapInfo(t._taskID)):t._initWebMap(),t}return e=s,(t=[{key:"resize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.map&&this.map.resize(),this.echartsLayerResize();var t=window.getComputedStyle(document.getElementById(this.target));e&&this.map&&this.bounds&&t&&((t=this._getResizedZoom(this.bounds,t))!==this.map.getZoom()&&this.map&&this.map.setZoom(t))}},{key:"setCrs",value:function(e){this.map&&(this.mapOptions.crs=e,this.mapOptions.crs&&(e.epsgCode?(this.mapOptions.crs=new f.a.CRS(this.mapOptions.crs.epsgCode,this.mapOptions.crs.extent,this.mapOptions.crs.unit),this.map.setCRS(this.mapOptions.crs)):this.map.setCRS(f.a.CRS.get(e))))}},{key:"setCenter",value:function(e){var t,a;this.map&&this.centerValid(e)&&(this.mapOptions.center=e,t=(a=this.map.getCenter()).lng,a=a.lat,e[0]===+t.toFixed(4)&&e[1]===+a.toFixed(4)||this.map.setCenter(e,{from:"setCenter"}))}},{key:"setRenderWorldCopies",value:function(e){this.map&&(this.mapOptions.renderWorldCopies=e)&&this.map.setRenderWorldCopies(e)}},{key:"setBearing",value:function(e){this.map&&(this.mapOptions.bearing=e)!==+this.map.getBearing().toFixed(2)&&(!e&&0!==e||this.map.setBearing(e))}},{key:"setPitch",value:function(e){this.map&&(this.mapOptions.pitch=e)!==+this.map.getPitch().toFixed(2)&&(!e&&0!==e||this.map.setPitch(e))}},{key:"setStyle",value:function(e){this.map&&(this.mapOptions.style=e)&&this.map.setStyle(e)}},{key:"setRasterTileSize",value:function(t){var a,i=this;this.map&&(t<=0||(a=this.map.getStyle().sources,Object.keys(a).forEach(function(e){"raster"===a[e].type&&"iserver"===a[e].rasterSource&&i._updateRasterSource(e,{tileSize:t})})))}},{key:"cleanLayers",value:function(){var t=this;this._taskID=null,this._cacheLayerId.forEach(function(e){t.map&&t.map.getLayer(e)&&t.map.removeLayer(e)}),this._cacheLayerId.forEach(function(e){t.map&&t.map.getSource(e)&&t.map.removeSource(e)}),this._cacheLayerId=[]}},{key:"getSourceListModel",get:function(){return this._sourceListModel}},{key:"_initWebMap",value:function(){this.initWebMap()}},{key:"_loadLayers",value:function(e,t){var a=this;this.map?this.map.getCRS().epsgCode===this.baseProjection||this.ignoreBaseProjection?this._handleLayerInfo(e,t):this.triggerEvent("projectionIsNotMatch",{}):(this._createMap(e),this.map.on("load",function(){a._handleLayerInfo(e,t)}))}},{key:"_getMapInfo",value:function(t,a){var i=this,r=t.projection;if(this.baseProjection=Object(T.c)(r),f.a.CRS.get(this.baseProjection))this._defineProj4(r),this._loadLayers(t,a);else{if(!t.baseLayer||"TILE"!==t.baseLayer.layerType)throw Error(Object(n.b)().t("webmap.crsNotSupport"));this.getEpsgCodeWKT("".concat(t.baseLayer.url,"/prjCoordSys.wkt"),{withoutFormatSuffix:!0}).then(function(e){i._defineProj4(e,r);e=t.extent,e=new f.a.CRS(i.baseProjection,[e.leftBottom.x,e.leftBottom.y,e.rightTop.x,e.rightTop.y],180<e.rightTop.x?"meter":"degree");f.a.CRS.set(e),i._loadLayers(t,a)})}}},{key:"_handleLayerInfo",value:function(e,t){e=this._setLayerID(e),this._layers=[];var a=e,i=a.layers,r=a.baseLayer,a=a.grid;"function"==typeof this.layerFilter&&this.layerFilter(r)&&this._initBaseLayer(e),i&&0!==i.length?this._initOverlayLayers(i,t):this._sendMapToUser(0,0),a&&a.graticule&&this._initGraticuleLayer(a.graticule)}},{key:"_createMap",value:function(e){var i=this;if(!e)return this.mapOptions.container=this.target,this.mapOptions.crs&&this.mapOptions.crs.epsgCode&&(this.mapOptions.crs=new f.a.CRS(this.mapOptions.crs.epsgCode,this.mapOptions.crs.extent,this.mapOptions.crs.unit)),this.mapOptions.transformRequest||(this.mapOptions.transformRequest=function(e,t){var a="";return{url:(a="string"==typeof i.proxy?i.webMapService.handleProxy("Tile"===t?"image":"data"):a)?"".concat(a).concat(encodeURIComponent(e)):e,credentials:i.webMapService.handleWithCredentials(a,e,i.withCredentials||!1)?"include":"omit"}}),void setTimeout(function(){var e=0;Object.prototype.hasOwnProperty.call(i.mapOptions,"fadeDuration")&&(e=i.mapOptions.fadeDuration),i.map=new f.a.Map(Object.assign(Object.assign({},i.mapOptions),{fadeDuration:e,renderWorldCopies:!1})),i.map.on("load",function(){i.triggerEvent("addlayerssucceeded",{map:i.map,mapparams:{},layers:[]})})},0);var t=this._getLabelFontFamily(e),a=this._getMapCenter(e),r=e.level||0,n=this.mapOptions,o=n.bounds,s=n.minZoom,l=n.maxZoom,c=this.mapOptions.interactive;isNaN(s)&&(s=e.minScale?this._transformScaleToZoom(e.minScale,f.a.CRS.get(this.baseProjection)):0),isNaN(l)&&(l=e.maxScale?this._transformScaleToZoom(e.maxScale,f.a.CRS.get(this.baseProjection)):22),e.visibleExtent&&4===e.visibleExtent.length&&!o&&(o=[this._unproject([e.visibleExtent[0],e.visibleExtent[1]]),this._unproject([e.visibleExtent[2],e.visibleExtent[3]])]),l<s&&(s=(n=[l,s])[0],l=n[1]),o||(r+=e.minScale&&e.maxScale?Math.min(this._transformScaleToZoom(e.minScale,f.a.CRS.get(this.baseProjection)),this._transformScaleToZoom(e.maxScale,f.a.CRS.get(this.baseProjection))):+Math.log2(this._getResolution(f.a.CRS.get(this.baseProjection).getExtent())/this._getResolution(e.extent)).toFixed(2)),this.map=new f.a.Map(Object.assign(Object.assign({},this.mapOptions),{container:this.target,center:this.center||a,zoom:this.zoom||r,minZoom:s,maxZoom:l,bearing:this.bearing||0,pitch:this.pitch||0,bounds:o,interactive:void 0===c||c,style:{version:8,sources:{},layers:[]},crs:this.baseProjection,localIdeographFontFamily:t||"",renderWorldCopies:!1,transformRequest:function(e,t){if("Tile"!==t)return{url:e};i.isSuperMapOnline&&0===e.indexOf("http://")&&(e="https://www.supermapol.com/apps/viewer/getUrlResource.png?url=".concat(encodeURIComponent(e))),i.webMapService.isIportalResourceUrl(e)&&(e=i.webMapService.handleParentRes(e));t=i.webMapService.handleProxy("image");return{url:e,credentials:i.webMapService.handleWithCredentials(t,e,!1)?"include":"omit"}},fadeDuration:0})),this.triggerEvent("mapinitialized",{map:this.map})}},{key:"_createMVTBaseLayer",value:function(e){e=e.dataSource.url;-1<e.indexOf("/restjsr/")&&!/\/style\.json$/.test(e)&&(e+="/style.json"),this.map.addStyle(e)}},{key:"_initBaseLayer",value:function(e){var t,a=e.baseLayer||e,i=this.getBaseLayerType(a),r=this.getMapurls();switch(this.baseLayerProxy=this.webMapService.handleProxy("image"),i){case"TIANDITU":this.baseLayerProxy=null,this._createTiandituLayer(e);break;case"BING":this.baseLayerProxy=null,this._createBingLayer(a.layerID||a.name,a);break;case"WMS":this._createWMSLayer(a);break;case"WMTS":this._createWMTSLayer(a);break;case"TILE":this._createDynamicTiledLayer(a);break;case"CLOUD":case"XYZ":t=r[a.layerType],this._createXYZLayer(a,t);break;case"BAIDU":this.triggerEvent("notsupportbaidumap",{});break;case"MAPBOXSTYLE":this._createMVTBaseLayer(a)}}},{key:"_initOverlayLayers",value:function(e,r){var n=this;"function"==typeof this.layerFilter&&(e=e.filter(this.layerFilter)),this._layers=e,this.layerAdded=0,this.expectLayerLen=e.length,0<this.expectLayerLen&&e.forEach(function(e){var t,a,i=n.webMapService.getDatasourceType(e);if("SAMPLE_DATA"===i)return n._addLayerSucceeded(),void n.triggerEvent("getlayerdatasourcefailed",{error:"SAMPLE DATA is not supported",layer:e,map:n.map});e.visibleScale&&(t=(a=e.visibleScale).minScale,a=a.maxScale,e.minzoom=Math.max(n._transformScaleToZoom(t),0),e.maxzoom=Math.min(24,n._transformScaleToZoom(a)+1e-7)),"tile"===i?(n._initBaseLayer(e),n._addLayerSucceeded(),e.autoUpdateTime&&n._layerTimerList.push(setInterval(function(){n._initBaseLayer(e)},e.autoUpdateTime))):(n.getLayerFeatures(e,r,i),e.autoUpdateTime&&n._layerTimerList.push(setInterval(function(){n.getLayerFeatures(e,r,i)},e.autoUpdateTime)))},this)}},{key:"_initOverlayLayer",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],a=2<arguments.length?arguments[2]:void 0,i=e.layerID,r=e.layerType,n=e.visible,o=e.style,s=e.featureType,l=e.labelStyle,c=e.projection;e.visible=n?"visible":"none",t=this.mergeFeatures(i,t,a),"restMap"!==r?"mvt"!==r?((t=t&&t[0]&&t[0].geometry&&"Polygon"===t[0].geometry.type?Object(u.a)(t):t)&&c&&(c!==this.baseProjection||"EPSG:3857"===c||"EPSG:-1000"===c)&&e.dataSource&&"REST_DATA"!==e.dataSource.type&&(this._unprojectProjection=this._defineProj4(c),t=this.transformFeatures(t)),t=this.handleLayerFeatures(t,e),"VECTOR"===r?"POINT"===s?"SYMBOL_POINT"===o.type?this._createSymbolLayer(e,t):this._createGraphicLayer(e,t):(this._createVectorLayer(e,t),this._addLayerSucceeded()):"UNIQUE"===r?this._createUniqueLayer(e,t):"RANGE"===r?this._createRangeLayer(e,t):"HEAT"===r?this._createHeatLayer(e,t):"MARKER"===r?this._createMarkerLayer(e,t):"MIGRATION"===r?this._createMigrationLayer(e,t):"RANK_SYMBOL"===r?this._createRankSymbolLayer(e,t):"DATAFLOW_POINT_TRACK"!==r&&"DATAFLOW_HEAT"!==r||this._createDataflowLayer(e),l&&l.labelField&&"DATAFLOW_POINT_TRACK"!==r&&this._addLabelLayer(e,t,!1)):this._createMvtLayer(t.info,e,t.featureType):this._createRestMapLayer(t,e)}},{key:"_initGraticuleLayer",value:function(e){var t=this._createGraticuleOptions(e),t=new f.a.supermap.GraticuleLayer(t);this.map.addLayer(t),this._setGraticuleDash(e.lineDash,t)}},{key:"_createGraticuleOptions",value:function(e){var t=e.extent,a=e.lonLabelStyle,i=e.latLabelStyle,r=e.strokeColor,n=e.lineDash,o=e.strokeWidth,e=e.interval,o={lineColor:r,lindDasharray:n,lineWidth:o},a={textFont:a.fontFamily.split(","),textSize:a.fontSize,textAnchor:i.textBaseline,textColor:a.fill,textHaloColor:a.outlineColor,textHaloWidth:a.outlineWidth},i={textFont:i.fontFamily.split(","),textSize:i.fontSize,textAnchor:i.textBaseline,textColor:i.fill,textHaloColor:i.outlineColor,textHaloWidth:i.outlineWidth},t=t||this.map.getCRS().extent;return{minZoom:1,strokeStyle:o,extent:[this._unproject([t[0],t[1]]),this._unproject([t[2],t[3]])],interval:e&&e[0],lngLabelStyle:a,latLabelStyle:i}}},{key:"_setGraticuleDash",value:function(e,t){var a=this;this.map.on("zoomend",function(){a.map.getZoom()<3?t.setStrokeStyle({lindDasharray:[.1,3]}):t.setStrokeStyle({lindDasharray:e})})}},{key:"_createTiandituLayer",value:function(e){var t=this._getTiandituUrl(e),a=e.baseLayer,i=a.labelLayerVisible,r=a.name,e=a.visible,a=Boolean(i),i=t.labelUrl,t=t.tiandituUrl;this._addBaselayer(t,r,e),a&&this._addBaselayer(i,"".concat(r,"-label"),e)}},{key:"_createWMTSLayer",value:function(i){var r=this;this.webMapService.getWmtsInfo(i,this.map.getCRS().epsgCode).then(function(e){var t,a=i.layerID||i.name;e.isMatched&&(t=r._getWMTSUrl(Object.assign({},i,e)),r._addBaselayer([t],a,i.visible,0,e.matchMaxZoom,!1,e.bounds))},function(e){throw new Error(e)}).catch(function(e){r.triggerEvent("getmapinfofailed",{error:e})})}},{key:"_createBingLayer",value:function(e,t){this._addBaselayer(["https://dynamic.t0.tiles.ditu.live.com/comp/ch/{quadkey}?it=G,TW,L,LA&mkt=zh-cn&og=109&cstl=w4c&ur=CN&n=z"],e,t.visible)}},{key:"_createXYZLayer",value:function(e,t){var a=[];if("OSM"===e.layerType){for(var i=t.match(/\w\-\w/g)[0],r=i[0],n=i[2],o="",s=97;s<123;s++)o+=String.fromCharCode(s);for(var i=o.split(""),r=i.indexOf(r),n=i.indexOf(n),l=i.slice(r,n+1),c=0;c<l.length;c++){var u=t.replace(/{\w\-\w}/g,l[c]);a.push(u)}}else if("GOOGLE_CN"===e.layerType)for(var n=t.match(/\d\-\d/g)[0],h=parseInt(n[0]),p=parseInt(n[2]),d=h;d<=p;d++){var f=t.replace(/{\d\-\d}/g,d.toString());a.push(f)}else a=[t];h=e.layerID||e.name;this._addBaselayer(a,h,e.visible)}},{key:"_createDynamicTiledLayer",value:function(e){var t=e.url,a=e.layerID||e.name,i=e.minzoom,r=e.maxzoom;this._addBaselayer([t],a,e.visible,i,r,!0)}},{key:"_createWMSLayer",value:function(a){var i=this;this.webMapService.getWmsInfo(a).then(function(e){var t=a.layerID||a.name;e&&(e=i._getWMSUrl(a,e.version),i._addBaselayer([e],t,a.visible))},function(e){throw new Error(e)}).catch(function(e){i.triggerEvent("getmapinfofailed",{error:e})})}},{key:"_createVectorLayer",value:function(e,t){var a=this,i=e.featureType,r=e.layerID,n=e.minzoom,o=e.maxzoom,s=e.style,l=e.visible,e=this.map.getSource(r),t={type:"FeatureCollection",features:t};e?e.setData(t):this.map.addSource(r,{type:"geojson",data:t});t=Array.isArray(s)?s:[s];2===t.length&&("solid"===t[0].lineDash&&"solid"===t[1].lineDash&&(t[0].strokeWidth=t[1].strokeWidth,t[1].strokeWidth=t[1].strokeWidth-2),"solid"===t[0].lineDash&&"dash"===t[1].lineDash&&(t[0].strokeWidth=t[1].strokeWidth,t[1].strokeWidth=.5*t[1].strokeWidth,t[1].lineDash="dashrailway")),t.forEach(function(e,t){e={style:a._transformStyleToMapBoxGl(e,i),layout:{visibility:l}},t=0===t?r:"".concat(r,"-additional-").concat(t);a._addOverlayToMap(i,r,t,e,n,o)}),"POLYGON"===i&&s.strokeColor&&this._addStrokeLineForPoly(s,r,r+"-strokeLine",l,n,o)}},{key:"_getWMSUrl",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"1.1.1",a=(a=e.url).split("?")[0],e={service:"WMS",request:"GetMap",layers:null!==e.layers&&"object"===N(e.layers)?e.layers.join(","):e.layers||"0",styles:"",format:"image/png",transparent:"true",version:t,width:256,height:256};return"1.3.0"===t?e.crs=this.baseProjection:e.srs=this.baseProjection,a+="".concat(this._getParamString(e,a),"&bbox={bbox-epsg-3857}")}},{key:"_setLayerID",value:function(e){var r=this,n={},o=e.baseLayer,t=e.layers,a=void 0===t?[]:t;this.checkSameLayer||(t=this._generateUniqueLayerId(o.name,0),o.name=t.newId);var s=a.map(function(e){return e.name}),a=a.map(function(e,t){e.name in n||(n[e.name]=o.name===e.name?1:0);var a=s.indexOf(e.name),i=s.lastIndexOf(e.name);a<t&&t<=i&&(n[e.name]=n[e.name]+1);a=n[e.name]?"".concat(e.name,"-").concat(n[e.name]):e.name;return r.checkSameLayer&&"raster"===e.layerType||(i=(t=r._generateUniqueLayerId(a,n[e.name])).newId,t=t.newIndex,n[e.name]=t,a=i),Object.assign(e,{layerID:a})});return e.layers=a,e.baseLayer=o,e}},{key:"_generateUniqueLayerId",value:function(e,t){return this.map.getLayer(e)?(t++,e=e.match(/-\d+&/gi)?e.replace(/\d+$/gi,t):"".concat(e,"-").concat(t),this._generateUniqueLayerId(e,t)):{newId:e,newIndex:t}}},{key:"_getResizedZoom",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:512,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:360,r=t.width,n=t.height,t=Math.abs(e.getEast()-e.getWest()),e=Math.abs(this._getBoundsRadian(e.getSouth())-this._getBoundsRadian(e.getNorth())),r=+Math.log2(i/(t/parseInt(r)*a)).toFixed(2),a=+Math.log2(i/(e/parseInt(n)*a)).toFixed(2);return r<=a?r:a}},{key:"_getBoundsRadian",value:function(e){return 180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360))}},{key:"_createRestMapLayer",value:function(e,t){var a=this;e.forEach(function(e){t=a.getRestMapLayerInfo(e,t),a._initBaseLayer(t)}),this._addLayerSucceeded()}},{key:"_addLayerSucceeded",value:function(){this.layerAdded++,this._sendMapToUser(this.layerAdded,this.expectLayerLen)}},{key:"_createDataflowLayer",value:function(e){var t=new f.a.supermap.DataFlowService(e.wsUrl).initSubscribe();this._handleDataflowFeaturesCallback=this._handleDataflowFeatures.bind(this,e),this._initDataflowLayerCallback=this._initDataflowLayer.bind(this,e),t.on("subscribesucceeded",this._initDataflowLayerCallback),t.on("messageSucceeded",this._handleDataflowFeaturesCallback),this._dataflowService=t}},{key:"_initDataflowLayer",value:function(){this._addLayerSucceeded()}},{key:"_handleDataflowFeatures",value:function(e,t){var a=[JSON.parse(t.data)];this.triggerEvent("dataflowfeatureupdated",{features:a,identifyField:e.identifyField,layerID:e.layerID}),"EPSG:3857"===e.projection&&(a=this.transformFeatures(a)),e.filterCondition?(t=this.replaceFilterCharacter(e.filterCondition),(t=window.jsonsql.query("select * from json where ("+t+")",{attributes:a[0].properties}))&&0<t.length&&this._addDataflowLayer(e,a[0])):this._addDataflowLayer(e,a[0])}},{key:"_getDataFlowRotateStyle",value:function(e,a,i){var r=["match",["get",i]];return e.forEach(function(e){var t=void 0!==a&&"未设置"!==a&&"None"!==a?e.properties[a]:0;if(360<t||t<0)return null;r.push(e.properties[i],parseInt(t))}),r.push(0),r}},{key:"_addDataflowLayer",value:function(e,t){var a,i,r=e.layerID;"DATAFLOW_HEAT"===e.layerType?this.map.getSource(r)?this._updateDataFlowFeature(r,t,e):this._createHeatLayer(e,[t],!1):(a=e.pointStyle,e.style=a,this.map.getSource(r)?this._updateDataFlowFeature(r,t,e,"point"):(i=this._getDataFlowRotateStyle([t],e.directionField,e.identifyField),-1!==["BASIC_POINT","SVG_POINT","IMAGE_POINT"].indexOf(a.type)?this._createGraphicLayer(e,[t],null,i,!1):this._createSymbolLayer(e,[t],null,i,!1)),e.labelStyle&&e.visible&&(this.map.getSource(r+"-label")?this._updateDataFlowFeature(r+"-label",t,e):this._addLabelLayer(e,[t],!0)),e.lineStyle&&e.visible&&(this.map.getSource(r+"-line")?this._updateDataFlowFeature(r+"-line",t,e,"line"):(i=t.geometry.coordinates,i={type:"Feature",properties:t.properties,geometry:{type:"LineString",coordinates:[i]}},this._createVectorLayer({style:e.lineStyle,featureType:"LINE",visible:"visible",layerID:r+"-line"},[i]))))}},{key:"_updateDataFlowFeature",value:function(e,a,t,i){var r=t.identifyField,n=t.maxPointCount,o=t.directionField,s=h()(this.map.getSource(e)._data.features),l=!1;s.map(function(e,t){e.properties[r]===a.properties[r]&&(l=!0,"line"===i?((e=e.geometry.coordinates).push(a.geometry.coordinates),n&&e.length>n&&e.splice(0,e.length-n),s[t].geometry.coordinates=e):s[t]=a)}),l||("line"===i?s.push({type:"Feature",properties:a.properties,geometry:{type:"LineString",coordinates:[a.geometry.coordinates]}}):s.push(a)),this.map.getSource(e).setData({type:"FeatureCollection",features:s}),"point"===i&&(t=t.pointStyle.type,o=this._getDataFlowRotateStyle(s,o,r),-1!==["SVG_POINT","IMAGE_POINT"].indexOf(t)?this.map.setLayoutProperty(e,"icon-rotate",o):"SYMBOL_POINT"===t&&this.map.setLayoutProperty(e,"text-rotate",o))}},{key:"_createMigrationLayer",value:function(e,t){window.echarts=i.a;e=this.getEchartsLayerOptions(e,t,"GLMap");e.GLMap={roam:!0};t=new r.a(this.map);t.chart.setOption(e),this.echartslayer.push(t),this._addLayerSucceeded()}},{key:"_createRankSymbolLayer",value:function(e,t){var a=e.minzoom,i=e.maxzoom,r=e.themeSetting.themeField,n=e.themeSetting.colors,o=e.style,s=e.featureType,l=this.createRankStyleSource(e,t).styleGroups;t=this.getFilterFeatures(e.filterCondition,t);for(var c,u=["match",["get","index"]],h=["match",["get","index"]],p=0;p<t.length;p++){var d=t[p],f=parseFloat(d.properties[r]);if(l)for(var m=0;m<l.length;m++)if(l[m].start<=f&&f<l[m].end){var y="SYMBOL_POINT"===o.type||"IMAGE_POINT"===o.type?"SYMBOL_POINT"===o.type?2*l[m].radius:2*Number.parseFloat((l[m].radius/o.imageInfo.size.h).toFixed(2)):l[m].radius;u.push(d.properties.index,y),h.push(d.properties.index,l[m].color);break}}u.push(1),h.push("rgba(0, 0, 0, 0)"),this._initLegendConfigInfo(e,l),n&&0<n.length&&(o.fillColor=h),"SYMBOL_POINT"===o.type?this._createSymbolLayer(e,t,u):"IMAGE_POINT"===o.type?this._createGraphicLayer(e,t,u):(c={type:"geojson",data:{type:"FeatureCollection",features:t}},(n={layout:{visibility:e.visible}}).style=this._transformStyleToMapBoxGl(e.style,s,u,"circle-radius"),e=e.layerID,this._addOverlayToMap(s,c,e,n,a,i),this._addLayerSucceeded())}},{key:"_addLabelLayer",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=e.labelStyle,r=i.backgroundFill,n=i.fontFamily,o=e.minzoom,s=e.maxzoom,l=parseFloat(i.fontSize||14),r="rgba(".concat(r.join(","),")"),c="rgba(255,255,255,0)";i.outlineColor&&0<i.outlineWidth?c=i.outlineColor:"line"!==i.placement&&(c=r||"rgba(255,255,255,1)");var u=(i.outlineWidth||0)/2;0===u&&"line"!==i.placement&&r&&(u=4);var h=i.textAlign||"center";i.textBaseline&&"middle"!==i.textBaseline&&(h="".concat(i.textBaseline).concat("center"===h?"":"-".concat(h)));r="POINT"===e.featureType?[i.offsetX/l||0,i.offsetY/l||0]:[0,0];this._addLayer({id:"".concat(e.layerID,"-label"),type:"symbol",source:this.map.getSource(e.layerID)&&!a?e.layerID:{type:"geojson",data:{type:"FeatureCollection",features:t}},paint:{"text-color":i.fill,"text-halo-color":c,"text-halo-width":u},layout:{"text-field":"{".concat(i.labelField,"}"),"text-size":l,"text-offset":r,"text-font":n?[n]:["DIN Offc Pro Italic","Arial Unicode MS Regular"],"symbol-placement":"line"===i.placement?"POLYGON"===e.featureType?"line":"line-center":"point","text-max-angle":"POLYGON"===e.featureType?40:30,"symbol-spacing":"POLYGON"===e.featureType?200:50,"text-anchor":h,"text-line-height":1.2,visibility:e.visible},minzoom:o||0,maxzoom:s||22})}},{key:"_createSymbolLayer",value:function(e,t,a,i){var r=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],n=5<arguments.length?arguments[5]:void 0;document.getElementById("".concat(this.target)).classList.add("supermapol-icons-map");var o=e.layerID,s=e.minzoom,l=e.maxzoom,c=e.style,u=c.unicode,h=String.fromCharCode(parseInt(u.replace(/^&#x/,""),16)),u=a||(Array.isArray(c.fontSize)?c.fontSize:c.fontSize&&parseFloat(c.fontSize)||12),a=Array.isArray(c.rotation)?c.rotation:180*(c.rotation||0)/Math.PI;this.map.getSource(o)||this.map.addSource(o,{type:"geojson",data:{type:"FeatureCollection",features:[]}});l={id:o,type:"symbol",source:o,paint:{"text-color":Array.isArray(c.fillColor)?c.fillColor:Object(Y.c)(c.fillColor,c.fillOpacity),"text-halo-color":Array.isArray(c.strokeColor)?c.strokeColor:Object(Y.c)(c.strokeColor||"rgba(0,0,0,0)",c.strokeOpacity),"text-halo-width":c.strokeWidth||0},layout:{"text-field":h,"text-size":u,"text-font":["DIN Offc Pro Italic","Arial Unicode MS Regular"],"text-rotate":i||a||0,"text-offset":Array.isArray(c.offsetX)?c.offsetX:[c.offsetX/2||0,c.offsetY/2||0],"text-allow-overlap":!0,visibility:e.visible},minzoom:s||0,maxzoom:l||22};n&&(l.filter=n),this._addLayer(l),this.map.getSource(o).setData({type:"FeatureCollection",features:t}),r&&this._addLayerSucceeded()}},{key:"_createGraphicLayer",value:function(i,e,r,n){var o=this,s=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],l=5<arguments.length?arguments[5]:void 0,c=i.layerID,u=i.minzoom,h=i.maxzoom,p=i.style,e={type:"geojson",data:{type:"FeatureCollection",features:e}};this.map.getSource(c)||this.map.addSource(c,e);var d,t,a="imageIcon-".concat(c);"IMAGE_POINT"===p.type?(t=p.imageInfo,this.map.loadImage(t.url,function(e,t){e?console.error(e):(e=2*Number.parseFloat((p.radius/t.width).toFixed(2)),o.map.hasImage(a)||o.map.addImage(a,t),t={id:c,type:"symbol",source:c,layout:{"icon-image":a,"icon-anchor":"bottom-right","icon-size":r||e,"icon-allow-overlap":!0,visibility:i.visible,"icon-offset":[p.offsetX*t.width||0,p.offsetY*t.height||0],"icon-rotate":n||180*(i.style.rotation||0)/Math.PI},minzoom:u||0,maxzoom:h||22},l&&(t.filter=l),o._addLayer(t),s&&o._addLayerSucceeded())})):"SVG_POINT"===p.type?(d=p.url,this._svgDiv||(this._svgDiv=document.createElement("div"),document.body.appendChild(this._svgDiv)),this.getCanvasFromSVG(d,this._svgDiv,function(a){var e=a.toDataURL("img/png");e&&o.map.loadImage(e,function(e,t){e&&console.log(e);e=2*Number.parseFloat((p.radius/a.width).toFixed(2));o.map.hasImage(d)||o.map.addImage(d,t,{sdf:!0});e={id:c,type:"symbol",source:c,layout:{"icon-image":d,"icon-size":r||e,"icon-anchor":"bottom-right",visibility:i.visible,"icon-offset":[p.offsetX*a.width||0,p.offsetY*a.height||0],"icon-allow-overlap":!0,"icon-rotate":n||180*(i.style.rotation||0)/Math.PI},paint:{"icon-color":p.fillColor},minzoom:u||0,maxzoom:h||22};l&&(e.filter=l),o._addLayer(e),s&&o._addLayerSucceeded()})})):(t={style:this._transformStyleToMapBoxGl(p,i.featureType),layout:{visibility:i.visible}},this._addOverlayToMap("POINT",c,c,t,u,h),s&&this._addLayerSucceeded())}},{key:"_createUniqueLayer",value:function(d,e){var f=this,n={unicode:function(e){e=e.unicode;return String.fromCharCode(parseInt(e.replace(/^&#x/,""),16))},fontSize:function(e){e=e.fontSize;return e?parseFloat(e):12},rotation:function(e){return 180*(e.rotation||0)/Math.PI},fillColor:function(e){var t=e.fillColor,e=e.fillOpacity;return Object(Y.c)(t,e)},strokeColor:function(e){var t=e.strokeColor,e=e.strokeOpacity;return Object(Y.c)(t||"rgba(0,0,0,0)",e)},strokeWidth:function(e){return e.strokeWidth||0},offsetX:function(e){return[e.offsetX/2||0,e.offsetY/2||0]}},t={unicode:"",fontSize:12,rotation:0,strokeColor:"rgba(0,0,0,0)",fillColor:"rgba(0,0,0,0)",strokeWidth:0,offsetX:[0,0]},a=this.getUniqueStyleGroup(d,e);e=this.getFilterFeatures(d.filterCondition,e);var i,r,o,s,m=d.layerID,y=d.minzoom,g=d.maxzoom,l=d.style,c=a[0].themeField,u=d.featureType,h=d.style,v={},p={};for(i in a.forEach(function(e){p[e.value]=e}),e.forEach(function(e){var t=e.properties,e=p[t[c]];if(e){var a,i,r=e.style;for(a in r)!Object.prototype.hasOwnProperty.call(r,a)||(i=r[a])!==h[a]&&(v[a]||(v[a]=["match",["get","index"]]),v[a].push(t.index,n[a]?n[a](r):i))}}),v)Object.prototype.hasOwnProperty.call(v,i)&&(r=v[i],o=h[i]||t[i],s=n[i],r.push(void 0===o?null:s&&s(K({},i,o))||o));this._initLegendConfigInfo(d,a);var b=m;this.map.addSource(b,{type:"geojson",data:{type:"FeatureCollection",features:e}});function x(e,t,a,i,r,n,o){i={style:f._transformStyleToMapBoxGl(Object.assign({},i),e),layout:{visibility:w}},f._addOverlayToMap(e,t,a,i,r,n,o)}var w=d.visible;if(-1!==["POLYGON","LINE"].indexOf(u)){var S=v.lineDash,P=["all"],_=!1,C="";if(S&&1<S.length){delete v.lineDash;for(var T=S[1],k="POLYGON"===u?m+"-strokeLine":m,M=2;M<S.length-1;M+=2){var E=["==",T,S[M]];P.push(["!=",T,S[M]]);var O="".concat(k,"-additional-linedasharray-").concat(M/2),C=C||O;x("LINE",b,O,Object.assign(Object.assign(Object.assign({},l),v),{lineDash:S[M+1]}),y,g,E)}1<P.length&&x("LINE",b,k,Object.assign(Object.assign(Object.assign({},l),v),{lineDash:S[S.length]}),y,g,P),_=!0}"LINE"!==u||_||x("LINE",b,m,Object.assign(Object.assign({},l),v),y,g,P),"POLYGON"===u&&(x("POLYGON",b,m,Object.assign(Object.assign({},l),v),y,g),C&&this.map.moveLayer(m,C),_||(x("LINE",b,m+"-strokeLine",Object.assign(Object.assign({},l),v),y,g,P),C&&this.map.moveLayer(m+"-strokeLine",C)))}else{var I=["all"],a=v.unicode;if(a){var L=v.className||[];delete v.unicode,delete v.classname;for(var u="".concat(m,"-additional-symbol"),D=["any"],j=2;j<L.length-1;j+=2)I.push(["!=",L[1],L[j]]),D.push(["==",L[1],L[j]]);document.getElementById("".concat(this.target)).classList.add("supermapol-icons-map");_=Object.assign(Object.assign({},l),v),_={id:u,type:"symbol",source:b,paint:{"text-color":_.fillColor,"text-halo-color":_.strokeColor,"text-halo-width":_.strokeWidth},layout:{"text-field":a,"text-size":"string"==typeof _.fontSize?parseInt(_.fontSize):_.fontSize||12,"text-font":["DIN Offc Pro Italic","Arial Unicode MS Regular"],"text-rotate":_.rotation||0,"text-offset":Array.isArray(_.offsetX)?_.offsetX:[_.offsetX/2||0,_.offsetY/2||0],"text-allow-overlap":!0,visibility:w},minzoom:y||0,maxzoom:g||22};1<D.length&&(_.filter=D),this._addLayer(_)}var A,N=v.imageInfo||[],F=v.url||[];if(0<N.length||0<F.length){delete v.imageInfo,delete v.url;for(var B=[],R=0<N.length?[N[0],N[1]]:[],z=0<F.length?[F[0],F[1]]:[],U=["any"],V=["any"],G=2;G<N.length-1;G+=2){var W=N[G+1];B.push(W.url),R.push(N[G]),R.push(W.url),I.push(["!=",N[1],N[G]]),U.push(["==",N[1],N[G]])}for(var $=2;$<F.length-1;$+=2){var q=F[$+1];B.push(q),z.push(F[$]),z.push(q),I.push(["!=",F[1],F[$]]),V.push(["==",F[1],F[$]])}R.push(""),z.push("");var H=[];B.forEach(function(e){var i;H.push((i=e,new Promise(function(a){i.indexOf("svg")<0?f.map.loadImage(i,function(e,t){return e?(console.log(e),void a(e)):(f.map.hasImage(i)||f.map.addImage(i,t),void a({src:i,image:t}))}):(f._svgDiv||(f._svgDiv=document.createElement("div"),document.body.appendChild(f._svgDiv)),f.getCanvasFromSVG(i,f._svgDiv,function(e){f.handleSvgColor(h,e),f.map.loadImage(e.toDataURL("img/png"),function(e,t){return e?(console.log(e),void a(e)):(f.map.hasImage(i)||f.map.addImage(i,t,{sdf:!0}),void a({src:i,image:t}))})}))})))});var X=Object.assign(Object.assign({},l),v);Promise.all(H).then(function(e){for(var t={},a={},i=v.radius||[],r=2;r<i.length-1;r+=2)a[i[r]]=i[r+1];if(e.forEach(function(e){e&&e.src&&(t[e.src]=e.image.width)}),1<R.length){for(var n=["match",["get","index"]],o=2;o<R.length-1;o+=2){var s=R[o],l=R[o+1],l=2*Number.parseFloat(((a[s]||8)/t[l]).toFixed(2));n.push(s),n.push(l)}n.push(1),f._addLayer({id:"".concat(m,"-additional-image"),type:"symbol",source:b,layout:{"icon-image":R,"icon-anchor":"bottom-right","icon-size":n,"icon-allow-overlap":!0,visibility:d.visible,"icon-offset":X.offsetX||[0,0],"icon-rotate":X.rotation||0},minzoom:y||0,maxzoom:g||22,filter:U})}if(1<z.length){for(var c=["match",["get","index"]],u=2;u<z.length-1;u+=2){var h=z[u],p=z[u+1],p=2*Number.parseFloat(((a[h]||8)/t[p]).toFixed(2));c.push(h),c.push(p)}c.push(1),f._addLayer({id:"".concat(m,"-additional-svg"),type:"symbol",source:b,layout:{"icon-image":z,"icon-anchor":"bottom-right","icon-size":1,"icon-allow-overlap":!0,visibility:d.visible,"icon-offset":X.offsetX||[0,0],"icon-rotate":X.rotation||0},paint:{"icon-color":X.fillColor},minzoom:y||0,maxzoom:g||22,filter:V})}})}"SYMBOL_POINT"===l.type?((A=Object.assign({},d)).style=Object.assign(Object.assign(Object.assign({},l),v),{type:l.type}),this._createSymbolLayer(A,e,"","",!0,1<I.length?I:void 0)):"IMAGE_POINT"===l.type||"SVG_POINT"===l.type?((A=Object.assign({},d)).style=Object.assign(Object.assign(Object.assign({},l),v),{type:l.type}),this._createGraphicLayer(A,e,"","",!0,1<I.length?I:void 0)):x("POINT",b,m,Object.assign(Object.assign({},l),v),y,g,1<I.length?I:void 0)}this._addLayerSucceeded()}},{key:"_getWMTSUrl",value:function(e){if("REST"===e.requestEncoding&&e.restResourceURL)return e.restResourceURL.replace("{Style}",e.style||"").replace("{TileMatrixSet}",e.tileMatrixSet).replace("{TileRow}","{y}").replace("{TileCol}","{x}").replace("{TileMatrix}","{z}");var t={service:"WMTS",request:"GetTile",version:"1.0.0",style:e.style||"",layer:e.layer,tilematrixSet:e.tileMatrixSet,format:"image/png",tilematrix:"{z}",tilerow:"{y}",tilecol:"{x}"};return"".concat(e.kvpResourceUrl).concat(this._getParamString(t,e.kvpResourceUrl))}},{key:"_createMarkerLayer",value:function(l,c){var u=this,h=l.minzoom,p=l.maxzoom,i={};(c=c||[]).forEach(function(e,t){var a=e.dv_v5_markerStyle,e=e.geometry.type.toUpperCase(),t=(e="POINT"===e&&a.text?"TEXT":e)+"-"+t;"POINT"===e&&a.src&&-1===a.src.indexOf("http://")&&-1===a.src.indexOf("https://")&&(a.src=u.serverUrl+a.src),i[t]||(i[t]={src:a.src,defaultStyle:a})});var e,t=[];for(e in i)t.push(function(r,e){var n=e.src,t=e.defaultStyle;return new Promise(function(i){n&&n.indexOf("svg")<0&&(n.startsWith("http://")||n.startsWith("https://"))?u.map.loadImage(n,function(e,t){return e?(console.log(e),void i(e)):(u.map.hasImage(n)||u.map.addImage(n,t),void i(K({},r,n)))}):(u._svgDiv||(u._svgDiv=document.createElement("div"),document.body.appendChild(u._svgDiv)),u.getCanvasFromSVG(n,u._svgDiv,function(e){u.handleSvgColor(t,e);var a=e.toDataURL("img/png");u.map.loadImage(a,function(e,t){if(e)return console.log(e),void i(e);e=n||a;u.map.hasImage(e)||u.map.addImage(e,t),i(K({},r,e))})}))})}(e,i[e]));Promise.all(t).then(function(e){for(var t=0;t<c.length;t++){var a=c[t],i=a.dv_v5_markerStyle,r=a.geometry.type.toUpperCase();"POINT"===r&&i.text&&(r="TEXT");var n=u.setFeatureInfo(a);a.properties.useStyle=i,a.properties.featureInfo=n;var o={type:"geojson",data:a},s=r+"-"+t,n=e[t][s];"POINT"===r||"TEXT"===r?n&&u._addLayer({id:s,type:"symbol",source:o,layout:{"icon-image":n,"icon-size":i.scale||1,visibility:l.visible},minzoom:h||0,maxzoom:p||22}):(a={layout:{}},"LINESTRING"===r&&i.lineCap&&(r="LINE",a.layout={"line-cap":i.lineCap}),n=l.visible,a.layout.visibility=n,a.style=u._transformStyleToMapBoxGl(i,r),u._addOverlayToMap(r,o,s,a,h,p),"POLYGON"===r&&i.strokeColor&&u._addStrokeLineForPoly(i,s,s+"-strokeLine",n,h,p))}u._addLayerSucceeded()})}},{key:"_createHeatLayer",value:function(e,t){var a,i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],r=e.minzoom,n=e.maxzoom,o=e.themeSetting,s={gradient:o.colors.slice(),radius:parseInt(o.radius)},l=o.customSettings;for(a in l)s.gradient[a]=l[a];o.weight&&this._changeWeight(t,o.weight);var c=["interpolate",["linear"],["heatmap-density"]],u=[.1,.3,.5,.7,1];s.gradient.forEach(function(e,t){c.push(u[t]),0===t&&(e=f.a.supermap.Util.hexToRgba(e,0)),1===t&&(e=f.a.supermap.Util.hexToRgba(e,.5)),c.push(e)}),this._initLegendConfigInfo(e,s.gradient);var h,p,d={"heatmap-color":c,"heatmap-radius":3*o.radius,"heatmap-intensity":1.3};t[0].weight&&4<=t.length&&(h=[],t.forEach(function(e){h.push(e.weight)}),p=SuperMap.ArrayStatistic.getMax(h),o=SuperMap.ArrayStatistic.getMin(h),d["heatmap-weight"]=["interpolate",["linear"],["get","weight"],o,0,p,1]),this._addLayer({id:e.layerID,type:"heatmap",source:{type:"geojson",data:{type:"FeatureCollection",features:t}},paint:d,layout:{visibility:e.visible},minzoom:r||0,maxzoom:n||22}),i&&this._addLayerSucceeded()}},{key:"_changeWeight",value:function(e,a){this._fieldMaxValue={},this._getMaxValue(e,a);var i=this._fieldMaxValue[a];e.forEach(function(e){var t=e.properties[a];e.weight=t/i})}},{key:"_getMaxValue",value:function(e,t){var a,i=[],r=t;this._fieldMaxValue[r]||(e.forEach(function(e){(a=e.properties)&&parseFloat(a[r])&&i.push(parseFloat(a[r]))}),this._fieldMaxValue[r]=SuperMap.ArrayStatistic.getArrayStatistic(i,"Maximum"))}},{key:"_createRangeLayer",value:function(e,t){var i=e.themeSetting.themeField,a=e.featureType,r=e.minzoom,n=e.maxzoom,o=e.style,s=this.getRangeStyleGroup(e,t);t=this.getFilterFeatures(e.filterCondition,t);var l=["match",["get","index"]],c=t.filter(function(e){var t=parseFloat(e.properties[i]);if(!t&&0!==t)return!1;if(s)for(var a=0;a<s.length;a++)if(s[a].start<=t&&t<s[a].end){l.push(e.properties.index,s[a].color);break}return!0},this);l.push("rgba(0, 0, 0, 0)");var u={type:"geojson",data:{type:"FeatureCollection",features:c}};this._initLegendConfigInfo(e,s);t={layout:{}};"LINE"===a&&o.lineCap&&(t.layout={"line-cap":o.lineCap});c=e.visible;t.layout.visibility=c,t.style=this._transformStyleToMapBoxGl(o,a,l);e=e.layerID;this._addOverlayToMap(a,u,e,t,r,n),"POLYGON"===a&&o.strokeColor&&this._addStrokeLineForPoly(o,e,e+"-strokeLine",c,r,n),this._addLayerSucceeded()}},{key:"_sendMapToUser",value:function(e,t){var a=this;if(e===t){for(var i in this._sourceListModel=new c.a({map:this.map}),this._legendList)this._sourceListModel.addSourceStyle(i,this._legendList[i]);for(var r=this._layers.filter(function(e){return!!a.map.getLayer(e.layerID)}),n=r.length-1;-1<n;n--){var o=r[n].layerID,s=r[n+1]?r[n+1].layerID:void 0;this.map.moveLayer(o,s),this.map.getLayer("".concat(o,"-strokeLine"))&&this.map.moveLayer("".concat(o,"-strokeLine"),s);for(var l=1;l<this.expectLayerLen+1&&this.map.getLayer("".concat(o,"-additional-").concat(l));l++)this.map.moveLayer("".concat(o,"-additional-").concat(l),s);this.map.getLayer("".concat(o,"-label"))&&this.map.moveLayer("".concat(o,"-label"))}this.triggerEvent("addlayerssucceeded",{map:this.map,mapparams:this.mapParams,layers:this._layers})}}},{key:"_getParamString",value:function(e,t){var a,i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=[];for(a in e)r.push((i?a.toUpperCase():a)+"="+e[a]);return(t&&-1!==t.indexOf("?")?"&":"?")+r.join("&")}},{key:"_transformStyleToMapBoxGl",value:function(e,t,a,i){var r={};"POINT"!==e.type&&"BASIC_POINT"!==e.type&&"POINT"!==t||"LINE"===t?-1!==["LINE","LINESTRING","MULTILINESTRING"].indexOf(t)?r={strokeWidth:"line-width",strokeColor:"line-color",strokeOpacity:"line-opacity"}:-1!==["REGION","POLYGON","MULTIPOLYGON"].indexOf(t)&&(r={fillColor:"fill-color",fillOpacity:"fill-opacity"}):r={fillColor:"circle-color",strokeWidth:"circle-stroke-width",fillOpacity:"circle-opacity",radius:"circle-radius",strokeColor:"circle-stroke-color",strokeOpacity:"circle-stroke-opacity"};var n,o={};for(n in e)r[n]&&(o[r[n]]=e[n]);return a&&(i?o[i]=a:o["circle-color"]?o["circle-color"]=a:o["line-color"]?o["line-color"]=a:o["fill-color"]=a),e.lineDash&&!o["line-dasharray"]&&(Array.isArray(e.lineDash)?o["line-dasharray"]=e.lineDash:"solid"!==e.lineDash&&"LINE"===t&&(o["line-dasharray"]=this.getDashStyle(e.lineDash))),e.lineDash&&!o["circle-translate"]&&(Array.isArray(e.circleTranslate)?o["circle-translate"]=e.circleTranslate:"POINT"!==e.type&&"BASIC_POINT"!==e.type&&"POINT"!==t||(a=e.offsetX||0,t=e.offsetY||0,o["circle-translate"]=[a*e.radius,t*e.radius])),o}},{key:"_addOverlayToMap",value:function(e,t,a,i,r,n,o){e={POINT:"circle",LINE:"line",POLYGON:"fill"}[e];"circle"!==e&&"line"!==e&&"fill"!==e||(n={id:a,type:e,source:t,paint:i.style,layout:i.layout||{},minzoom:r||0,maxzoom:n||22},o&&(n.filter=o),this._addLayer(n))}},{key:"_addBaselayer",value:function(e,t){var a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:22,n=5<arguments.length&&void 0!==arguments[5]&&arguments[5],o=6<arguments.length?arguments[6]:void 0,e={type:"raster",tiles:e,tileSize:n?this.rasterTileSize:256,rasterSource:n?"iserver":"",prjCoordSys:n&&!this.isOnlineBaseLayer(e[0],this.baseProjection)&&0<+this.baseProjection.split(":")[1]?{epsgCode:this.baseProjection.split(":")[1]}:"",proxy:this.baseLayerProxy};o&&(e.bounds=o),this._addLayer({id:t,type:"raster",source:e,minzoom:i||0,maxzoom:r||22,layout:{visibility:a?"visible":"none"}}),this.baseLayerProxy=null}},{key:"_addStrokeLineForPoly",value:function(e,t,a,i,r,n){i={style:this._transformStyleToMapBoxGl(e,"LINE"),layout:{visibility:i}};this._addOverlayToMap("LINE",t,a,i,r,n)}},{key:"_initLegendConfigInfo",value:function(e,t){this._legendList[e.layerID]||(this._legendList[e.layerID]={layerType:e.layerType,featureType:e.featureType,layerId:e.layerID,themeField:"HEAT"===e.layerType?e.themeSetting.weight:e.themeSetting.themeField,styleGroup:t})}},{key:"_createMvtLayer",value:function(e,t,a){var i=this._getDataVectorTileStyle(a),r=this._transformStyleToMapBoxGl(i,a),n=e.url+"/tileFeature.mvt",o=f.a.CRS.get(this.baseProjection).getOrigin(),s=t.minzoom,a=t.maxzoom;n+="?&returnAttributes=true&width=512&height=512&x={x}&y={y}&scale={scale}&origin={x:".concat(o[0],",y:").concat(o[1],"}"),this._addLayer({id:t.layerID,type:i.mbglType,source:{type:"vector",tiles:[n],proxy:this.webMapService.handleProxy("image")},"source-layer":"".concat(e.datasetName,"@").concat(e.datasourceName),paint:r,layout:{visibility:t.visible?"visible":"none"},minzoom:s||0,maxzoom:a||22}),this._addLayerSucceeded()}},{key:"_getDataVectorTileStyle",value:function(e){var t={radius:8,fillColor:"#EE4D5A",fillOpacity:.9,strokeColor:"#ffffff",strokeWidth:1,strokeOpacity:1,lineDash:"solid",type:"BASIC_POINT",mbglType:"circle"};return-1!==["LINE","LINESTRING","MULTILINESTRING"].indexOf(e)?(t.strokeColor="#4CC8A3",t.strokeWidth=2,t.mbglType="line"):-1!==["REGION","POLYGON","MULTIPOLYGON"].indexOf(e)&&(t.fillColor="#826DBA",t.mbglType="fill"),t}},{key:"_unproject",value:function(e){var t=this._unprojectProjection||this.baseProjection;if("EPSG:4326"===t)return e;e=Object(A.a)(t,"EPSG:4326",e),t=A.a.defs(t);return t.axis&&0===t.axis.indexOf("ne")&&e.reverse(),e}},{key:"_getMapCenter",value:function(e){e=e.center&&[e.center.x,e.center.y];return e=this._unproject(e=e||[0,0]),e=new f.a.LngLat(e[0],e[1])}},{key:"_getLabelFontFamily",value:function(e){var t=[],e=e.layers;return e&&0<e.length&&e.forEach(function(e){e.labelStyle&&t.push(e.labelStyle.fontFamily)},this),t.push("'supermapol-icons'"),t.join(",")}},{key:"_getTiandituUrl",value:function(e){for(var t=/t0/gi,a={tiandituUrl:[],labelUrl:[]},i=e.baseLayer.layerType.split("_")[1].toLowerCase(),r=Boolean(e.baseLayer.labelLayerVisible),n=this.tiandituKey||e.baseLayer.tk,o="https://t0.tianditu.gov.cn/{layer}_{proj}/wmts?tk=".concat(n),s=o,e="EPSG:4326"===this.baseProjection?"c":"w",n={service:"WMTS",request:"GetTile",style:"default",version:"1.0.0",layer:i,tilematrixSet:e,format:"tiles",width:256,height:256},l=(o+=this._getParamString(n,o)+"&tilematrix={z}&tilerow={y}&tilecol={x}").replace("{layer}",i).replace("{proj}",e),c=[],u=0;u<8;u++)c.push(l.replace(t,"t".concat(u)));if(a.tiandituUrl=c,r){i={vec:"cva",ter:"cta",img:"cia"}[i];n.layer=i;for(var s=(s+=this._getParamString(n,s)+"&tilematrix={z}&tilerow={y}&tilecol={x}").replace("{layer}",i).replace("{proj}",e),h=[],p=0;p<8;p++)h.push(s.replace(t,"t".concat(p)));a.labelUrl=h}return a}},{key:"_defineProj4",value:function(e,t){var a=e;e.split(":")[1]||(a=t||Object(T.c)(e),i=e);var e=Object(T.a)(a),i=i||e;return i?(A.a.defs(a)||A.a.defs(a,i),e||Object(T.b)(a,i)):console.error("".concat(a," not define")),a}},{key:"getEpsgCodeWKT",value:function(e,t){if(e)return SuperMap.FetchRequest.get(e,null,t).then(function(e){return e.text()}).then(function(e){return e}).catch(function(e){console.log(e)})}},{key:"_addLayer",value:function(e){var t=e.id;if(this._cacheLayerId.push(t),e=Object.assign(e,{id:t}),this.map.getLayer(t))return this.checkSameLayer&&this._isSameRasterLayer(t,e)?void 0:void this._updateLayer(e);this.map.addLayer(e)}},{key:"_isSameRasterLayer",value:function(e,t){var a=t.source,t=a.type,a=a.tiles;if("raster"===t){e=this.map.getSource(e);if(t===e.type&&a&&e.tiles&&a[0]===e.tiles[0])return!0}return!1}},{key:"setLayersVisible",value:function(e,t){var a=this,i=e?"visible":"none";this._cacheLayerId.length&&this._cacheLayerId.forEach(function(e){(t&&-1===t.indexOf(e)||!t)&&a.map.setLayoutProperty(e,"visibility",i)})}},{key:"cleanWebMap",value:function(){this.map&&(this.triggerEvent("beforeremovemap",{}),this.map.remove(),this.map=null,this._legendList={},this._sourceListModel=null,this.center=null,this.zoom=null,this._layers=[],this._dataflowService&&this._dataflowService.off("messageSucceeded",this._handleDataflowFeaturesCallback)&&this._dataflowService.off("subscribesucceeded",this._initDataflowLayerCallback),this._unprojectProjection=null),this._layerTimerList.length&&(this._layerTimerList.forEach(function(e){clearInterval(e)}),this._layerTimerList=[])}},{key:"centerValid",value:function(e){return!(!e||!(0<e.length||N(e)===f.a.LngLat||e.lng))}},{key:"_getResolution",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:512;return e.leftBottom&&e.rightTop?Math.max(e.rightTop.x-e.leftBottom.x,e.rightTop.y-e.leftBottom.y)/t:Math.max(e[2]-e[0],e[3]-e[1])/t}},{key:"_transformScaleToZoom",value:function(e,t){var a=(t||this.map.getCRS()).getExtent(),t=(t||this.map.getCRS()).unit,t=1/SuperMap.Util.getScaleFromResolutionDpi((a[2]-a[0])/512,96,t),e=e.split(":")[1];return Math.min(24,+Math.log2(t/+e).toFixed(2))}},{key:"_updateLayer",value:function(e){var t=this,a=e.id,i=e.paint,r=e.source,n=r.type,o=r.tiles,s=r.data,e=r.proxy,r=this.map.getSource(a);r&&("geojson"===n?(Object.keys(i).forEach(function(e){t.map.setPaintProperty(a,e,i[e])}),r.setData(s)):"raster"===n&&this._updateRasterSource(a,{proxy:e,tiles:o}))}},{key:"_updateRasterSource",value:function(e,t){var a;e&&(a=this.map.getSource(e),Object.assign(a,t),this.map.style.sourceCaches[e].clearTiles(),this.map.style.sourceCaches[e].update(this.map.transform),this.map.triggerRepaint())}},{key:"updateOverlayLayer",value:function(e,t,a){t?this._initOverlayLayer(e,t,a):(a=this.webMapService.getDatasourceType(e),this.getLayerFeatures(e,this._taskID,a))}},{key:"isOnlineBaseLayer",value:function(e,t){return e.startsWith("https://maptiles.supermapol.com/iserver/services/map_China/rest/maps/China_Dark")&&"EPSG:3857"===t}}])&&F(e.prototype,t),a&&F(e,a),Object.defineProperty(e,"prototype",{writable:!1}),s}()},"9/5/":function(i,e,t){!function(e){function v(){return a.Date.now()}var r=NaN,n="[object Symbol]",o=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt,t="object"==typeof e&&e&&e.Object===Object&&e,e="object"==typeof self&&self&&self.Object===Object&&self,a=t||e||Function("return this")(),h=Object.prototype.toString,b=Math.max,x=Math.min;function w(e){var t=typeof e;return e&&("object"==t||"function"==t)}function S(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||!!(a=t)&&"object"==typeof a&&h.call(t)==n)return r;var t,a;if("string"!=typeof(e=w(e)?w(i="function"==typeof e.valueOf?e.valueOf():e)?i+"":i:e))return 0===e?e:+e;e=e.replace(o,"");var i=l.test(e);return i||c.test(e)?u(e.slice(2),i?2:8):s.test(e)?r:+e}i.exports=function(i,a,e){var r,n,o,s,l,c,u=0,h=!1,p=!1,t=!0;if("function"!=typeof i)throw new TypeError("Expected a function");function d(e){var t=r,a=n;return r=n=void 0,u=e,s=i.apply(a,t)}function f(e){var t=e-c;return void 0===c||a<=t||t<0||p&&o<=e-u}function m(){var e,t=v();if(f(t))return y(t);l=setTimeout(m,(t=a-((e=t)-c),p?x(t,o-(e-u)):t))}function y(e){return l=void 0,t&&r?d(e):(r=n=void 0,s)}function g(){var e=v(),t=f(e);if(r=arguments,n=this,c=e,t){if(void 0===l)return u=t=c,l=setTimeout(m,a),h?d(t):s;if(p)return l=setTimeout(m,a),d(c)}return void 0===l&&(l=setTimeout(m,a)),s}return a=S(a)||0,w(e)&&(h=!!e.leading,p="maxWait"in e,o=p?b(S(e.maxWait)||0,a):o,t="trailing"in e?!!e.trailing:t),g.cancel=function(){void 0!==l&&clearTimeout(l),r=c=n=l=void(u=0)},g.flush=function(){return void 0===l?s:y(v())},g}}.call(this,t("yLpj"))},"9WTN":function(e){e.exports=JSON.parse('[{"name":"黑龙江省","coord":[127.64559817675396,48.48668098449708]},{"name":"内蒙古自治区","coord":[118.34519572208615,45.370218276977525]},{"name":"新疆维吾尔自治区","coord":[87.13479065593184,41.75497055053711]},{"name":"吉林省","coord":[126.12985278813787,43.57983207702637]},{"name":"辽宁省","coord":[124.02494773936439,41.105743408203125]},{"name":"甘肃省","coord":[102.87785725633012,37.69582366943361]},{"name":"河北省","coord":[115.66327227481898,39.33383178710938]},{"name":"北京市","coord":[116.62199343603638,40.25053787231445]},{"name":"山西省","coord":[112.45180235808988,37.666561126708984]},{"name":"天津市","coord":[117.35711842642581,39.406789779663086]},{"name":"陕西省","coord":[109.56294003056632,35.64754199981689]},{"name":"宁夏回族自治区","coord":[105.96110877640074,37.3081169128418]},{"name":"青海省","coord":[96.07301048277901,35.44417190551758]},{"name":"山东省","coord":[118.03833752951093,36.29800605773925]},{"name":"西藏自治区","coord":[87.47361520439412,31.6703872680664]},{"name":"河南省","coord":[113.07832397097275,33.87751102447509]},{"name":"江苏省","coord":[119.93926538201052,32.945452690124505]},{"name":"安徽省","coord":[117.15146765881019,32.024482727050774]},{"name":"四川省","coord":[102.28998890142759,30.182161331176758]},{"name":"湖北省","coord":[112.87798261431585,31.157071113586426]},{"name":"重庆市","coord":[107.870126637831,30.188085556030266]},{"name":"上海市","coord":[121.42561166015514,31.276043891906745]},{"name":"浙江省","coord":[119.75337092707514,29.175934791564945]},{"name":"湖南省","coord":[111.52770282777405,27.38110256195069]},{"name":"江西省","coord":[115.51091280655628,27.283511161804206]},{"name":"云南省","coord":[101.27053825991308,25.19783210754396]},{"name":"贵州省","coord":[106.49672346773299,26.92267990112305]},{"name":"福建省","coord":[117.9976766946587,25.939599990844727]},{"name":"广西壮族自治区","coord":[108.98706831086302,23.891559600830078]},{"name":"台湾省","coord":[120.82468432537434,23.602651596069336]},{"name":"香港特别行政区","coord":[114.21036850371561,22.374858856201172]},{"name":"海南省","coord":[109.62792940960824,19.163116455078125]},{"name":"广东省","coord":[113.32127888266032,22.873867034912106]},{"name":"澳门特别行政区","coord":[113.56819996291901,22.160347992976]}]')},"9ad+":function(e,t,a){e.exports=a.p+"static/img/tdt-img.png"},ATId:function(e,t,a){e.exports=function(d,m){"use strict";var e;return d=d&&d.hasOwnProperty("default")?d.default:d,m=m&&m.hasOwnProperty("default")?m.default:m,function(e){var u;e.exports;(u=window).DOMParser=window.DOMParser;function f(){return document.createElement("canvas")}var p,h=function(e,t,a){if(null!=e||null!=t||null!=a){var i=function(r){var L={opts:r,FRAMERATE:30,MAX_VIRTUAL_PIXELS:3e4,rootEmSize:12,emSize:12,log:function(e){}};1==L.opts.log&&"undefined"!=typeof console&&(L.log=function(e){console.log(e)});L.init=function(e){var t=0;L.UniqueId=function(){return"canvg"+ ++t},L.Definitions={},L.Styles={},L.StylesSpecificity={},L.Animations=[],L.Images=[],L.ctx=e,L.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(e,t){this.viewPorts.push({width:e,height:t})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(e){return null!=e&&"number"==typeof e?e:"x"==e?this.width():"y"==e?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},L.init(),L.ImagesLoaded=function(){for(var e=0;e<L.Images.length;e++)if(!L.Images[e].loaded)return!1;return!0},L.trim=function(e){return e.replace(/^\s+|\s+$/g,"")},L.compressSpaces=function(e){return e.replace(/(?!\u3000)\s+/gm," ")},L.ajax=function(e){var t;return(t=u.XMLHttpRequest?new u.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"))?(t.open("GET",e,!1),t.send(null),t.responseText):null},L.parseXml=function(e){if("undefined"!=typeof Windows&&void 0!==Windows.Data&&void 0!==Windows.Data.Xml){var t=new Windows.Data.Xml.Dom.XmlDocument,a=new Windows.Data.Xml.Dom.XmlLoadSettings;return a.prohibitDtd=!1,t.loadXml(e,a),t}if(!u.DOMParser){e=e.replace(/<!DOCTYPE svg[^>]*>/,"");var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}try{var i=r.xmldom?new u.DOMParser(r.xmldom):new u.DOMParser;return i.parseFromString(e,"image/svg+xml")}catch(t){return(i=r.xmldom?new u.DOMParser(r.xmldom):new u.DOMParser).parseFromString(e,"text/xml")}},L.Property=function(e,t){this.name=e,this.value=t},L.Property.prototype.getValue=function(){return this.value},L.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},L.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var e=parseFloat(this.value);return(this.value+"").match(/%$/)&&(e/=100),e},L.Property.prototype.valueOrDefault=function(e){return this.hasValue()?this.value:e},L.Property.prototype.numValueOrDefault=function(e){return this.hasValue()?this.numValue():e},L.Property.prototype.addOpacity=function(e){var t=this.value;if(null!=e.value&&""!=e.value&&"string"==typeof this.value){var a=new d(this.value);a.ok&&(t="rgba("+a.r+", "+a.g+", "+a.b+", "+e.numValue()+")")}return new L.Property(this.name,t)},L.Property.prototype.getDefinition=function(){var e=this.value.match(/#([^\)'"]+)/);return e&&(e=e[1]),e||(e=this.value),L.Definitions[e]},L.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},L.Property.prototype.getFillStyleDefinition=function(e,t){var a=this.getDefinition();if(null!=a&&a.createGradient)return a.createGradient(L.ctx,e,t);if(null!=a&&a.createPattern){if(a.getHrefAttribute().hasValue()){var i=a.attribute("patternTransform");a=a.getHrefAttribute().getDefinition(),i.hasValue()&&(a.attribute("patternTransform",!0).value=i.value)}return a.createPattern(L.ctx,e)}return null},L.Property.prototype.getDPI=function(e){return 96},L.Property.prototype.getREM=function(e){return L.rootEmSize},L.Property.prototype.getEM=function(e){return L.emSize},L.Property.prototype.getUnits=function(){var e=this.value+"";return e.replace(/[0-9\.\-]/g,"")},L.Property.prototype.isPixels=function(){if(!this.hasValue())return!1;var e=this.value+"";return!!e.match(/px$/)||!!e.match(/^[0-9]+$/)},L.Property.prototype.toPixels=function(e,t){if(!this.hasValue())return 0;var a=this.value+"";if(a.match(/rem$/))return this.numValue()*this.getREM(e);if(a.match(/em$/))return this.numValue()*this.getEM(e);if(a.match(/ex$/))return this.numValue()*this.getEM(e)/2;if(a.match(/px$/))return this.numValue();if(a.match(/pt$/))return this.numValue()*this.getDPI(e)*(1/72);if(a.match(/pc$/))return 15*this.numValue();if(a.match(/cm$/))return this.numValue()*this.getDPI(e)/2.54;if(a.match(/mm$/))return this.numValue()*this.getDPI(e)/25.4;if(a.match(/in$/))return this.numValue()*this.getDPI(e);if(a.match(/%$/))return this.numValue()*L.ViewPort.ComputeSize(e);var i=this.numValue();return t&&i<1?i*L.ViewPort.ComputeSize(e):i},L.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/s$/)?1e3*this.numValue():(e.match(/ms$/),this.numValue())},L.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/deg$/)?this.numValue()*(Math.PI/180):e.match(/grad$/)?this.numValue()*(Math.PI/200):e.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var e={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return L.Property.prototype.toTextBaseline=function(){return this.hasValue()?e[this.value]:null},L.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(e,t,a,i,r,n){var o=null!=n?this.Parse(n):this.CreateFont("","","","","",L.ctx.font);return{fontFamily:r=r||o.fontFamily,fontSize:i||o.fontSize,fontStyle:e||o.fontStyle,fontWeight:a||o.fontWeight,fontVariant:t||o.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var o=this;this.Parse=function(e){for(var t={},a=L.trim(L.compressSpaces(e||"")).split(" "),i={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},r="",n=0;n<a.length;n++)i.fontStyle||-1==o.Styles.indexOf(a[n])?i.fontVariant||-1==o.Variants.indexOf(a[n])?i.fontWeight||-1==o.Weights.indexOf(a[n])?i.fontSize?"inherit"!=a[n]&&(r+=a[n]):("inherit"!=a[n]&&(t.fontSize=a[n].split("/")[0]),i.fontStyle=i.fontVariant=i.fontWeight=i.fontSize=!0):("inherit"!=a[n]&&(t.fontWeight=a[n]),i.fontStyle=i.fontVariant=i.fontWeight=!0):("inherit"!=a[n]&&(t.fontVariant=a[n]),i.fontStyle=i.fontVariant=!0):("inherit"!=a[n]&&(t.fontStyle=a[n]),i.fontStyle=!0);return""!=r&&(t.fontFamily=r),t}},L.ToNumberArray=function(e){for(var t=L.trim(L.compressSpaces((e||"").replace(/,/g," "))).split(" "),a=0;a<t.length;a++)t[a]=parseFloat(t[a]);return t},L.Point=function(e,t){this.x=e,this.y=t},L.Point.prototype.angleTo=function(e){return Math.atan2(e.y-this.y,e.x-this.x)},L.Point.prototype.applyTransform=function(e){var t=this.x*e[0]+this.y*e[2]+e[4],a=this.x*e[1]+this.y*e[3]+e[5];this.x=t,this.y=a},L.CreatePoint=function(e){var t=L.ToNumberArray(e);return new L.Point(t[0],t[1])},L.CreatePath=function(e){for(var t=L.ToNumberArray(e),a=[],i=0;i<t.length;i+=2)a.push(new L.Point(t[i],t[i+1]));return a},L.BoundingBox=function(e,t,a,i){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(e,t){null!=e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),null!=t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},this.addX=function(e){this.addPoint(e,null)},this.addY=function(e){this.addPoint(null,e)},this.addBoundingBox=function(e){this.addPoint(e.x1,e.y1),this.addPoint(e.x2,e.y2)},this.addQuadraticCurve=function(e,t,a,i,r,n){var o=e+2/3*(a-e),s=t+2/3*(i-t),l=o+1/3*(r-e),c=s+1/3*(n-t);this.addBezierCurve(e,t,o,l,s,c,r,n)},this.addBezierCurve=function(e,t,a,i,r,n,o,s){var l=[e,t],c=[a,i],u=[r,n],h=[o,s];this.addPoint(l[0],l[1]),this.addPoint(h[0],h[1]);for(var p=0;p<=1;p++){var d=function(e){return Math.pow(1-e,3)*l[p]+3*Math.pow(1-e,2)*e*c[p]+3*(1-e)*Math.pow(e,2)*u[p]+Math.pow(e,3)*h[p]},f=6*l[p]-12*c[p]+6*u[p],m=-3*l[p]+9*c[p]-9*u[p]+3*h[p],y=3*c[p]-3*l[p];if(0!=m){var g=Math.pow(f,2)-4*y*m;if(!(g<0)){var v=(-f+Math.sqrt(g))/(2*m);0<v&&v<1&&(0==p&&this.addX(d(v)),1==p&&this.addY(d(v)));var b=(-f-Math.sqrt(g))/(2*m);0<b&&b<1&&(0==p&&this.addX(d(b)),1==p&&this.addY(d(b)))}}else{if(0==f)continue;var x=-y/f;0<x&&x<1&&(0==p&&this.addX(d(x)),1==p&&this.addY(d(x)))}}},this.isPointInBox=function(e,t){return this.x1<=e&&e<=this.x2&&this.y1<=t&&t<=this.y2},this.addPoint(e,t),this.addPoint(a,i)},L.Transform=function(e){var t=this;this.Type={},this.Type.translate=function(e){this.p=L.CreatePoint(e),this.apply=function(e){e.translate(this.p.x||0,this.p.y||0)},this.unapply=function(e){e.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(e){e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(e){var t=L.ToNumberArray(e);this.angle=new L.Property("angle",t[0]),this.cx=t[1]||0,this.cy=t[2]||0,this.apply=function(e){e.translate(this.cx,this.cy),e.rotate(this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.unapply=function(e){e.translate(this.cx,this.cy),e.rotate(-1*this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.applyToPoint=function(e){var t=this.angle.toRadians();e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),e.applyTransform([Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0]),e.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(e){this.p=L.CreatePoint(e),this.apply=function(e){e.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(e){e.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(e){e.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(e){this.m=L.ToNumberArray(e),this.apply=function(e){e.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(e){var t=this.m[0],a=this.m[2],i=this.m[4],r=this.m[1],n=this.m[3],o=this.m[5],s=1/(t*(1*n-0*o)-a*(1*r-0*o)+i*(0*r-0*n));e.transform(s*(1*n-0*o),s*(0*o-1*r),s*(0*i-1*a),s*(1*t-0*i),s*(a*o-i*n),s*(i*r-t*o))},this.applyToPoint=function(e){e.applyTransform(this.m)}},this.Type.SkewBase=function(e){this.base=t.Type.matrix,this.base(e),this.angle=new L.Property("angle",e)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(e){this.base=t.Type.SkewBase,this.base(e),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(e){this.base=t.Type.SkewBase,this.base(e),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(e)},this.unapply=function(e){for(var t=this.transforms.length-1;0<=t;t--)this.transforms[t].unapply(e)},this.applyToPoint=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].applyToPoint(e)};for(var a=L.trim(L.compressSpaces(e)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),i=0;i<a.length;i++)if("none"!==a[i]){var r=L.trim(a[i].split("(")[0]),n=a[i].split("(")[1].replace(")",""),o=this.Type[r];if(void 0!==o){var s=new o(n);s.type=r,this.transforms.push(s)}}},L.AspectRatio=function(e,t,a,i,r,n,o,s,l,c){var u=(t=(t=L.compressSpaces(t)).replace(/^defer\s/,"")).split(" ")[0]||"xMidYMid",h=t.split(" ")[1]||"meet",p=a/i,d=r/n,f=Math.min(p,d),m=Math.max(p,d);"meet"==h&&(i*=f,n*=f),"slice"==h&&(i*=m,n*=m),l=new L.Property("refX",l),c=new L.Property("refY",c),l.hasValue()&&c.hasValue()?e.translate(-f*l.toPixels("x"),-f*c.toPixels("y")):(u.match(/^xMid/)&&("meet"==h&&f==d||"slice"==h&&m==d)&&e.translate(a/2-i/2,0),u.match(/YMid$/)&&("meet"==h&&f==p||"slice"==h&&m==p)&&e.translate(0,r/2-n/2),u.match(/^xMax/)&&("meet"==h&&f==d||"slice"==h&&m==d)&&e.translate(a-i,0),u.match(/YMax$/)&&("meet"==h&&f==p||"slice"==h&&m==p)&&e.translate(0,r-n)),"none"==u?e.scale(p,d):"meet"==h?e.scale(f,f):"slice"==h&&e.scale(m,m),e.translate(null==o?0:-o,null==s?0:-s)},L.Element={},L.EmptyProperty=new L.Property("EMPTY",""),L.Element.ElementBase=function(n){this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(e,t){var a=this.attributes[e];return null!=a?a:(1==t&&(a=new L.Property(e,""),this.attributes[e]=a),a||L.EmptyProperty)},this.getHrefAttribute=function(){for(var e in this.attributes)if("href"==e||e.match(/:href$/))return this.attributes[e];return L.EmptyProperty},this.style=function(e,t,a){var i=this.styles[e];if(null!=i)return i;var r=this.attribute(e);if(null!=r&&r.hasValue())return this.styles[e]=r;if(1!=a){var n=this.parent;if(null!=n){var o=n.style(e);if(null!=o&&o.hasValue())return o}}return 1==t&&(i=new L.Property(e,""),this.styles[e]=i),i||L.EmptyProperty},this.render=function(e){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){if(e.save(),this.style("mask").hasValue()){var t=this.style("mask").getDefinition();null!=t&&t.apply(e,this)}else if(this.style("filter").hasValue()){var a=this.style("filter").getDefinition();null!=a&&a.apply(e,this)}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}},this.setContext=function(e){},this.clearContext=function(e){},this.renderChildren=function(e){for(var t=0;t<this.children.length;t++)this.children[t].render(e)},this.addChild=function(e,t){var a=e;t&&(a=L.CreateElement(e)),a.parent=this,"title"!=a.type&&this.children.push(a)},this.addStylesFromStyleDefinition=function(){for(var e in L.Styles)if("@"!=e[0]&&p(n,e)){var t=L.Styles[e],a=L.StylesSpecificity[e];if(null!=t)for(var i in t){var r=this.stylesSpecificity[i];void 0===r&&(r="000"),r<a&&(this.styles[i]=t[i],this.stylesSpecificity[i]=a)}}};var e,t=new RegExp("^[A-Z-]+$");if(null!=n&&1==n.nodeType){for(var a=0;a<n.attributes.length;a++){var i=n.attributes[a],r=(e=i.nodeName,t.test(e)?e.toLowerCase():e);this.attributes[r]=new L.Property(r,i.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue()){var o=this.attribute("style").value.split(";");for(a=0;a<o.length;a++)if(""!=L.trim(o[a])){var s=o[a].split(":"),l=L.trim(s[0]),c=L.trim(s[1]);this.styles[l]=new L.Property(l,c)}}for(this.attribute("id").hasValue()&&null==L.Definitions[this.attribute("id").value]&&(L.Definitions[this.attribute("id").value]=this),a=0;a<n.childNodes.length;a++){var u=n.childNodes[a];if(1==u.nodeType&&this.addChild(u,!0),this.captureTextNodes&&(3==u.nodeType||4==u.nodeType)){var h=u.value||u.text||u.textContent||"";""!=L.compressSpaces(h)&&this.addChild(new L.Element.tspan(u),!1)}}}},L.Element.RenderedElementBase=function(e){this.base=L.Element.ElementBase,this.base(e),this.calculateOpacity=function(){for(var e=1,t=this;null!=t;){var a=t.style("opacity",!1,!0);a.hasValue()&&(e*=a.numValue()),t=t.parent}return e},this.setContext=function(e,t){if(!t){var a;if(this.style("fill").isUrlDefinition())null!=(a=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity")))&&(e.fillStyle=a);else if(this.style("fill").hasValue()){var i;"currentColor"==(i=this.style("fill")).value&&(i.value=this.style("color").value),"inherit"!=i.value&&(e.fillStyle="none"==i.value?"rgba(0,0,0,0)":i.value)}if(this.style("fill-opacity").hasValue()&&(i=(i=new L.Property("fill",e.fillStyle)).addOpacity(this.style("fill-opacity")),e.fillStyle=i.value),this.style("stroke").isUrlDefinition())null!=(a=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")))&&(e.strokeStyle=a);else if(this.style("stroke").hasValue()){var r;"currentColor"==(r=this.style("stroke")).value&&(r.value=this.style("color").value),"inherit"!=r.value&&(e.strokeStyle="none"==r.value?"rgba(0,0,0,0)":r.value)}if(this.style("stroke-opacity").hasValue()&&(r=(r=new L.Property("stroke",e.strokeStyle)).addOpacity(this.style("stroke-opacity")),e.strokeStyle=r.value),this.style("stroke-width").hasValue()){var n=this.style("stroke-width").toPixels();e.lineWidth=0==n?.001:n}if(this.style("stroke-linecap").hasValue()&&(e.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(e.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(e.miterLimit=this.style("stroke-miterlimit").value),this.style("paint-order").hasValue()&&(e.paintOrder=this.style("paint-order").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value){var o=L.ToNumberArray(this.style("stroke-dasharray").value);void 0!==e.setLineDash?e.setLineDash(o):void 0!==e.webkitLineDash?e.webkitLineDash=o:void 0===e.mozDash||1==o.length&&0==o[0]||(e.mozDash=o);var s=this.style("stroke-dashoffset").toPixels();void 0!==e.lineDashOffset?e.lineDashOffset=s:void 0!==e.webkitLineDashOffset?e.webkitLineDashOffset=s:void 0!==e.mozDashOffset&&(e.mozDashOffset=s)}}if(void 0!==e.font){e.font=L.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString();var l=this.style("font-size",!1,!1);l.isPixels()&&(L.emSize=l.toPixels())}if(this.style("transform",!1,!0).hasValue()&&new L.Transform(this.style("transform",!1,!0).value).apply(e),this.style("clip-path",!1,!0).hasValue()){var c=this.style("clip-path",!1,!0).getDefinition();null!=c&&c.apply(e)}e.globalAlpha=this.calculateOpacity()}},L.Element.RenderedElementBase.prototype=new L.Element.ElementBase,L.Element.PathElementBase=function(e){this.base=L.Element.RenderedElementBase,this.base(e),this.path=function(e){return null!=e&&e.beginPath(),new L.BoundingBox},this.renderChildren=function(e){this.path(e),L.Mouse.checkPath(this,e),""!=e.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?e.fill(this.style("fill-rule").value):e.fill()),""!=e.strokeStyle&&e.stroke();var t=this.getMarkers();if(null!=t){if(this.style("marker-start").isUrlDefinition()&&(a=this.style("marker-start").getDefinition()).render(e,t[0][0],t[0][1]),this.style("marker-mid").isUrlDefinition())for(var a=this.style("marker-mid").getDefinition(),i=1;i<t.length-1;i++)a.render(e,t[i][0],t[i][1]);this.style("marker-end").isUrlDefinition()&&(a=this.style("marker-end").getDefinition()).render(e,t[t.length-1][0],t[t.length-1][1])}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},L.Element.PathElementBase.prototype=new L.Element.RenderedElementBase,L.Element.svg=function(e){this.base=L.Element.RenderedElementBase,this.base(e),this.baseClearContext=this.clearContext,this.clearContext=function(e){this.baseClearContext(e),L.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(e){if(e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4,e.canvas.style&&void 0!==e.font&&void 0!==u.getComputedStyle){e.font=u.getComputedStyle(e.canvas).getPropertyValue("font");var t=new L.Property("fontSize",L.Font.Parse(e.font).fontSize);t.hasValue()&&(L.rootEmSize=L.emSize=t.toPixels("y"))}this.baseSetContext(e),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),e.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var a=L.ViewPort.width(),i=L.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),void 0===this.root){a=this.attribute("width").toPixels("x"),i=this.attribute("height").toPixels("y");var r=0,n=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(r=-this.attribute("refX").toPixels("x"),n=-this.attribute("refY").toPixels("y")),"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(e.beginPath(),e.moveTo(r,n),e.lineTo(a,n),e.lineTo(a,i),e.lineTo(r,i),e.closePath(),e.clip())}if(L.ViewPort.SetCurrent(a,i),this.attribute("viewBox").hasValue()){var o=L.ToNumberArray(this.attribute("viewBox").value),s=o[0],l=o[1];a=o[2],i=o[3],L.AspectRatio(e,this.attribute("preserveAspectRatio").value,L.ViewPort.width(),a,L.ViewPort.height(),i,s,l,this.attribute("refX").value,this.attribute("refY").value),L.ViewPort.RemoveCurrent(),L.ViewPort.SetCurrent(o[2],o[3])}}},L.Element.svg.prototype=new L.Element.RenderedElementBase,L.Element.rect=function(e){this.base=L.Element.PathElementBase,this.base(e),this.path=function(e){var t=this.attribute("x").toPixels("x"),a=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y"),n=this.attribute("rx").toPixels("x"),o=this.attribute("ry").toPixels("y");if(this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(o=n),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(n=o),n=Math.min(n,i/2),o=Math.min(o,r/2),null!=e){var s=(Math.sqrt(2)-1)/3*4;e.beginPath(),e.moveTo(t+n,a),e.lineTo(t+i-n,a),e.bezierCurveTo(t+i-n+s*n,a,t+i,a+o-s*o,t+i,a+o),e.lineTo(t+i,a+r-o),e.bezierCurveTo(t+i,a+r-o+s*o,t+i-n+s*n,a+r,t+i-n,a+r),e.lineTo(t+n,a+r),e.bezierCurveTo(t+n-s*n,a+r,t,a+r-o+s*o,t,a+r-o),e.lineTo(t,a+o),e.bezierCurveTo(t,a+o-s*o,t+n-s*n,a,t+n,a),e.closePath()}return new L.BoundingBox(t,a,t+i,a+r)}},L.Element.rect.prototype=new L.Element.PathElementBase,L.Element.circle=function(e){this.base=L.Element.PathElementBase,this.base(e),this.path=function(e){var t=this.attribute("cx").toPixels("x"),a=this.attribute("cy").toPixels("y"),i=this.attribute("r").toPixels();return null!=e&&(e.beginPath(),e.arc(t,a,i,0,2*Math.PI,!1),e.closePath()),new L.BoundingBox(t-i,a-i,t+i,a+i)}},L.Element.circle.prototype=new L.Element.PathElementBase,L.Element.ellipse=function(e){this.base=L.Element.PathElementBase,this.base(e),this.path=function(e){var t=(Math.sqrt(2)-1)/3*4,a=this.attribute("rx").toPixels("x"),i=this.attribute("ry").toPixels("y"),r=this.attribute("cx").toPixels("x"),n=this.attribute("cy").toPixels("y");return null!=e&&(e.beginPath(),e.moveTo(r+a,n),e.bezierCurveTo(r+a,n+t*i,r+t*a,n+i,r,n+i),e.bezierCurveTo(r-t*a,n+i,r-a,n+t*i,r-a,n),e.bezierCurveTo(r-a,n-t*i,r-t*a,n-i,r,n-i),e.bezierCurveTo(r+t*a,n-i,r+a,n-t*i,r+a,n),e.closePath()),new L.BoundingBox(r-a,n-i,r+a,n+i)}},L.Element.ellipse.prototype=new L.Element.PathElementBase,L.Element.line=function(e){this.base=L.Element.PathElementBase,this.base(e),this.getPoints=function(){return[new L.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new L.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(e){var t=this.getPoints();return null!=e&&(e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y)),new L.BoundingBox(t[0].x,t[0].y,t[1].x,t[1].y)},this.getMarkers=function(){var e=this.getPoints(),t=e[0].angleTo(e[1]);return[[e[0],t],[e[1],t]]}},L.Element.line.prototype=new L.Element.PathElementBase,L.Element.polyline=function(e){this.base=L.Element.PathElementBase,this.base(e),this.points=L.CreatePath(this.attribute("points").value),this.path=function(e){var t=new L.BoundingBox(this.points[0].x,this.points[0].y);null!=e&&(e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y));for(var a=1;a<this.points.length;a++)t.addPoint(this.points[a].x,this.points[a].y),null!=e&&e.lineTo(this.points[a].x,this.points[a].y);return t},this.getMarkers=function(){for(var e=[],t=0;t<this.points.length-1;t++)e.push([this.points[t],this.points[t].angleTo(this.points[t+1])]);return 0<e.length&&e.push([this.points[this.points.length-1],e[e.length-1][1]]),e}},L.Element.polyline.prototype=new L.Element.PathElementBase,L.Element.polygon=function(e){this.base=L.Element.polyline,this.base(e),this.basePath=this.path,this.path=function(e){var t=this.basePath(e);return null!=e&&(e.lineTo(this.points[0].x,this.points[0].y),e.closePath()),t}},L.Element.polygon.prototype=new L.Element.polyline,L.Element.path=function(e){this.base=L.Element.PathElementBase,this.base(e);var t=this.attribute("d").value;t=t.replace(/,/gm," ");for(var a=0;a<2;a++)t=t.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");for(t=(t=t.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2"),a=0;a<2;a++)t=t.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");t=t.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),t=L.compressSpaces(t),t=L.trim(t),this.PathParser=new function(e){this.tokens=e.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new L.Point(0,0),this.control=new L.Point(0,0),this.current=new L.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var e=new L.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(e)},this.getAsControlPoint=function(){var e=this.getPoint();return this.control=e},this.getAsCurrentPoint=function(){var e=this.getPoint();return this.current=e},this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase()?this.current:new L.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},this.makeAbsolute=function(e){return this.isRelativeCommand()&&(e.x+=this.current.x,e.y+=this.current.y),e},this.addMarker=function(e,t,a){null!=a&&0<this.angles.length&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(a)),this.addMarkerAngle(e,null==t?null:t.angleTo(e))},this.addMarkerAngle=function(e,t){this.points.push(e),this.angles.push(t)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var e=0;e<this.angles.length;e++)if(null==this.angles[e])for(var t=e+1;t<this.angles.length;t++)if(null!=this.angles[t]){this.angles[e]=this.angles[t];break}return this.angles}}(t),this.path=function(e){var t=this.PathParser;t.reset();var a=new L.BoundingBox;for(null!=e&&e.beginPath();!t.isEnd();)switch(t.nextCommand(),t.command){case"M":case"m":var i=t.getAsCurrentPoint();for(t.addMarker(i),a.addPoint(i.x,i.y),null!=e&&e.moveTo(i.x,i.y),t.start=t.current;!t.isCommandOrEnd();)i=t.getAsCurrentPoint(),t.addMarker(i,t.start),a.addPoint(i.x,i.y),null!=e&&e.lineTo(i.x,i.y);break;case"L":case"l":for(;!t.isCommandOrEnd();){var r=t.current;i=t.getAsCurrentPoint(),t.addMarker(i,r),a.addPoint(i.x,i.y),null!=e&&e.lineTo(i.x,i.y)}break;case"H":case"h":for(;!t.isCommandOrEnd();){var n=new L.Point((t.isRelativeCommand()?t.current.x:0)+t.getScalar(),t.current.y);t.addMarker(n,t.current),t.current=n,a.addPoint(t.current.x,t.current.y),null!=e&&e.lineTo(t.current.x,t.current.y)}break;case"V":case"v":for(;!t.isCommandOrEnd();)n=new L.Point(t.current.x,(t.isRelativeCommand()?t.current.y:0)+t.getScalar()),t.addMarker(n,t.current),t.current=n,a.addPoint(t.current.x,t.current.y),null!=e&&e.lineTo(t.current.x,t.current.y);break;case"C":case"c":for(;!t.isCommandOrEnd();){var o=t.current,s=t.getPoint(),l=t.getAsControlPoint(),c=t.getAsCurrentPoint();t.addMarker(c,l,s),a.addBezierCurve(o.x,o.y,s.x,s.y,l.x,l.y,c.x,c.y),null!=e&&e.bezierCurveTo(s.x,s.y,l.x,l.y,c.x,c.y)}break;case"S":case"s":for(;!t.isCommandOrEnd();)o=t.current,s=t.getReflectedControlPoint(),l=t.getAsControlPoint(),c=t.getAsCurrentPoint(),t.addMarker(c,l,s),a.addBezierCurve(o.x,o.y,s.x,s.y,l.x,l.y,c.x,c.y),null!=e&&e.bezierCurveTo(s.x,s.y,l.x,l.y,c.x,c.y);break;case"Q":case"q":for(;!t.isCommandOrEnd();)o=t.current,l=t.getAsControlPoint(),c=t.getAsCurrentPoint(),t.addMarker(c,l,l),a.addQuadraticCurve(o.x,o.y,l.x,l.y,c.x,c.y),null!=e&&e.quadraticCurveTo(l.x,l.y,c.x,c.y);break;case"T":case"t":for(;!t.isCommandOrEnd();)o=t.current,l=t.getReflectedControlPoint(),t.control=l,c=t.getAsCurrentPoint(),t.addMarker(c,l,l),a.addQuadraticCurve(o.x,o.y,l.x,l.y,c.x,c.y),null!=e&&e.quadraticCurveTo(l.x,l.y,c.x,c.y);break;case"A":case"a":for(;!t.isCommandOrEnd();){o=t.current;var u=t.getScalar(),h=t.getScalar(),p=t.getScalar()*(Math.PI/180),d=t.getScalar(),f=t.getScalar(),m=(c=t.getAsCurrentPoint(),new L.Point(Math.cos(p)*(o.x-c.x)/2+Math.sin(p)*(o.y-c.y)/2,-Math.sin(p)*(o.x-c.x)/2+Math.cos(p)*(o.y-c.y)/2)),y=Math.pow(m.x,2)/Math.pow(u,2)+Math.pow(m.y,2)/Math.pow(h,2);1<y&&(u*=Math.sqrt(y),h*=Math.sqrt(y));var g=(d==f?-1:1)*Math.sqrt((Math.pow(u,2)*Math.pow(h,2)-Math.pow(u,2)*Math.pow(m.y,2)-Math.pow(h,2)*Math.pow(m.x,2))/(Math.pow(u,2)*Math.pow(m.y,2)+Math.pow(h,2)*Math.pow(m.x,2)));isNaN(g)&&(g=0);var v=new L.Point(g*u*m.y/h,g*-h*m.x/u),b=new L.Point((o.x+c.x)/2+Math.cos(p)*v.x-Math.sin(p)*v.y,(o.y+c.y)/2+Math.sin(p)*v.x+Math.cos(p)*v.y),x=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},w=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(x(e)*x(t))},S=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(w(e,t))},P=S([1,0],[(m.x-v.x)/u,(m.y-v.y)/h]),_=[(m.x-v.x)/u,(m.y-v.y)/h],C=[(-m.x-v.x)/u,(-m.y-v.y)/h],T=S(_,C);w(_,C)<=-1&&(T=Math.PI),1<=w(_,C)&&(T=0);var k=1-f?1:-1,M=P+k*(T/2),E=new L.Point(b.x+u*Math.cos(M),b.y+h*Math.sin(M));if(t.addMarkerAngle(E,M-k*Math.PI/2),t.addMarkerAngle(c,M-k*Math.PI),a.addPoint(c.x,c.y),null!=e){w=h<u?u:h;var O=h<u?1:u/h,I=h<u?h/u:1;e.translate(b.x,b.y),e.rotate(p),e.scale(O,I),e.arc(0,0,w,P,P+T,1-f),e.scale(1/O,1/I),e.rotate(-p),e.translate(-b.x,-b.y)}}break;case"Z":case"z":null!=e&&a.x1!==a.x2&&a.y1!==a.y2&&e.closePath(),t.current=t.start}return a},this.getMarkers=function(){for(var e=this.PathParser.getMarkerPoints(),t=this.PathParser.getMarkerAngles(),a=[],i=0;i<e.length;i++)a.push([e[i],t[i]]);return a}},L.Element.path.prototype=new L.Element.PathElementBase,L.Element.pattern=function(e){this.base=L.Element.ElementBase,this.base(e),this.createPattern=function(e,t){var a=this.attribute("width").toPixels("x",!0),i=this.attribute("height").toPixels("y",!0),r=new L.Element.svg;r.attributes.viewBox=new L.Property("viewBox",this.attribute("viewBox").value),r.attributes.width=new L.Property("width",a+"px"),r.attributes.height=new L.Property("height",i+"px"),r.attributes.transform=new L.Property("transform",this.attribute("patternTransform").value),r.children=this.children;var n=f();n.width=a,n.height=i;var o=n.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&o.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var s=-1;s<=1;s++)for(var l=-1;l<=1;l++)o.save(),r.attributes.x=new L.Property("x",s*n.width),r.attributes.y=new L.Property("y",l*n.height),r.render(o),o.restore();return e.createPattern(n,"repeat")}},L.Element.pattern.prototype=new L.Element.ElementBase,L.Element.marker=function(e){this.base=L.Element.ElementBase,this.base(e),this.baseRender=this.render,this.render=function(e,t,a){if(t){e.translate(t.x,t.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&e.rotate(a),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&e.scale(e.lineWidth,e.lineWidth),e.save();var i=new L.Element.svg;i.attributes.viewBox=new L.Property("viewBox",this.attribute("viewBox").value),i.attributes.refX=new L.Property("refX",this.attribute("refX").value),i.attributes.refY=new L.Property("refY",this.attribute("refY").value),i.attributes.width=new L.Property("width",this.attribute("markerWidth").value),i.attributes.height=new L.Property("height",this.attribute("markerHeight").value),i.attributes.fill=new L.Property("fill",this.attribute("fill").valueOrDefault("black")),i.attributes.stroke=new L.Property("stroke",this.attribute("stroke").valueOrDefault("none")),i.children=this.children,i.render(e),e.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&e.scale(1/e.lineWidth,1/e.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&e.rotate(-a),e.translate(-t.x,-t.y)}}},L.Element.marker.prototype=new L.Element.ElementBase,L.Element.defs=function(e){this.base=L.Element.ElementBase,this.base(e),this.render=function(e){}},L.Element.defs.prototype=new L.Element.ElementBase,L.Element.GradientBase=function(e){this.base=L.Element.ElementBase,this.base(e),this.stops=[];for(var t=0;t<this.children.length;t++){var a=this.children[t];"stop"==a.type&&this.stops.push(a)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(e){for(var t=0;t<this.attributesToInherit.length;t++){var a=this.attributesToInherit[t];!this.attribute(a).hasValue()&&e.attribute(a).hasValue()&&(this.attribute(a,!0).value=e.attribute(a).value)}},this.createGradient=function(e,t,a){var i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(i));var r=function(e){return a.hasValue()?new L.Property("color",e).addOpacity(a).value:e},n=this.getGradient(e,t);if(null==n)return r(i.stops[i.stops.length-1].color);for(var o=0;o<i.stops.length;o++)n.addColorStop(i.stops[o].offset,r(i.stops[o].color));if(this.attribute("gradientTransform").hasValue()){var s=L.ViewPort.viewPorts[0],l=new L.Element.rect;l.attributes.x=new L.Property("x",-L.MAX_VIRTUAL_PIXELS/3),l.attributes.y=new L.Property("y",-L.MAX_VIRTUAL_PIXELS/3),l.attributes.width=new L.Property("width",L.MAX_VIRTUAL_PIXELS),l.attributes.height=new L.Property("height",L.MAX_VIRTUAL_PIXELS);var c=new L.Element.g;c.attributes.transform=new L.Property("transform",this.attribute("gradientTransform").value),c.children=[l];var u=new L.Element.svg;u.attributes.x=new L.Property("x",0),u.attributes.y=new L.Property("y",0),u.attributes.width=new L.Property("width",s.width),u.attributes.height=new L.Property("height",s.height),u.children=[c];var h=f();h.width=s.width,h.height=s.height;var p=h.getContext("2d");return p.fillStyle=n,u.render(p),p.createPattern(h,"no-repeat")}return n}},L.Element.GradientBase.prototype=new L.Element.ElementBase,L.Element.linearGradient=function(e){this.base=L.Element.GradientBase,this.base(e),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(e,t){var a="objectBoundingBox"==this.gradientUnits()?t.getBoundingBox(e):null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var i="objectBoundingBox"==this.gradientUnits()?a.x()+a.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),r="objectBoundingBox"==this.gradientUnits()?a.y()+a.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),n="objectBoundingBox"==this.gradientUnits()?a.x()+a.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),o="objectBoundingBox"==this.gradientUnits()?a.y()+a.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return i==n&&r==o?null:e.createLinearGradient(i,r,n,o)}},L.Element.linearGradient.prototype=new L.Element.GradientBase,L.Element.radialGradient=function(e){this.base=L.Element.GradientBase,this.base(e),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(e,t){var a=t.getBoundingBox(e);this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var i="objectBoundingBox"==this.gradientUnits()?a.x()+a.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),r="objectBoundingBox"==this.gradientUnits()?a.y()+a.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),n=i,o=r;this.attribute("fx").hasValue()&&(n="objectBoundingBox"==this.gradientUnits()?a.x()+a.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(o="objectBoundingBox"==this.gradientUnits()?a.y()+a.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var s="objectBoundingBox"==this.gradientUnits()?(a.width()+a.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return e.createRadialGradient(n,o,0,i,r,s)}},L.Element.radialGradient.prototype=new L.Element.GradientBase,L.Element.stop=function(e){this.base=L.Element.ElementBase,this.base(e),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),1<this.offset&&(this.offset=1);var t=this.style("stop-color",!0);""===t.value&&(t.value="#000"),this.style("stop-opacity").hasValue()&&(t=t.addOpacity(this.style("stop-opacity"))),this.color=t.value},L.Element.stop.prototype=new L.Element.ElementBase,L.Element.AnimateBase=function(e){this.base=L.Element.ElementBase,this.base(e),L.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var e=this.attribute("attributeType").value,t=this.attribute("attributeName").value;return"CSS"==e?this.parent.style(t,!0):this.parent.attribute(t,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(e){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+e;var t=!1;if(this.begin<this.duration){var a=this.calcValue();this.attribute("type").hasValue()&&(a=this.attribute("type").value+"("+a+")"),this.getProperty().value=a,t=!0}return t},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var e={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var t=e.progress*(this.values.value.length-1),a=Math.floor(t),i=Math.ceil(t);e.from=new L.Property("from",parseFloat(this.values.value[a])),e.to=new L.Property("to",parseFloat(this.values.value[i])),e.progress=(t-a)/(i-a)}else e.from=this.from,e.to=this.to;return e}},L.Element.AnimateBase.prototype=new L.Element.ElementBase,L.Element.animate=function(e){this.base=L.Element.AnimateBase,this.base(e),this.calcValue=function(){var e=this.progress();return e.from.numValue()+(e.to.numValue()-e.from.numValue())*e.progress+this.initialUnits}},L.Element.animate.prototype=new L.Element.AnimateBase,L.Element.animateColor=function(e){this.base=L.Element.AnimateBase,this.base(e),this.calcValue=function(){var e=this.progress(),t=new d(e.from.value),a=new d(e.to.value);if(t.ok&&a.ok){var i=t.r+(a.r-t.r)*e.progress,r=t.g+(a.g-t.g)*e.progress,n=t.b+(a.b-t.b)*e.progress;return"rgb("+parseInt(i,10)+","+parseInt(r,10)+","+parseInt(n,10)+")"}return this.attribute("from").value}},L.Element.animateColor.prototype=new L.Element.AnimateBase,L.Element.animateTransform=function(e){this.base=L.Element.AnimateBase,this.base(e),this.calcValue=function(){for(var e=this.progress(),t=L.ToNumberArray(e.from.value),a=L.ToNumberArray(e.to.value),i="",r=0;r<t.length;r++)i+=t[r]+(a[r]-t[r])*e.progress+" ";return i}},L.Element.animateTransform.prototype=new L.Element.animate,L.Element.font=function(e){this.base=L.Element.ElementBase,this.base(e),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var t=0;t<this.children.length;t++){var a=this.children[t];"font-face"==a.type?(this.fontFace=a).style("font-family").hasValue()&&(L.Definitions[a.style("font-family").value]=this):"missing-glyph"==a.type?this.missingGlyph=a:"glyph"==a.type&&(""!=a.arabicForm?(this.isRTL=!0,this.isArabic=!0,void 0===this.glyphs[a.unicode]&&(this.glyphs[a.unicode]=[]),this.glyphs[a.unicode][a.arabicForm]=a):this.glyphs[a.unicode]=a)}},L.Element.font.prototype=new L.Element.ElementBase,L.Element.fontface=function(e){this.base=L.Element.ElementBase,this.base(e),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},L.Element.fontface.prototype=new L.Element.ElementBase,L.Element.missingglyph=function(e){this.base=L.Element.path,this.base(e),this.horizAdvX=0},L.Element.missingglyph.prototype=new L.Element.path,L.Element.glyph=function(e){this.base=L.Element.path,this.base(e),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},L.Element.glyph.prototype=new L.Element.path,L.Element.text=function(e){this.captureTextNodes=!0,this.base=L.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e);var t=this.style("dominant-baseline").toTextBaseline();null==t&&(t=this.style("alignment-baseline").toTextBaseline()),null!=t&&(e.textBaseline=t)},this.initializeCoordinates=function(e){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(e,this,0)},this.getBoundingBox=function(e){this.initializeCoordinates(e);for(var t=null,a=0;a<this.children.length;a++){var i=this.getChildBoundingBox(e,this,this,a);null==t?t=i:t.addBoundingBox(i)}return t},this.renderChildren=function(e){this.initializeCoordinates(e);for(var t=0;t<this.children.length;t++)this.renderChild(e,this,this,t)},this.getAnchorDelta=function(e,t,a){var i=this.style("text-anchor").valueOrDefault("start");if("start"!=i){for(var r=0,n=a;n<t.children.length;n++){var o=t.children[n];if(a<n&&o.attribute("x").hasValue())break;r+=o.measureTextRecursive(e)}return-1*("end"==i?r:r/2)}return 0},this.adjustChildCoordinates=function(e,t,a,i){var r=a.children[i];return r.attribute("x").hasValue()?(r.x=r.attribute("x").toPixels("x")+t.getAnchorDelta(e,a,i),r.attribute("dx").hasValue()&&(r.x+=r.attribute("dx").toPixels("x"))):(r.attribute("dx").hasValue()&&(t.x+=r.attribute("dx").toPixels("x")),r.x=t.x),t.x=r.x+r.measureText(e),r.attribute("y").hasValue()?(r.y=r.attribute("y").toPixels("y"),r.attribute("dy").hasValue()&&(r.y+=r.attribute("dy").toPixels("y"))):(r.attribute("dy").hasValue()&&(t.y+=r.attribute("dy").toPixels("y")),r.y=t.y),t.y=r.y,r},this.getChildBoundingBox=function(e,t,a,i){var r=this.adjustChildCoordinates(e,t,a,i),n=r.getBoundingBox(e);for(i=0;i<r.children.length;i++){var o=t.getChildBoundingBox(e,t,r,i);n.addBoundingBox(o)}return n},this.renderChild=function(e,t,a,i){var r=this.adjustChildCoordinates(e,t,a,i);for(r.render(e),i=0;i<r.children.length;i++)t.renderChild(e,t,r,i)}},L.Element.text.prototype=new L.Element.RenderedElementBase,L.Element.TextElementBase=function(e){this.base=L.Element.RenderedElementBase,this.base(e),this.getGlyph=function(e,t,a){var i=t[a],r=null;if(e.isArabic){var n="isolated";(0==a||" "==t[a-1])&&a<t.length-2&&" "!=t[a+1]&&(n="terminal"),0<a&&" "!=t[a-1]&&a<t.length-2&&" "!=t[a+1]&&(n="medial"),0<a&&" "!=t[a-1]&&(a==t.length-1||" "==t[a+1])&&(n="initial"),void 0!==e.glyphs[i]&&null==(r=e.glyphs[i][n])&&"glyph"==e.glyphs[i].type&&(r=e.glyphs[i])}else r=e.glyphs[i];return null==r&&(r=e.missingGlyph),r},this.renderChildren=function(e){var t=this.parent.style("font-family").getDefinition();if(null==t)"stroke"==e.paintOrder?(""!=e.strokeStyle&&e.strokeText(L.compressSpaces(this.getText()),this.x,this.y),""!=e.fillStyle&&e.fillText(L.compressSpaces(this.getText()),this.x,this.y)):(""!=e.fillStyle&&e.fillText(L.compressSpaces(this.getText()),this.x,this.y),""!=e.strokeStyle&&e.strokeText(L.compressSpaces(this.getText()),this.x,this.y));else{var a=this.parent.style("font-size").numValueOrDefault(L.Font.Parse(L.ctx.font).fontSize),i=this.parent.style("font-style").valueOrDefault(L.Font.Parse(L.ctx.font).fontStyle),r=this.getText();t.isRTL&&(r=r.split("").reverse().join(""));for(var n=L.ToNumberArray(this.parent.attribute("dx").value),o=0;o<r.length;o++){var s=this.getGlyph(t,r,o),l=a/t.fontFace.unitsPerEm;e.translate(this.x,this.y),e.scale(l,-l);var c=e.lineWidth;e.lineWidth=e.lineWidth*t.fontFace.unitsPerEm/a,"italic"==i&&e.transform(1,0,.4,1,0,0),s.render(e),"italic"==i&&e.transform(1,0,-.4,1,0,0),e.lineWidth=c,e.scale(1/l,-1/l),e.translate(-this.x,-this.y),this.x+=a*(s.horizAdvX||t.horizAdvX)/t.fontFace.unitsPerEm,void 0===n[o]||isNaN(n[o])||(this.x+=n[o])}}},this.getText=function(){},this.measureTextRecursive=function(e){for(var t=this.measureText(e),a=0;a<this.children.length;a++)t+=this.children[a].measureTextRecursive(e);return t},this.measureText=function(e){var t=this.parent.style("font-family").getDefinition();if(null!=t){var a=this.parent.style("font-size").numValueOrDefault(L.Font.Parse(L.ctx.font).fontSize),i=0,r=this.getText();t.isRTL&&(r=r.split("").reverse().join(""));for(var n=L.ToNumberArray(this.parent.attribute("dx").value),o=0;o<r.length;o++)i+=(this.getGlyph(t,r,o).horizAdvX||t.horizAdvX)*a/t.fontFace.unitsPerEm,void 0===n[o]||isNaN(n[o])||(i+=n[o]);return i}var s=L.compressSpaces(this.getText());if(!e.measureText)return 10*s.length;e.save(),this.setContext(e,!0);var l=e.measureText(s).width;return e.restore(),l},this.getBoundingBox=function(e){var t=this.parent.style("font-size").numValueOrDefault(L.Font.Parse(L.ctx.font).fontSize);return new L.BoundingBox(this.x,this.y-t,this.x+this.measureText(e),this.y)}},L.Element.TextElementBase.prototype=new L.Element.RenderedElementBase,L.Element.tspan=function(e){this.captureTextNodes=!0,this.base=L.Element.TextElementBase,this.base(e),this.text=L.compressSpaces(e.value||e.text||e.textContent||""),this.getText=function(){return 0<this.children.length?"":this.text}},L.Element.tspan.prototype=new L.Element.TextElementBase,L.Element.tref=function(e){this.base=L.Element.TextElementBase,this.base(e),this.getText=function(){var e=this.getHrefAttribute().getDefinition();if(null!=e)return e.children[0].getText()}},L.Element.tref.prototype=new L.Element.TextElementBase,L.Element.a=function(e){this.base=L.Element.TextElementBase,this.base(e),this.hasText=0<e.childNodes.length;for(var t=0;t<e.childNodes.length;t++)3!=e.childNodes[t].nodeType&&(this.hasText=!1);this.text=this.hasText?e.childNodes[0].value||e.childNodes[0].data:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(e){if(this.hasText){this.baseRenderChildren(e);var t=new L.Property("fontSize",L.Font.Parse(L.ctx.font).fontSize);L.Mouse.checkBoundingBox(this,new L.BoundingBox(this.x,this.y-t.toPixels("y"),this.x+this.measureText(e),this.y))}else if(0<this.children.length){var a=new L.Element.g;a.children=this.children,a.parent=this,a.render(e)}},this.onclick=function(){u.open(this.getHrefAttribute().value)},this.onmousemove=function(){L.ctx.canvas.style.cursor="pointer"}},L.Element.a.prototype=new L.Element.TextElementBase,L.Element.image=function(e){this.base=L.Element.RenderedElementBase,this.base(e);var t=this.getHrefAttribute().value;if(""!=t){var n=t.match(/\.svg$/);if(L.Images.push(this),this.loaded=!1,n)this.img=L.ajax(t),this.loaded=!0;else{this.img=document.createElement("img"),1==L.opts.useCORS&&(this.img.crossOrigin="Anonymous");var o=this;this.img.onload=function(){o.loaded=!0},this.img.onerror=function(){L.log('ERROR: image "'+t+'" not found'),o.loaded=!0},this.img.src=t}this.renderChildren=function(e){var t=this.attribute("x").toPixels("x"),a=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");0!=i&&0!=r&&(e.save(),n?e.drawSvg(this.img,t,a,i,r):(e.translate(t,a),L.AspectRatio(e,this.attribute("preserveAspectRatio").value,i,this.img.width,r,this.img.height,0,0),o.loaded&&(void 0===this.img.complete||this.img.complete)&&e.drawImage(this.img,0,0)),e.restore())},this.getBoundingBox=function(){var e=this.attribute("x").toPixels("x"),t=this.attribute("y").toPixels("y"),a=this.attribute("width").toPixels("x"),i=this.attribute("height").toPixels("y");return new L.BoundingBox(e,t,e+a,t+i)}}},L.Element.image.prototype=new L.Element.RenderedElementBase,L.Element.g=function(e){this.base=L.Element.RenderedElementBase,this.base(e),this.getBoundingBox=function(e){for(var t=new L.BoundingBox,a=0;a<this.children.length;a++)t.addBoundingBox(this.children[a].getBoundingBox(e));return t}},L.Element.g.prototype=new L.Element.RenderedElementBase,L.Element.symbol=function(e){this.base=L.Element.RenderedElementBase,this.base(e),this.render=function(e){}},L.Element.symbol.prototype=new L.Element.RenderedElementBase,L.Element.style=function(e){this.base=L.Element.ElementBase,this.base(e);for(var t="",a=0;a<e.childNodes.length;a++)t+=e.childNodes[a].data;t=t.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");var i=(t=L.compressSpaces(t)).split("}");for(a=0;a<i.length;a++)if(""!=L.trim(i[a]))for(var r=i[a].split("{"),n=r[0].split(","),o=r[1].split(";"),s=0;s<n.length;s++){var l=L.trim(n[s]);if(""!=l){for(var c=L.Styles[l]||{},u=0;u<o.length;u++){var h=o[u].indexOf(":"),p=o[u].substr(0,h),d=o[u].substr(h+1,o[u].length-h);null!=p&&null!=d&&(c[L.trim(p)]=new L.Property(L.trim(p),L.trim(d)))}if(L.Styles[l]=c,L.StylesSpecificity[l]=P(l),"@font-face"==l)for(var f=c["font-family"].value.replace(/"/g,""),m=c.src.value.split(","),y=0;y<m.length;y++)if(0<m[y].indexOf('format("svg")'))for(var g=m[y].indexOf("url"),v=m[y].indexOf(")",g),b=m[y].substr(g+5,v-g-6),x=L.parseXml(L.ajax(b)).getElementsByTagName("font"),w=0;w<x.length;w++){var S=L.CreateElement(x[w]);L.Definitions[f]=S}}}},L.Element.style.prototype=new L.Element.ElementBase,L.Element.use=function(e){this.base=L.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.attribute("x").hasValue()&&e.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&e.translate(0,this.attribute("y").toPixels("y"))};var i=this.getHrefAttribute().getDefinition();this.path=function(e){null!=i&&i.path(e)},this.elementTransform=function(){if(null!=i&&i.style("transform",!1,!0).hasValue())return new L.Transform(i.style("transform",!1,!0).value)},this.getBoundingBox=function(e){if(null!=i)return i.getBoundingBox(e)},this.renderChildren=function(e){if(null!=i){var t=i;"symbol"==i.type&&((t=new L.Element.svg).type="svg",t.attributes.viewBox=new L.Property("viewBox",i.attribute("viewBox").value),t.attributes.preserveAspectRatio=new L.Property("preserveAspectRatio",i.attribute("preserveAspectRatio").value),t.attributes.overflow=new L.Property("overflow",i.attribute("overflow").value),t.children=i.children),"svg"==t.type&&(this.attribute("width").hasValue()&&(t.attributes.width=new L.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(t.attributes.height=new L.Property("height",this.attribute("height").value)));var a=t.parent;t.parent=null,t.render(e),t.parent=a}}},L.Element.use.prototype=new L.Element.RenderedElementBase,L.Element.mask=function(e){this.base=L.Element.ElementBase,this.base(e),this.apply=function(e,t){var a=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),r=this.attribute("width").toPixels("x"),n=this.attribute("height").toPixels("y");if(0==r&&0==n){for(var o=new L.BoundingBox,s=0;s<this.children.length;s++)o.addBoundingBox(this.children[s].getBoundingBox(e));a=Math.floor(o.x1),i=Math.floor(o.y1),r=Math.floor(o.width()),n=Math.floor(o.height())}var l=t.attribute("mask").value;t.attribute("mask").value="";var c=f();c.width=a+r,c.height=i+n;var u=c.getContext("2d");this.renderChildren(u);var h=f();h.width=a+r,h.height=i+n;var p=h.getContext("2d");t.render(p),p.globalCompositeOperation="destination-in",p.fillStyle=u.createPattern(c,"no-repeat"),p.fillRect(0,0,a+r,i+n),e.fillStyle=p.createPattern(h,"no-repeat"),e.fillRect(0,0,a+r,i+n),t.attribute("mask").value=l},this.render=function(e){}},L.Element.mask.prototype=new L.Element.ElementBase,L.Element.clipPath=function(e){this.base=L.Element.ElementBase,this.base(e),this.apply=function(e){var t="undefined"!=typeof CanvasRenderingContext2D,a=e.beginPath,i=e.closePath;t&&(CanvasRenderingContext2D.prototype.beginPath=function(){},CanvasRenderingContext2D.prototype.closePath=function(){}),a.call(e);for(var r=0;r<this.children.length;r++){var n=this.children[r];if(void 0!==n.path){var o=void 0!==n.elementTransform&&n.elementTransform();!o&&n.style("transform",!1,!0).hasValue()&&(o=new L.Transform(n.style("transform",!1,!0).value)),o&&o.apply(e),n.path(e),t&&(CanvasRenderingContext2D.prototype.closePath=i),o&&o.unapply(e)}}i.call(e),e.clip(),t&&(CanvasRenderingContext2D.prototype.beginPath=a,CanvasRenderingContext2D.prototype.closePath=i)},this.render=function(e){}},L.Element.clipPath.prototype=new L.Element.ElementBase,L.Element.filter=function(e){this.base=L.Element.ElementBase,this.base(e),this.apply=function(e,t){var a=t.getBoundingBox(e),i=Math.floor(a.x1),r=Math.floor(a.y1),n=Math.floor(a.width()),o=Math.floor(a.height()),s=t.style("filter").value;t.style("filter").value="";for(var l=0,c=0,u=0;u<this.children.length;u++){var h=this.children[u].extraFilterDistance||0;l=Math.max(l,h),c=Math.max(c,h)}var p=f();p.width=n+2*l,p.height=o+2*c;var d=p.getContext("2d");for(d.translate(-i+l,-r+c),t.render(d),u=0;u<this.children.length;u++)"function"==typeof this.children[u].apply&&this.children[u].apply(d,0,0,n+2*l,o+2*c);e.drawImage(p,0,0,n+2*l,o+2*c,i-l,r-c,n+2*l,o+2*c),t.style("filter",!0).value=s},this.render=function(e){}},L.Element.filter.prototype=new L.Element.ElementBase,L.Element.feMorphology=function(e){this.base=L.Element.ElementBase,this.base(e),this.apply=function(e,t,a,i,r){}},L.Element.feMorphology.prototype=new L.Element.ElementBase,L.Element.feComposite=function(e){this.base=L.Element.ElementBase,this.base(e),this.apply=function(e,t,a,i,r){}},L.Element.feComposite.prototype=new L.Element.ElementBase,L.Element.feColorMatrix=function(e){this.base=L.Element.ElementBase,this.base(e);var i=L.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var t=i[0];i=[.213+.787*t,.715-.715*t,.072-.072*t,0,0,.213-.213*t,.715+.285*t,.072-.072*t,0,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var r=i[0]*Math.PI/180,a=function(e,t,a){return e+Math.cos(r)*t+Math.sin(r)*a};i=[a(.213,.787,-.213),a(.715,-.715,-.715),a(.072,-.072,.928),0,0,a(.213,-.213,.143),a(.715,.285,.14),a(.072,-.072,-.283),0,0,a(.213,-.213,-.787),a(.715,-.715,.715),a(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}function u(e,t,a,i,r,n){return e[a*i*4+4*t+n]}function h(e,t,a,i,r,n,o){e[a*i*4+4*t+n]=o}function p(e,t){var a=i[e];return a*(a<0?t-255:t)}this.apply=function(e,t,a,i,r){var n=e.getImageData(0,0,i,r);for(a=0;a<r;a++)for(t=0;t<i;t++){var o=u(n.data,t,a,i,0,0),s=u(n.data,t,a,i,0,1),l=u(n.data,t,a,i,0,2),c=u(n.data,t,a,i,0,3);h(n.data,t,a,i,0,0,p(0,o)+p(1,s)+p(2,l)+p(3,c)+p(4,1)),h(n.data,t,a,i,0,1,p(5,o)+p(6,s)+p(7,l)+p(8,c)+p(9,1)),h(n.data,t,a,i,0,2,p(10,o)+p(11,s)+p(12,l)+p(13,c)+p(14,1)),h(n.data,t,a,i,0,3,p(15,o)+p(16,s)+p(17,l)+p(18,c)+p(19,1))}e.clearRect(0,0,i,r),e.putImageData(n,0,0)}},L.Element.feColorMatrix.prototype=new L.Element.ElementBase,L.Element.feGaussianBlur=function(e){this.base=L.Element.ElementBase,this.base(e),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(e,t,a,i,r){m&&void 0!==m.canvasRGBA?(e.canvas.id=L.UniqueId(),e.canvas.style.display="none",document.body.appendChild(e.canvas),m.canvasRGBA(e.canvas,t,a,i,r,this.blurRadius),document.body.removeChild(e.canvas)):L.log("ERROR: StackBlur.js must be included for blur to work")}},L.Element.feGaussianBlur.prototype=new L.Element.ElementBase,L.Element.title=function(e){},L.Element.title.prototype=new L.Element.ElementBase,L.Element.desc=function(e){},L.Element.desc.prototype=new L.Element.ElementBase,L.Element.MISSING=function(e){L.log("ERROR: Element '"+e.nodeName+"' not yet implemented.")},L.Element.MISSING.prototype=new L.Element.ElementBase,L.CreateElement=function(e){var t=e.nodeName.replace(/^[^:]+:/,"");t=t.replace(/\-/g,"");var a=null;return(a=void 0!==L.Element[t]?new L.Element[t](e):new L.Element.MISSING(e)).type=e.nodeName,a},L.load=function(e,t){L.loadXml(e,L.ajax(t))},L.loadXml=function(e,t){L.loadXmlDoc(e,L.parseXml(t))},L.loadXmlDoc=function(n,o){L.init(n);var a=function(e){for(var t=n.canvas;t;)e.x-=t.offsetLeft,e.y-=t.offsetTop,t=t.offsetParent;return u.scrollX&&(e.x+=u.scrollX),u.scrollY&&(e.y+=u.scrollY),e};1!=L.opts.ignoreMouse&&(n.canvas.onclick=function(e){var t=a(new L.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));L.Mouse.onclick(t.x,t.y)},n.canvas.onmousemove=function(e){var t=a(new L.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));L.Mouse.onmousemove(t.x,t.y)});var s=L.CreateElement(o.documentElement);s.root=!0,s.addStylesFromStyleDefinition();var l=!0,i=function(){L.ViewPort.Clear(),n.canvas.parentNode?L.ViewPort.SetCurrent(n.canvas.parentNode.clientWidth,n.canvas.parentNode.clientHeight):L.ViewPort.SetCurrent(800,600),1!=L.opts.ignoreDimensions&&(s.style("width").hasValue()&&(n.canvas.width=s.style("width").toPixels("x"),n.canvas.style&&(n.canvas.style.width=n.canvas.width+"px")),s.style("height").hasValue()&&(n.canvas.height=s.style("height").toPixels("y"),n.canvas.style&&(n.canvas.style.height=n.canvas.height+"px")));var e=n.canvas.clientWidth||n.canvas.width,t=n.canvas.clientHeight||n.canvas.height;if(1==L.opts.ignoreDimensions&&s.style("width").hasValue()&&s.style("height").hasValue()&&(e=s.style("width").toPixels("x"),t=s.style("height").toPixels("y")),L.ViewPort.SetCurrent(e,t),null!=L.opts.offsetX&&(s.attribute("x",!0).value=L.opts.offsetX),null!=L.opts.offsetY&&(s.attribute("y",!0).value=L.opts.offsetY),null!=L.opts.scaleWidth||null!=L.opts.scaleHeight){var a=null,i=null,r=L.ToNumberArray(s.attribute("viewBox").value);null!=L.opts.scaleWidth&&(s.attribute("width").hasValue()?a=s.attribute("width").toPixels("x")/L.opts.scaleWidth:isNaN(r[2])||(a=r[2]/L.opts.scaleWidth)),null!=L.opts.scaleHeight&&(s.attribute("height").hasValue()?i=s.attribute("height").toPixels("y")/L.opts.scaleHeight:isNaN(r[3])||(i=r[3]/L.opts.scaleHeight)),null==a&&(a=i),null==i&&(i=a),s.attribute("width",!0).value=L.opts.scaleWidth,s.attribute("height",!0).value=L.opts.scaleHeight,s.style("transform",!0,!0).value+=" scale("+1/a+","+1/i+")"}1!=L.opts.ignoreClear&&n.clearRect(0,0,e,t),s.render(n),l&&(l=!1,"function"==typeof L.opts.renderCallback&&L.opts.renderCallback(o))},r=!0;L.ImagesLoaded()&&(r=!1,i()),L.intervalID=setInterval(function(){var e=!1;if(r&&L.ImagesLoaded()&&(e=!(r=!1)),1!=L.opts.ignoreMouse&&(e|=L.Mouse.hasEvents()),1!=L.opts.ignoreAnimation)for(var t=0;t<L.Animations.length;t++)e|=L.Animations[t].update(1e3/L.FRAMERATE);"function"==typeof L.opts.forceRedraw&&1==L.opts.forceRedraw()&&(e=!0),e&&(i(),L.Mouse.runEvents())},1e3/L.FRAMERATE)},L.stop=function(){L.intervalID&&clearInterval(L.intervalID)},L.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(e,t){this.events.push({type:"onclick",x:e,y:t,run:function(e){e.onclick&&e.onclick()}})},this.onmousemove=function(e,t){this.events.push({type:"onmousemove",x:e,y:t,run:function(e){e.onmousemove&&e.onmousemove()}})},this.eventElements=[],this.checkPath=function(e,t){for(var a=0;a<this.events.length;a++){var i=this.events[a];t.isPointInPath&&t.isPointInPath(i.x,i.y)&&(this.eventElements[a]=e)}},this.checkBoundingBox=function(e,t){for(var a=0;a<this.events.length;a++){var i=this.events[a];t.isPointInBox(i.x,i.y)&&(this.eventElements[a]=e)}},this.runEvents=function(){L.ctx.canvas.style.cursor="";for(var e=0;e<this.events.length;e++)for(var t=this.events[e],a=this.eventElements[e];a;)t.run(a),a=a.parent;this.events=[],this.eventElements=[]}},L}(a||{});"string"==typeof e&&(e=document.getElementById(e)),null!=e.svg&&e.svg.stop(),e.childNodes&&1==e.childNodes.length&&"OBJECT"==e.childNodes[0].nodeName||(e.svg=i);var r=e.getContext("2d");void 0!==t.documentElement?i.loadXmlDoc(r,t):"<"==t.substr(0,1)?i.loadXml(r,t):i.load(r,t)}else for(var n=document.querySelectorAll("svg"),o=0;o<n.length;o++){var s=n[o],l=document.createElement("canvas");l.width=s.clientWidth,l.height=s.clientHeight,s.parentNode.insertBefore(l,s),s.parentNode.removeChild(s);var c=document.createElement("div");c.appendChild(s),h(l,c.innerHTML)}};"undefined"==typeof Element||(void 0!==Element.prototype.matches?p=function(e,t){return e.matches(t)}:void 0!==Element.prototype.webkitMatchesSelector?p=function(e,t){return e.webkitMatchesSelector(t)}:void 0!==Element.prototype.mozMatchesSelector?p=function(e,t){return e.mozMatchesSelector(t)}:void 0!==Element.prototype.msMatchesSelector?p=function(e,t){return e.msMatchesSelector(t)}:void 0!==Element.prototype.oMatchesSelector?p=function(e,t){return e.oMatchesSelector(t)}:("function"!=typeof jQuery&&"function"!=typeof Zepto||(p=function(e,t){return $(e).is(t)}),void 0===p&&"undefined"!=typeof Sizzle&&(p=Sizzle.matchesSelector)));var t=/(\[[^\]]+\])/g,a=/(#[^\s\+>~\.\[:]+)/g,n=/(\.[^\s\+>~\.\[:]+)/g,o=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,s=/(:[\w-]+\([^\)]*\))/gi,l=/(:[^\s\+>~\.\[:]+)/g,c=/([^\s\+>~\.\[:]+)/g;function P(i){var r=[0,0,0],e=function(e,t){var a=i.match(e);null!=a&&(r[t]+=a.length,i=i.replace(e," "))};return i=(i=i.replace(/:not\(([^\)]*)\)/g,"     $1 ")).replace(/{[\s\S]*/gm," "),e(t,1),e(a,0),e(n,1),e(o,2),e(s,1),e(l,1),i=(i=i.replace(/[\*\s\+>~]/g," ")).replace(/[#\.]/g," "),e(c,2),r.join("")}"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(e,t,a,i,r,n){var o={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:t,offsetY:a,scaleWidth:i,scaleHeight:r};for(var s in n)n.hasOwnProperty(s)&&(o[s]=n[s]);h(this.canvas,e,o)}),e.exports=h}(e={exports:{}},e.exports),e.exports}(a("WOGj"),a("Qu5F"))},DUx5:function(e,t,a){},GAzf:function(e,t,a){"use strict";var i=a("4zwu"),r=a("FuRH"),n=a("3Dh3"),o=a("+NyJ");t.a={data:function(){return{listenMapLoad:!1}},computed:{dataIds:function(){return this.component.dataIds||[]},dataId:function(){return this.dataIds[0]},currentDataCache:function(){return this.$store.getters.getDataCache(this.dataId)},components:function(){return this.$store.getters.components},componentType:function(){return this.component.componentType},mapTarget:function(){return this.component.propDatas.mapTarget},currentProps:function(){var e,t;return"server"===(e=this.renderProps).dataType&&0<this.dataIds.length&&(t=this.getValueProps(e),Object.assign(e,t)),e},labelConfig:function(){return Object(o.f)(this.component.componentId,this.dataId)}},beforeCreate:function(){this.watcher=[]},mounted:function(){this.listenMapLoad&&r.a.$on("load-map",this.loadMapSucceed)},beforeDestroy:function(){this.listenMapLoad&&r.a.$off("load-map",this.loadMapSucceed)},methods:{cleanWatcher:function(){this.watcher.forEach(function(e){e()}),this.watcher=[]},loadMapSucceed:function(e,t){t===this.mapTarget&&this.loadMap(t)},loadMap:function(){},getValueProps:function(e){var t=this.getFeatureId(this.dataId),t=this.currentDataCache&&this.currentDataCache.type&&-1!==this.currentDataCache.type.indexOf("time")&&e.filterCategoryValue?i.a.$options.getDataByCategory(this.currentDataCache,[e.filterCategoryValue])||{}:i.a.$options.getData(t)||{};return this.updateDataPropsHandler(e,{features:t})},getValueByField:function(e,t){var a=this.currentDataCache&&this.currentDataCache.type&&-1!==this.currentDataCache.type.indexOf("time"),e=e&&e.features&&e.features.features,a=a?e&&e.length-1:0,t=e&&0<=a&&e[a]&&e[a].properties[t];return t||0===t?t.toString():""},hasField:function(e,t){return e&&e.features&&e.features.features[0]&&e.features.features[0].properties.hasOwnProperty(t)},getFeatureId:function(e){return Object(n.f)(this.$store.getters.getDataCache,e)}}}},Lb6U:function(e,t,a){"use strict";t.a={highlight:"featureSelection"}},OcSP:function(e){e.exports=JSON.parse('[{"name":"jiuzhaigou","thumbnail":"static/templates/img/jiuzhaigou.png","templatePath":"static/templates/jiuzhaigou.json"},{"name":"wisdomPark","thumbnail":"static/templates/img/wisdomPark.png","templatePath":"static/templates/wisdom-park.json"},{"name":"citySmartCityOverview","thumbnail":"static/templates/img/city-smart-city-overview.png","templatePath":"static/templates/city-smart-city-overview.json"},{"name":"citySmartCityManagement","thumbnail":"static/templates/img/city-smart-city-management.png","templatePath":"static/templates/city-smart-city-management.json"},{"name":"citySmartCityEconomy","thumbnail":"static/templates/img/city-smart-city-economy.png","templatePath":"static/templates/city-smart-city-economy.json"},{"name":"citySmartCityLivelihood","thumbnail":"static/templates/img/city-smart-city-livelihood.png","templatePath":"static/templates/city-smart-city-livelihood.json"},{"name":"seventhCensus","thumbnail":"static/templates/img/seventh-census.png","templatePath":"static/templates/seventh-census.json"},{"name":"securityMonitoring","thumbnail":"static/templates/img/securityMonitoring.png","templatePath":"static/templates/security-monitoring.json"},{"name":"NatureResourcePlatform","thumbnail":"static/templates/img/resource.png","templatePath":"static/templates/natureResource.json"},{"name":"EcologicalBigDataPlatform","thumbnail":"static/templates/img/ecological-big-data-platform.png","templatePath":"static/templates/ecological-big-data-platform.json"},{"name":"Interaction","thumbnail":"static/templates/img/interaction.png","templatePath":"static/templates/interaction.json"},{"name":"TrackPlayback","thumbnail":"static/templates/img/track-playback.png","templatePath":"static/templates/track-playback.json"},{"name":"MultiMap-Interaction","thumbnail":"static/templates/img/multi-map-interaction.png","templatePath":"static/templates/multi-map-interaction.json"},{"name":"operationMonitoring","thumbnail":"static/templates/img/operation-monitoring.png","templatePath":"static/templates/operation-monitoring.json"},{"name":"Ncp","thumbnail":"static/templates/img/ncp.png","templatePath":"static/templates/ncp.json"},{"name":"SuperMap Building","thumbnail":"static/templates/img/supermap-building.png","templatePath":"static/templates/supermap.json"},{"name":"Qixiang Cloud","thumbnail":"static/templates/img/qixiang-cloud.png","templatePath":"static/templates/qixiang-cloud.json"},{"name":"NcpSwitch","thumbnail":"static/templates/img/ncp-switch1.png","templatePath":"static/templates/ncp-switch.json"},{"name":"NcpGlobal","thumbnail":"static/templates/img/ncp-global.png","templatePath":"static/templates/ncp-global.json"},{"name":"NcpTimeline","thumbnail":"static/templates/img/ncp-timeline.png","templatePath":"static/templates/ncp-timeline.json"},{"name":"NcpCompare","thumbnail":"static/templates/img/ncp-compare.png","templatePath":"static/templates/ncp-compare.json"},{"name":"LandUse","thumbnail":"static/templates/img/landuse.png","templatePath":"static/templates/landuse.json"},{"name":"RealEstateMonitoring","thumbnail":"static/templates/img/estatemonitor.png","templatePath":"static/templates/estatemonitor.json"},{"name":"tianditu","thumbnail":"static/templates/img/tianditu.png","templatePath":"static/templates/tianditu.json"},{"name":"travelMonitoring","thumbnail":"static/templates/img/travel-monitoring.png","templatePath":"static/templates/travel-monitoring.json"},{"name":"businessRevenue","thumbnail":"static/templates/img/business-revenue.png","templatePath":"static/templates/business-revenue.json"}]')},QDzv:function(e,t,a){"use strict";a("R4ge")},Qu5F:function(e,t){var G=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],W=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function s(e,t,a,i,r){if("string"==typeof e)e=document.getElementById(e);else if("undefined"!=typeof HTMLCanvasElement&&!e instanceof HTMLCanvasElement)return;var n,e=e.getContext("2d");try{try{n=e.getImageData(t,a,i,r)}catch(e){throw new Error("unable to access local image data: "+e)}}catch(e){throw new Error("unable to access image data: "+e)}return n}function l(e,t,a,i,r,n){var o;isNaN(n)||n<1||(n|=0,o=c(o=s(e,t,a,i,r),0,0,i,r,n),e.getContext("2d").putImageData(o,t,a))}function c(e,t,a,i,r,n){for(var o,s,l,c,u,h,p,d,f,m,y,g,v,b,x,w,S,P,_,C,T,k=e.data,M=n+n+1,E=i-1,O=r-1,I=n+1,L=I*(I+1)/2,D=new $,j=D,A=1;A<M;A++){var N,j=j.next=new $;A==I&&(N=j)}j.next=D;for(var F=null,B=null,R=c=0,z=G[n],U=W[n],V=0;V<r;V++){for(v=b=x=w=u=h=p=d=0,f=I*(S=k[c]),m=I*(P=k[c+1]),y=I*(_=k[c+2]),g=I*(C=k[c+3]),u+=L*S,h+=L*P,p+=L*_,d+=L*C,j=D,A=0;A<I;A++)j.r=S,j.g=P,j.b=_,j.a=C,j=j.next;for(A=1;A<I;A++)u+=(j.r=S=k[s=c+((E<A?E:A)<<2)])*(T=I-A),h+=(j.g=P=k[s+1])*T,p+=(j.b=_=k[s+2])*T,d+=(j.a=C=k[s+3])*T,v+=S,b+=P,x+=_,w+=C,j=j.next;for(F=D,B=N,o=0;o<i;o++)k[c+3]=C=d*z>>U,0!=C?(k[c]=(u*z>>U)*(C=255/C),k[c+1]=(h*z>>U)*C,k[c+2]=(p*z>>U)*C):k[c]=k[c+1]=k[c+2]=0,u-=f,h-=m,p-=y,d-=g,f-=F.r,m-=F.g,y-=F.b,g-=F.a,s=R+((s=o+n+1)<E?s:E)<<2,u+=v+=F.r=k[s],h+=b+=F.g=k[s+1],p+=x+=F.b=k[s+2],d+=w+=F.a=k[s+3],F=F.next,f+=S=B.r,m+=P=B.g,y+=_=B.b,g+=C=B.a,v-=S,b-=P,x-=_,w-=C,B=B.next,c+=4;R+=i}for(o=0;o<i;o++){for(b=x=w=v=h=p=d=u=0,f=I*(S=k[c=o<<2]),m=I*(P=k[c+1]),y=I*(_=k[c+2]),g=I*(C=k[c+3]),u+=L*S,h+=L*P,p+=L*_,d+=L*C,j=D,A=0;A<I;A++)j.r=S,j.g=P,j.b=_,j.a=C,j=j.next;for(l=i,A=1;A<=n;A++)u+=(j.r=S=k[c=l+o<<2])*(T=I-A),h+=(j.g=P=k[c+1])*T,p+=(j.b=_=k[c+2])*T,d+=(j.a=C=k[c+3])*T,v+=S,b+=P,x+=_,w+=C,j=j.next,A<O&&(l+=i);for(c=o,F=D,B=N,V=0;V<r;V++)k[(s=c<<2)+3]=C=d*z>>U,0<C?(k[s]=(u*z>>U)*(C=255/C),k[s+1]=(h*z>>U)*C,k[s+2]=(p*z>>U)*C):k[s]=k[s+1]=k[s+2]=0,u-=f,h-=m,p-=y,d-=g,f-=F.r,m-=F.g,y-=F.b,g-=F.a,s=o+((s=V+I)<O?s:O)*i<<2,u+=v+=F.r=k[s],h+=b+=F.g=k[s+1],p+=x+=F.b=k[s+2],d+=w+=F.a=k[s+3],F=F.next,f+=S=B.r,m+=P=B.g,y+=_=B.b,g+=C=B.a,v-=S,b-=P,x-=_,w-=C,B=B.next,c+=i}return e}function u(e,t,a,i,r,n){var o;isNaN(n)||n<1||(n|=0,o=h(o=s(e,t,a,i,r),0,0,i,r,n),e.getContext("2d").putImageData(o,t,a))}function h(e,t,a,i,r,n){for(var o,s,l,c,u,h,p,d,f,m,y,g,v,b,x,w,S,P=e.data,_=n+n+1,C=i-1,T=r-1,k=n+1,M=k*(k+1)/2,E=new $,O=E,I=1;I<_;I++){var L,O=O.next=new $;I==k&&(L=O)}O.next=E;for(var D=null,j=null,A=c=0,N=G[n],F=W[n],B=0;B<r;B++){for(y=g=v=u=h=p=0,d=k*(b=P[c]),f=k*(x=P[c+1]),m=k*(w=P[c+2]),u+=M*b,h+=M*x,p+=M*w,O=E,I=0;I<k;I++)O.r=b,O.g=x,O.b=w,O=O.next;for(I=1;I<k;I++)u+=(O.r=b=P[s=c+((C<I?C:I)<<2)])*(S=k-I),h+=(O.g=x=P[s+1])*S,p+=(O.b=w=P[s+2])*S,y+=b,g+=x,v+=w,O=O.next;for(D=E,j=L,o=0;o<i;o++)P[c]=u*N>>F,P[c+1]=h*N>>F,P[c+2]=p*N>>F,u-=d,h-=f,p-=m,d-=D.r,f-=D.g,m-=D.b,s=A+((s=o+n+1)<C?s:C)<<2,u+=y+=D.r=P[s],h+=g+=D.g=P[s+1],p+=v+=D.b=P[s+2],D=D.next,d+=b=j.r,f+=x=j.g,m+=w=j.b,y-=b,g-=x,v-=w,j=j.next,c+=4;A+=i}for(o=0;o<i;o++){for(g=v=y=h=p=u=0,d=k*(b=P[c=o<<2]),f=k*(x=P[c+1]),m=k*(w=P[c+2]),u+=M*b,h+=M*x,p+=M*w,O=E,I=0;I<k;I++)O.r=b,O.g=x,O.b=w,O=O.next;for(l=i,I=1;I<=n;I++)u+=(O.r=b=P[c=l+o<<2])*(S=k-I),h+=(O.g=x=P[c+1])*S,p+=(O.b=w=P[c+2])*S,y+=b,g+=x,v+=w,O=O.next,I<T&&(l+=i);for(c=o,D=E,j=L,B=0;B<r;B++)P[s=c<<2]=u*N>>F,P[s+1]=h*N>>F,P[s+2]=p*N>>F,u-=d,h-=f,p-=m,d-=D.r,f-=D.g,m-=D.b,s=o+((s=B+k)<T?s:T)*i<<2,u+=y+=D.r=P[s],h+=g+=D.g=P[s+1],p+=v+=D.b=P[s+2],D=D.next,d+=b=j.r,f+=x=j.g,m+=w=j.b,y-=b,g-=x,v-=w,j=j.next,c+=i}return e}function $(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}e.exports={image:function(e,t,a,i){if("string"==typeof e)e=document.getElementById(e);else if("undefined"!=typeof HTMLImageElement&&!e instanceof HTMLImageElement)return;var r=e.naturalWidth,n=e.naturalHeight;if("string"==typeof t)t=document.getElementById(t);else if("undefined"!=typeof HTMLCanvasElement&&!t instanceof HTMLCanvasElement)return;t.style.width=r+"px",t.style.height=n+"px",t.width=r,t.height=n;var o=t.getContext("2d");o.clearRect(0,0,r,n),o.drawImage(e,0,0),isNaN(a)||a<1||(i?l:u)(t,0,0,r,n,a)},canvasRGBA:l,canvasRGB:u,imageDataRGBA:c,imageDataRGB:h}},R4ge:function(e,t,a){},SknJ:function(e,t,a){"use strict";a("5Ynx")},UUUU:function(e,t,a){"use strict";a("c2Rp")},UYfL:function(e,t,a){"use strict";a("DUx5")},WOGj:function(e,t){e.exports=function(e){this.ok=!1,this.alpha=1,e=(e=(e="#"==e.charAt(0)?e.substr(1,6):e).replace(/ /g,"")).toLowerCase();var u={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};e=u[e]||e;for(var h=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseFloat(e[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],t=0;t<h.length;t++){var a=h[t].re,i=h[t].process,a=a.exec(e);a&&(a=i(a),this.r=a[0],this.g=a[1],this.b=a[2],3<a.length&&(this.alpha=a[3]),this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:255<this.r?255:this.r,this.g=this.g<0||isNaN(this.g)?0:255<this.g?255:this.g,this.b=this.b<0||isNaN(this.b)?0:255<this.b?255:this.b,this.alpha=this.alpha<0?0:1<this.alpha||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),a=this.b.toString(16);return"#"+(e=1==e.length?"0"+e:e)+(t=1==t.length?"0"+t:t)+(a=1==a.length?"0"+a:a)},this.getHelpXML=function(){for(var e,t=new Array,a=0;a<h.length;a++)for(var i=h[a].example,r=0;r<i.length;r++)t[t.length]=i[r];for(e in u)t[t.length]=e;var n=document.createElement("ul");n.setAttribute("id","rgbcolor-examples");for(a=0;a<t.length;a++)try{var o=document.createElement("li"),s=new RGBColor(t[a]),l=document.createElement("div");l.style.cssText="margin: 3px; border: 1px solid black; background:"+s.toHex()+"; color:"+s.toHex(),l.appendChild(document.createTextNode("test"));var c=document.createTextNode(" "+t[a]+" -> "+s.toRGB()+" -> "+s.toHex());o.appendChild(l),o.appendChild(c),n.appendChild(o)}catch(e){}return n}}},YQ51:function(e,t,a){"use strict";var n=a("GbHz"),i={data:function(){return{}},computed:{listeners:function(){var e=this.component.componentId;return this.$store.getters.getListensByComponentId(e)}},methods:{initListeners:function(){this.listenersHandler&&this.listenersHandler(this.listeners,[])},handleResetTriggers:function(e,t){if(t)for(var a in t){var i,r=n.c[a].resetHandlerName;r&&(i=t[a],a=e&&e[a]||[],0<i.length&&0===a.length&&this[r]())}}}},a=a("KHd+"),i=Object(a.a)(i,void 0,void 0,!1,null,null,null);t.a=i.exports},"Z94/":function(e,t){var a=Object.prototype.toString;e.exports=function(e){return"number"==typeof e||!!(t=e)&&"object"==typeof t&&"[object Number]"==a.call(e);var t}},aXEy:function(e,t,a){"use strict";a.r(t);var i=a("hdLw"),d=a.n(i),r=(a("xKWM"),a("oUIn")),f=a("QCDS"),h=a("3Dh3"),n=a("GAzf"),o=a("zT9C"),m=a.n(o),s=a("wd/R"),y=a.n(s),l=a("YY/H"),p=a.n(l),g=a("FuRH"),v=a("M7pi"),b=a("wyqS");function c(t,e){var a,i=Object.keys(t);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(t),e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,a)),i}function x(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?c(Object(r),!0).forEach(function(e){var t,a;t=i,e=r[a=e],a in t?Object.defineProperty(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}function u(e){var i,r,n,o,t,a=e.layerNames,s=e.mapTarget,l=e.dataCache,c=e.transformSucceeded,u=e.getFeaturesSucceeded;a instanceof Array&&(i=g.a.$options.getWebMap(s)||{},r=i._layers,n=[],o=[],a.forEach(function(t){var e,l,c,u,h,p,d,a=r.find(function(e){return e.layerID===t});a&&(o.push((a=(e={layer:a,webMap:i,mapTarget:s}).layer,l=e.webMap,c=e.mapName,u=e.mapTarget,h=a.dataSource,p=a.layerID,d=(h||{}).serverId||a.serverId,new Promise(function(t){var a={dataInfo:{name:p,displayName:"".concat(c||l.mapParams.title,"-").concat(p),mapTarget:u},frequency:2,timing:!1},e=h||{},i=e.type,r=e.dataSourceName,n=e.url,o=e.layerName,s=e.accessType;-1!==["REST_DATA","REST_MAP"].indexOf(i)?(i={type:"iServer",withCredentials:!1,url:n},o&&(i.layerName=o),r&&(i.dataName=[r]),i.id=n+(o||r||""),a.hashId=i.id,a.proxy="",Object.assign(a.dataInfo,i),t(a)):d?Object(b.d)("".concat(l.serverUrl,"web/datas/").concat(d),l.withCredentials).then(function(e){e={type:"iPortal",id:d,url:e.url,dataType:e.dataType,updateTime:y()(e.lastModfiedTime).format("YYYY-MM-DD HH:mm:ss"),serviceStatus:e.serviceStatus,dataItemServices:e.dataItemServices,withCredentials:!0,preferContent:"DIRECT"===s};a.hashId=d.toString(),a.proxy="",Object.assign(a.dataInfo,e),t(a)},function(){return t()}):t()}))),n.push(t))}),t=p()(a,n),o&&o.length&&Promise.all(o).then(function(e){e=v.a.deduplicateData(e);e.forEach(function(s){s.dataInfo.attributeFilter||(s.dataInfo.attributeFilter="SmID>0"),s.dataInfo.maxFeatures||(s.dataInfo.maxFeatures=8),Object(b.a)(x(x({},s.dataInfo),{},{proxy:s.proxy}),function(e){var t,a=e.features,i=e.fields,r=e.fieldCaptions,n=e.fieldValues,o=e.transformed,e=e.error;a&&!e||(t="failed"),l[s.hashId]||u&&u(x(x({},s),{},{status:t}),{features:a,fields:i,fieldCaptions:r,fieldValues:n,transformed:o})})});e=Object(h.a)(e.map(function(e){return e.dataInfo||{}})),e=Object.assign(e,{layerNames:t});c&&c(e)}))}var w={computed:{layerNames:function(){var e=this.component.propDatas,t=e.searchControl,e=e.layerNames;return(void 0===t?{}:t).layerNames||e}},created:function(){this.layerNames&&this.layerNames.length&&(this.listenMapLoad=!0)},methods:{loadMap:function(){u({layerNames:this.layerNames,mapTarget:this.mapTarget,dataCache:this.$store.getters.dataCache,transformSucceeded:this.updateSearchProps,getFeaturesSucceeded:this.addDataCache})},dispatchUpdateDataProps:function(e){this.$store.dispatch("CHANGE_COMPONENT_PROPS_SETTING",{componentId:this.component.componentId,propDatas:e})},updateSearchProps:function(e){var t,a=m()(this.component.propDatas),i=a.searchControl||a;for(t in e){var r,n,o=e[t];"layerNames"===t?i[t]=o:0<o.length&&(r=i[t],n=i.dataIds||[],i[t]=r?r.concat(o):o,o=Array.from(new Set(n.concat(o.map(function(e){return e.hashId})))),i.dataIds=o)}this.dispatchUpdateDataProps(a)},addDataCache:function(e,t){this.$store.dispatch("ADD_DATA",{dataInfo:e,data:t})}}},S=a("qAG6"),P=a("4zwu");function _(e){return function(e){if(Array.isArray(e))return C(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return C(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(a="Object"===a&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?C(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function T(t,e){var a,i=Object.keys(t);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(t),e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,a)),i}function k(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?T(Object(r),!0).forEach(function(e){var t,a;t=i,e=r[a=e],a in t?Object.defineProperty(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}var i={mixins:[n.a,w],computed:{layerDataIds:function(){var e={};if(this.dataIds)for(var t in this.dataIds)"searchControl"!==t&&"queryControl"!==t&&this.dataIds[t]&&0<this.dataIds[t].length&&(e[t]=this.dataIds[t]);return e},currentProps:function(){var e;return(e=this.defaultParams.props).layers=this.getFilterLayerFeatures(),e.trackLayers=this.getTrackLayersFeatures(),e},layerDataCache:function(){var a=this;return function(e,t){e=a.$store.getters.getDataCache(e)||{};return Object.assign({},e,a.filterActionData[t]||{})}}},watch:{dataIds:{handler:function(e,t){var i=this;if(this.cleanWatcher(),this.dataProps={},this.dataIds)for(var a in this.dataIds)!function(a){var e=i.dataIds[a];e?e.forEach(function(e){i.watcher.push(i.$watch(function(){return i.$store.getters.getDataIdFromDataCache(e)},function(e,t){!e&&!t&&i.component.componentId||e===t||i.handleWebMapUpdate(a)},{deep:!0,immediate:!0}))}):t&&t[a]&&i.resetWebMapInfo(),"trackLayers"===a&&i.resetTrackLayers(i.dataIds.trackLayers,t&&t.trackLayers)}(a)},immediate:!0},"currentProps.layersIdField":function(e,t){var a;if(e)for(var i in e)t&&e[i]!==t[i]&&((a=a||{})[i]=e[i]);a&&this.updateMapSelfLayers()}},methods:{handleWebMapUpdate:function(e){"searchControl"!==e&&"queryControl"!==e&&(this.getFilterLayerFeatures(),this.getTrackLayersFeatures())},getLayerFeatures:function(){var e,i=this,r={};for(e in this.layerDataIds)!function(a){i.layerDataIds[a]&&0<i.layerDataIds[a].length&&(r[a]=[],i.layerDataIds[a].forEach(function(e,t){e?(t="trackLayers"===a?"track-layer".concat(0<t?t:""):a,t=(t=i.layerDataCache(e,t)).featureId||t.data,r[a].push(P.a.$options.getData(t)||{})):r[a].push(void 0)}))}(e);return r},updateMapSelfLayers:function(n){var o,s,l=this,e=this.currentProps.target;!g.a.$options.getMap(e)||(e=(o=g.a.$options.getWebMap(e))._layers)&&(s=this.getLayerFeatures(),e.forEach(function(e){var t,a,i,r="".concat(e.layerID);(n&&n[e.layerID]||l.dataIds.hasOwnProperty(r))&&(t=(i=n&&n[e.layerID]||{}).mergeField,a=(i=(a=i.featureId)&&P.a.$options.getData(a)||s[r]&&s[r][0]||{}).features&&i.features.features,e.hasOwnProperty("themeSetting")&&a&&!Object(S.i)(a[0]&&a[0].properties,e.themeSetting.themeField)&&0!==Object(S.i)(a[0]&&a[0].properties,e.themeSetting.themeField)?l.$message.error(l.$t("setting.webMap.inValidDataTip")):(i=l.defaultParams.props.layersIdField||{},(e=m()(e)).projection="EPSG:4326",o.updateOverlayLayer(e,a,t||i[r])))}))},resetWebMapInfo:function(){this.updateMapSelfLayers()},diffData:function(e,t){var a,i;for(i in e)t&&t[i]&&e[i]!==t[i]&&((a=a||{})[i]=e[i]);return a},getFilterLayerFeatures:function(){var n,o=this.defaultParams.props.layers;return o&&o.length&&(n=this.getLayerFeatures(),o.forEach(function(e,t){var a=e.propDatas,i=a.attributeFilter,r=a.maxFeatures,a="layers_".concat(e.ref),e=n[a]&&n[a][0],a=e&&e.features,e={};i&&(e=Object(b.b)(i,r,a)),r&&!i&&(e=Object(b.c)(r,a)),o[t].propDatas.features=Object.freeze(e)})),Object.freeze(o)},getTrackLayersFeatures:function(){var o=this,s=this.defaultParams.props.trackLayers;if(!s||!s.length)return s;var l=this.getLayerFeatures().trackLayers,c=this.layerDataIds.trackLayers;return l?(s.forEach(function(e,t){s[t].propDatas.trackPoints=o.getTrackLayerDatas(c[t]);var a=o.layerDataCache(c[t],s[t].ref),i=l[t]&&l[t].features,r=i&&i.features&&i.features[0]&&i.features[0].properties,n=a.nextTimeStamp,i=a.playInterval,a=a.currentTimeStamp,r=(r=(r||{}).timestamp)&&+new Date(r);s[t].propDatas.position={prevTimestamp:r,currentTimestamp:a||r,nextTimestamp:n&&1e3*n,step:i}}),Object.freeze(s)):s},getTrackAllDatas:function(e){e=this.$store.getters.getDataCache(e);if(e){e="timeData"===e.type?e.timeDataId:e.data;return P.a.$options.getData(e)}},getTrackLayerDatas:function(e){var a=this.getTrackAllDatas(e);if(a){var t,i=[];for(t in a)!function(t){var e=a[t];e&&0<e.length&&(0<(e=e.filter(function(e){return e.geometry&&"Point"===e.geometry.type}).map(function(e){return k(k({},e),{},{properties:k(k({},e.properties),{},{timestamp:1e3*t})})})).length&&i.push.apply(i,_(e)))}(t);return Object.freeze(i)}},resetTrackLayers:function(e,t){var a=this,t=this.diffData(e,t);t&&Object.keys(t).forEach(function(e){a.currentProps.trackLayers&&a.currentProps.trackLayers[e]&&(e=a.currentProps.trackLayers[e].ref,(e=a.$refs[e])&&e[0].reset())})}}},o=a("l6bU"),s=a("YQ51"),M=a("bG4Z"),l=a("9ad+"),n=a.n(l),w=a("5zrt"),l=a.n(w),w=a("45Hi"),w=a.n(w),E=a("mSNy"),O=[{id:"tianditu_vec_3857",title:Object(E.d)().t("internetMap.tiandituVec3857"),thumbnail:w.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/vec_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=vec&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cva_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=cva&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:3857",s:8},{id:"tianditu_ter_3857",title:Object(E.d)().t("internetMap.tiandituTer3857"),thumbnail:l.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/ter_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=ter&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cta_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=cta&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:3857",s:8},{id:"tianditu_img_3857",title:Object(E.d)().t("internetMap.tiandituImg3857"),thumbnail:n.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/img_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=img&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cia_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=cia&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:3857",s:8},{id:"tianditu_vec_4326",title:Object(E.d)().t("internetMap.tiandituVec4326"),thumbnail:w.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/vec_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=vec&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cva_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=cva&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:4326",s:8},{id:"tianditu_ter_4326",title:Object(E.d)().t("internetMap.tiandituTer4326"),thumbnail:l.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/ter_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=ter&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cta_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=cta&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:4326",s:8},{id:"tianditu_img_4326",title:Object(E.d)().t("internetMap.tiandituImg4326"),thumbnail:n.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/img_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=img&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cia_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=cia&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:4326",s:8}],I=a("OcSP");function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(t,e){var a,i=Object.keys(t);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(t),e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,a)),i}function j(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?D(Object(r),!0).forEach(function(e){var t,a;t=i,e=r[a=e],a in t?Object.defineProperty(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}function A(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function F(a){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=B(a);return function(e,t){{if(t&&("object"===L(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,i?(e=B(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var R=Object(f.g)(),z=Object(f.h)(),U="".concat(R,"/web/static/portal/img/mapDashboard/defaultThumbnail.png"),V={Map:function(e,t,a){a.url=t?z:R,a.withCredentials=!t},DrillMap:function(e,t,a){a.url=t?z:R,a.withCredentials=!t},Dashboard:function(e,t,a){a.name&&(a.title=a.name),a.thumbnail||(a.thumbnail=U),a.url="".concat(R,"/web/mapdashboards/").concat(a.id,".json"),a.withCredentials=!0},Scene:function(e,t,a){a.name&&(a.title=a.name),a.url||(a.url="".concat(R,"/web/scenes/").concat(a.id)),a.withCredentials=!0}},G={publicMap:!1,myMap:!0,publicDashboard:!1,myDashboard:!0,publicScene:!1,myScene:!0,online:!1},W=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&N(e,t)}(r,d.a.Evented);var e,t,a,i=F(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=i.call(this)).url=e,t.getDrillMaps=M.b,t.getMaps=M.b,t.getDashboards=M.a,t.getScenes=M.c,t.templates=I.map(function(e,t){return j(j({},e),{},{id:t+1,title:Object(E.d)().t("templatesName.".concat(e.name)),content:null})}),t.templates.unshift({content:{name:"empty"},id:0,thumbnail:"static/templates/img/empty.png",title:Object(E.d)().t("templatesName.newblankTemplate")}),t}return e=r,(t=[{key:"getResourceInfo",value:function(a,e,i,t,r,n){var o=this;this["get".concat(a,"s")]({params:e,isMyContent:i,permissionType:t,isOnline:r}).then(function(e){var t;e&&e.content&&(e.content.forEach(V[a].bind(o,i,r)),t=e.total?{current:e.currentPage,pageSize:e.pageSize,total:e.total}:null,o.fire("getresourceinfosucceeded",{result:e.content,activeKey:n,pagination:t}))})}},{key:"getResourceContent",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,r=4<arguments.length?arguments[4]:void 0,n={currentPage:a,pageSize:i};r&&(n.keywords=encodeURIComponent(r));var o=G[t],i="READ",r=!1;if("internetMap"!==t&&"service"!==t){if("Template"===e){if("template"===t)return void this.getTemplates(n,t);e="Dashboard",i="ALL"}this.getResourceInfo(e,n,o,i,r="online"===t?!0:r,t)}else"internetMap"===t&&this.fire("getresourceinfosucceeded",{result:O,activeKey:t,pagination:{total:O.length,current:a,pageSize:8}})}},{key:"getTemplates",value:function(e,t){var a=e.currentPage,i=e.pageSize,r=(a-1)*i,e=this.templates.slice(r,r+i),r=this.templates.length;this.fire("getresourceinfosucceeded",{result:e,activeKey:t,pagination:r?{current:a,pageSize:i,total:r}:null})}}])&&A(e.prototype,t),a&&A(e,a),Object.defineProperty(e,"prototype",{writable:!1}),r}(),w=a("9/5/"),$=a.n(w),l={name:"Input",model:{prop:"value",event:"change"},props:{type:{type:String,default:"text"},title:{type:String},placeholder:{type:String,default:function(){return this.$t("setting.common.input")}},value:{type:[String,Number]},input:{type:Function},wrap:{type:Boolean,default:!1},unit:{type:String},tips:{type:String},defaultValue:{type:Number,default:0},formatter:{type:Function},parser:{type:Function},max:{type:Number},min:{type:Number},precisionLimit:{type:Boolean,default:!0},precision:{type:Number,default:2},step:{type:Number,default:.5},decimalSeparator:{type:String,default:"."},disabled:{type:Boolean},icon:{type:Boolean,default:!1},iconClickCallback:{type:Function},iconTitle:String,colon:{type:Boolean,default:!1},useDebounce:{type:Boolean,default:!1},debounceTime:{type:Number,default:2e3}},computed:{precisionProps:function(){return this.precisionLimit?{precision:this.precision,step:this.step}:null}},created:function(){this.useDebounce&&(this.handleChangeFn=$()(this.emitChange,this.debounceTime,{trailing:!0}))},methods:{handleInput:function(e){this.$emit("input",e.target.value),this.input&&this.input(e.target.value)},handleBlur:function(e){this.$emit("blur",e.target.value)},handleFocus:function(e){this.$emit("focus",e.target.value)},handleClick:function(e){this.$emit("click",e.target.value)},handlePressEnter:function(e){this.$emit("pressEnter",e.target.value)},emitChange:function(e){this.$emit("change",""===e?void 0:e)},handleChange:function(e){this.useDebounce?this.handleChangeFn(e):this.emitChange(e)}}},n=(a("pc/F"),a("KHd+")),w=Object(n.a)(l,function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{class:["sm-setting-panel",{"is-wrap":t.wrap}]},[t.title?e("div",{staticClass:"sm-setting-panel__header"},[t._v("\n    "+t._s(t.colon?t.title+"：":t.title)+"\n    "),t.iconClickCallback?[t.icon?e("i",{staticClass:"sm-mapdashboard-icon-circle-query",style:{"margin-left":"-4px","font-size":"12px",cursor:"pointer"},attrs:{title:t.iconTitle},on:{click:t.iconClickCallback}}):t._e()]:[e("a-popover",{attrs:{trigger:"hover",placement:"bottom"}},[e("template",{slot:"content"},[e("div",[t._t("iconTip")],2)]),t._v(" "),t.icon?e("i",{staticClass:"sm-mapdashboard-icon-circle-query",style:{"margin-left":"-3px","font-size":"12px"},attrs:{title:t.iconTitle}}):t._e()],2)]],2):t._e(),t._v(" "),e("div",{staticClass:"sm-setting-panel__content",attrs:{title:t.tips}},["textArea"===t.type?e("sm-textarea",{attrs:{value:t.value,placeholder:t.placeholder},on:{input:t.handleInput,change:function(e){return t.handleChange(e.target.value)}}}):t._e(),t._v(" "),"text"===t.type?e("sm-input",{attrs:{value:t.value,placeholder:t.placeholder,disabled:t.disabled},on:{input:t.handleInput,blur:t.handleBlur,focus:t.handleFocus,click:t.handleClick,pressEnter:t.handlePressEnter,change:function(e){return t.handleChange(e.target.value)}}}):t._e(),t._v(" "),"number"===t.type?e("div",{class:{"input-number-holder":!0,"unit-gap":!!t.unit}},[e("sm-input-number",t._b({attrs:{value:t.value,placeholder:t.placeholder,formatter:t.formatter,defaultValue:t.defaultValue,parser:t.parser,max:t.max,min:t.min},on:{input:t.handleInput,change:function(e){return t.handleChange(e)}}},"sm-input-number",t.precisionProps,!1)),t._v(" "),t.unit?e("span",{staticClass:"sm-setting-unit"},[t._v(t._s(t.unit))]):t._e()],1):t._e()],1)])},[],!1,null,null,null).exports,q=a("GSdF"),l={name:"SmSettingTdtKey",components:{InputElement:w},props:{wrap:{type:Boolean,default:!0},resourceStyle:{type:Boolean,default:!1}},data:function(){return{tiandituToken:""}},watch:{"$store.getters.tdtKey":{handler:function(e){this.tiandituToken=this.$store.getters.tdtKey,this.checkKey(this.tiandituToken)},immediate:!0}},created:function(){var e=this;this.debounceFn=q.b.debounce(function(){e.$store.dispatch("SET_TDT_TOKEN",e.tiandituToken)},1e3)},methods:{changeKey:function(){this.debounceFn()},checkKey:function(e){this.$emit("correctTdtKeyFn",e)}}},l=(a("UYfL"),Object(n.a)(l,function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{class:["sm-setting-tdt-key",t.resourceStyle?"sm-setting-resource":""]},[e("InputElement",{attrs:{wrap:t.wrap,icon:!0,title:t.$t("setting.webMap.key")},on:{change:t.changeKey},model:{value:t.tiandituToken,callback:function(e){t.tiandituToken=e},expression:"tiandituToken"}},[e("span",{attrs:{slot:"iconTip"},slot:"iconTip"},[e("a",{attrs:{target:"_blank",rel:"noopener noreferrer",href:"http://lbs.tianditu.gov.cn/authorization/authorization.html"}},[t._v(t._s(t.$t("setting.webMap.keyInfo")))])])])],1)},[],!1,null,"8fb0c48a",null).exports),H=a("tWJv"),X=a("fr48");function Y(e,t,a,i,r,n,o){try{var s=e[n](o),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(i,r)}var K=[3857,4326,4214,4610,4490],w={name:"SmResourceSelector",components:{InputElement:w,"sm-setting-tdt-token":l},props:{dialogVisible:{type:Boolean,default:!1},useType:{type:String,default:"Map"},selectId:{type:[String,Number]},defaultSelectId:{type:[String,Number]},proxy:{type:Boolean,default:!1},filter:{type:Function}},data:function(){return{activeName:"",visible:!1,title:this.$t("setting.webMap.selectMap"),pagination:null,searchKey:null,cacheParam:{},resourceInfo:null,tiandituToken:"",correctKey:!1,allTabs:{Dashboard:[{key:"publicDashboard",name:this.$t("setting.dashboardSwitch.publicMD")},{key:"myDashboard",name:this.$t("setting.dashboardSwitch.myMD")}],Map:[{key:"publicMap",name:this.$t("setting.webMap.publicMap")},{key:"myMap",name:this.$t("setting.webMap.myMap")},{key:"internetMap",name:this.$t("setting.webMap.internetMap")},{key:"service",name:this.$t("setting.webMap.service")}],DrillMap:[{key:"publicMap",name:this.$t("setting.webMap.publicMap")},{key:"myMap",name:this.$t("setting.webMap.myMap")}],Scene:[{key:"publicScene",name:this.$t("setting.webScene.publicScene")},{key:"myScene",name:this.$t("setting.webScene.myScene")}],Template:[{key:"template",name:this.$t("templatesName.template")},{key:"publicDashboard",name:this.$t("setting.dashboardSwitch.publicMD")},{key:"myDashboard",name:this.$t("setting.dashboardSwitch.myMD")}]},crossAgent:this.proxy}},computed:{disableComfirmBtn:function(){return!this.cacheParam[this.activeName]},currentSelectType:function(){return this.allTabs[this.useType]},isInternetMap:function(){return"internetMap"===this.activeName},isIServerMap:function(){return"service"===this.activeName},filterResourceInfo:function(){var t=this;return this.resourceInfo.map(function(e){return e.notAllowedTip="",e.notAllowed=!1,"TIANDITU"!==e.sourceType||t.correctKey||(e.notAllowedTip+=t.$t("setting.webMap.configKey"),e.notAllowed=!0),e.id===t.selectId&&(e.notAllowedTip+=t.$t("setting.webMap.notAllowedSelectSameMap"),e.notAllowed=!0),t.filter&&t.filter(e)&&(e.notAllowedTip+=t.$t("setting.webMap.notMatchCurrentProjection"),e.notAllowed=!0),e})},isEmptyTemplate:function(){return function(e){return e.content&&"empty"===e.content.name}},lockPublicDashboard:function(e){var t=this;return function(e){return!("Template"!==t.useType||"publicDashboard"!==t.activeName||"READWRITE"===t.dashboardAuthorize(e)||"DELETE"===t.dashboardAuthorize(e))}}},watch:{dialogVisible:function(){this.getDatas(),this.visible=this.dialogVisible,this.dialogVisible&&(this.activeName=this.lastModifyActiveName||this.activeName)},visible:function(){!1===this.visible&&(this.$emit("dialogvisible",!1),this.clearData())},activeName:function(){this.pagination=null,this.searchKey=null,this.resourceInfo=null,this.getDatasFn()},"$store.getters.tdtKey":{handler:function(e){this.tiandituToken=e},immediate:!0}},created:function(){Object(f.l)()||(this.allTabs.Map.splice(2,0,{key:"online",name:this.$t("setting.webMap.onlineMap")}),this.allTabs.DrillMap.splice(2,0,{key:"online",name:this.$t("setting.webMap.onlineMap")}))},mounted:function(){this.getDatasFn=$()(this.getDatas,100,{trailing:!0}),this.url=Object(f.g)(),this.viewModel=new W(this.url),this.registerEvents(),this.init()},methods:{init:function(){var t=this;this.title={DrillMap:this.$t("setting.webMap.selectMap"),Map:this.$t("setting.webMap.selectMap"),Dashboard:this.$t("setting.dashboardSwitch.selectMD"),Template:this.$t("setting.dashboardSwitch.selectMD"),Scene:this.$t("setting.webScene.selectScene")}[this.useType],this.activeName=this.currentSelectType[0].key,this.dialogVisible&&this.getDatas(),this.viewModel.on("getresourceinfosucceeded",function(e){"Template"===t.useType&&t.resourceInfoClicked(null,t.resourceInfo[t.defaultSelectId])})},refresh:function(){this.resourceInfo=[],this.getDatas()},getDatas:function(e,t){var a;this.dialogVisible&&(a=this.searchKey&&JSON.stringify([this.searchKey]),this.viewModel.getResourceContent(this.useType,this.activeName,e,t,a))},getEpsgCodeWKT:function(e,t){if(e)return SuperMap.FetchRequest.get(e,null,t).then(function(e){return e.text()}).then(function(e){return e}).catch(function(e){console.log(e)})},onOk:function(){var s,p=this;return s=regeneratorRuntime.mark(function e(){var t,a,i,r,n,o,s,l,c,u,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.lastModifyActiveName=p.activeName,t=m()(p.cacheParam[p.activeName]),-1===p.useType.indexOf("Map")){e.next=48;break}if(!p.isInternetMap){e.next=14;break}e.t0=t.sourceType,e.next="TIANDITU"===e.t0?7:9;break;case 7:return a=p.createTilesInfo(t,p.tiandituToken),e.abrupt("break",10);case 9:return e.abrupt("break",10);case 10:t.mapOptions=p.createInternetMapInfo(a),t.url="",e.next=46;break;case 14:if(p.isIServerMap)return o=(i=t).split("/"),r=o[o.length-1],e.next=20,Object(H.g)(i);e.next=45;break;case 20:return n=e.sent,e.next=23,p.getiServerMapInfo(i,n);case 23:if(o=e.sent,s="EPSG:3857",!o){e.next=43;break}if(l=o.dynamicProjection,u=o.prjCoordSys,c=o.bounds,u=u.epsgCode,-1!==K.indexOf(u)){e.next=42;break}if(!l){e.next=34;break}u=3857,s="EPSG:".concat(u),e.next=42;break;case 34:return e.next=36,p.getEpsgCodeWKT("".concat(i,"/prjCoordSys.wkt"),{withoutFormatSuffix:!0});case 36:h=e.sent,Object(X.b)("EPSG:".concat(u),h),h=[c.leftBottom.x,c.leftBottom.y,c.rightTop.x,c.rightTop.y],h=new d.a.CRS("EPSG:".concat(u),h,180<h[2]?"meter":"degree"),d.a.CRS.set(h),s=h;case 42:t={url:i,title:r,withCredentials:n,mapOptions:{crs:s,style:{version:8,sources:{"iserver-tiles":{type:"raster",tiles:[i],tileSize:256,prjCoordSys:u<0?"":{epsgCode:u},rasterSource:"iserver",proxy:p.crossAgent?Object(f.i)("image"):null}},layers:[{id:"simple-tiles",type:"raster",source:"iserver-tiles",minzoom:0,maxzoom:22}]}}};case 43:e.next=46;break;case 45:"online"!==p.activeName&&(t.proxy=p.crossAgent);case 46:h={serverUrl:p.isInternetMap||p.isIServerMap?null:t.url,mapId:p.isInternetMap||p.isIServerMap?null:t.id,mapOptions:t.mapOptions,withCredentials:t.withCredentials},Object(b.f)(h);case 48:p.$emit("resourceinfoclicked",{resourceParam:t,activeName:p.activeName}),p.isIServerMap||p.$emit("changeselectid",t.id),p.$emit("dialogvisible",!1);case 51:case"end":return e.stop()}},e)}),function(){var e=this,o=arguments;return new Promise(function(t,a){var i=s.apply(e,o);function r(e){Y(i,t,a,r,n,"next",e)}function n(e){Y(i,t,a,r,n,"throw",e)}r(void 0)})}()},getiServerMapInfo:function(e){var a=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return new Promise(function(t){new d.a.supermap.MapService(e,{withCredentials:a}).getMapInfo(function(e){t((e||{}).result)})})},createTilesInfo:function(e,t){for(var a=[],i=[],r=[],n=0;n<e.s;n++)i.push(e.url.replace("{tk}",t).replace("{s}",n)),e.withLabel&&r.push(e.labelUrl.replace("{tk}",t).replace("{s}",n));return a.push({url:i,id:e.id}),e.withLabel&&a.push({url:r,id:e.id+"_label"}),e.mapInfo=a,e},createInternetMapInfo:function(e){var t={},a=[];return e.mapInfo.forEach(function(e){t[e.id]={type:"raster",tiles:e.url,tileSize:256},a.push({id:e.id,type:"raster",source:e.id})}),{crs:e.epsgCode,minzoom:e.minzoom||0,maxzoom:e.maxzoom||22,style:{version:8,sources:t,layers:a},renderWorldCopies:!1}},closeDialog:function(){this.$emit("dialogvisible",!1)},registerEvents:function(){var t=this;this.viewModel.on("getresourceinfosucceeded",function(e){e.activeKey===t.activeName&&(t.resourceInfo=e.result,t.pagination=e.pagination,t.isInternetMap&&t.resourceInfo.forEach(function(e){"TIANDITU"===e.sourceType&&e.labelUrl&&(e.withLabel=!0)}),t.hasDatas(t.resourceInfo))})},hasDatas:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=this.cacheParam[this.activeName],e=e.find(function(e){return t&&e.id===t.id});t&&!e&&(this.cacheParam[this.activeName]=null)},resourceInfoClicked:function(e,t,a){t&&t.notAllowed||a||this.$set(this.cacheParam,this.activeName,t)},clearData:function(){if(this.lastModifyActiveName)for(var e in this.cacheParam)e!==this.lastModifyActiveName&&this.cacheParam[e]&&(this.cacheParam[e]=null)},changeLabelLayer:function(e,t){var a=this.resourceInfo[e];a.withLabel=!t,this.$set(this.resourceInfo,e,a)},correctTdtKeyFn:function(e,t){this.correctKey=e},setCrossAgent:function(e){this.crossAgent=e.target.checked},dashboardAuthorize:function(e){var t,a=this.$store.getters.userName;e=e||[];for(var i=0;i<e.length;i++){var r=e[i];if(r.aliasName===a){t=r.permissionType;break}"GUEST"===r.aliasName&&(t=r.permissionType)}return t}}},l=(a("QDzv"),a("UUUU"),Object(n.a)(w,function(){var i=this,e=i.$createElement,r=i._self._c||e;return r("sm-modal",{attrs:{dialogStyle:{"max-width":"1152px"},width:"auto",closable:!0,"lock-scroll":!1,maskClosable:!1,title:i.useType.includes("Map")?i.$t("setting.common.selectMap")+"：":i.$t("setting.common.selectDashboard")+"：",wrapClassName:"sm-resource-selector sm-setting-selector",dialogClass:"sm-resource-selector-modal sm-setting-selector-modal"},on:{cancel:i.closeDialog},model:{value:i.visible,callback:function(e){i.visible=e},expression:"visible"}},[r("sm-tabs",{model:{value:i.activeName,callback:function(e){i.activeName=e},expression:"activeName"}},i._l(i.currentSelectType,function(e){return r("sm-tab-pane",{key:e.key,attrs:{tab:e.name,name:e.key}},[r("div",{class:["sm-resource-selector__resource-info",!i.useType.includes("Map")&&"sm-resource-selector__info"]},[["publicMap","myMap","publicDashboard","myDashboard","online"].includes(e.key)?r("div",{staticClass:"sm-resource-selector_update"},[r("sm-button",{staticClass:"sm-mapdashboard-icon",attrs:{size:"small"},on:{click:function(e){return i.refresh()}}},[i._v("")]),i._v(" "),["publicMap","myMap"].includes(e.key)?r("span",{staticClass:"cross-agent-holder"},[r("sm-checkbox",{attrs:{checked:i.crossAgent},on:{change:i.setCrossAgent}},[i._v("\n              "+i._s(i.$t("setting.common.proxy"))+"\n              "),r("a-popover",{attrs:{placement:"right","arrow-point-at-center":"",getPopupContainer:function(e){return e.parentNode}}},[r("template",{slot:"content"},[r("span",[i._v(i._s(i.$t("setting.common.crossAgent")))])]),i._v(" "),r("i",{staticClass:"sm-mapdashboard-icon-circle-query",style:{"margin-left":"-2px","font-size":"12px"}})],2)],1)],1):i._e(),i._v(" "),r("div",{staticClass:"search-holder"},[r("i",{staticClass:"sm-mapdashboard-icon-search"}),i._v(" "),r("sm-input-search",{staticStyle:{width:"204px"},attrs:{placeholder:i.$t("setting.common.searchByKeyWords")},on:{search:function(e){return i.getDatas(1)}},model:{value:i.searchKey,callback:function(e){i.searchKey=e},expression:"searchKey"}})],1)],1):"internetMap"===e.key?r("div",{staticClass:"tdt-token"},[r("sm-setting-tdt-token",{attrs:{wrap:!1,resourceStyle:!0},on:{correctTdtKeyFn:i.correctTdtKeyFn}})],1):i._e(),i._v(" "),i.resourceInfo?r("a-row",{attrs:{type:"flex",justify:"start"}},i._l(i.filterResourceInfo,function(t,a){return r("a-col",{key:a,attrs:{span:6,title:t.notAllowedTip}},[r("sm-card",{class:{clicked:i.cacheParam[i.activeName]&&t.id===i.cacheParam[i.activeName].id},style:{cursor:t.notAllowed?"not-allowed":""},nativeOn:{click:function(e){i.resourceInfoClicked(e,t,i.lockPublicDashboard(t.authorizeSetting))}}},[i.isEmptyTemplate(t)?i._e():r("img",{attrs:{slot:"cover",alt:t.title,src:t.thumbnail},slot:"cover"}),i._v(" "),i.lockPublicDashboard(t.authorizeSetting)||i.isEmptyTemplate(t)?r("div",{staticClass:"sm-template-mongolia",staticStyle:{cursor:"pointer"},attrs:{slot:"cover",title:t.title},slot:"cover"},[r("i",{class:i.isEmptyTemplate(t)?"sm-mapdashboard-icon-plus":"sm-mapdashboard-icon-lock",style:{fontSize:i.isEmptyTemplate(t)?"40px":"30px"},attrs:{type:i.isEmptyTemplate(t)?"plus":"lock"}})]):i._e(),i._v(" "),r("sm-card-meta",[r("span",{attrs:{slot:"title",title:t.title},slot:"title"},[i._v(i._s(t.title))]),i._v(" "),r("div",{staticStyle:{"{float":"right}"},attrs:{slot:"avatar"},slot:"avatar"},[t.labelUrl?r("span",[r("i",{staticClass:"sm-mapdashboard-icon-roadnetwork",style:{color:t.withLabel?"#13a2fc":"#c0c4cc"},attrs:{title:i.$t("setting.common.label")},on:{click:function(e){return i.changeLabelLayer(a,t.withLabel)}}})]):i._e()])])],1)],1)}),1):"service"===i.activeName?r("div",{staticClass:"sm-resource-selector__my-service"},[i._v("\n          URL：\n          "),r("sm-input",{attrs:{placeholder:i.$t("setting.common.matchIServerUrl")},model:{value:i.cacheParam[i.activeName],callback:function(e){i.$set(i.cacheParam,i.activeName,e)},expression:"cacheParam[activeName]"}}),i._v(" "),r("div",{staticClass:"cross-agent-holder"},[r("sm-checkbox",{attrs:{checked:i.crossAgent},on:{change:i.setCrossAgent}},[i._v("\n              "+i._s(i.$t("setting.common.proxy"))+"\n              "),r("a-popover",{attrs:{placement:"right","arrow-point-at-center":"",getPopupContainer:function(e){return e.parentNode}}},[r("template",{slot:"content"},[r("span",{staticStyle:{padding:"2px 6px"}},[i._v(i._s(i.$t("setting.common.crossAgent")))])]),i._v(" "),r("i",{staticClass:"sm-mapdashboard-icon-circle-query",style:{"margin-left":"-2px","font-size":"12px"}})],2)],1)],1),i._v(" "),r("div",{staticClass:"example-holder"},[r("span",[i._v(i._s(i.$t("setting.common.example"))+"：")]),i._v(" "),r("div",[r("h3",[i._v(i._s(i.$t("setting.common.iServerRestMapUrl"))+"：")]),i._v(" "),r("p",[i._v("http://{server}:{port}/iserver/services/{component}/rest/maps/{mapName}")])])])],1):r("div",{staticClass:"empty-tip"},[r("sm-empty")],1)],1)])}),1),i._v(" "),r("div",{staticClass:"toolbar-holder"},[i.pagination?r("sm-pagination",{staticClass:"pagination",attrs:{pageSize:i.pagination.pageSize,total:i.pagination.total},on:{change:i.getDatas},model:{value:i.pagination.current,callback:function(e){i.$set(i.pagination,"current",e)},expression:"pagination.current"}}):i._e()],1),i._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("sm-button",{attrs:{type:"primary",disabled:i.disableComfirmBtn},on:{click:i.onOk}},[i._v(i._s(i.$t("setting.common.ok")))])],1)],1)},[],!1,null,"63ae3488",null).exports),Z=a("QNBb"),J=a("Lb6U"),Q=a("KqOx"),ee=a("7L49"),w=a("XaGS"),te=a.n(w);function ae(t,e){var a,i=Object.keys(t);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(t),e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,a)),i}function ie(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ae(Object(r),!0).forEach(function(e){var t,a;t=i,e=r[a=e],a in t?Object.defineProperty(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):ae(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}w={props:{mapInfoList:{type:Object},mapStatus:{type:Array},dataCacheName:{type:String},propDatas:Object,activeKey:[String,Number]},data:function(){return{targetData:this.propDatas.target,readyNext:!0}},computed:{allLoaded:function(){return!(!this.mapStatus||!this.mapStatus.length)&&this.mapStatus.every(function(e){return e.status})}},watch:{mapInfoList:function(e,t){var a=this;!te()(e,t)&&this.map&&(e=Object.keys(this.viewModelList),Object.keys(this.mapInfoList).length>e.length&&(!t||JSON.stringify("{}"===t))?Object.keys(this.mapInfoList).forEach(function(e){a.viewModelList[e]||a.addMap(e,a.mapInfoList[e])}):(e.forEach(function(e){a.viewModelList[e].vm.cleanLayers(),a.viewModelList[e]=null}),this.viewModelList={},this.addMaps()))},activeKey:function(e,t){te()(e,t)||this.setActiveMap(e,t)}},created:function(){this.viewModelList={},this.mapQueue=[],this.map=null},beforeDestroy:function(){this.map&&this.map.off("zoomend",this.resetMapLoadStatus)},methods:{addMap:function(e,t){var n=this;Object.keys(this.viewModelList).length||this.hideExistedLayers();var o,a=t.id,i=t.url,r=t.withCredentials,s=this.propDatas,l=s.target,c=s.tiandituKey,s=s.mapOptions.rasterTileSize;this.viewModelList[e]||(this.readyNext?(o=new ee.a(a,{serverUrl:i,withCredentials:r,target:l,tiandituKey:c,checkSameLayer:!0},{rasterTileSize:s},this.map),this.readyNext=!1,o.on({addlayerssucceeded:function(e){var t,a,i,r;n.readyNext=!0,o.setLayersVisible(!1),n.mapQueue.length?(t=(r=n.mapQueue.shift()).id,a=r.url,i=r.withCredentials,r=r.key,n.addMap(r,{id:t,url:a,withCredentials:i})):n.setActiveMap(n.activeKey,null)}}),this.viewModelList[e]={id:a,vm:o}):this.mapQueue.push(ie(ie({},t),{},{key:e})))},addMaps:function(){var t=this;Object.keys(this.mapInfoList).length&&Object.keys(this.mapInfoList).forEach(function(e){t.addMap(e,t.mapInfoList[e])})},setActiveMap:function(e,t){var a;this.viewModelList[e]&&e&&e!==t&&!this.timer&&(this.viewModelList[e]&&this.viewModelList[e].vm.setLayersVisible(!0),a=this.viewModelList[e].vm._cacheLayerId,this.allLoaded||this.isAllSourceLoaded(e,a),t&&this.viewModelList[t]&&this.viewModelList[t].vm.setLayersVisible(!1,a))},isAllSourceLoaded:function(t,a){var i=this;this.timer&&(clearInterval(this.timer),this.timer=null),this.timer=setInterval(function(){var e;i.$emit("loadingChange",!0),a.every(function(e){return!i.map||!i.map.style||(!i.map.getSource(e)||i.map.isSourceLoaded(e))})&&i.mapStatus&&(clearInterval(i.timer),i.timer=null,(e=i.mapStatus.concat()).forEach(function(e){e.key===t&&(e.status=!0)}),i.$store.dispatch("UPDATE_DATA_INFO",{uuid:i.dataCacheName,dataInfo:{mapStatus:e}}),i.$emit("loadingChange",!1))},100)},setMap:function(e){this.map=e,this.addMaps(),this.resetMapLoadStatus(),this.map.on("zoomend",this.resetMapLoadStatus)},hideExistedLayers:function(){var t=this;this.map&&this.map.getStyle().layers.forEach(function(e){t.map.setLayoutProperty(e.id,"visibility","none")})},resetMapLoadStatus:function(){var t,e;this.mapStatus&&this.mapStatus.length?t=this.mapStatus.map(function(e){return e.status=!1,e}):(e=Object.keys(this.mapInfoList)).length&&(t=[],e.forEach(function(e){t.push({key:e,status:!1})})),t&&t.length&&(this.$store.dispatch("UPDATE_DATA_INFO",{uuid:this.dataCacheName,dataInfo:{mapStatus:t}}),this.setActiveMap(this.activeKey,null))}},render:function(){return null}},w=Object(n.a)(w,void 0,void 0,!1,null,null,null).exports;function re(t,e){var a,i=Object.keys(t);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(t),e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,a)),i}function ne(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?re(Object(r),!0).forEach(function(e){var t,a;t=i,e=r[a=e],a in t?Object.defineProperty(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}function oe(e){return function(e){if(Array.isArray(e))return se(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return se(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(a="Object"===a&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?se(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function se(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}var le={beforehorizontal:{top:"25%",left:"50%"},beforevertical:{top:"50%",left:"25%"},afterhorizontal:{top:"75%",left:"50%"},aftervertical:{top:"50%",left:"75%"}},s={components:{"sm-resource-selector":l,"sm-table-popup":r.a,"map-manager":w},mixins:[i,o.a,s.a],props:{component:{type:Object,required:!0},defaultParams:{type:Object},updateComponentName:{type:Boolean,default:!0}},data:function(){return{componentId:null,dialogVisible:!1,isCreateDialog:!1,childrenList:[],mapInfoList:{},mapCacheInfo:{},dataCacheName:"",activeKey:"",loading:!1,eventList:[],tablePopupProps:{columns:[{title:this.$t("query.attribute"),dataIndex:"attribute",width:80},{title:this.$t("query.attributeValue"),dataIndex:"attributeValue",width:150}],data:[]},filterActionData:{},uuid:""}},computed:{validMap:function(){if(!this.mergeDefaultParams)return!1;if(this.mergeDefaultParams.mapId&&this.mergeDefaultParams.serverUrl)return!0;var e=this.mergeDefaultParams.mapOptions.style,t=e.layers,e=e.sources;if(t&&e&&0<t.length&&0<Object.keys(e).length)return!0;if(Object.keys(this.mapInfoList).length)return!0;e=this.mergeDefaultParams.data;return!!(this.isDrillMap&&e[0]&&e[0].mapId&&e[0].serverUrl)},compareMapBtnStyle:function(){var e=this.defaultParams.props,t=e.orientation,e=e.target;return t?-1===e.indexOf("before")&&-1!==e.indexOf("after")?le["after".concat(t)]:le["before".concat(t)]:null},isDrillMap:function(){return"SmDrillMap"===this.componentId},isEditor:function(){return"editor"===this.$store.getters.getAction},mergeDefaultParams:function(){return Object.assign({},this.defaultParams.props,{loading:this.loading})},background:function(){return this.defaultParams.props.queryControl.background},textColor:function(){return this.defaultParams.props.queryControl.textColor},triggers:function(){return this.$store.getters.getActionsByComponentId(this.component.componentId)},enableSelectedLayers:function(){var t=this,e=this.triggers&&this.triggers.featureSelection||[],a=[];return e.forEach(function(e){e=e.config.sourceData.dataId,e=Object(Q.l)(t.map,e,!0);a=a.concat(e)}),a},resetActionIds:function(){return(this.listeners||[]).filter(function(e){return Z.b[e.type].reset}).map(function(e){return e.actionId})},mode:function(){return this.$store.getters.mode},mapStatus:function(){return this.uuid&&this.$store.getters.getDataCache(this.uuid).mapStatus||[]},selfLayersActionInfo:function(){var e,t={};for(e in this.filterActionData)-1===e.indexOf("track-layer")&&-1===e.indexOf("layers_layer")&&(t[e]=this.filterActionData[e]);return t},subComponentList:function(){var e=this.$store.getters.components;return Object.values(e.mapSubComponent).map(function(e){return e.type})}},watch:{component:{handler:function(){this.componentId=Object(h.d)(this.component.uri),this.resetMapControlShow(),this.createWebMapNode()},deep:!0,immediate:!0},defaultParams:function(){this.resetMapControlShow()},currentProps:function(){this.createWebMapNode()},"filterActionData.mapInfo":{handler:function(e,t){var a;e&&Object.keys(e).length&&!te()(e,t)&&(a=e.mapDatas,t=e.data,e=e.uuid,this.uuid=e,this.mapInfoList=a,this.activeKey=t,this.dataCacheName=e)},immediate:!0},selfLayersActionInfo:{handler:function(e){this.updateMapSelfLayers(e)},immediate:!0},background:function(){Object(Q.g)(this.background)},triggers:{handler:function(e,t){this.handleTriggers(e)},deep:!0},listeners:{handler:function(e,t){this.listenersHandler(e,t)}}},methods:{setLayerFeatures:function(e,t,a,i){this.$set(t.propDatas,"features",e.features);e=m()(e.fieldCaptions);e.unshift(this.$t("setting.webMap.notShowField")),this.$set(t.propDatas,"textField",t.propDatas.textField||e&&e[0]),t.fieldCaptions=e,i.layers[a]=t},changeLabelStatus:function(e){var t=m()(this.component.propDatas);t.tdtComponents.tdtMapSwitcher.data.label=e,this.$store.dispatch("CHANGE_COMPONENT_PROPS_SETTING",{componentId:this.$store.getters.activeComponentId,propDatas:t})},changeSelectTdtMapType:function(e){var t=m()(this.component.propDatas);t.tdtComponents.tdtMapSwitcher.data.select=e,this.$store.dispatch("CHANGE_COMPONENT_PROPS_SETTING",{componentId:this.$store.getters.activeComponentId,propDatas:t})},listenersHandler:function(e,t){this.filterActionData={},e&&!te()(e,t)&&this.getActionsData(t)},mapLoaded:function(e){var t=this;!!this.$store.getters.openAllDrag&&this.component.propDatas.keepBounds&&this.component.componentId&&this.$store.dispatch("SET_MAP_KEEP_BOUNDS",{keepBounds:!1,componentId:this.component.componentId}),this.updateMapSelfLayers(),this.$emit("load",e),this.map=e.map,this.isDrillMap||(this.initResetFunction(),this.handleTriggers(this.triggers),setTimeout(function(){t.map.fire("moveend")},1e3),this.$refs.mapManager&&this.$refs.mapManager.setMap(this.map)),this.initListeners()},generateLayerNodes:function(e,t){var a=[],i=[];return t.layers&&i.push.apply(i,oe(t.layers)),t.trackLayers&&i.push.apply(i,oe(t.trackLayers)),i&&0<i.length&&i.forEach(function(e,t){"OBJ2"===e.propDatas.loaderType?e.propDatas.url=e.propDatas.obj2Url:"GLTF"===e.propDatas.loaderType?e.propDatas.url=e.propDatas.gltfUrl:"IMAGE"===e.propDatas.loaderType&&(e.propDatas.url=e.propDatas.imgUrl),a.push({subComponentId:Object(h.d)(e.uri),subComponentInfo:{props:e.propDatas,key:e.ref,ref:"TrackLayer"===e.componentType?e.ref:void 0}})}),a},generateTdtNodes:function(e){var t,a,i=[];for(t in e)e[t].show&&(a=Object(h.d)(e[t].uri),-1!==this.subComponentList.indexOf(a.replace("Sm",""))&&(e[t].splitLine=!0),i.push({subComponentId:a,subComponentInfo:{key:a,props:e[t],on:{"change-select-map-type":this.changeSelectTdtMapType,"change-label-status":this.changeLabelStatus}}}));return i},transformedSuspensionCmpsToContol:function(e,t){if(e.hasOwnProperty("controlComponents"))for(var a in e.controlComponents){var i,r=e.controlComponents[a];r&&(i=Object(h.d)(r.uri),-1!==this.subComponentList.indexOf(i.replace("Sm",""))&&(r.splitLine=!0),"SmLayerList"===i&&function(){var e=r.attributes.container&&r.attributes.container.toLowerCase();r.attributes.getContainer=function(){return document.querySelector(".".concat(e))||document.getElementById(e)}}(),t.push({subComponentId:i,subComponentInfo:{key:a,props:r}}))}},generateControlNodes:function(t){var a,e=[];for(a in this.transformedSuspensionCmpsToContol(t,e),t){var i=this.isMapSubComponent(a);i&&this.component.propDatas[a].show&&(t[a].mapTarget=t.target,"SmIdentify"===(i=Object(h.d)(i.uri))&&this.identifyToComponent(t[a]),-1!==this.subComponentList.indexOf(i.replace("Sm",""))&&(t[a].splitLine=!0),"SmLayerList"===i&&function(){var e=t[a].attributes.container&&t[a].attributes.container.toLowerCase();t[a].attributes.getContainer=function(){return document.querySelector(".".concat(e))||document.getElementById(e)}}(),e.push({subComponentId:i,subComponentInfo:{key:i,props:t[a]}}))}return e},identifyToComponent:function(e){var t,a=e.layers,i=e.fields,r=[];for(t in a)!function(t){(a[t]||[]).forEach(function(e){r.push(i[t]||[])})}(t);e.fields=r,e.layers=[].concat.apply([],Object.values(a||{}))},isMapSubComponent:function(t){if(-1!==t.indexOf("identify"))return{uri:"mapboxgl/web-map/control/identify/Identify"};var e=this.$store.getters.components;return Object.values(e.mapSubComponent).find(function(e){return-1<t.toLowerCase().indexOf(e.type.toLowerCase())})},createWebMapNode:function(){var e=this.component,t=this.currentProps,a=m()(this.component.propDatas),i=a.tdtComponents||{},e=this.generateLayerNodes(e,t),i=this.generateTdtNodes(i),a=this.generateControlNodes(a);t.mapOptions||(t.mapOptions={}),t.mapOptions.preserveDrawingBuffer=!0,"unFixed"!==t.fixedMap&&(t.mapOptions.bounds=this.$store.getters.getMapByTarget(t.target)&&d.a.LngLatBounds.convert(this.$store.getters.getMapByTarget(t.target).bounds)),Object(f.l)()&&(t.isSuperMapOnline=!0),this.$store.getters.openAllDrag||this.handleMapFixed(t),this.childrenList=[].concat(e,i,a)},handleMapFixed:function(e,t){var a,i=e.fixedMap,r=e.mapOptions,r=void 0===r?{}:r;switch(i){case"fixed":a=!1;break;case"unFixed":a=!0;break;case"fixedInMobile":a=!("mobile"===this.mode)}a!==r.interactive&&(e.mapOptions.interactive=a)},resetMapControlShow:function(){var e,t=this.currentProps;for(e in t)-1!==e.indexOf("Control")&&t[e].show&&(t[e].show=!1)},changeDialogVisible:function(e){var t=this;this.isCreateDialog=e,this.$nextTick(function(){t.dialogVisible=e})},resourceInfoClicked:function(e){this.mapParam=e.resourceParam;var t=this.mapParam,a=t.title,i=t.id,r=t.url,n=t.mapOptions,o=t.proxy,s=m()(this.defaultParams.props),t=ne(ne({},s.mapOptions),{},{style:{version:8,sources:{},layers:[]},center:[0,0],zoom:1,bearing:0,pitch:0,tileSize:256});this.isDrillMap?(s.data[0]={layerId:"",serverUrl:r||"",withCredentials:e.resourceParam.withCredentials,proxy:o,mapId:i,relatedField:"",title:a},n||(s.mapOptions=t)):(s.serverUrl=r||"",s.withCredentials=this.mapParam.withCredentials,s.proxy=o,n?(o=s.mapOptions,s.mapOptions=Object.assign(o,n),s.mapId=""):(s.mapId=i,s.mapOptions=t),this.updateComponentName||(s.name=a)),this.updateMapName(a),this.defaultParams.props&&this.defaultParams.props.target&&(-1!==this.defaultParams.props.target.indexOf("before")||-1!==this.defaultParams.props.target.indexOf("after"))?this.$emit("change-compare-props",{target:this.defaultParams.props.target,propDatas:s}):this.$store.dispatch("INIT_COMPONENT_CONFIG_SILENT",{componentId:this.component.componentId,propDatas:s})},updateMapName:function(e){e&&this.updateComponentName&&this.$store.dispatch("CHANGE_COMPONENT_PROPS_SETTING",{componentId:this.$store.getters.activeComponentId,componentName:e})},handleDataviz:function(){window.open(Object(f.f)())},selectMap:function(){this.changeDialogVisible(!0)},handleTriggers:function(t){var c=this;if(this.eventList.length&&this.map&&this.eventList.forEach(function(e){var t=e.eventName,a=e.listenerName,e=e.layers;e&&e instanceof Array?e.forEach(function(e){c.map.off(t,e,a)}):c[a]&&(c.map.off(t,c[a]),c[a]=null)}),this.eventList=[],t&&this.map)for(var e in t)!function(l){var e=Z.d[l].events||[],a=t[l];c.monitorEventLinkage(Z.d,l,a),e.forEach(function(e){var t="handleTrigger".concat(e.replace(e[0],e[0].toUpperCase()));c[t]=function(r){var n,o=[],s=!0;a.forEach(function(e){var t=Z.d[l].callback({e:r},e,c),a=P.a.$options.updateFeature(t.feature,"".concat(c.component.componentId,"-").concat(l)),i=c.getUpdateCondition(l,e,t.passingActionInfo);s=t.status,n=t.passingActionInfo,delete t.feature,delete t.passingActionInfo,i&&o.push(ne(ne({actionId:e.actionId},t),{},{featureId:a}))}),s&&c.$store.dispatch("UPDATE_ACTION",{componentId:c.component.componentId,type:l,datas:o,passingActionInfo:n,status:"active"})},c.map.on(e,c[t]),"click"===e&&a.forEach(function(e){var t=e.actionId,e=e.config.sourceData.dataId,e=Object(Q.l)(c.map,e),t=Object(Q.f)(c.map,e,t);c.eventList=c.eventList.concat(t)}),c.eventList.push({eventName:e,listenerName:t})})}(e)},getActionsData:function(){var l=this,c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],u=[];return this.map&&this.listeners.forEach(function(e){var t=e.type,a=e.targetData,i=e.featureId,r=e.actionId,n=e.timestamp,o=e.blockEventLinkage,s=a&&a.dataId,a=c.find(function(e){return e.actionId===r});a&&a.timestamp===n||o||(o=l.$store.getters.getPassingActionInfoByActionId(r,J.a[t]||"boundsChange"),e=ne(ne({},e),{},{passingActionInfo:o}),o=(o=Object(Q.k)(l.map,s))&&o.features||[],i&&(e.feature=P.a.$options.getData(i)),o=Z.b[t].callback(e,o,l),u.push(o),"switchMap"!==t&&"switchDataSource"!==t||(l.filterActionData=Object.assign({},l.filterActionData,o)),l.emitEventLinkage(t,r,s,o))}),u},initResetFunction:function(){var e=this;this.map.off("click",this.callback),this.callback=function(){Object(Z.c)(e.map),e.$store.dispatch("UPDATE_ACTIONS_STATUS",{actionIds:e.resetActionIds,status:"reset",fromComponentId:e.component.componentId})},this.map.on("click",this.callback)},loadingChange:function(e){this.loading=e}}},s=(a("SknJ"),Object(n.a)(s,function(){var a=this,e=a.$createElement,i=a._self._c||e;return i(a.componentId,a._b({tag:"component",style:a.defaultParams.style,on:{load:a.mapLoaded}},"component",a.mergeDefaultParams,!1),[a.isEditor&&!a.validMap?i("div",{staticClass:"map-mask",attrs:{slot:a.isDrillMap?"blank":"default"},slot:a.isDrillMap?"blank":"default"}):a._e(),a._v(" "),a._l(a.childrenList,function(e){var t=e.subComponentId,e=e.subComponentInfo;return[i(t,a._g(a._b({key:a.mode+"-"+e.key,ref:e.ref,refInFor:!0,tag:"component"},"component",e.props,!1),e.on))]}),a._v(" "),a.isEditor&&!a.validMap?i("div",{staticClass:"btn-wrap",style:a.compareMapBtnStyle,attrs:{slot:a.isDrillMap?"blank":"default"},slot:a.isDrillMap?"blank":"default"},[i("sm-button",{staticClass:"customRenderButton",attrs:{type:"primary"},on:{click:a.selectMap}},[a._v(a._s(a.$t("setting.webMap.selectMap")))]),a._v(" "),i("div",{staticClass:"line"}),a._v(" "),i("sm-button",{staticClass:"customRenderButton",attrs:{type:"primary"},on:{click:a.handleDataviz}},[a._v(a._s(a.$t("setting.webMap.makeMapOnline")))])],1):a._e(),a._v(" "),a.isCreateDialog?i("sm-resource-selector",{attrs:{slot:a.isDrillMap?"blank":"default",dialogVisible:a.dialogVisible,useType:a.isDrillMap?"DrillMap":"Map"},on:{resourceinfoclicked:a.resourceInfoClicked,dialogvisible:a.changeDialogVisible},slot:a.isDrillMap?"blank":"default"}):a._e(),a._v(" "),i("map-manager",{ref:"mapManager",attrs:{slot:a.isDrillMap?"blank":"default",mapInfoList:a.mapInfoList,mapStatus:a.mapStatus,dataCacheName:a.dataCacheName,propDatas:a.defaultParams.props,activeKey:a.activeKey},on:{loadingChange:a.loadingChange},slot:a.isDrillMap?"blank":"default"}),a._v(" "),i("sm-table-popup",a._b({directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"tablePopup",attrs:{slot:a.isDrillMap?"blank":"default",background:a.background,textColor:a.textColor},slot:a.isDrillMap?"blank":"default"},"sm-table-popup",a.tablePopupProps,!1))],2)},[],!1,null,null,null));t.default=s.exports},c2Rp:function(e,t,a){},hhWd:function(e,a,r){e.exports=function(){var m=function(e){return typeof e==="number"&&parseFloat(e)==parseInt(e,10)&&!isNaN(e)},A=function(e){return e},r=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(e,t){if(this===undefined||this===null)throw new TypeError('"this" is null or not defined');var a=this.length>>>0;t=+t||0;if(Math.abs(t)===Infinity)t=0;if(t<0){t+=a;if(t<0)t=0}for(;t<a;t++)if(this[t]===e)return t;return-1};var e=function(e){this.objectID="";this.separator=" - ";this.legendSeparator=this.separator;this.method="";this.precision=0;this.precisionflag="auto";this.roundlength=2;this.is_uniqueValues=false;this.debug=false;this.silent=false;this.bounds=Array();this.ranges=Array();this.inner_ranges=null;this.colors=Array();this.counter=Array();this.stat_sorted=null;this.stat_mean=null;this.stat_median=null;this.stat_sum=null;this.stat_max=null;this.stat_min=null;this.stat_pop=null;this.stat_variance=null;this.stat_stddev=null;this.stat_cov=null;this.log=function(e,t){if(this.debug==true||t!=null)console.log(this.objectID+"(object id) :: "+e)};this.setBounds=function(e){this.log("Setting bounds ("+e.length+") : "+e.join());this.bounds=Array();this.bounds=e};this.setSerie=function(e){this.log("Setting serie ("+e.length+") : "+e.join());this.serie=Array();this.serie=e;this.resetStatistics();this.setPrecision()};this.setColors=function(e){this.log("Setting color ramp ("+e.length+") : "+e.join());this.colors=e};this.doCount=function(){if(this._nodata())return;var e=this.sorted();this.counter=new Array;for(i=0;i<this.bounds.length-1;i++)this.counter[i]=0;for(j=0;j<e.length;j++){var t=this.getClass(e[j]);this.counter[t]++}};this.setPrecision=function(e){if(typeof e!=="undefined"){this.precisionflag="manual";this.precision=e}if(this.precisionflag=="auto")for(var t=0;t<this.serie.length;t++){if(!isNaN(this.serie[t]+"")&&(this.serie[t]+"").toString().indexOf(".")!=-1)var a=(this.serie[t]+"").split(".")[1].length;else var a=0;if(a>this.precision)this.precision=a}if(this.precision>20){this.log("this.precision value ("+this.precision+') is greater than max value. Automatic set-up to 20 to prevent "Uncaught RangeError: toFixed()" when calling decimalFormat() method.');this.precision=20}this.log("Calling setPrecision(). Mode : "+this.precisionflag+" - Decimals : "+this.precision);this.serie=this.decimalFormat(this.serie)};this.decimalFormat=function(e){var t=new Array;for(var a=0;a<e.length;a++)if(r(e[a]))t[a]=parseFloat(parseFloat(e[a]).toFixed(this.precision));else t[a]=e[a];return t};this.setRanges=function(){this.ranges=Array();for(i=0;i<this.bounds.length-1;i++)this.ranges[i]=this.bounds[i]+this.separator+this.bounds[i+1]};this.min=function(){if(this._nodata())return;this.stat_min=this.serie[0];for(i=0;i<this.pop();i++)if(this.serie[i]<this.stat_min)this.stat_min=this.serie[i];return this.stat_min};this.max=function(){if(this._nodata())return;this.stat_max=this.serie[0];for(i=0;i<this.pop();i++)if(this.serie[i]>this.stat_max)this.stat_max=this.serie[i];return this.stat_max};this.sum=function(){if(this._nodata())return;if(this.stat_sum==null){this.stat_sum=0;for(i=0;i<this.pop();i++)this.stat_sum+=parseFloat(this.serie[i])}return this.stat_sum};this.pop=function(){if(this._nodata())return;if(this.stat_pop==null)this.stat_pop=this.serie.length;return this.stat_pop};this.mean=function(){if(this._nodata())return;if(this.stat_mean==null)this.stat_mean=parseFloat(this.sum()/this.pop());return this.stat_mean};this.median=function(){if(this._nodata())return;if(this.stat_median==null){this.stat_median=0;var e=this.sorted();if(e.length%2)this.stat_median=parseFloat(e[Math.ceil(e.length/2)-1]);else this.stat_median=(parseFloat(e[e.length/2-1])+parseFloat(e[e.length/2]))/2}return this.stat_median};this.variance=function(){round=typeof round==="undefined"?true:false;if(this._nodata())return;if(this.stat_variance==null){var e=0,t=this.mean();for(var a=0;a<this.pop();a++)e+=Math.pow(this.serie[a]-t,2);this.stat_variance=e/this.pop();if(round==true)this.stat_variance=Math.round(this.stat_variance*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength)}return this.stat_variance};this.stddev=function(e){e=typeof e==="undefined"?true:false;if(this._nodata())return;if(this.stat_stddev==null){this.stat_stddev=Math.sqrt(this.variance());if(e==true)this.stat_stddev=Math.round(this.stat_stddev*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength)}return this.stat_stddev};this.cov=function(e){e=typeof e==="undefined"?true:false;if(this._nodata())return;if(this.stat_cov==null){this.stat_cov=this.stddev()/this.mean();if(e==true)this.stat_cov=Math.round(this.stat_cov*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength)}return this.stat_cov};this.resetStatistics=function(){this.stat_sorted=null;this.stat_mean=null;this.stat_median=null;this.stat_sum=null;this.stat_max=null;this.stat_min=null;this.stat_pop=null;this.stat_variance=null;this.stat_stddev=null;this.stat_cov=null};this._nodata=function(){if(this.serie.length==0){if(this.silent)this.log("[silent mode] Error. You should first enter a serie!",true);else throw new TypeError("Error. You should first enter a serie!");return 1}else return 0};this._hasNegativeValue=function(){for(i=0;i<this.serie.length;i++)if(this.serie[i]<0)return true;return false};this._hasZeroValue=function(){for(i=0;i<this.serie.length;i++)if(parseFloat(this.serie[i])===0)return true;return false};this.sorted=function(){if(this.stat_sorted==null)if(this.is_uniqueValues==false)this.stat_sorted=this.serie.sort(function(e,t){return e-t});else this.stat_sorted=this.serie.sort(function(e,t){var a=e.toString().toLowerCase(),i=t.toString().toLowerCase();if(a<i)return-1;if(a>i)return 1;return 0});return this.stat_sorted};this.info=function(){if(this._nodata())return;var e="";e+=A("Population")+" : "+this.pop()+" - ["+A("Min")+" : "+this.min()+" | "+A("Max")+" : "+this.max()+"]"+"\n";e+=A("Mean")+" : "+this.mean()+" - "+A("Median")+" : "+this.median()+"\n";e+=A("Variance")+" : "+this.variance()+" - "+A("Standard deviation")+" : "+this.stddev()+" - "+A("Coefficient of variation")+" : "+this.cov()+"\n";return e};this.setClassManually=function(e){if(this._nodata())return;if(e[0]!==this.min()||e[e.length-1]!==this.max()){if(this.silent)this.log("[silent mode] "+t("Given bounds may not be correct! please check your input.\nMin value : "+this.min()+" / Max value : "+this.max()),true);else throw new TypeError(A("Given bounds may not be correct! please check your input.\nMin value : "+this.min()+" / Max value : "+this.max()));return}this.setBounds(e);this.setRanges();this.method=A("manual classification")+" ("+(e.length-1)+" "+A("classes")+")";return this.bounds};this.getClassEqInterval=function(e,t,a){if(this._nodata())return;var r=typeof t==="undefined"?this.min():t;var n=typeof a==="undefined"?this.max():a;var o=Array();var s=r;var l=(n-r)/e;for(i=0;i<=e;i++){o[i]=s;s+=l}o[e]=n;this.setBounds(o);this.setRanges();this.method=A("eq. intervals")+" ("+e+" "+A("classes")+")";return this.bounds};this.getQuantiles=function(e){var t=this.sorted();var a=[];var i=this.pop()/e;for(var r=1;r<e;r++){var n=Math.round(r*i+.49);a.push(t[n-1])}return a};this.getClassQuantile=function(e){if(this._nodata())return;var t=this.sorted();var a=this.getQuantiles(e);a.unshift(t[0]);if(a[t.length-1]!==t[t.length-1])a.push(t[t.length-1]);this.setBounds(a);this.setRanges();this.method=A("quantile")+" ("+e+" "+A("classes")+")";return this.bounds};this.getClassStdDeviation=function(e,t){if(this._nodata())return;var a=this.max();var r=this.min();var n=Array();if(e%2==1){var o=Math.floor(e/2);var s=o+1;n[o]=this.mean()-this.stddev()/2;n[s]=this.mean()+this.stddev()/2;for(i=o-1;i>0;i--){var l=n[i+1]-this.stddev();n[i]=l}for(i=s+1;i<e;i++){var l=n[i-1]+this.stddev();n[i]=l}}else{var c=e/2;n[c]=this.mean();for(i=c-1;i>0;i--){var l=n[i+1]-this.stddev();n[i]=l}for(i=c+1;i<e;i++){var l=n[i-1]+this.stddev();n[i]=l}}n[0]=typeof t==="undefined"?n[1]-this.stddev():this.min();n[e]=typeof t==="undefined"?n[e-1]+this.stddev():this.max();this.setBounds(n);this.setRanges();this.method=A("std deviation")+" ("+e+" "+A("classes")+")";return this.bounds};this.getClassGeometricProgression=function(e){if(this._nodata())return;if(this._hasNegativeValue()||this._hasZeroValue()){if(this.silent)this.log("[silent mode] "+A("geometric progression can't be applied with a serie containing negative or zero values."),true);else throw new TypeError(A("geometric progression can't be applied with a serie containing negative or zero values."));return}var t=Array();var a=this.min();var r=this.max();var n=Math.log(r)/Math.LN10;var o=Math.log(a)/Math.LN10;var s=(n-o)/e;for(i=0;i<e;i++)if(i==0)t[i]=o;else t[i]=t[i-1]+s;t=t.map(function(e){return Math.pow(10,e)});t.push(this.max());this.setBounds(t);this.setRanges();this.method=A("geometric progression")+" ("+e+" "+A("classes")+")";return this.bounds};this.getClassArithmeticProgression=function(e){if(this._nodata())return;var t=0;for(i=1;i<=e;i++)t+=i;var a=Array();var r=this.min();var n=this.max();var o=(n-r)/t;for(i=0;i<=e;i++)if(i==0)a[i]=r;else a[i]=a[i-1]+i*o;this.setBounds(a);this.setRanges();this.method=A("arithmetic progression")+" ("+e+" "+A("classes")+")";return this.bounds};this.getClassJenks=function(e){if(this._nodata())return;dataList=this.sorted();var t=[];for(var a=0,i=dataList.length+1;a<i;a++){var r=[];for(var n=0,o=e+1;n<o;n++)r.push(0);t.push(r)}var s=[];for(var l=0,c=dataList.length+1;l<c;l++){var u=[];for(var h=0,p=e+1;h<p;h++)u.push(0);s.push(u)}for(var d=1,f=e+1;d<f;d++){t[0][d]=1;s[0][d]=0;for(var m=1,y=dataList.length+1;m<y;m++)s[m][d]=Infinity;var g=0}for(var v=2,b=dataList.length+1;v<b;v++){var x=0;var w=0;var S=0;for(var P=1,_=v+1;P<_;P++){var C=v-P+1;var T=parseFloat(dataList[C-1]);w+=T*T;x+=T;S+=1;g=w-x*x/S;var k=C-1;if(k!=0)for(var M=2,E=e+1;M<E;M++)if(s[v][M]>=g+s[k][M-1]){t[v][M]=C;s[v][M]=g+s[k][M-1]}}t[v][1]=1;s[v][1]=g}var O=dataList.length;var I=[];for(l=0;l<=e;l++)I.push(0);I[e]=parseFloat(dataList[dataList.length-1]);I[0]=parseFloat(dataList[0]);var L=e;while(L>=2){var D=parseInt(t[O][L]-2);I[L-1]=dataList[D];O=parseInt(t[O][L]-1);L-=1}if(I[0]==I[1])I[0]=0;this.setBounds(I);this.setRanges();this.method=A("Jenks")+" ("+e+" "+A("classes")+")";return this.bounds};this.getClassUniqueValues=function(){if(this._nodata())return;this.is_uniqueValues=true;var e=this.sorted();var t=Array();for(i=0;i<this.pop();i++)if(t.indexOf(e[i])===-1)t.push(e[i]);this.bounds=t;this.method=A("unique values");return t};this.getClass=function(e){for(i=0;i<this.bounds.length;i++)if(this.is_uniqueValues==true){if(e==this.bounds[i])return i}else if(parseFloat(e)<=this.bounds[i+1])return i;return A("Unable to get value's class.")};this.getRanges=function(){return this.ranges};this.getRangeNum=function(e){var t,a;for(a=0;a<this.ranges.length;a++){t=this.ranges[a].split(/ - /);if(e<=parseFloat(t[1]))return a}};this.getInnerRanges=function(){if(this.inner_ranges!=null)return this.inner_ranges;var e=new Array;var t=this.sorted();var a=1;for(i=0;i<t.length;i++){if(i==0)var r=t[i];if(parseFloat(t[i])>parseFloat(this.bounds[a])){e[a-1]=""+r+this.separator+t[i-1];var r=t[i];a++}if(a==this.bounds.length-1){e[a-1]=""+r+this.separator+t[t.length-1];this.inner_ranges=e;return this.inner_ranges}}};this.getSortedlist=function(){return this.sorted().join(", ")};this.getHtmlLegend=function(e,t,a,r,n,o){var s="";var l=new Array;this.doCount();if(e!=null)ccolors=e;else ccolors=this.colors;if(t!=null)lg=t;else lg="Legend";if(a!=null)getcounter=true;else getcounter=false;if(r!=null)fn=r;else fn=function(e){return e};if(n==null)n="default";if(n=="discontinuous"){this.getInnerRanges();if(this.counter.indexOf(0)!==-1){if(this.silent)this.log("[silent mode] "+A("Geostats cannot apply 'discontinuous' mode to the getHtmlLegend() method because some classes are not populated.\nPlease switch to 'default' or 'distinct' modes. Exit!"),true);else throw new TypeError(A("Geostats cannot apply 'discontinuous' mode to the getHtmlLegend() method because some classes are not populated.\nPlease switch to 'default' or 'distinct' modes. Exit!"));return}}if(o!=="DESC")o="ASC";if(ccolors.length<this.ranges.length){if(this.silent)this.log("[silent mode] "+A("The number of colors should fit the number of ranges. Exit!"),true);else throw new TypeError(A("The number of colors should fit the number of ranges. Exit!"));return}if(this.is_uniqueValues==false)for(i=0;i<this.ranges.length;i++){if(getcounter===true)s=' <span class="geostats-legend-counter">('+this.counter[i]+")</span>";var c=this.ranges[i].split(this.separator);var u=parseFloat(c[0]).toFixed(this.precision);var h=parseFloat(c[1]).toFixed(this.precision);if(n=="distinct"&&i!=0)if(m(u)){u=parseInt(u)+1;if(this.precisionflag=="manual"&&this.precision!=0)u=parseFloat(u).toFixed(this.precision)}else{u=parseFloat(u)+1/Math.pow(10,this.precision);u=parseFloat(u).toFixed(this.precision)}if(n=="discontinuous"){var c=this.inner_ranges[i].split(this.separator);var u=parseFloat(c[0]).toFixed(this.precision);var h=parseFloat(c[1]).toFixed(this.precision)}var p=fn(u)+this.legendSeparator+fn(h);var d='<div><div class="geostats-legend-block" style="background-color:'+ccolors[i]+'"></div> '+p+s+"</div>";l.push(d)}else for(i=0;i<this.bounds.length;i++){if(getcounter===true)s=' <span class="geostats-legend-counter">('+this.counter[i]+")</span>";var p=fn(this.bounds[i]);var d='<div><div class="geostats-legend-block" style="background-color:'+ccolors[i]+'"></div> '+p+s+"</div>";l.push(d)}if(o==="DESC")l.reverse();var f='<div class="geostats-legend"><div class="geostats-legend-title">'+A(lg)+"</div>";for(i=0;i<l.length;i++)f+=l[i];f+="</div>";return f};this.objectID=(new Date).getUTCMilliseconds();this.log("Creating new geostats object");if(typeof e!=="undefined"&&e.length>0){this.serie=e;this.setPrecision();this.log("Setting serie ("+e.length+") : "+e.join())}else this.serie=Array();this.getJenks=this.getClassJenks;this.getGeometricProgression=this.getClassGeometricProgression;this.getEqInterval=this.getClassEqInterval;this.getQuantile=this.getClassQuantile;this.getStdDeviation=this.getClassStdDeviation;this.getUniqueValues=this.getClassUniqueValues;this.getArithmeticProgression=this.getClassArithmeticProgression};return window.geostats=e}()},ka33:function(e,t,a){},l6bU:function(e,t,a){"use strict";var r=a("Lb6U"),f=a("4zwu"),i=a("zT9C"),m=a.n(i);function n(t,e){var a,i=Object.keys(t);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(t),e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,a)),i}function y(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach(function(e){var t,a;t=i,e=r[a=e],a in t?Object.defineProperty(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}i={data:function(){return{}},methods:{monitorEventLinkage:function(a,i,r,n,o){var s=this,e="linkage-".concat(i);this.$off("actionEventLinkage".concat(i),this[e]),this[e]=function(e){var t;i===e.triggerType&&(e=(t=s._getEventLinkageData(e,r,a,i,n,o)).datas,t=t.passingActionInfo,s.$store.dispatch("UPDATE_ACTION",{componentId:s.component.componentId,type:i,status:"active",datas:e,passingActionInfo:t}))},this.$on("actionEventLinkage".concat(i),this[e])},emitEventLinkage:function(e,t,a,i){e=r.a[e];!e||4<arguments.length&&void 0!==arguments[4]&&!arguments[4]||(t=this.$store.getters.getPassingActionInfoByActionId(t,e),this.$emit("actionEventLinkage".concat(e),{triggerType:e,dataId:a,data:i,from:t}))},getUpdateCondition:function(e,t,a){var i=this.$store.getters.getTargetIdBySourceId(this.component.componentId,t.actionId,e,t.targetAction);return!(a&&i&&a.find(function(e){return e.componentId===i}))},_getEventLinkageData:function(n,o,s,l,c,u){for(var h,p=this,e=this.$store.getters.getTriggerEventByComponentIdAndType(this.component.componentId,l)||{},d=(d=m()(e.datas)||[]).map(function(e){return e.blockEventLinkage=!0,e}),t=0;t<o.length;t++)(function(e){var t=o[e];if(t.config.sourceData.dataId!==n.dataId)return;var a=s[l].callback({features:c,actionEventParams:n},t,p),i=f.a.$options.updateFeature(a.feature,"".concat(p.component.componentId,"-").concat(l)),r=p.getUpdateCondition(l,t,a.passingActionInfo);h=a.passingActionInfo,delete a.feature,delete a.passingActionInfo,delete a.highlightOptions,r&&(r=-1<(e=d.findIndex(function(e){return e.actionId===t.actionId}))?1:0,e=-1<e?e:0,i=y(y({actionId:t.actionId},a),{},{featureId:(!u||-1!==u.indexOf(t.targetAction))&&i}),d.splice(e,r,i))})(t);return{datas:d,passingActionInfo:h}}}},a=a("KHd+"),i=Object(a.a)(i,void 0,void 0,!1,null,null,null);t.a=i.exports},o2tc:function(e){e.exports=JSON.parse('[{"name":"克拉玛依市","coord":[85.01486759299489,45.406422237230046]},{"name":"昌吉回族自治州","coord":[88.7154624754753,44.26991024636568]},{"name":"石河子市","coord":[86.0208600035924,44.239045558096805]},{"name":"霍林郭勒市","coord":[114.73479243733115,44.16058374713977]},{"name":"本溪市","coord":[124.64357865201586,41.177197783134275]},{"name":"嘉峪关市","coord":[98.16891560537093,39.76279786284264]},{"name":"莱芜市","coord":[117.65723565456207,36.27916499211527]},{"name":"神农架林区","coord":[110.48296222218153,31.581260143666697]},{"name":"天门市","coord":[113.00615321481195,30.64105781887143]},{"name":"鄂州市","coord":[114.94764081970385,30.325634953844585]},{"name":"潜江市","coord":[112.70703817700621,30.349210666019893]},{"name":"仙桃市","coord":[113.34688900729822,30.315951161935402]},{"name":"萍乡市","coord":[113.88072263074415,27.47193090553213]},{"name":"台湾省","coord":[120.14338943402045,23.596002465926095]},{"name":"东莞市","coord":[113.89443658529342,22.897826158636448]},{"name":"中山市","coord":[113.37118387764659,22.501478858616522]},{"name":"珠海市","coord":[113.21799258934986,22.23782602992192]},{"name":"北海市","coord":[109.18248083043899,21.695773689750148]},{"name":"香港","coord":[114.20689279508653,22.36016760139811]},{"name":"舟山市","coord":[122.22514712841459,30.338633120695956]},{"name":"克孜勒苏柯尔克孜","coord":[74.62910472637343,39.59886016069875]},{"name":"喀什地区","coord":[77.19899922143753,37.85462871211595]},{"name":"阿克苏地区","coord":[81.43930290016381,41.067304799230456]},{"name":"和田地区","coord":[80.69780509160952,36.95287032287055]},{"name":"阿里地区","coord":[82.536487505389,32.69566569631762]},{"name":"日喀则地区","coord":[86.5996831353606,29.54861754814263]},{"name":"那曲地区","coord":[88.32523292667608,33.20600450932715]},{"name":"玉树藏族自治州","coord":[95.2107128446203,33.90320387919257]},{"name":"迪庆藏族自治州","coord":[99.42465312188943,28.052797714348895]},{"name":"怒江傈傈族自治州","coord":[98.85737910439825,26.98345757528851]},{"name":"大理白族自治州","coord":[99.93934374816013,25.684737357453045]},{"name":"德宏傣族景颇族自","coord":[98.13830877778075,24.593421919561205]},{"name":"保山市","coord":[99.19031013453166,24.979380341662]},{"name":"临沧市","coord":[99.62483778975081,24.058807858948214]},{"name":"普洱市","coord":[100.94440267992684,23.44121660743221]},{"name":"西双版纳傣族自治","coord":[100.86105801845994,21.882475641324206]},{"name":"拉萨市","coord":[91.3684790613129,30.14176592960237]},{"name":"山南地区","coord":[92.11665242621062,28.33000201578789]},{"name":"林芝地区","coord":[94.9307847458166,29.125110156601963]},{"name":"昌都地区","coord":[97.33912235873476,30.48520825551814]},{"name":"丽江市","coord":[100.65713436205135,26.96190318191959]},{"name":"攀枝花市","coord":[101.73355913301131,26.714486678752795]},{"name":"凉山彝族自治州","coord":[102.08678551422615,27.683020519860396]},{"name":"楚雄彝族自治州","coord":[101.68264761198458,25.369603845264024]},{"name":"红河哈尼族彝族自","coord":[102.95101719613119,23.624860095239875]},{"name":"文山壮族苗族自治","coord":[104.8708359910614,23.579587266862504]},{"name":"百色市","coord":[106.69546907589859,23.98220841166522]},{"name":"崇左市","coord":[107.3277087317123,22.49769755349952]},{"name":"防城港市","coord":[107.88939931155171,21.94550204069006]},{"name":"南宁市","coord":[108.67078983716917,23.12207641861882]},{"name":"钦州市","coord":[108.8532307305186,22.157690108421384]},{"name":"玉林市","coord":[110.26918466489103,22.391823643610415]},{"name":"湛江市","coord":[109.93033457863683,21.086751055633457]},{"name":"茂名市","coord":[110.80336192333934,22.069184739040775]},{"name":"阳江市","coord":[111.70471342186183,22.108751366417575]},{"name":"江门市","coord":[112.53715618649149,22.297368082806777]},{"name":"广州市","coord":[113.4949302208309,23.28359314707863]},{"name":"清远市","coord":[113.10957368131268,24.334444053233856]},{"name":"肇庆市","coord":[112.11117530204233,23.60241158796112]},{"name":"梧州市","coord":[111.01709510772797,23.518132876753846]},{"name":"贺州市","coord":[111.50423061842756,24.4095096817199]},{"name":"桂林市","coord":[110.44046163393094,25.353966673735407]},{"name":"柳州市","coord":[109.34854449214147,24.972408051485047]},{"name":"河池市","coord":[107.81191841865586,24.649291651298164]},{"name":"黔东南苗族侗族自","coord":[108.39952601614591,26.429286420465576]},{"name":"贵阳市","coord":[106.59784062851153,26.797907456479816]},{"name":"安顺市","coord":[105.76161265300635,25.988644902171018]},{"name":"黔西南布依族苗族","coord":[105.5954078788574,25.404850939549405]},{"name":"曲靖市","coord":[103.9164335632742,25.697243690315265]},{"name":"六盘水市","coord":[104.77723228072432,26.15402255629164]},{"name":"毕节地区","coord":[105.03867422931839,27.077913968069666]},{"name":"昭通市","coord":[104.29730513046874,27.62418247971078]},{"name":"宜宾市","coord":[104.76748901448207,28.553501804266475]},{"name":"乐山市","coord":[103.56027669102787,29.160754519210577]},{"name":"自贡市","coord":[104.63272827056402,29.273152614922402]},{"name":"内江市","coord":[104.82644562304716,29.61272653799929]},{"name":"遵义市","coord":[106.82413636302059,28.191847588570702]},{"name":"达州市","coord":[107.59704170009518,31.32138258839703]},{"name":"遂宁市","coord":[105.48979445433736,30.677687821242678]},{"name":"广安市","coord":[106.56708164098042,30.43500706741521]},{"name":"泸州市","coord":[105.42591761727707,28.50277238478137]},{"name":"资阳市","coord":[104.97995126874034,30.154251886139654]},{"name":"雅安市","coord":[102.69931299964517,29.892630706195035]},{"name":"眉山市","coord":[104.07052881858888,29.894202166560405]},{"name":"甘孜藏族自治州","coord":[100.50721042614238,30.975216556269658]},{"name":"果洛藏族自治州","coord":[99.30775565051923,34.03539865224808]},{"name":"海南藏族自治州","coord":[100.39969108016373,35.90048272566899]},{"name":"黄南藏族自治州","coord":[101.5360706381689,35.10286360841902]},{"name":"赣南藏族自治州","coord":[102.97083885806067,34.326752803339026]},{"name":"陇南市","coord":[105.24780098912132,33.57031117443431]},{"name":"天水市","coord":[105.53503634660417,34.62320421368087]},{"name":"定西市","coord":[104.58787768541339,35.08900966621695]},{"name":"临夏回族自治州","coord":[103.2612870434902,35.591577124455235]},{"name":"西宁市","coord":[101.57680657999033,36.84800271717157]},{"name":"海东地区","coord":[102.30909850729282,36.287400615025646]},{"name":"海北藏族自治州","coord":[100.27122484450717,37.892557516083826]},{"name":"金昌市","coord":[102.02244049169511,38.497330414886164]},{"name":"酒泉市","coord":[95.94486678270127,40.56891536586272]},{"name":"海西蒙古族藏族自","coord":[94.67143298050689,36.022725148503724]},{"name":"巴音郭楞蒙古自治","coord":[88.18116214759745,39.556478810319916]},{"name":"哈密地区","coord":[93.84302392518026,42.95015211178875]},{"name":"叶鲁番地区","coord":[89.82035217277885,42.399368632283505]},{"name":"乌鲁木齐市","coord":[88.00048109561487,43.549986370786]},{"name":"阿勒泰地区","coord":[88.11213933257655,47.05593413019629]},{"name":"博尔塔拉蒙古自治","coord":[82.26402238163408,44.671135542630864]},{"name":"伊犁哈萨克自治州","coord":[82.80778717477179,43.53783381365267]},{"name":"阿拉善盟","coord":[103.29923966842289,40.10955801781495]},{"name":"武威市","coord":[102.73362058791429,37.94211141321436]},{"name":"兰州市","coord":[103.73793563506032,36.27379827886003]},{"name":"中卫市","coord":[105.6943786030716,37.20654236148948]},{"name":"银川市","coord":[106.20022174140034,38.52103167597483]},{"name":"石嘴山市","coord":[106.41544011793628,38.84054137571417]},{"name":"乌海市","coord":[106.8984175998405,39.54616572239788]},{"name":"鄂尔多斯市","coord":[108.43285571424619,39.24036799350715]},{"name":"巴彦淖尔市","coord":[107.45840392808307,41.30159860424196]},{"name":"包头市","coord":[110.46472193224272,41.48017783644221]},{"name":"呼和浩特市","coord":[111.48365173603975,40.498363056149884]},{"name":"乌兰察布市","coord":[112.61568977597707,41.75789561273154]},{"name":"大同市","coord":[113.7107192749083,39.898956799744184]},{"name":"朔州市","coord":[112.65428748167508,39.681772914701924]},{"name":"忻州市","coord":[112.36127575589583,38.88990233614568]},{"name":"榆林市","coord":[109.68473112169593,38.19921027134876]},{"name":"延安市","coord":[109.52425222161318,36.406522726136814]},{"name":"庆阳市","coord":[107.73052193155061,36.183821532624464]},{"name":"固原市","coord":[106.20191575442442,36.11634909496382]},{"name":"白银市","coord":[104.68634478137065,36.51582865625868]},{"name":"宝鸡市","coord":[107.33534779230747,34.3387216485855]},{"name":"汉中市","coord":[107.03534754266246,33.00142998064871]},{"name":"广元市","coord":[105.92928137563939,32.21872447205537]},{"name":"巴中市","coord":[107.03422410306194,31.99874720836291]},{"name":"南充市","coord":[106.32964805032347,31.156657700184095]},{"name":"绵阳市","coord":[104.58949560201106,31.88628780630976]},{"name":"德阳市","coord":[104.41542984932845,31.110558133718676]},{"name":"成都市","coord":[103.8852290010473,30.777258040348634]},{"name":"阿坝藏族羌族自治","coord":[102.26209319552814,32.45725845387284]},{"name":"安康市","coord":[109.14236501848015,32.77467694678074]},{"name":"十堰市","coord":[110.39934083416314,32.376209039347906]},{"name":"襄阳市","coord":[111.97539147094662,31.93399822417465]},{"name":"宜昌市","coord":[111.22204852395754,30.772457669035354]},{"name":"恩施市","coord":[109.42158366502872,30.260366574390105]},{"name":"张家界市","coord":[110.59760006538717,29.330107409240718]},{"name":"吉首市","coord":[109.72176899848378,28.681903937242495]},{"name":"铜仁地区","coord":[108.54247523485463,28.11736237519646]},{"name":"重庆市","coord":[107.86007108564992,30.186253395053196]},{"name":"怀化市","coord":[109.94325166787243,27.43919084801186]},{"name":"益阳市","coord":[112.43060358108062,28.75127294553697]},{"name":"娄底市","coord":[111.41891416951897,27.696312460064604]},{"name":"常德市","coord":[111.72571610131646,29.27189463838195]},{"name":"荆州市","coord":[112.65896596965268,30.05161542755362]},{"name":"荆门市","coord":[112.6586855902184,31.01267124474617]},{"name":"岳阳市","coord":[113.2595036144316,29.106247116930163]},{"name":"长沙市","coord":[113.15415586456598,28.222934680488425]},{"name":"湘潭市","coord":[112.51092596317824,27.69881544105668]},{"name":"株州市","coord":[113.49665538546823,27.03993794610501]},{"name":"衡阳市","coord":[112.48849636578527,26.783613569970782]},{"name":"邵阳市","coord":[110.6723832117475,26.81652287086792]},{"name":"永州市","coord":[111.8565364154186,25.768488267811968]},{"name":"韶关市","coord":[113.53420325850979,24.69848878771937]},{"name":"惠州市","coord":[114.32029589634925,23.25504544231892]},{"name":"佛山市","coord":[112.95925897403649,23.10116677189257]},{"name":"云浮市","coord":[111.78042514904234,22.840400494105687]},{"name":"深圳市","coord":[114.13138648919008,22.649563063468342]},{"name":"汕尾市","coord":[115.57412892884373,23.06989642104901]},{"name":"河源市","coord":[114.89746229844398,23.97971937124767]},{"name":"揭阳市","coord":[116.04290004239446,23.304802704715357]},{"name":"汕头市","coord":[116.7008461897183,23.35898625947344]},{"name":"潮州市","coord":[116.75405548481658,23.854381508863064]},{"name":"梅州市","coord":[116.13719397345734,24.15633544812716]},{"name":"漳州市","coord":[117.38279760543345,24.41111215459575]},{"name":"厦门市","coord":[118.04275971554665,24.675908246507944]},{"name":"龙岩市","coord":[116.69341144552507,25.20284542644492]},{"name":"泉州市","coord":[118.12035864630246,25.22984144365049]},{"name":"莆田市","coord":[118.82439690138142,25.439653480972687]},{"name":"福州市","coord":[119.1608285845262,25.99117532466728]},{"name":"三明市","coord":[117.51188176216434,26.318292906961602]},{"name":"南平市","coord":[118.16153136678187,27.306303151805437]},{"name":"抚州市","coord":[116.3455359885574,27.487043655935366]},{"name":"鹰潭市","coord":[117.01082360702333,28.241253742969946]},{"name":"吉安市","coord":[114.91377151807418,26.957486660664525]},{"name":"赣州市","coord":[115.046455717572,25.81565075681663]},{"name":"郴州市","coord":[113.1544526703492,25.871927095452524]},{"name":"新余市","coord":[114.94161795877827,27.79044654578371]},{"name":"宜春市","coord":[115.04574494880995,28.306428044943356]},{"name":"南昌市","coord":[115.9963824234495,28.664803351584705]},{"name":"九江市","coord":[115.53225905704193,29.362905920276297]},{"name":"上饶市","coord":[117.8595355766598,28.765755150094634]},{"name":"景德镇市","coord":[117.25387030721845,29.33426823662448]},{"name":"黄山市","coord":[117.85476357809696,29.969632034273722]},{"name":"池州市","coord":[117.34517113140791,30.208089337922335]},{"name":"铜陵市","coord":[117.93160431300694,30.926442655001676]},{"name":"安庆市","coord":[116.54307680610799,30.524265461641296]},{"name":"黄石市","coord":[115.02354597728443,29.924060229331015]},{"name":"咸宁市","coord":[114.26967602231792,29.652174021136048]},{"name":"黄冈市","coord":[115.2859016705373,30.65856897065683]},{"name":"武汉市","coord":[114.34552076948799,30.68836237966767]},{"name":"随州市","coord":[113.3850627838818,31.87891659924412]},{"name":"信阳市","coord":[114.81374730587638,32.0309685135914]},{"name":"驻马店市","coord":[114.07756451509235,32.896720987266114]},{"name":"商洛市","coord":[109.82044421310393,33.77403373563189]},{"name":"西安市","coord":[109.11839808451401,34.225257215515896]},{"name":"渭南市","coord":[109.75732444226935,35.025913644359306]},{"name":"铜川市","coord":[108.98695328111377,35.19235092947735]},{"name":"咸阳市","coord":[108.36398776446165,34.84311348287181]},{"name":"三门峡市","coord":[110.80049688104964,34.31818709571671]},{"name":"运城市","coord":[111.1736679525165,35.19010372283576]},{"name":"洛阳市","coord":[111.87577573098216,34.33379926109848]},{"name":"平顶山市","coord":[112.80931281928427,33.759895800153096]},{"name":"漯河市","coord":[113.83505724178012,33.70034266174508]},{"name":"许昌市","coord":[113.78762484088509,34.051835688452435]},{"name":"郑州市","coord":[113.49619951867594,34.61181797865449]},{"name":"焦作市","coord":[113.13404280173008,35.134167097471625]},{"name":"晋城市","coord":[112.7495732073233,35.63186423091449]},{"name":"长治市","coord":[112.85900842873183,36.45872910742828]},{"name":"临汾市","coord":[111.49379787924448,36.22810800777857]},{"name":"太原市","coord":[112.15628804033796,37.91704444063036]},{"name":"吕梁市","coord":[111.31901105774872,37.712740463356496]},{"name":"晋中市","coord":[113.08199599739676,37.36532613794343]},{"name":"邯郸市","coord":[114.41824047234618,36.530119932543315]},{"name":"安阳市","coord":[113.88883283163116,35.7797611183252]},{"name":"鹤壁市","coord":[114.3654094911545,35.75770487428472]},{"name":"新乡市","coord":[113.9184107718167,35.348471214026716]},{"name":"开封市","coord":[114.52801677500626,34.61371216679872]},{"name":"周口市","coord":[114.88509782391864,33.69999759722657]},{"name":"阜阳市","coord":[115.44595951398213,32.98060371610532]},{"name":"淮南市","coord":[116.68941991880993,32.79972275772595]},{"name":"蚌埠市","coord":[117.38594715783302,33.106729536033896]},{"name":"淮北市","coord":[116.69651711889378,33.69527529383458]},{"name":"宿州市","coord":[117.30175405886838,33.943330421260015]},{"name":"亳州市","coord":[116.12410804185097,33.46769392946132]},{"name":"商丘市","coord":[115.59575176872548,34.28339840831147]},{"name":"菏泽市","coord":[115.53631974831816,35.197319393220624]},{"name":"濮阳市","coord":[115.3070485514902,35.775883510964334]},{"name":"聊城市","coord":[115.8870069012884,36.40529594548765]},{"name":"邢台市","coord":[114.74259008644859,37.251396750084155]},{"name":"石家庄市","coord":[114.56923838363613,38.13141710980106]},{"name":"阳泉市","coord":[113.39216149668508,38.09075470547468]},{"name":"保定市","coord":[115.261524468934,39.09118520781398]},{"name":"衡水市","coord":[115.8182936677897,37.715661598187154]},{"name":"德州市","coord":[116.4582273790399,37.19372347888644]},{"name":"沧州市","coord":[116.76192710911863,38.20240042039232]},{"name":"廊坊市","coord":[116.50410772133856,39.27896741763884]},{"name":"天津市","coord":[117.31988934444873,39.37154482470619]},{"name":"北京市","coord":[116.59734730757869,40.237112944270976]},{"name":"张家口市","coord":[115.1823606483226,40.83732566607167]},{"name":"唐山市","coord":[117.8693184261954,39.71862889477249]},{"name":"秦皇岛市","coord":[119.30467355367742,39.990574652162564]},{"name":"承德市","coord":[117.16275671911026,41.36623845548547]},{"name":"葫芦岛市","coord":[119.9342336210531,40.5628822626519]},{"name":"朝阳市","coord":[120.11853493535794,41.471852354885755]},{"name":"赤峰市","coord":[118.50943546234379,43.25452976059767]},{"name":"锦州市","coord":[121.5167549323861,41.45933087433065]},{"name":"营口市","coord":[122.58571915054674,40.42093503997384]},{"name":"丹东市","coord":[124.33549382902183,40.46369290272115]},{"name":"辽阳市","coord":[123.34064798039414,41.152331397771356]},{"name":"盘锦市","coord":[122.06718005354679,41.05573599862555]},{"name":"阜新市","coord":[121.93889757908204,42.27641773244204]},{"name":"鞍山市","coord":[122.78904432242356,40.77781183142038]},{"name":"沈阳市","coord":[122.99508899709724,42.1162195010079]},{"name":"铁岭市","coord":[124.23100515588399,42.72666083611828]},{"name":"扶顺市","coord":[124.46027188217573,41.82955407638859]},{"name":"通辽市","coord":[122.0729370657937,43.90889130864869]},{"name":"兴安盟","coord":[120.79456431092532,45.92003249442161]},{"name":"白城市","coord":[123.10619907715235,45.25475749267784]},{"name":"齐齐哈尔市","coord":[124.5462214659102,47.55395009317394]},{"name":"大兴安岭地区","coord":[124.50992855161529,52.18438447846694]},{"name":"黑河市","coord":[127.14721400335922,49.25080134026901]},{"name":"大庆市","coord":[124.40329830095243,46.401048760966745]},{"name":"绥化市","coord":[126.5214484055605,46.76992452194825]},{"name":"松原市","coord":[124.21244334807682,44.75779381338502]},{"name":"四平市","coord":[124.27839350328821,43.52139065090318]},{"name":"通化市","coord":[125.67392830706305,41.91771808663852]},{"name":"辽源市","coord":[125.33529527643432,42.758340204944986]},{"name":"吉林市","coord":[126.83350281902375,43.60730120049175]},{"name":"长春市","coord":[125.53597875970374,44.24624314701737]},{"name":"白山市","coord":[127.16780160322108,42.093893880305075]},{"name":"哈尔滨市","coord":[127.39125008786029,45.36200668820575]},{"name":"鹤岗市","coord":[130.4703811258197,47.66520688940109]},{"name":"伊春市","coord":[128.91240831703635,47.93833794565277]},{"name":"七台河市","coord":[131.2677920224311,45.945099776108584]},{"name":"鸡西市","coord":[132.38059153660274,45.722934218318535]},{"name":"双鸭山市","coord":[132.3184817002743,46.65813679030265]},{"name":"佳木斯市","coord":[132.26174446608726,47.17569713691394]},{"name":"呼伦贝尔市","coord":[122.3210739998419,50.18176996070858]},{"name":"孝感市","coord":[113.83749892135485,31.11757234692128]},{"name":"贵港市","coord":[110.07354588052804,23.380735604767374]},{"name":"黔南布依族苗族自","coord":[107.30931767543106,26.2976919432269]},{"name":"宁德市","coord":[119.52482556634342,27.013151692716413]},{"name":"温州市","coord":[120.30037042732202,27.8699145504001]},{"name":"台州市","coord":[120.88886782713843,28.670799172772313]},{"name":"丽水市","coord":[119.56796851966463,28.170268394477755]},{"name":"衢州市","coord":[118.79479802644406,28.865874397158763]},{"name":"金华市","coord":[119.99381920686633,29.093455548185744]},{"name":"绍兴市","coord":[120.46546691682343,29.69382513836818]},{"name":"宁波市","coord":[121.42142987830871,29.70001162878972]},{"name":"杭州市","coord":[119.4405685790891,29.87218307296989]},{"name":"宣城市","coord":[118.68748382914703,30.628143499626418]},{"name":"湖州市","coord":[119.98261306633574,30.7945175862809]},{"name":"嘉兴市","coord":[120.83889215988998,30.67538495499343]},{"name":"上海市","coord":[121.37534147322967,31.25628247908459]},{"name":"苏州市","coord":[120.6906182622391,31.381280695137775]},{"name":"无锡市","coord":[120.32182300914366,31.54113306724517]},{"name":"常州市","coord":[119.61953292830165,31.611878565375576]},{"name":"南京市","coord":[118.71890548838064,31.910863187910323]},{"name":"镇江市","coord":[119.42349332902813,31.97942313430778]},{"name":"合肥市","coord":[117.30651975617157,31.79407863049138]},{"name":"六安市","coord":[116.24668220575353,31.820846193819513]},{"name":"滁州市","coord":[117.88422385307969,32.51792621904418]},{"name":"泰州市","coord":[120.03124303305091,32.56503102346783]},{"name":"南通市","coord":[120.85599446760912,32.18496706099728]},{"name":"盐城市","coord":[120.01812490612667,33.54219948734023]},{"name":"淮安市","coord":[119.0749424205415,33.39203631772854]},{"name":"宿迁市","coord":[118.45404943216346,33.666258719120265]},{"name":"徐州市","coord":[117.77482249295966,34.30847766157078]},{"name":"济宁市","coord":[116.74147276546373,35.27488504351119]},{"name":"枣庄市","coord":[117.43359942491492,34.884162021736]},{"name":"连云港市","coord":[119.01553213785074,34.54316517587849]},{"name":"临沂市","coord":[118.31478835349617,35.28173079028279]},{"name":"日照市","coord":[119.14265350444272,35.54479073199592]},{"name":"青岛市","coord":[120.27779044405756,36.3464117375903]},{"name":"威海市","coord":[122.12963327195605,37.13879077904251]},{"name":"烟台市","coord":[120.7689567423966,37.19772002195597]},{"name":"潍坊市","coord":[119.02178548592039,36.49292234053931]},{"name":"淄博市","coord":[117.92936024367185,36.60871347163638]},{"name":"泰安市","coord":[116.93810893944303,36.0423330118612]},{"name":"济南市","coord":[117.34560282551296,36.769574973846304]},{"name":"东营市","coord":[118.4915054457184,37.52194690335787]},{"name":"滨州市","coord":[117.67610299757533,37.4439597758601]},{"name":"昆明市","coord":[102.93100245594789,25.481300763922075]},{"name":"玉溪市","coord":[102.23080854291823,24.156168324611663]},{"name":"塔城地区","coord":[83.60908162840168,45.3721852373893]},{"name":"张掖市","coord":[100.47710030600572,38.704239320458385]},{"name":"南阳市","coord":[112.1400670951149,33.03033276715801]},{"name":"扬州市","coord":[119.48949608990988,32.80956776339646]},{"name":"延边朝鲜族自治州","coord":[129.3577692895626,43.24968794080283]},{"name":"牡丹江市","coord":[129.87240796405672,44.7073040108322]},{"name":"澳门","coord":[113.56289691515346,22.14602596262204]},{"name":"吴忠市","coord":[106.76894508116403,37.72566765880316]},{"name":"来宾市","coord":[109.25592217010114,23.86346274681084]},{"name":"平凉市","coord":[107.0708132782897,35.30329631658711]},{"name":"马鞍山市","coord":[118.27245878467022,31.657727937739004]},{"name":"芜湖市","coord":[118.32992684415504,31.081688223101658]},{"name":"澄迈县","coord":[110.04198076060266,19.694955078668105]},{"name":"保亭黎族苗族自治","coord":[109.6055304964257,18.6101488675304]},{"name":"乐东黎族自治县","coord":[109.04051999525574,18.643137437909203]},{"name":"儋州市","coord":[109.3431358337404,19.550974957403195]},{"name":"定安县","coord":[110.38744429685676,19.47557074114284]},{"name":"屯昌县","coord":[110.00574767630334,19.367175093044388]},{"name":"白沙黎族自治县","coord":[109.36860737761768,19.214416393082217]},{"name":"琼中黎族苗族自治","coord":[109.86691465937548,19.073671135862682]},{"name":"东方市","coord":[108.86903802405428,19.017352815445214]},{"name":"昌江黎族自治县","coord":[108.9686431884767,19.182594167127824]},{"name":"海口市","coord":[110.420654296875,19.806565564640795]},{"name":"济源市","coord":[112.38051465474433,35.07958362422394]},{"name":"五指山市","coord":[109.53595187364496,18.832908264613966]},{"name":"大连市","coord":[121.96662235866603,39.444150542439914]},{"name":"文昌市三沙市","coord":[110.81828537536748,19.756501444162936]},{"name":"三亚市","coord":[109.38424600793707,18.39186315877128]},{"name":"万宁市","coord":[110.28485046979574,18.860240588635115]},{"name":"陵水黎族自治县","coord":[109.95577603229562,18.594712684620465]},{"name":"临高县","coord":[109.71915395436967,19.79420403032508]},{"name":"琼海市","coord":[110.41650700703043,19.22315873149372]}]')},oUIn:function(e,t,a){"use strict";var i=a("oTir"),r=a("dDBl"),n=a("qAG6"),i={name:"SmTablePopup",components:{SmTable:r.a},mixins:[i.a],props:{data:{type:Array,default:function(){return[]}},columns:{type:Array,default:function(){return[]}},splitLine:{type:Boolean,default:!0}},watch:{"collapseCardHeaderBgStyle.background":function(e){this.setTheadStyle("background",e)},"tablePopupBgStyle.background":function(e){Object(n.s)(e)},"headingTextColorStyle.color":function(e){this.setTheadStyle("color",e)}},mounted:function(){this.setTheadStyle("color",this.headingTextColorStyle.color),this.setTheadStyle("background",this.collapseCardHeaderBgStyle.background)},methods:{setTheadStyle:function(t,a){var e;!this.$el||(e=this.$el.querySelectorAll("tr > th"))&&e.forEach(function(e){e.style[t]=a})}}},a=a("KHd+"),i=Object(a.a)(i,function(){var e=this.$createElement,e=this._self._c||e;return e("div",{class:{"sm-component-table-popup":!0,"with-split-line":this.splitLine},style:[this.tablePopupBgStyle,this.getTextColorStyle]},[e("sm-table",{staticClass:"sm-component-table-popup__table",attrs:{"data-source":this.data,columns:this.columns,rowKey:function(e,t){return t},pagination:!1}})],1)},[],!1,null,null,null);t.a=i.exports},"pc/F":function(e,t,a){"use strict";a("ka33")},y7ZN:function(e,r,n){!function(e){var t,a;function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}
/*!
* 	   Copyright (c) 2016 @thinkinggis
* 	   Copyright© 2000-2017 SuperMap Software Co. Ltd
*     echartsLayer.
*     github: https://github.com/SuperMap/echartsLayer
*     license: MIT
*/
a=function(a){return n={},i.m=r=[function(e,t){e.exports=a},function(e,t,a){a(2);a=a(6);e.exports=a},function(e,t,a){t=function(e){return a(0).registerCoordinateSystem("GLMap",a(3)),a(4),a(5),a(0).registerAction({type:"GLMapRoam",event:"GLMapRoam",update:"updateLayout"},function(e,t){}),{version:"1.0.0"}}.call(t,a,t,e);void 0===t||(e.exports=t)},function(e,t,a){t=function(e){var r=a(0);function n(e,t){this._GLMap=e,this.dimensions=["lng","lat"],this._mapOffset=[0,0],this._api=t}return n.prototype.dimensions=["lng","lat"],n.prototype.setMapOffset=function(e){this._mapOffset=e},n.prototype.getBMap=function(){return this._GLMap},n.prototype.fixLat=function(e){return 90<=e?89.99999999999999:e<=-90?-89.99999999999999:e},n.prototype.dataToPoint=function(e){e[1]=this.fixLat(e[1]);var t=this._GLMap.project(e),e=this._mapOffset;return[t.x-e[0],t.y-e[1]]},n.prototype.pointToData=function(e){var t=this._mapOffset;return[(e=this._bmap.project([e[0]+t[0],e[1]+t[1]])).lng,e.lat]},n.prototype.getViewRect=function(){var e=this._api;return new r.graphic.BoundingRect(0,0,e.getWidth(),e.getHeight())},n.prototype.getRoamTransform=function(){return r.matrix.create()},n.prototype.prepareCustoms=function(e){var t=r.util,a=this.getViewRect();return{coordSys:{type:"GLMap",x:a.x,y:a.y,width:a.width,height:a.height},api:{coord:t.bind(this.dataToPoint,this),size:t.bind(function(n,o){return o=o||[0,0],t.map([0,1],function(e){var t=o[e],a=n[e]/2,i=[],r=[];return i[e]=t-a,r[e]=t+a,i[1-e]=r[1-e]=o[1-e],Math.abs(this.dataToPoint(i)[e]-this.dataToPoint(r)[e])},this)},this)}}},n.dimensions=n.prototype.dimensions,n.create=function(e,a){var i;e.eachComponent("GLMap",function(e){a.getZr().painter.getViewportRoot();var t=r.glMap;(i=new n(t,a)).setMapOffset(e.__mapOffset||[0,0]),e.coordinateSystem=i}),e.eachSeries(function(e){"GLMap"===e.get("coordinateSystem")&&(e.coordinateSystem=i)})},n}.call(t,a,t,e);void 0===t||(e.exports=t)},function(e,t,a){t=function(e){return a(0).extendComponentModel({type:"GLMap",getBMap:function(){return this.__GLMap},defaultOption:{roam:!1}})}.call(t,a,t,e);void 0===t||(e.exports=t)},function(e,t,a){t=function(e){return a(0).extendComponentView({type:"GLMap",render:function(i,e,r){function t(e,t){var a;n||(a=document.getElementsByClassName("mapboxgl-map")[0],a=[-parseInt(a.style.left,10)||0,-parseInt(a.style.top,10)||0],o.style.left=a[0]+"px",o.style.top=a[1]+"px",s.setMapOffset(a),i.__mapOffset=a,r.dispatchAction({type:"GLMapRoam"}))}var n=!0,a=echarts.glMap,o=r.getZr().painter.getViewportRoot(),s=i.coordinateSystem;function l(){n||r.dispatchAction({type:"GLMapRoam"})}a.off("move",this._oldMoveHandler),a.off("zoomend",this._oldZoomEndHandler),a.on("move",t),a.on("zoomend",l),this._oldMoveHandler=t,this._oldZoomEndHandler=l;i.get("roam");n=!1}})}.call(t,a,t,e);void 0===t||(e.exports=t)},function(e,t){function a(e){var t=e.getCanvasContainer();this._container=document.createElement("div"),this._container.style.width=e.getCanvas().style.width,this._container.style.height=e.getCanvas().style.height,this._container.setAttribute("id","echarts"),this._container.setAttribute("class","echartMap"),this._map=e,t.appendChild(this._container),this.chart=echarts.init(this._container),echarts.glMap=e,this.resize()}a.prototype.remove=function(){var t=this;this._map._listeners.move.forEach(function(e){"moveHandler"===e.name&&t._map.off("move",e)}),this._map._listeners.move.forEach(function(e){"zoomEndHandler"===e.name&&t._map.off("zoomend",e)}),this.chart.clear(),this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._map=void 0},a.prototype.resize=function(){var e=this;window.onresize=function(){e._container.style.width=e._map.getCanvas().style.width,e._container.style.height=e._map.getCanvas().style.height,e.chart.resize()}},e.exports=a}],i.c=n,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1);function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}var r,n},"object"===i(r)&&"object"===i(e)?e.exports=a(n("MT78")):(t=[n("MT78")],void 0===(a="function"==typeof(a=a)?a.apply(r,t):a)||(e.exports=a))}.call(this,n("YuTi")(e))}}]);