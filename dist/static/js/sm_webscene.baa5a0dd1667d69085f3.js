(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{"+5wz":function(e,t,n){"use strict";n.r(t);var c=n("oCYn"),o=n("YKMj"),i=n("hdLw"),s=n.n(i),r=(n("xKWM"),n("XaGS")),a=n.n(r);function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(n){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=y(n);return h(this,o?(e=y(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function h(e,t){if(t&&("object"===f(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(r,s.a.Evented);var e,t,n,c=l(r);function r(e,t,n){var o,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),o=c.call(this),e&&t?(o.Cesium=e,o.viewer=t,o.scene=t.scene,o.scanEffect=i.scanEffect||{status:!1,type:"noScan",centerPostion:{},period:2e3,speed:500},o.withCredentials=i.withCredentials||!1,o.position=i.position||{},o.setSceneUrl(n),o):h(o)}return e=r,(t=[{key:"setSceneUrl",value:function(e){e&&(0<=e.indexOf("iserver")?(this.sceneUrl=e,this._createScene()):this._getSceneInfo(e))}},{key:"setScanEffect",value:function(e){var t=this;a()(this.scanEffect,e)||("noScan"===(this.scanEffect=e).type?(this.scene&&(this.scene.scanEffect.show=!1),this.scene&&(this.scene.scanEffect.type=e.type)):setTimeout(function(){t.scene&&(t.scene.scanEffect.show=!0),t._startScan(e.type)},100))}},{key:"setPosition",value:function(e){var t;a()(this.position,e)||(this.position=e,this.scene&&e&&(t=this.scene.camera,this.scene.camera.setView({destination:e,orientation:{heading:t.heading,pitch:t.pitch,roll:t.roll}})))}},{key:"_getSceneInfo",value:function(e){var n=this;SuperMap.FetchRequest.get(e+".json",{},{withCredentials:this.withCredentials}).then(function(e){return e.json()}).then(function(e){var t=e.url;n.sceneUrl=t,n._checkPrivate(e)})}},{key:"_checkPrivate",value:function(e){var t=e.url,e=e.content,n=JSON.parse(e);if(!t)if(n.layers instanceof Array)this.sceneUrl=n.layers[0].url;else for(var o in n.layers){o=n.layers[o];if(0<o.length){this.sceneUrl=o[0].url;break}}this.sceneUrl&&this._createScene()}},{key:"_createScene",value:function(){var o=this;this.scene&&this.scene.layers.removeAll();var t=this._getSceneParam(),e=(e=t.sceneUrl).slice(0,e.indexOf("/rest/realspace")+15),e=this.scene.open(e);this.scene.fxaa=!0,this.Cesium.when.all(e,function(){var n=o.scene.camera;o.scene.camera.setView({destination:o.position.x&&o.position||o.Cesium.Cartesian3(n.position.x,n.position.y,n.position.z),orientation:{heading:n.heading,pitch:n.pitch,roll:n.roll}});var e=new o.Cesium.ScreenSpaceEventHandler(o.scene.canvas);e.setInputAction(function(e){var t=o._getSceneParam();t.position=new o.Cesium.Cartesian3(n.position.x,n.position.y,n.position.z),o.fire("viewerpositionchanged",{position:t.position}),t.scanEffect.status&&"noScan"!==t.scanEffect.type&&(e=e.position,e=o.scene.pickPosition(e),o.scene.scanEffect.centerPostion=e,t.scanEffect.centerPostion=e,o.scanEffect.centerPostion=e,o.fire("scanpositionchanged",{position:t.position}))},o.Cesium.ScreenSpaceEventType.LEFT_CLICK),e.setInputAction(function(){t.position=new o.Cesium.Cartesian3(n.position.x,n.position.y,n.position.z),o.fire("viewerpositionchanged",{position:t.position})},o.Cesium.ScreenSpaceEventType.LEFT_UP),t.scanEffect.status&&"noScan"!==t.scanEffect.type&&setTimeout(function(){o._startScan(t.scanEffect.type)},3e3),o.sceneParam=t})}},{key:"_getSceneParam",value:function(){return{sceneUrl:this.sceneUrl,position:null,scanEffect:{status:this.scanEffect.status||!1,type:this.scanEffect.type||this.scanEffect.status&&"circle"||"noScan",centerPostion:this.scanEffect.centerPostion||{},_period:this.scanEffect.period||2e3,speed:this.scanEffect.speed||500,color:null}}}},{key:"_startScan",value:function(e){var t=this.scene.camera;this.scene.scanEffect.show=!1,this.scene.scanEffect.mode="line"===e?this.Cesium.ScanEffectMode.LINE:this.Cesium.ScanEffectMode.CIRCLE,(this.sceneParam.scanEffect.centerPostion||this.scanEffect.centerPostion||{}).x?this.scene.scanEffect.centerPostion=this.scanEffect.centerPostion||this.sceneParam.scanEffect.centerPostion:(this.sceneParam.scanEffect.centerPostion=new this.Cesium.Cartesian3(t.position.x,t.position.y,t.position.z),this.scene.scanEffect.centerPostion=new this.Cesium.Cartesian3(t.position.x,t.position.y,t.position.z)),this.scene.scanEffect.color=this.Cesium.Color.CORNFLOWERBLUE,this.scene.scanEffect._period=parseFloat(this.scanEffect.period),this.scene.scanEffect.speed=parseFloat(this.scanEffect.speed),this.scene.scanEffect.show=!0}}])&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),r}();function b(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(n){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=E(n);return function(e,t){{if(t&&("object"===m(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,o?(e=E(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}i=function(e,t,n,o){var i,c=arguments.length,r=c<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":m(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(r=(c<3?i(r):3<c?i(t,n,r):i(t,n))||r);return 3<c&&r&&Object.defineProperty(t,n,r),r},r=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(i,c["default"]);var e,t,n,o=w(i);function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),o.apply(this,arguments)}return e=i,(t=[{key:"sceneUrlChaned",value:function(){this.WebSceneViewModel&&this.WebSceneViewModel.setSceneUrl(this.sceneUrl)}},{key:"scanEffectChaned",value:function(){this.WebSceneViewModel&&this.WebSceneViewModel.setScanEffect(this.options.scanEffect)}},{key:"positionChaned",value:function(){this.WebSceneViewModel&&this.WebSceneViewModel.setPosition(this.options.position)}},{key:"viewerPositionChanged",value:function(e){return e}},{key:"scanPositionChanged",value:function(e){return e}},{key:"ready",value:function(e){var t=e.Cesium,e=e.viewer;this.WebSceneViewModel=new d(t,e,this.sceneUrl,this.options),this.registerEvents()}},{key:"registerEvents",value:function(){var t=this;this.WebSceneViewModel.on("viewerpositionchanged",function(e){e=e.position;t.viewerPositionChanged(e)}),this.WebSceneViewModel.on("scanpositionchanged",function(e){e=e.position;t.scanPositionChanged(e)})}}])&&b(e.prototype,t),n&&b(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}();i([Object(o.Prop)()],r.prototype,"sceneUrl",void 0),i([Object(o.Prop)()],r.prototype,"cesiumPath",void 0),i([Object(o.Prop)()],r.prototype,"options",void 0),i([Object(o.Watch)("sceneUrl")],r.prototype,"sceneUrlChaned",null),i([Object(o.Watch)("options.scanEffect")],r.prototype,"scanEffectChaned",null),i([Object(o.Watch)("options.position")],r.prototype,"positionChaned",null),i([Object(o.Emit)()],r.prototype,"viewerPositionChanged",null),i([Object(o.Emit)()],r.prototype,"scanPositionChanged",null);r=i([Object(o.Component)({name:"SmWebScene"})],r),n=n("KHd+"),r=Object(n.a)(r,function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{staticClass:"sm-component-web-scene"},[e.sceneUrl?t("vc-viewer",{staticClass:"sm-component-web-scene__wrap",attrs:{cesiumPath:e.cesiumPath},on:{ready:e.ready}}):e._e()],1)},[],!1,null,null,null);t.default=r.exports}}]);